var Iy=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var kT=Iy(N=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const Ny=async t=>{const e=document.getElementById(t);e.width=window.innerWidth,e.height=window.innerHeight;const n=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),r=await n.requestDevice(),s=e.getContext("webgpu"),a=navigator.gpu.getPreferredCanvasFormat();s.configure({device:r,format:a,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,alphaMode:"premultiplied"});const u=r.limits;return console.log("✨%c ---- Aurora ---- ✨","color: yellowgreen"),console.log("%climits:","color:yellowgreen",u),{canvas:e,adapter:n,context:s,device:r,format:a}};Array.prototype.forEachDeep=function(t,e="children"){this.length!=0&&this.forEach((function(r){t(r),Array.isArray(r[e])&&r[e].forEachDeep(t)}).bind(this))};Array.prototype.pushWhile=function(){const[t,...e]=Array.from(arguments);t&&this.push(...e)};Array.prototype.split=function(t){const e=[];let n=[];return this.forEach((r,s,a)=>{n.push(r),n.length==t&&(e.push(n),n=[])}),e};function ei(t,e){const n=Math.ceil(t.length/e),r=[];for(let s=0;s<n;s++){const a=s*e,u=a+e,l=t.slice(a,u);r.push(l)}return r}const kc=new Set;function Gy(){let t;do t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)});while(kc.has(t));return kc.add(t),t}let zy=0;function Kf(){return++zy}function ti(t){return typeof t=="number"&&!isNaN(t)}class J{constructor(){if(arguments.length==1){const e=arguments[0];Array.isArray(e)?this.coeffs=e:ti(e)&&(this.coeffs=[e])}else this.coeffs=Array.from(arguments)}add(e){if(e instanceof J)if(this.coeffs.length!==0)if(e.coeffs.length!==0){const n=[],r=Math.max(this.coeffs.length,e.coeffs.length);for(let s=0;s<r;s++)n.push(0);return this.coeffs.forEach((s,a,u)=>{n[a+r-u.length]+=s}),e.coeffs.forEach((s,a,u)=>{n[a+r-u.length]+=s}),new J(...n)}else return this;else return e;else if(ti(e))return this.add(new J(e))}sub(e){if(e instanceof J)return this.add(e.mul(-1));if(ti(e))return this.sub(new J(e))}multiple(e){if(e instanceof J)if(this.coeffs.length!==0)if(e.coeffs.length!==0){const n=[];for(let r=0;r<this.coeffs.length+e.coeffs.length-1;r++)n.push(0);return this.coeffs.forEach((r,s)=>{e.coeffs.forEach((a,u)=>{n[s+u]+=r*a})}),new J(...n)}else return this;else return e;else if(ti(e))return this.multiple(new J(e))}mul(e){return this.multiple(e)}pow(e=1){let n=new J(1);for(let r=0;r<e;r++)n=n.mul(this);return n}valueOf(e){if(e!=null)return this.coeffs.reduce((n,r,s,a)=>n+=r*e**(a.length-1-s),0);console.error('[WARNING]: neccessary param is missing while calling function "valueOf"')}roots(e=0,n=1,r=8){const s=[this.coeffs];for(let u=this.coeffs.length;u>2;u--){const l=[];for(let f=s.at(-1).length-1;f>0;f--){const h=s.at(-1).length-1-f,p=f*s.at(-1)[h];l.push(p)}s.push(l)}s.reverse();let a=[];for(let u=0;u<s.length;u++){const l=[],f=[e,n],h=new J(...s[u]);a.length!=0&&f.push(...a.at(-1)),f.filter((g,v,y)=>y.indexOf(g)==v).filter(g=>g>=e&&g<=n).filter(g=>{const v=h.valueOf(g);return v==0&&l.push(g),v!=0}).toSorted((g,v)=>g-v).forEach((g,v,y)=>{const w=y[v-1];if(w!=null){const T=Eo(S=>h.valueOf(S),w,g,1/10**r);T!=null&&l.push(T)}}),a.push(l)}return a.at(-1).map(u=>Number(u.toFixed(r)))}}function ws(t,e,n){return t===e?t:t*(1-n)+e*n}function uo(t,e,n){return Math.min(Math.max(t,e),n)}function Ho(t){return t*180/Math.PI}function ve(t){return t*Math.PI/180}function Mc(t){return t=t%360,t<=0&&(t+=360),t}function xr(t){const e=t.reduce((a,u)=>{for(let l=0;l<u.length-1;l++){const f=[...u];for(let h=0;h<u.length-2;h++)f.push([0]);for(let h=0;h<l;h++)f.unshift(f.pop());a.push(f)}return a},[]),n=[];for(let a=0;a<(t[0].length-1)*2;a++)n.push(a);return Hy(n).reduce((a,u)=>{const l=qy(u),f=new J([Math.pow(-1,l)]),h=u.reduce((p,g,v)=>p.multiple(new J(e[v][g])),new J([1])).multiple(f);return a.add(h)},new J([0])).roots()}function Hy(t){const e=[];function n(r,s){if(s.length===t.length){e.push(s.slice());return}for(let a=0;a<r.length;a++){const u=s.concat(r[a]),l=r.slice(0,a).concat(r.slice(a+1));n(l,u)}}return n(t,[]),e}function qy(t){let e=0;const n=t.length;for(let r=0;r<n;r++)for(let s=r+1;s<n;s++)t[r]>t[s]&&e++;return e}function Kr(t,e,n){const r=[],s=e**2-4*t*n;return t==0?r.push(-n/e):s>0?r.push((-e+Math.sqrt(s))/t/2,(-e-Math.sqrt(s))/t/2):s==0&&r.push(-e/t/2),r}function Eo(t,e,n,r=1e-6){if(Math.abs(e-n)<r){const s=t(e),a=t(n);if(s*a<0)return(e+n)/2}else{const s=t(e),a=t(n);if(s*a<0){const u=(e+n)/2,l=t(u);return s*l<0?Eo(t,e,u,r):s*l>0?Eo(t,n,u,r):u}}}function ps(t,e,n){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=n,r}function Oo(){return We.isObject(arguments[0])?ps(...Object.values(arguments[0])):We.isArray(arguments[0])?ps(...arguments[0]):We.isNumber(arguments[0])?ps(...arguments):new Float32Array(3)}function br(t){let e=W.create();var n=t[0],r=t[1],s=t[2],a=n*n+r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Co(t,e){let n=W.create();return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Zf(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $f(t,e){let n=W.create();var r=t[0],s=t[1],a=t[2],u=e[0],l=e[1],f=e[2];return n[0]=s*f-a*l,n[1]=a*u-r*f,n[2]=r*l-s*u,n}function Wy(t,e){let n=W.create();var r=t[0],s=t[1],a=t[2];return n[0]=r*e[0]+s*e[3]+a*e[6],n[1]=r*e[1]+s*e[4]+a*e[7],n[2]=r*e[2]+s*e[5]+a*e[8],n}function Vy(t,e){if(!e)return Oo(t);let n=W.create();var r=t[0],s=t[1],a=t[2],u=e[3]*r+e[7]*s+e[11]*a+e[15];return u=u||1,n[0]=(e[0]*r+e[4]*s+e[8]*a+e[12])/u,n[1]=(e[1]*r+e[5]*s+e[9]*a+e[13])/u,n[2]=(e[2]*r+e[6]*s+e[10]*a+e[14])/u,n}function Xy(t,e){let n=W.create();return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Jf(t,e){let n=W.create();return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function Yy(t,e,n){let r=W.create();return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function Ky(t,e,n){if(t=br(t),e=br(e),n){n=br(n);let r=br($f(t,e));if(uo(W.dot(n,r),-1,1)===-1)return-Math.acos(uo(W.dot(t,e),-1,1))}return Math.acos(uo(W.dot(t,e),-1,1))}function Bc(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Fo(t,e){return e=br(e),Jf(e,Zf(t,e))}function Pc(t,e){let n=Fo(t,e);return Co(t,n)}const W={len:Bc,length:Bc,fromValues:ps,create:Oo,cv3:Oo,normalize:br,add:Xy,scale:Jf,scaleAndAdd:Yy,subtract:Co,sub:Co,dot:Zf,cross:$f,transformMat3:Wy,transformMat4:Vy,angle:Ky,proj:Fo,projection:Fo,perp:Pc,perpendicular:Pc},Zy=1e-6;function tr(){var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function $y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qf(t,e){let n=Me.create();var r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],f=t[5],h=t[6],p=t[7],g=t[8],v=t[9],y=t[10],w=t[11],T=t[12],S=t[13],O=t[14],C=t[15],F=e[0],U=e[1],_=e[2],z=e[3];return n[0]=F*r+U*l+_*g+z*T,n[1]=F*s+U*f+_*v+z*S,n[2]=F*a+U*h+_*y+z*O,n[3]=F*u+U*p+_*w+z*C,F=e[4],U=e[5],_=e[6],z=e[7],n[4]=F*r+U*l+_*g+z*T,n[5]=F*s+U*f+_*v+z*S,n[6]=F*a+U*h+_*y+z*O,n[7]=F*u+U*p+_*w+z*C,F=e[8],U=e[9],_=e[10],z=e[11],n[8]=F*r+U*l+_*g+z*T,n[9]=F*s+U*f+_*v+z*S,n[10]=F*a+U*h+_*y+z*O,n[11]=F*u+U*p+_*w+z*C,F=e[12],U=e[13],_=e[14],z=e[15],n[12]=F*r+U*l+_*g+z*T,n[13]=F*s+U*f+_*v+z*S,n[14]=F*a+U*h+_*y+z*O,n[15]=F*u+U*p+_*w+z*C,n}function Jy(){return Array.from(arguments).reduce((t,e)=>Qf(t,e),tr())}function Qy(t){let e=Me.create();var n=t[0],r=t[1],s=t[2],a=t[3],u=n*n+r*r+s*s+a*a,l=u?1/u:0;return e[0]=-n*l,e[1]=-r*l,e[2]=-s*l,e[3]=a*l,e}function jy(t,e,n){let r=Me.create(),s=W.fromValues(...t),a=W.fromValues(...e),u=W.fromValues(...n),l=W.normalize(W.subtract(s,a)),f=W.normalize(W.cross(u,l)),h=W.normalize(W.cross(l,f));return r[0]=f[0],r[1]=h[0],r[2]=l[0],r[4]=f[1],r[5]=h[1],r[6]=l[1],r[8]=f[2],r[9]=h[2],r[10]=l[2],r[12]=-(f[0]*t[0]+f[1]*t[1]+f[2]*t[2]),r[13]=-(h[0]*t[0]+h[1]*t[1]+h[2]*t[2]),r[14]=-(l[0]*t[0]+l[1]*t[1]+l[2]*t[2]),r}function Dc(t,e,n,r,s,a){let u=Me.create();var l=1/(t-e),f=1/(n-r),h=1/(s-a);return u[0]=-2*l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*f,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=h,u[11]=0,u[12]=(t+e)*l,u[13]=(r+n)*f,u[14]=s*h,u[15]=1,u}function ex(t,e,n,r,s,a){let u=Me.create();var l=1/(t-e),f=1/(n-r),h=1/(s-a);return u[0]=-2*l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*f,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*h,u[11]=0,u[12]=(t+e)*(t-e),u[13]=(r+n)*(n-r),u[14]=(a+s)*(s-a),u[15]=1,u}function Ic(t,e,n,r){var s=Me.create(),a=1/Math.tan(t/2);return s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n+r/(n-r)||-1,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*n*r/(n-r)||-n,s[15]=0,s}function tx(t,e,n,r){let s=Me.create(),a=1/Math.tan(t/2),u;return s[0]=a/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,r!=null&&r!==1/0?(u=1/(n-r),s[10]=(r+n)*u,s[14]=2*r*n*u):(s[10]=-1,s[14]=-2*n),s}function nx(t,e){let n=Me.create();var r=t[0],s=t[1],a=t[2],u=Math.hypot(r,s,a),l,f,h;return u<Zy?null:(u=1/u,r*=u,s*=u,a*=u,l=Math.sin(e),f=Math.cos(e),h=1-f,n[0]=r*r*h+f,n[1]=s*r*h+a*l,n[2]=a*r*h-s*l,n[3]=0,n[4]=r*s*h-a*l,n[5]=s*s*h+f,n[6]=a*s*h+r*l,n[7]=0,n[8]=r*a*h+s*l,n[9]=s*a*h-r*l,n[10]=a*a*h+f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function rx(t,e){let n=tr(),r=e[0],s=e[1],a=e[2],u,l,f,h,p,g,v,y,w,T,S,O;return u=t[0],l=t[1],f=t[2],h=t[3],p=t[4],g=t[5],v=t[6],y=t[7],w=t[8],T=t[9],S=t[10],O=t[11],n[0]=u,n[1]=l,n[2]=f,n[3]=h,n[4]=p,n[5]=g,n[6]=v,n[7]=y,n[8]=w,n[9]=T,n[10]=S,n[11]=O,n[12]=u*r+p*s+w*a+t[12],n[13]=l*r+g*s+T*a+t[13],n[14]=f*r+v*s+S*a+t[14],n[15]=h*r+y*s+O*a+t[15],n}function ix(t,e){let n=tr(),r=Math.sin(e),s=Math.cos(e),a=t[4],u=t[5],l=t[6],f=t[7],h=t[8],p=t[9],g=t[10],v=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=a*s+h*r,n[5]=u*s+p*r,n[6]=l*s+g*r,n[7]=f*s+v*r,n[8]=h*s-a*r,n[9]=p*s-u*r,n[10]=g*s-l*r,n[11]=v*s-f*r,n}function sx(t,e){let n=tr(),r=Math.sin(e),s=Math.cos(e),a=t[0],u=t[1],l=t[2],f=t[3],h=t[8],p=t[9],g=t[10],v=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=a*s-h*r,n[1]=u*s-p*r,n[2]=l*s-g*r,n[3]=f*s-v*r,n[8]=a*r+h*s,n[9]=u*r+p*s,n[10]=l*r+g*s,n[11]=f*r+v*s,n}function ax(t,e){let n=tr(),r=Math.sin(e),s=Math.cos(e),a=t[0],u=t[1],l=t[2],f=t[3],h=t[4],p=t[5],g=t[6],v=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=a*s+h*r,n[1]=u*s+p*r,n[2]=l*s+g*r,n[3]=f*s+v*r,n[4]=h*s-a*r,n[5]=p*s-u*r,n[6]=g*s-l*r,n[7]=v*s-f*r,n}function ox(t,e){let n=tr(),r=e[0],s=e[1],a=e[2];return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*s,n[5]=t[5]*s,n[6]=t[6]*s,n[7]=t[7]*s,n[8]=t[8]*a,n[9]=t[9]*a,n[10]=t[10]*a,n[11]=t[11]*a,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}const Me={create:tr,identity:$y,multiply:Qf,multiplies:Jy,invert:Qy,lookAt:jy,ortho:Dc,orthoZO:Dc,orthoNO:ex,perspective:Ic,perspectiveZO:Ic,perspectiveNO:tx,fromRotation:nx,translate:rx,rotateX:ix,rotateY:sx,rotateZ:ax,scale:ox};function ux(t){return{r:t[0]/255,g:t[1]/255,b:t[2]/255,a:t[3]}}function jf(t){return{vertex:new Float32Array(t.positions.map((e,n)=>(e.push(...t.normals[n]),e.push(...t.uvs[n]),Array.isArray(t.tangents)&&e.push(...t.tangents[n]),Array.isArray(t.bitangents)&&e.push(...t.bitangents[n]),e)).flat()),index:new Uint32Array(t.triangles.flat()),vertexCount:t.positions.length,indexCount:t.triangles.length*3,triangles:t.triangles}}function lx(t=2,e=2,n=2,r=!0,s){t/=2,e/=2,n/=2;const a=r?1:-1;return{positions:[[+t,-e,+n],[+t,-e,-n],[+t,+e,-n],[+t,+e,+n],[-t,-e,-n],[-t,-e,+n],[-t,+e,+n],[-t,+e,-n],[-t,+e,+n],[+t,+e,+n],[+t,+e,-n],[-t,+e,-n],[-t,-e,-n],[+t,-e,-n],[+t,-e,+n],[-t,-e,+n],[-t,-e,+n],[+t,-e,+n],[+t,+e,+n],[-t,+e,+n],[+t,-e,-n],[-t,-e,-n],[-t,+e,-n],[+t,+e,-n]].map(l=>Array.from(W.transformMat4(l,s))),normals:[[+a,0,0],[+a,0,0],[+a,0,0],[+a,0,0],[-a,0,0],[-a,0,0],[-a,0,0],[-a,0,0],[0,+a,0],[0,+a,0],[0,+a,0],[0,+a,0],[0,-a,0],[0,-a,0],[0,-a,0],[0,-a,0],[0,0,+a],[0,0,+a],[0,0,+a],[0,0,+a],[0,0,-a],[0,0,-a],[0,0,-a],[0,0,-a]],uvs:[[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1]].map(l=>{const[f,h]=l;return r?l:[.5*2-f,h]}),triangles:[[0,1,2],[0,2,3],[4,5,6],[4,6,7],[8,9,10],[8,10,11],[12,13,14],[12,14,15],[16,17,18],[16,18,19],[20,21,22],[20,22,23]].map(l=>{if(r)return l;{let f=l.toReversed();return f.unshift(f.pop()),f}})}}function cx(t=2,e=0,n=2,r){return{positions:[[-1,0,1],[1,0,1],[1,0,-1],[-1,0,-1]].map(a=>(a[0]*=t/2,a[1]=e,a[2]*=n/2,a)),normals:[[0,1,0],[0,1,0],[0,1,0],[0,1,0]].map(a=>(a[1]*=r?-1:1,a)),uvs:[[0,0],[1,0],[1,1],[0,1]].map(a=>{const[u,l]=a;return r?[1-u,l]:a}),triangles:[[0,1,2],[0,2,3]].map(a=>r?a.map(u=>(u=Math.abs(u-3),u-=2,u=u<0?u+4:u,u)):a)}}function fx(t=2,e=2,n=0,r){return{positions:[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]].map(a=>(a[0]*=t/2,a[1]*=e/2,a[2]=n,a)),normals:[[0,0,1],[0,0,1],[0,0,1],[0,0,1]].map(a=>(a[2]*=r?-1:1,a)),uvs:[[0,0],[1,0],[1,1],[0,1]].map(a=>{const[u,l]=a;return r?[1-u,l]:a}),triangles:[[0,1,2],[0,2,3]].map(a=>r?a.map(u=>(u=Math.abs(u-3),u-=2,u=u<0?u+4:u,u)):a)}}function hx(t=0,e=2,n=2,r){return{positions:[[0,-1,1],[0,-1,-1],[0,1,-1],[0,1,1]].map(a=>(a[0]=t,a[1]*=e/2,a[2]*=n/2,a)),normals:[[1,0,0],[1,0,0],[1,0,0],[1,0,0]].map(a=>(a[0]*=r?-1:1,a)),uvs:[[0,0],[1,0],[1,1],[0,1]].map(a=>{const[u,l]=a;return r?[1-u,l]:a}),triangles:[[0,1,2],[0,2,3]].map(a=>r?a.map(u=>(u=Math.abs(u-3),u-=2,u=u<0?u+4:u,u)):a)}}function px(t=2,e=2,n=0){return{positions:[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]].map(s=>(s[0]*=t/2,s[1]*=e/2,s[2]=n,s)),normals:[[0,0,1],[0,0,1],[0,0,1],[0,0,1]],uvs:[[0,0],[1,0],[1,1],[0,1]],indice:[0,1,3,2]}}function dx(t,e){const n=t.map(()=>[0,0,0]);return e.forEach(([r,s,a])=>{const u=t[r],l=t[s],f=t[a],h=W.sub(l,u),p=W.sub(f,u),g=W.normalize(W.cross(h,p));n[r]=W.add(n[r],g),n[s]=W.add(n[s],g),n[a]=W.add(n[a],g)}),n}function vx(t=1,e=10){const n=[],r=[],s=[];for(var a=0;a<=e;a++)for(var u=a*Math.PI/e,l=Math.sin(u),f=Math.cos(u),h=f,p=0;p<=e;p++){var g=p*(2*Math.PI/e),v=Math.sin(g),y=Math.cos(g),w=y*l,T=v*l,S=1-p/e,O=1-a/e;if(n.push([t*w,t*h,t*T]),s.push([S,O]),a<e&&p<e){var C=a*(e+1)+p,F=C+e+1;r.push([C,C+1,F],[F,C+1,F+1])}}const U=dx(n,r);return{positions:n,normals:U,uvs:s,triangles:r}}function gx(t=1,e=10){const n=[],r=[],s=[];for(var a=0;a<=e;a++){var u=a*Math.PI/e,l=Math.sin(u),f=Math.cos(u),h=f;if(a==0){n.push([0,t*h,0]),s.push([1,1]);for(var p=0;p<e;p++)r.push([0,p+1,p!=e-1?p+2:1])}else if(a==e)n.push([0,t*h,0]),s.push([0,0]);else for(var p=0;p<e;p++){var g=p*(2*Math.PI/e),v=Math.sin(g),y=Math.cos(g),w=y*l,T=v*l,S=1-p/e,O=1-a/e;n.push([t*w,t*h,t*T]),s.push([S,O])}}return{positions:n,uvs:s,triangles:r}}function mx(t=1,e=1,n=3){const r=[],s=[],a=[],u=[],l=2*Math.PI/n,f=e/2;r.push([0,-f,0]),s.push([0,-1,0]),a.push([0,0]);for(let p=0;p<n;p++){const g=t*Math.cos(p*l),v=t*Math.sin(p*l);r.push([g,-f,v]),s.push([0,-1,0]);let y=Math.hypot(t,e);a.push([p/n,t/(t+y)]),u.push([0,p+1,p!=n-1?p+2:1]),u.push([p!=n-1?p+2:1,p+1,n+1])}return r.push([0,f,0]),s.push([0,1,0]),a.push([1,1]),{positions:r,normals:s,uvs:a,triangles:u}}function yx(){return{positions:[[0,1,0],[1,0,0],[0,0,-1],[0,1,0],[0,0,-1],[-1,0,0],[0,1,0],[-1,0,0],[0,0,1],[0,1,0],[0,0,1],[1,0,0],[1,0,0],[-1,0,0],[0,0,-1],[1,0,0],[0,0,1],[-1,0,0]],normals:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],uvs:[[1,1],[0,0],[1,0],[1,1],[0,0],[1,0],[1,1],[0,0],[1,0],[1,1],[0,0],[1,0],[1,1],[0,0],[1,0],[1,1],[0,0],[1,0]],triangles:[[0,1,2],[3,4,5],[6,7,8],[9,10,11],[12,13,14],[15,16,17]]}}async function xx(t){let n=await(await fetch(t)).text();const r={vertices:[],normals:[],uvs:[],faces:0},s={triangles:[],positions:[],normals:[],uvs:[]};n.indexOf(`\r
`)!==-1&&(n=n.replace(/\r\n/g,`
`)),n.indexOf(`\\
`)!==-1&&(n=n.replace(/\\\n/g,""));const a=n.split(`
`);for(let u=0,l=a.length;u<l;u++){const f=a[u].trimStart();if(f.length===0)continue;const h=f.charAt(0);if(h!=="#"){if(h==="v"){const p=f.split(/\s+/);switch(p[0]){case"v":r.vertices.push([parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])]);break;case"vn":r.normals.push([parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])]);break;case"vt":r.uvs.push([parseFloat(p[1]),parseFloat(p[2])]);break}}else if(h==="f"){const g=f.slice(1).trim().split(/\s+/),v=s.triangles.length>0?s.triangles.at(-1).at(-1)+1:0;for(let y=0;y<g.length;y++){const w=g[y];if(w.length>0){const T=w.split("/"),S=T[0]-1,O=T[1]-1,C=T[2]-1;s.positions.push(r.vertices[S]),s.normals.push(r.normals[C]),s.uvs.push(r.uvs[O])}y<g.length-2&&s.triangles.push([v,v+y+1,v+y+2])}}}}return console.log(s),s}async function bx(t){const e=new Date().valueOf();let r=await(await fetch(t)).text();const s={positions:[],normals:[],uvs:[],faces:[],triangles:[]};r.indexOf(`\r
`)!==-1&&(r=r.replace(/\r\n/g,`
`)),r.indexOf(`\\
`)!==-1&&(r=r.replace(/\\\n/g,""));const a=r.split(`
`);for(let u=0,l=a.length;u<l;u++){const f=a[u].trimStart();if(f.length===0)continue;const h=f.charAt(0);if(h!=="#"){if(h==="v"){const p=f.split(/\s+/);switch(p[0]){case"v":s.positions.push([parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])]);break;case"vn":s.normals.push([parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])]);break;case"vt":s.uvs.push([parseFloat(p[1]),parseFloat(p[2])]);break}}if(h==="f"){const g=f.slice(1).trim().split(/\s+/),v=[];for(let y=0;y<g.length;y++){const w=g[y];if(w.length>0){const T=w.split("/"),S=T[0]-1;v.push(S)}}s.faces.push(v),v.forEach((y,w,T)=>{w<T.length-2&&s.triangles.push([T[0],T[w+1],T[w+2]])})}}}return s.normals.length===0&&(s.normals=computeSurfaceNormals(s.positions,s.triangles)),s.uvs.length===0&&(s.uvs=computeProjectedPlaneUVs(s.positions)),console.log(s.triangles.length,(new Date().valueOf()-e)/1e3),jf(s)}async function wx(t){return await axios.get(t)}function Sx({aspect:t,eye:e,center:n,fovy:r=30,up:s=[0,1,0],near:a=.1,far:u=1e5}={}){let l=W.create(e),f=W.create(n),h=W.create(s),p=Me.lookAt(l,f,h),g=Me.perspectiveZO(ve(r),t,a,u);return Me.multiply(g,p)}function Tx({light:t=[-40,200,40],center:e=[0,0,0],up:n=[0,1,0],left:r=-1,right:s=1,bottom:a=-1,top:u=1,near:l=1,far:f=300}={}){let h=W.create(t),p=W.create(e),g=W.create(n),v=Me.lookAt(h,p,g),y=Me.ortho(r,s,a,u,l,f);return Me.multiply(y,v)}function Ex({anchor:t=[0,0,0],position:e=[0,1,0],rotation:n=[0,0,0],scale:r=[1,1,1]}={}){let s=Me.create();return s=Me.translate(s,e),s=Me.rotateX(s,n[0]*Math.PI/180),s=Me.rotateY(s,n[1]*Math.PI/180),s=Me.rotateZ(s,n[2]*Math.PI/180),s=Me.scale(s,r),s=Me.translate(s,t.map(a=>-a)),s}function Ox(t,e,{length:n=15,symbol:r="-",color:s="yellowgreen"}={}){if(e){let a="";for(let f=0;f<n;f++)a+=r;a=`[${a}]`;let u=a.slice(0,Math.floor((n+2-t.length)/2)),l=a.slice(Math.floor((n+2-t.length)/2)+t.length);console.log(`%c${u}${t}${l}:`,`color: ${s}`,e)}}function Cx({canvas:t,eye:e,center:n,up:r=[0,1,0],offsetX:s=50,offsetY:a=50,vp:u}={}){let l=W.create(e),f=W.scale(l,.5),h=W.create(r),p=W.cross(h,f),g=Math.atan((t.height/2-a)/(t.width/2-s)),v=Me.fromRotation(l,g),y=W.normalize(W.transformMat4(p,v)),w=W.add(f,y),T=W.transformMat4(w,u);return y=W.scale(y,Math.abs(s-t.width/2)/(t.width/2)/T[0]),w=W.add(f,y),w}function Fx(t){return Array.isArray(t)}function Ax(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Rx(t){var e=typeof t;return t!=null&&e=="function"}function Lx(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function _x(t){return typeof t=="number"&&!isNaN(t)}const We={colorFormat:ux,getGeometry:jf,createCube:lx,createRectangleZX:cx,createRectangleXY:fx,createRectangleYZ:hx,createSphere:vx,createSphere2:gx,createPlane:px,createPyramid:mx,createPyramid2:yx,loadObj:xx,loadOBJ:bx,loadSTL:wx,getCameraViewProjectionMatrix:Sx,getLightViewProjectionMatrix:Tx,getModelTransformMatrix:Ex,print:Ox,invertRasterizeByOffset:Cx,isArray:Fx,isTypedArray:Ax,isFunction:Rx,isObject:Lx,isNumber:_x};class Ux{constructor({device:e,light:n=[1,2,10],eye:r=[15,15,15],center:s=[0,0,0],up:a=[0,1,0],fovy:u=45,bgColor:l=[20,20,20,1],topology:f="triangle-list",frontFace:h="ccw",cullMode:p="none"}={}){this.device=e,this.eye=r,this.center=s,this.up=a,this.fovy=u,this.bgColor=l,this.topology=f,this.frontFace=h,this.cullMode=p,this.light=n,this.lightCenter=[0,4.95,0],this.lightWidth=2,this.lightHeight=2,this.lightingModel="Blinn-Phong",this.init()}init(){this.instances=[{name:"box-bottom",anchor:[0,0,0],position:[0,-1,0],rotation:[0,0,0],scale:[1,1,1],color:[1,1,1,0],emissive:0,mesh:We.createRectangleZX(10,0,10)},{name:"cube-s",anchor:[0,0,0],position:[0,.01,0],rotation:[0,0,0],scale:[1,1,1],color:[.4,.4,.4,0],emissive:0,mesh:We.createCube(2,2,2)}].sort((r,s)=>Math.sign(1-r.color[3])-Math.sign(1-s.color[3])),this.vertexBufferLayout=[{arrayStride:14*4,attributes:[{shaderLocation:0,offset:0*4,format:"float32x3"},{shaderLocation:1,offset:3*4,format:"float32x3"},{shaderLocation:2,offset:6*4,format:"float32x2"},{shaderLocation:3,offset:8*4,format:"float32x4"},{shaderLocation:4,offset:12*4,format:"float32"},{shaderLocation:5,offset:13*4,format:"float32"}]}],this.instances.forEach(r=>{this.triangleIndex??(this.triangleIndex=-1);const{color:s,emissive:a,mesh:u}=r,{positions:l,uvs:f,normals:h,triangles:p}=u,g=p.map(T=>(this.triangleIndex+=1,T.map(S=>[...l[S],...h[S],...f[S],...s,a,this.triangleIndex]).flat())).flat(),v=new Float32Array(g),y=p.map((T,S)=>[S*3,S*3+1,S*3+2]).flat(),w=new Uint32Array(y);r.vertexBuffer=this.createMappedBuffer({size:v.byteLength,usage:GPUBufferUsage.VERTEX,source:v,typedArray:Float32Array}),r.indexBuffer=this.createMappedBuffer({size:w.byteLength,usage:GPUBufferUsage.INDEX,source:w,typedArray:Uint32Array})}),this.triangles=this.instances.map((r,s)=>{const{color:a,mesh:u}=r,l=u.positions;return u.triangles.map(f=>{const[h,p,g]=f;return{a:l[h],b:l[p],c:l[g],color:a,instanceIndex:s}})}).flat();const e=20,n=new Float32Array(this.triangles.length*e);this.triangles.forEach((r,s)=>{const{a,b:u,c:l,color:f,instanceIndex:h}=r,p=e*s;n.set([...a,1,...u,1,...l,1,...f,h],p)}),this.triangleBuffer=this.createMappedBuffer({size:n.byteLength,usage:GPUBufferUsage.STORAGE,source:n,typedArray:Float32Array})}createMappedBuffer({size:e=0,usage:n=GPUBufferUsage.VERTEX,source:r,typedArray:s=Float32Array}={}){const a=this.device.createBuffer({size:e,usage:n,mappedAtCreation:!0});return new s(a.getMappedRange()).set(r),a.unmap(),a}setCenter(e){let n=new Array(3);if(We.isArray(e)||We.isTypedArray(e))if(e.some(r=>Number.isNaN(r))){console.error("参数 [center] 不是数字类型 : ",e);return}else n[0]=e[0],n[1]=e[1],n[2]=e[2];else if(We.isObject(e))this.setCenter(Object.values(e));else{console.error(`参数 [center] 需要是数组或者对象，这里是一个${typeof e} : `,e);return}this.center=n}setEye(e){let n=new Array(3);if(We.isArray(e)||We.isTypedArray(e))if(e.some(r=>Number.isNaN(r))){console.error("参数 [eye] 不是数字类型 : ",e);return}else n[0]=e[0],n[1]=e[1],n[2]=e[2];else if(We.isObject(e))this.setEye(Object.values(e));else{console.error(`参数 [eye] 需要是数组或者对象，这里是一个${typeof e} : `,e);return}this.eye=n}getCenter(){return this.center}getEye(){return this.eye}$(e){if(e)if(e.charAt(0)==="#"&&e.length>1){let n=e.slice(1);return this.instances.find(s=>s.label==n)}else return this.instances.filter(r=>r.name===e)}}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var n={},r=Object.defineProperty,s=r(n,n,n)&&r}catch{}return s}(),e=function(n){if(this==null)throw TypeError();var r=String(this),s=r.length,a=n?Number(n):0;if(a!=a&&(a=0),!(a<0||a>=s)){var u=r.charCodeAt(a),l;return u>=55296&&u<=56319&&s>a+1&&(l=r.charCodeAt(a+1),l>=56320&&l<=57343)?(u-55296)*1024+l-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function eh(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var kx=new eh,Mx=new eh,th=new Uint8Array(30),nh=new Uint16Array(30),Bx=new Uint8Array(30),Px=new Uint16Array(30);function rh(t,e,n,r){var s,a;for(s=0;s<n;++s)t[s]=0;for(s=0;s<30-n;++s)t[s+n]=s/n|0;for(a=r,s=0;s<30;++s)e[s]=a,a+=1<<t[s]}function Dx(t,e){var n;for(n=0;n<7;++n)t.table[n]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,n=0;n<24;++n)t.trans[n]=256+n;for(n=0;n<144;++n)t.trans[24+n]=n;for(n=0;n<8;++n)t.trans[168+n]=280+n;for(n=0;n<112;++n)t.trans[176+n]=144+n;for(n=0;n<5;++n)e.table[n]=0;for(e.table[5]=32,n=0;n<32;++n)e.trans[n]=n}Dx(kx,Mx);rh(th,nh,4,3);rh(Bx,Px,2,1);th[28]=0;nh[28]=258;function yr(t,e,n,r,s){return Math.pow(1-s,3)*t+3*Math.pow(1-s,2)*s*e+3*(1-s)*Math.pow(s,2)*n+Math.pow(s,3)*r}function Dn(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Dn.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Dn.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Dn.prototype.addX=function(t){this.addPoint(t,null)};Dn.prototype.addY=function(t){this.addPoint(null,t)};Dn.prototype.addBezier=function(t,e,n,r,s,a,u,l){var f=[t,e],h=[n,r],p=[s,a],g=[u,l];this.addPoint(t,e),this.addPoint(u,l);for(var v=0;v<=1;v++){var y=6*f[v]-12*h[v]+6*p[v],w=-3*f[v]+9*h[v]-9*p[v]+3*g[v],T=3*h[v]-3*f[v];if(w===0){if(y===0)continue;var S=-T/y;0<S&&S<1&&(v===0&&this.addX(yr(f[v],h[v],p[v],g[v],S)),v===1&&this.addY(yr(f[v],h[v],p[v],g[v],S)));continue}var O=Math.pow(y,2)-4*T*w;if(!(O<0)){var C=(-y+Math.sqrt(O))/(2*w);0<C&&C<1&&(v===0&&this.addX(yr(f[v],h[v],p[v],g[v],C)),v===1&&this.addY(yr(f[v],h[v],p[v],g[v],C)));var F=(-y-Math.sqrt(O))/(2*w);0<F&&F<1&&(v===0&&this.addX(yr(f[v],h[v],p[v],g[v],F)),v===1&&this.addY(yr(f[v],h[v],p[v],g[v],F)))}}};Dn.prototype.addQuad=function(t,e,n,r,s,a){var u=t+.6666666666666666*(n-t),l=e+2/3*(r-e),f=u+1/3*(s-t),h=l+1/3*(a-e);this.addBezier(t,e,u,l,f,h,s,a)};function tt(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}tt.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};tt.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};tt.prototype.curveTo=tt.prototype.bezierCurveTo=function(t,e,n,r,s,a){this.commands.push({type:"C",x1:t,y1:e,x2:n,y2:r,x:s,y:a})};tt.prototype.quadTo=tt.prototype.quadraticCurveTo=function(t,e,n,r){this.commands.push({type:"Q",x1:t,y1:e,x:n,y:r})};tt.prototype.close=tt.prototype.closePath=function(){this.commands.push({type:"Z"})};tt.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Dn){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};tt.prototype.getBoundingBox=function(){for(var t=new Dn,e=0,n=0,r=0,s=0,a=0;a<this.commands.length;a++){var u=this.commands[a];switch(u.type){case"M":t.addPoint(u.x,u.y),e=r=u.x,n=s=u.y;break;case"L":t.addPoint(u.x,u.y),r=u.x,s=u.y;break;case"Q":t.addQuad(r,s,u.x1,u.y1,u.x,u.y),r=u.x,s=u.y;break;case"C":t.addBezier(r,s,u.x1,u.y1,u.x2,u.y2,u.x,u.y),r=u.x,s=u.y;break;case"Z":r=e,s=n;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t};tt.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var n=this.commands[e];n.type==="M"?t.moveTo(n.x,n.y):n.type==="L"?t.lineTo(n.x,n.y):n.type==="C"?t.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):n.type==="Q"?t.quadraticCurveTo(n.x1,n.y1,n.x,n.y):n.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};tt.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function n(){for(var u=arguments,l="",f=0;f<arguments.length;f+=1){var h=u[f];h>=0&&f>0&&(l+=" "),l+=e(h)}return l}for(var r="",s=0;s<this.commands.length;s+=1){var a=this.commands[s];a.type==="M"?r+="M"+n(a.x,a.y):a.type==="L"?r+="L"+n(a.x,a.y):a.type==="C"?r+="C"+n(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?r+="Q"+n(a.x1,a.y1,a.x,a.y):a.type==="Z"&&(r+="Z")}return r};tt.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};tt.prototype.toDOMElement=function(t){var e=this.toPathData(t),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n};function ih(t){throw new Error(t)}function Nc(t,e){t||ih(e)}var he={fail:ih,argument:Nc,assert:Nc},Gc=32768,zc=2147483648,Tr={},X={},ce={};function Zt(t){return function(){return t}}X.BYTE=function(t){return he.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};ce.BYTE=Zt(1);X.CHAR=function(t){return[t.charCodeAt(0)]};ce.CHAR=Zt(1);X.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],n=0;n<t.length;n+=1)e[n]=t.charCodeAt(n);return e};ce.CHARARRAY=function(t){return typeof t>"u"?0:t.length};X.USHORT=function(t){return[t>>8&255,t&255]};ce.USHORT=Zt(2);X.SHORT=function(t){return t>=Gc&&(t=-(2*Gc-t)),[t>>8&255,t&255]};ce.SHORT=Zt(2);X.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};ce.UINT24=Zt(3);X.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};ce.ULONG=Zt(4);X.LONG=function(t){return t>=zc&&(t=-(2*zc-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};ce.LONG=Zt(4);X.FIXED=X.ULONG;ce.FIXED=ce.ULONG;X.FWORD=X.SHORT;ce.FWORD=ce.SHORT;X.UFWORD=X.USHORT;ce.UFWORD=ce.USHORT;X.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};ce.LONGDATETIME=Zt(8);X.TAG=function(t){return he.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};ce.TAG=Zt(4);X.Card8=X.BYTE;ce.Card8=ce.BYTE;X.Card16=X.USHORT;ce.Card16=ce.USHORT;X.OffSize=X.BYTE;ce.OffSize=ce.BYTE;X.SID=X.USHORT;ce.SID=ce.USHORT;X.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?X.NUMBER16(t):X.NUMBER32(t)};ce.NUMBER=function(t){return X.NUMBER(t).length};X.NUMBER16=function(t){return[28,t>>8&255,t&255]};ce.NUMBER16=Zt(3);X.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};ce.NUMBER32=Zt(5);X.REAL=function(t){var e=t.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(n){var r=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));e=(Math.round(t*r)/r).toString()}for(var s="",a=0,u=e.length;a<u;a+=1){var l=e[a];l==="e"?s+=e[++a]==="-"?"c":"b":l==="."?s+="a":l==="-"?s+="e":s+=l}s+=s.length&1?"f":"ff";for(var f=[30],h=0,p=s.length;h<p;h+=2)f.push(parseInt(s.substr(h,2),16));return f};ce.REAL=function(t){return X.REAL(t).length};X.NAME=X.CHARARRAY;ce.NAME=ce.CHARARRAY;X.STRING=X.CHARARRAY;ce.STRING=ce.CHARARRAY;Tr.UTF8=function(t,e,n){for(var r=[],s=n,a=0;a<s;a++,e+=1)r[a]=t.getUint8(e);return String.fromCharCode.apply(null,r)};Tr.UTF16=function(t,e,n){for(var r=[],s=n/2,a=0;a<s;a++,e+=2)r[a]=t.getUint16(e);return String.fromCharCode.apply(null,r)};X.UTF16=function(t){for(var e=[],n=0;n<t.length;n+=1){var r=t.charCodeAt(n);e[e.length]=r>>8&255,e[e.length]=r&255}return e};ce.UTF16=function(t){return t.length*2};var Ao={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};Tr.MACSTRING=function(t,e,n,r){var s=Ao[r];if(s!==void 0){for(var a="",u=0;u<n;u++){var l=t.getUint8(e+u);l<=127?a+=String.fromCharCode(l):a+=s[l&127]}return a}};var as=typeof WeakMap=="function"&&new WeakMap,os,Ix=function(t){if(!os){os={};for(var e in Ao)os[e]=new String(e)}var n=os[t];if(n!==void 0){if(as){var r=as.get(n);if(r!==void 0)return r}var s=Ao[t];if(s!==void 0){for(var a={},u=0;u<s.length;u++)a[s.charCodeAt(u)]=u+128;return as&&as.set(n,a),a}}};X.MACSTRING=function(t,e){var n=Ix(e);if(n!==void 0){for(var r=[],s=0;s<t.length;s++){var a=t.charCodeAt(s);if(a>=128&&(a=n[a],a===void 0))return;r[s]=a}return r}};ce.MACSTRING=function(t,e){var n=X.MACSTRING(t,e);return n!==void 0?n.length:0};function Ro(t){return t>=-128&&t<=127}function Nx(t,e,n){for(var r=0,s=t.length;e<s&&r<64&&t[e]===0;)++e,++r;return n.push(128|r-1),e}function Gx(t,e,n){for(var r=0,s=t.length,a=e;a<s&&r<64;){var u=t[a];if(!Ro(u)||u===0&&a+1<s&&t[a+1]===0)break;++a,++r}n.push(r-1);for(var l=e;l<a;++l)n.push(t[l]+256&255);return a}function zx(t,e,n){for(var r=0,s=t.length,a=e;a<s&&r<64;){var u=t[a];if(u===0||Ro(u)&&a+1<s&&Ro(t[a+1]))break;++a,++r}n.push(64|r-1);for(var l=e;l<a;++l){var f=t[l];n.push(f+65536>>8&255,f+256&255)}return a}X.VARDELTAS=function(t){for(var e=0,n=[];e<t.length;){var r=t[e];r===0?e=Nx(t,e,n):r>=-128&&r<=127?e=Gx(t,e,n):e=zx(t,e,n)}return n};X.INDEX=function(t){for(var e=1,n=[e],r=[],s=0;s<t.length;s+=1){var a=X.OBJECT(t[s]);Array.prototype.push.apply(r,a),e+=a.length,n.push(e)}if(r.length===0)return[0,0];for(var u=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,X.BYTE,X.USHORT,X.UINT24,X.ULONG][l],h=0;h<n.length;h+=1){var p=f(n[h]);Array.prototype.push.apply(u,p)}return Array.prototype.concat(X.Card16(t.length),X.OffSize(l),u,r)};ce.INDEX=function(t){return X.INDEX(t).length};X.DICT=function(t){for(var e=[],n=Object.keys(t),r=n.length,s=0;s<r;s+=1){var a=parseInt(n[s],0),u=t[a];e=e.concat(X.OPERAND(u.value,u.type)),e=e.concat(X.OPERATOR(a))}return e};ce.DICT=function(t){return X.DICT(t).length};X.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};X.OPERAND=function(t,e){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r+=1)he.argument(t.length===e.length,"Not enough arguments given for type"+e),n=n.concat(X.OPERAND(t[r],e[r]));else if(e==="SID")n=n.concat(X.NUMBER(t));else if(e==="offset")n=n.concat(X.NUMBER32(t));else if(e==="number")n=n.concat(X.NUMBER(t));else if(e==="real")n=n.concat(X.REAL(t));else throw new Error("Unknown operand type "+e);return n};X.OP=X.BYTE;ce.OP=ce.BYTE;var us=typeof WeakMap=="function"&&new WeakMap;X.CHARSTRING=function(t){if(us){var e=us.get(t);if(e!==void 0)return e}for(var n=[],r=t.length,s=0;s<r;s+=1){var a=t[s];n=n.concat(X[a.type](a.value))}return us&&us.set(t,n),n};ce.CHARSTRING=function(t){return X.CHARSTRING(t).length};X.OBJECT=function(t){var e=X[t.type];return he.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};ce.OBJECT=function(t){var e=ce[t.type];return he.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};X.TABLE=function(t){for(var e=[],n=t.fields.length,r=[],s=[],a=0;a<n;a+=1){var u=t.fields[a],l=X[u.type];he.argument(l!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var h=l(f);u.type==="TABLE"?(s.push(e.length),e=e.concat([0,0]),r.push(h)):e=e.concat(h)}for(var p=0;p<r.length;p+=1){var g=s[p],v=e.length;he.argument(v<65536,"Table "+t.tableName+" too big."),e[g]=v>>8,e[g+1]=v&255,e=e.concat(r[p])}return e};ce.TABLE=function(t){for(var e=0,n=t.fields.length,r=0;r<n;r+=1){var s=t.fields[r],a=ce[s.type];he.argument(a!==void 0,"No sizeOf function for field type "+s.type+" ("+s.name+")");var u=t[s.name];u===void 0&&(u=s.value),e+=a(u),s.type==="TABLE"&&(e+=2)}return e};X.RECORD=X.TABLE;ce.RECORD=ce.TABLE;X.LITERAL=function(t){return t};ce.LITERAL=function(t){return t.length};function it(t,e,n){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var r=0;r<e.length;r+=1){var s=e[r];this[s.name]=s.value}if(this.tableName=t,this.fields=e,n)for(var a=Object.keys(n),u=0;u<a.length;u+=1){var l=a[u],f=n[l];this[l]!==void 0&&(this[l]=f)}}it.prototype.encode=function(){return X.TABLE(this)};it.prototype.sizeOf=function(){return ce.TABLE(this)};function ri(t,e,n){n===void 0&&(n=e.length);var r=new Array(e.length+1);r[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<e.length;s++)r[s+1]={name:t+s,type:"USHORT",value:e[s]};return r}function Lo(t,e,n){var r=e.length,s=new Array(r+1);s[0]={name:t+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)s[a+1]={name:t+a,type:"TABLE",value:n(e[a],a)};return s}function ii(t,e,n){var r=e.length,s=[];s[0]={name:t+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)s=s.concat(n(e[a],a));return s}function Ss(t){t.format===1?it.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ri("glyph",t.glyphs))):t.format===2?it.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(ii("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):he.assert(!1,"Coverage format must be 1 or 2.")}Ss.prototype=Object.create(it.prototype);Ss.prototype.constructor=Ss;function Ts(t){it.call(this,"scriptListTable",ii("scriptRecord",t,function(e,n){var r=e.script,s=r.defaultLangSys;return he.assert(!!s,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+n,type:"TAG",value:e.tag},{name:"script"+n,type:"TABLE",value:new it("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new it("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:s.reqFeatureIndex}].concat(ri("featureIndex",s.featureIndexes)))}].concat(ii("langSys",r.langSysRecords,function(a,u){var l=a.langSys;return[{name:"langSysTag"+u,type:"TAG",value:a.tag},{name:"langSys"+u,type:"TABLE",value:new it("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(ri("featureIndex",l.featureIndexes)))}]})))}]}))}Ts.prototype=Object.create(it.prototype);Ts.prototype.constructor=Ts;function Es(t){it.call(this,"featureListTable",ii("featureRecord",t,function(e,n){var r=e.feature;return[{name:"featureTag"+n,type:"TAG",value:e.tag},{name:"feature"+n,type:"TABLE",value:new it("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(ri("lookupListIndex",r.lookupListIndexes)))}]}))}Es.prototype=Object.create(it.prototype);Es.prototype.constructor=Es;function Os(t,e){it.call(this,"lookupListTable",Lo("lookup",t,function(n){var r=e[n.lookupType];return he.assert(!!r,"Unable to write GSUB lookup type "+n.lookupType+" tables."),new it("lookupTable",[{name:"lookupType",type:"USHORT",value:n.lookupType},{name:"lookupFlag",type:"USHORT",value:n.lookupFlag}].concat(Lo("subtable",n.subtables,r)))}))}Os.prototype=Object.create(it.prototype);Os.prototype.constructor=Os;var Q={Table:it,Record:it,Coverage:Ss,ScriptList:Ts,FeatureList:Es,LookupList:Os,ushortList:ri,tableList:Lo,recordList:ii};function Hc(t,e){return t.getUint8(e)}function Cs(t,e){return t.getUint16(e,!1)}function Hx(t,e){return t.getInt16(e,!1)}function qo(t,e){return t.getUint32(e,!1)}function sh(t,e){var n=t.getInt16(e,!1),r=t.getUint16(e+2,!1);return n+r/65535}function qx(t,e){for(var n="",r=e;r<e+4;r+=1)n+=String.fromCharCode(t.getInt8(r));return n}function Wx(t,e,n){for(var r=0,s=0;s<n;s+=1)r<<=8,r+=t.getUint8(e+s);return r}function Vx(t,e,n){for(var r=[],s=e;s<n;s+=1)r.push(t.getUint8(s));return r}function Xx(t){for(var e="",n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return e}var Yx={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function B(t,e){this.data=t,this.offset=e,this.relativeOffset=0}B.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};B.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};B.prototype.parseCard8=B.prototype.parseByte;B.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};B.prototype.parseCard16=B.prototype.parseUShort;B.prototype.parseSID=B.prototype.parseUShort;B.prototype.parseOffset16=B.prototype.parseUShort;B.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};B.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};B.prototype.parseULong=function(){var t=qo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};B.prototype.parseOffset32=B.prototype.parseULong;B.prototype.parseFixed=function(){var t=sh(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};B.prototype.parseString=function(t){var e=this.data,n=this.offset+this.relativeOffset,r="";this.relativeOffset+=t;for(var s=0;s<t;s++)r+=String.fromCharCode(e.getUint8(n+s));return r};B.prototype.parseTag=function(){return this.parseString(4)};B.prototype.parseLongDateTime=function(){var t=qo(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};B.prototype.parseVersion=function(t){var e=Cs(this.data,this.offset+this.relativeOffset),n=Cs(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+n/t/10};B.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Yx[t]*e};B.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),n=this.data,r=this.offset+this.relativeOffset,s=0;s<t;s++)e[s]=n.getUint32(r),r+=4;return this.relativeOffset+=t*4,e};B.prototype.parseOffset16List=B.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),n=this.data,r=this.offset+this.relativeOffset,s=0;s<t;s++)e[s]=n.getUint16(r),r+=2;return this.relativeOffset+=t*2,e};B.prototype.parseShortList=function(t){for(var e=new Array(t),n=this.data,r=this.offset+this.relativeOffset,s=0;s<t;s++)e[s]=n.getInt16(r),r+=2;return this.relativeOffset+=t*2,e};B.prototype.parseByteList=function(t){for(var e=new Array(t),n=this.data,r=this.offset+this.relativeOffset,s=0;s<t;s++)e[s]=n.getUint8(r++);return this.relativeOffset+=t,e};B.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),r=0;r<t;r++)n[r]=e.call(this);return n};B.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),r=0;r<t;r++)n[r]=e.call(this);return n};B.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var n=new Array(t),r=Object.keys(e),s=0;s<t;s++){for(var a={},u=0;u<r.length;u++){var l=r[u],f=e[l];a[l]=f.call(this)}n[s]=a}return n};B.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var n=new Array(t),r=Object.keys(e),s=0;s<t;s++){for(var a={},u=0;u<r.length;u++){var l=r[u],f=e[l];a[l]=f.call(this)}n[s]=a}return n};B.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var s=e[r],a=t[s];n[s]=a.call(this)}return n};B.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};B.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),n=new Array(e),r=0;r<e;r++)n[r]=this.parseValueRecord(t);return n};B.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new B(this.data,this.offset+e).parseStruct(t)};B.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new B(this.data,this.offset+e).parseStruct(t)};B.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),n=e.length,r=this.relativeOffset,s=new Array(n),a=0;a<n;a++){var u=e[a];if(u===0){s[a]=void 0;continue}if(this.relativeOffset=u,t){for(var l=this.parseOffset16List(),f=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=u+l[h],f[h]=t.call(this);s[a]=f}else s[a]=this.parseUShortList()}return this.relativeOffset=r,s};B.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),n=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(n)};if(e===2){for(var r=new Array(n),s=0;s<n;s++)r[s]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:r}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};B.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:B.uShort,end:B.uShort,classId:B.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};B.list=function(t,e){return function(){return this.parseList(t,e)}};B.list32=function(t,e){return function(){return this.parseList32(t,e)}};B.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};B.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};B.pointer=function(t){return function(){return this.parsePointer(t)}};B.pointer32=function(t){return function(){return this.parsePointer32(t)}};B.tag=B.prototype.parseTag;B.byte=B.prototype.parseByte;B.uShort=B.offset16=B.prototype.parseUShort;B.uShortList=B.prototype.parseUShortList;B.uLong=B.offset32=B.prototype.parseULong;B.uLongList=B.prototype.parseULongList;B.struct=B.prototype.parseStruct;B.coverage=B.prototype.parseCoverage;B.classDef=B.prototype.parseClassDef;var qc={reserved:B.uShort,reqFeatureIndex:B.uShort,featureIndexes:B.uShortList};B.prototype.parseScriptList=function(){return this.parsePointer(B.recordList({tag:B.tag,script:B.pointer({defaultLangSys:B.pointer(qc),langSysRecords:B.recordList({tag:B.tag,langSys:B.pointer(qc)})})}))||[]};B.prototype.parseFeatureList=function(){return this.parsePointer(B.recordList({tag:B.tag,feature:B.pointer({featureParams:B.offset16,lookupListIndexes:B.uShortList})}))||[]};B.prototype.parseLookupList=function(t){return this.parsePointer(B.list(B.pointer(function(){var e=this.parseUShort();he.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var n=this.parseUShort(),r=n&16;return{lookupType:e,lookupFlag:n,subtables:this.parseList(B.pointer(t[e])),markFilteringSet:r?this.parseUShort():void 0}})))||[]};B.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();he.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var n=this.parseRecordList32({conditionSetOffset:B.offset32,featureTableSubstitutionOffset:B.offset32});return n})||[]};var ye={getByte:Hc,getCard8:Hc,getUShort:Cs,getCard16:Cs,getShort:Hx,getULong:qo,getFixed:sh,getTag:qx,getOffset:Wx,getBytes:Vx,bytesToString:Xx,Parser:B};function Kx(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var n;t.groupCount=n=e.parseULong(),t.glyphIndexMap={};for(var r=0;r<n;r+=1)for(var s=e.parseULong(),a=e.parseULong(),u=e.parseULong(),l=s;l<=a;l+=1)t.glyphIndexMap[l]=u,u++}function Zx(t,e,n,r,s){t.length=e.parseUShort(),t.language=e.parseUShort();var a;t.segCount=a=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new ye.Parser(n,r+s+14),l=new ye.Parser(n,r+s+16+a*2),f=new ye.Parser(n,r+s+16+a*4),h=new ye.Parser(n,r+s+16+a*6),p=r+s+16+a*8,g=0;g<a-1;g+=1)for(var v=void 0,y=u.parseUShort(),w=l.parseUShort(),T=f.parseShort(),S=h.parseUShort(),O=w;O<=y;O+=1)S!==0?(p=h.offset+h.relativeOffset-2,p+=S,p+=(O-w)*2,v=ye.getUShort(n,p),v!==0&&(v=v+T&65535)):v=O+T&65535,t.glyphIndexMap[O]=v}function $x(t,e){var n={};n.version=ye.getUShort(t,e),he.argument(n.version===0,"cmap table version should be 0."),n.numTables=ye.getUShort(t,e+2);for(var r=-1,s=n.numTables-1;s>=0;s-=1){var a=ye.getUShort(t,e+4+s*8),u=ye.getUShort(t,e+4+s*8+2);if(a===3&&(u===0||u===1||u===10)||a===0&&(u===0||u===1||u===2||u===3||u===4)){r=ye.getULong(t,e+4+s*8+4);break}}if(r===-1)throw new Error("No valid cmap sub-tables found.");var l=new ye.Parser(t,e+r);if(n.format=l.parseUShort(),n.format===12)Kx(n,l);else if(n.format===4)Zx(n,l,t,e,r);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");return n}function Jx(t,e,n){t.segments.push({end:e,start:e,delta:-(e-n),offset:0,glyphIndex:n})}function Qx(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function jx(t){var e=!0,n;for(n=t.length-1;n>0;n-=1){var r=t.get(n);if(r.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var s=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(s=s.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),s=s.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new Q.Table("cmap",s);for(a.segments=[],n=0;n<t.length;n+=1){for(var u=t.get(n),l=0;l<u.unicodes.length;l+=1)Jx(a,u.unicodes[l],n);a.segments=a.segments.sort(function(C,F){return C.start-F.start})}Qx(a);var f=a.segments.length,h=0,p=[],g=[],v=[],y=[],w=[],T=[];for(n=0;n<f;n+=1){var S=a.segments[n];S.end<=65535&&S.start<=65535?(p=p.concat({name:"end_"+n,type:"USHORT",value:S.end}),g=g.concat({name:"start_"+n,type:"USHORT",value:S.start}),v=v.concat({name:"idDelta_"+n,type:"SHORT",value:S.delta}),y=y.concat({name:"idRangeOffset_"+n,type:"USHORT",value:S.offset}),S.glyphId!==void 0&&(w=w.concat({name:"glyph_"+n,type:"USHORT",value:S.glyphId}))):h+=1,!e&&S.glyphIndex!==void 0&&(T=T.concat({name:"cmap12Start_"+n,type:"ULONG",value:S.start}),T=T.concat({name:"cmap12End_"+n,type:"ULONG",value:S.end}),T=T.concat({name:"cmap12Glyph_"+n,type:"ULONG",value:S.glyphIndex}))}if(a.segCountX2=(f-h)*2,a.searchRange=Math.pow(2,Math.floor(Math.log(f-h)/Math.log(2)))*2,a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(p),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(g),a.fields=a.fields.concat(v),a.fields=a.fields.concat(y),a.fields=a.fields.concat(w),a.cmap4Length=14+p.length*2+2+g.length*2+v.length*2+y.length*2+w.length*2,!e){var O=16+T.length*4;a.cmap12Offset=12+2*2+4+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:O},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:T.length/3}]),a.fields=a.fields.concat(T)}return a}var e2={parse:$x,make:jx},ds=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],t2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],n2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Wc=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function ah(t){this.font=t}ah.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.font.glyphs;if(n){for(var r=0;r<n.length;r+=1)for(var s=n.get(r),a=0;a<s.unicodes.length;a+=1)if(s.unicodes[a]===e)return r}return null};function Fs(t,e){this.encoding=t,this.charset=e}Fs.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),n=this.encoding[e];return this.charset.indexOf(n)};function r2(t,e,n,r,s){t.beginPath(),t.moveTo(e,n),t.lineTo(r,s),t.stroke()}var Zn={line:r2};function i2(t,e){var n=e||new tt;return{configurable:!0,get:function(){return typeof n=="function"&&(n=n()),n},set:function(r){n=r}}}function Nt(t){this.bindConstructorValues(t)}Nt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",i2(this,t.path))};Nt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};Nt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Nt.prototype.getPath=function(t,e,n,r,s){t=t!==void 0?t:0,e=e!==void 0?e:0,n=n!==void 0?n:72;var a,u;r||(r={});var l=r.xScale,f=r.yScale;if(r.hinting&&s&&s.hinting&&(u=this.path&&s.hinting.exec(this,n)),u)a=s.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),l=f=1;else{a=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*n;l===void 0&&(l=h),f===void 0&&(f=h)}for(var p=new tt,g=0;g<a.length;g+=1){var v=a[g];v.type==="M"?p.moveTo(t+v.x*l,e+-v.y*f):v.type==="L"?p.lineTo(t+v.x*l,e+-v.y*f):v.type==="Q"?p.quadraticCurveTo(t+v.x1*l,e+-v.y1*f,t+v.x*l,e+-v.y*f):v.type==="C"?p.curveTo(t+v.x1*l,e+-v.y1*f,t+v.x2*l,e+-v.y2*f,t+v.x*l,e+-v.y*f):v.type==="Z"&&p.closePath()}return p};Nt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],n=0;n<this.points.length;n+=1){var r=this.points[n];e.push(r),r.lastPointOfContour&&(t.push(e),e=[])}return he.argument(e.length===0,"There are still points left in the current contour."),t};Nt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],n=[],r=0;r<t.length;r+=1){var s=t[r];s.type!=="Z"&&(e.push(s.x),n.push(s.y)),(s.type==="Q"||s.type==="C")&&(e.push(s.x1),n.push(s.y1)),s.type==="C"&&(e.push(s.x2),n.push(s.y2))}var a={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a};Nt.prototype.draw=function(t,e,n,r,s){this.getPath(e,n,r,s).draw(t)};Nt.prototype.drawPoints=function(t,e,n,r){function s(g,v,y,w){t.beginPath();for(var T=0;T<g.length;T+=1)t.moveTo(v+g[T].x*w,y+g[T].y*w),t.arc(v+g[T].x*w,y+g[T].y*w,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,n=n!==void 0?n:0,r=r!==void 0?r:24;for(var a=1/this.path.unitsPerEm*r,u=[],l=[],f=this.path,h=0;h<f.commands.length;h+=1){var p=f.commands[h];p.x!==void 0&&u.push({x:p.x,y:-p.y}),p.x1!==void 0&&l.push({x:p.x1,y:-p.y1}),p.x2!==void 0&&l.push({x:p.x2,y:-p.y2})}t.fillStyle="blue",s(u,e,n,a),t.fillStyle="red",s(l,e,n,a)};Nt.prototype.drawMetrics=function(t,e,n,r){var s;e=e!==void 0?e:0,n=n!==void 0?n:0,r=r!==void 0?r:24,s=1/this.path.unitsPerEm*r,t.lineWidth=1,t.strokeStyle="black",Zn.line(t,e,-1e4,e,1e4),Zn.line(t,-1e4,n,1e4,n);var a=this.xMin||0,u=this.yMin||0,l=this.xMax||0,f=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",Zn.line(t,e+a*s,-1e4,e+a*s,1e4),Zn.line(t,e+l*s,-1e4,e+l*s,1e4),Zn.line(t,-1e4,n+-u*s,1e4,n+-u*s),Zn.line(t,-1e4,n+-f*s,1e4,n+-f*s),t.strokeStyle="green",Zn.line(t,e+h*s,-1e4,e+h*s,1e4)};function ls(t,e,n){Object.defineProperty(t,e,{get:function(){return t.path,t[n]},set:function(r){t[n]=r},enumerable:!0,configurable:!0})}function Wo(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];r.path.unitsPerEm=t.unitsPerEm,this.glyphs[n]=r}this.length=e&&e.length||0}Wo.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],n=this.font._IndexToUnicodeMap[t];if(n)for(var r=0;r<n.unicodes.length;r++)e.addUnicode(n.unicodes[r]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Wo.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function s2(t,e){return new Nt({index:e,font:t})}function a2(t,e,n,r,s,a){return function(){var u=new Nt({index:e,font:t});return u.path=function(){n(u,r,s);var l=a(t.glyphs,u);return l.unitsPerEm=t.unitsPerEm,l},ls(u,"xMin","_xMin"),ls(u,"xMax","_xMax"),ls(u,"yMin","_yMin"),ls(u,"yMax","_yMax"),u}}function o2(t,e,n,r){return function(){var s=new Nt({index:e,font:t});return s.path=function(){var a=n(t,s,r);return a.unitsPerEm=t.unitsPerEm,a},s}}var sn={GlyphSet:Wo,glyphLoader:s2,ttfGlyphLoader:a2,cffGlyphLoader:o2};function oh(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(!oh(t[n],e[n]))return!1;return!0}else return!1}function _o(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function _n(t,e,n){var r=[],s=[],a=ye.getCard16(t,e),u,l;if(a!==0){var f=ye.getByte(t,e+2);u=e+(a+1)*f+2;for(var h=e+3,p=0;p<a+1;p+=1)r.push(ye.getOffset(t,h,f)),h+=f;l=u+r[a]}else l=e+2;for(var g=0;g<r.length-1;g+=1){var v=ye.getBytes(t,u+r[g],u+r[g+1]);n&&(v=n(v)),s.push(v)}return{objects:s,startOffset:e,endOffset:l}}function u2(t,e){var n=[],r=ye.getCard16(t,e),s,a;if(r!==0){var u=ye.getByte(t,e+2);s=e+(r+1)*u+2;for(var l=e+3,f=0;f<r+1;f+=1)n.push(ye.getOffset(t,l,u)),l+=u;a=s+n[r]}else a=e+2;return{offsets:n,startOffset:e,endOffset:a}}function l2(t,e,n,r,s){var a=ye.getCard16(n,r),u=0;if(a!==0){var l=ye.getByte(n,r+2);u=r+(a+1)*l+2}var f=ye.getBytes(n,u+e[t],u+e[t+1]);return f}function c2(t){for(var e="",n=15,r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var s=t.parseByte(),a=s>>4,u=s&15;if(a===n||(e+=r[a],u===n))break;e+=r[u]}return parseFloat(e)}function f2(t,e){var n,r,s,a;if(e===28)return n=t.parseByte(),r=t.parseByte(),n<<8|r;if(e===29)return n=t.parseByte(),r=t.parseByte(),s=t.parseByte(),a=t.parseByte(),n<<24|r<<16|s<<8|a;if(e===30)return c2(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return n=t.parseByte(),(e-247)*256+n+108;if(e>=251&&e<=254)return n=t.parseByte(),-(e-251)*256-n-108;throw new Error("Invalid b0 "+e)}function h2(t){for(var e={},n=0;n<t.length;n+=1){var r=t[n][0],s=t[n][1],a=void 0;if(s.length===1?a=s[0]:a=s,e.hasOwnProperty(r)&&!isNaN(e[r]))throw new Error("Object "+e+" already has key "+r);e[r]=a}return e}function uh(t,e,n){e=e!==void 0?e:0;var r=new ye.Parser(t,e),s=[],a=[];for(n=n!==void 0?n:t.length;r.relativeOffset<n;){var u=r.parseByte();u<=21?(u===12&&(u=1200+r.parseByte()),s.push([u,a]),a=[]):a.push(f2(r,u))}return h2(s)}function ni(t,e){return e<=390?e=ds[e]:e=t[e-391],e}function lh(t,e,n){for(var r={},s,a=0;a<e.length;a+=1){var u=e[a];if(Array.isArray(u.type)){var l=[];l.length=u.type.length;for(var f=0;f<u.type.length;f++)s=t[u.op]!==void 0?t[u.op][f]:void 0,s===void 0&&(s=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(s=ni(n,s)),l[f]=s;r[u.name]=l}else s=t[u.op],s===void 0&&(s=u.value!==void 0?u.value:null),u.type==="SID"&&(s=ni(n,s)),r[u.name]=s}return r}function p2(t,e){var n={};return n.formatMajor=ye.getCard8(t,e),n.formatMinor=ye.getCard8(t,e+1),n.size=ye.getCard8(t,e+2),n.offsetSize=ye.getCard8(t,e+3),n.startOffset=e,n.endOffset=e+4,n}var ch=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],fh=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function d2(t,e){var n=uh(t,0,t.byteLength);return lh(n,ch,e)}function hh(t,e,n,r){var s=uh(t,e,n);return lh(s,fh,r)}function Vc(t,e,n,r){for(var s=[],a=0;a<n.length;a+=1){var u=new DataView(new Uint8Array(n[a]).buffer),l=d2(u,r);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var f=l.private[0],h=l.private[1];if(f!==0&&h!==0){var p=hh(t,h+e,f,r);if(l._defaultWidthX=p.defaultWidthX,l._nominalWidthX=p.nominalWidthX,p.subrs!==0){var g=h+p.subrs,v=_n(t,g+e);l._subrs=v.objects,l._subrsBias=_o(l._subrs)}l._privateDict=p}s.push(l)}return s}function v2(t,e,n,r){var s,a,u=new ye.Parser(t,e);n-=1;var l=[".notdef"],f=u.parseCard8();if(f===0)for(var h=0;h<n;h+=1)s=u.parseSID(),l.push(ni(r,s));else if(f===1)for(;l.length<=n;){s=u.parseSID(),a=u.parseCard8();for(var p=0;p<=a;p+=1)l.push(ni(r,s)),s+=1}else if(f===2)for(;l.length<=n;){s=u.parseSID(),a=u.parseCard16();for(var g=0;g<=a;g+=1)l.push(ni(r,s)),s+=1}else throw new Error("Unknown charset format "+f);return l}function g2(t,e,n){var r,s={},a=new ye.Parser(t,e),u=a.parseCard8();if(u===0)for(var l=a.parseCard8(),f=0;f<l;f+=1)r=a.parseCard8(),s[r]=f;else if(u===1){var h=a.parseCard8();r=1;for(var p=0;p<h;p+=1)for(var g=a.parseCard8(),v=a.parseCard8(),y=g;y<=g+v;y+=1)s[y]=r,r+=1}else throw new Error("Unknown encoding format "+u);return new Fs(s,n)}function Xc(t,e,n){var r,s,a,u,l=new tt,f=[],h=0,p=!1,g=!1,v=0,y=0,w,T,S,O;if(t.isCIDFont){var C=t.tables.cff.topDict._fdSelect[e.index],F=t.tables.cff.topDict._fdArray[C];w=F._subrs,T=F._subrsBias,S=F._defaultWidthX,O=F._nominalWidthX}else w=t.tables.cff.topDict._subrs,T=t.tables.cff.topDict._subrsBias,S=t.tables.cff.topDict._defaultWidthX,O=t.tables.cff.topDict._nominalWidthX;var U=S;function _(q,K){g&&l.closePath(),l.moveTo(q,K),g=!0}function z(){var q;q=f.length%2!==0,q&&!p&&(U=f.shift()+O),h+=f.length>>1,f.length=0,p=!0}function V(q){for(var K,ee,ne,oe,ie,ue,pe,ge,le,Ce,Le,Ee,be=0;be<q.length;){var Ie=q[be];switch(be+=1,Ie){case 1:z();break;case 3:z();break;case 4:f.length>1&&!p&&(U=f.shift()+O,p=!0),y+=f.pop(),_(v,y);break;case 5:for(;f.length>0;)v+=f.shift(),y+=f.shift(),l.lineTo(v,y);break;case 6:for(;f.length>0&&(v+=f.shift(),l.lineTo(v,y),f.length!==0);)y+=f.shift(),l.lineTo(v,y);break;case 7:for(;f.length>0&&(y+=f.shift(),l.lineTo(v,y),f.length!==0);)v+=f.shift(),l.lineTo(v,y);break;case 8:for(;f.length>0;)r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u+f.shift(),l.curveTo(r,s,a,u,v,y);break;case 10:ie=f.pop()+T,ue=w[ie],ue&&V(ue);break;case 11:return;case 12:switch(Ie=q[be],be+=1,Ie){case 35:r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),pe=a+f.shift(),ge=u+f.shift(),le=pe+f.shift(),Ce=ge+f.shift(),Le=le+f.shift(),Ee=Ce+f.shift(),v=Le+f.shift(),y=Ee+f.shift(),f.shift(),l.curveTo(r,s,a,u,pe,ge),l.curveTo(le,Ce,Le,Ee,v,y);break;case 34:r=v+f.shift(),s=y,a=r+f.shift(),u=s+f.shift(),pe=a+f.shift(),ge=u,le=pe+f.shift(),Ce=u,Le=le+f.shift(),Ee=y,v=Le+f.shift(),l.curveTo(r,s,a,u,pe,ge),l.curveTo(le,Ce,Le,Ee,v,y);break;case 36:r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),pe=a+f.shift(),ge=u,le=pe+f.shift(),Ce=u,Le=le+f.shift(),Ee=Ce+f.shift(),v=Le+f.shift(),l.curveTo(r,s,a,u,pe,ge),l.curveTo(le,Ce,Le,Ee,v,y);break;case 37:r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),pe=a+f.shift(),ge=u+f.shift(),le=pe+f.shift(),Ce=ge+f.shift(),Le=le+f.shift(),Ee=Ce+f.shift(),Math.abs(Le-v)>Math.abs(Ee-y)?v=Le+f.shift():y=Ee+f.shift(),l.curveTo(r,s,a,u,pe,ge),l.curveTo(le,Ce,Le,Ee,v,y);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Ie),f.length=0}break;case 14:f.length>0&&!p&&(U=f.shift()+O,p=!0),g&&(l.closePath(),g=!1);break;case 18:z();break;case 19:case 20:z(),be+=h+7>>3;break;case 21:f.length>2&&!p&&(U=f.shift()+O,p=!0),y+=f.pop(),v+=f.pop(),_(v,y);break;case 22:f.length>1&&!p&&(U=f.shift()+O,p=!0),v+=f.pop(),_(v,y);break;case 23:z();break;case 24:for(;f.length>2;)r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u+f.shift(),l.curveTo(r,s,a,u,v,y);v+=f.shift(),y+=f.shift(),l.lineTo(v,y);break;case 25:for(;f.length>6;)v+=f.shift(),y+=f.shift(),l.lineTo(v,y);r=v+f.shift(),s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u+f.shift(),l.curveTo(r,s,a,u,v,y);break;case 26:for(f.length%2&&(v+=f.shift());f.length>0;)r=v,s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a,y=u+f.shift(),l.curveTo(r,s,a,u,v,y);break;case 27:for(f.length%2&&(y+=f.shift());f.length>0;)r=v+f.shift(),s=y,a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u,l.curveTo(r,s,a,u,v,y);break;case 28:K=q[be],ee=q[be+1],f.push((K<<24|ee<<16)>>16),be+=2;break;case 29:ie=f.pop()+t.gsubrsBias,ue=t.gsubrs[ie],ue&&V(ue);break;case 30:for(;f.length>0&&(r=v,s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u+(f.length===1?f.shift():0),l.curveTo(r,s,a,u,v,y),f.length!==0);)r=v+f.shift(),s=y,a=r+f.shift(),u=s+f.shift(),y=u+f.shift(),v=a+(f.length===1?f.shift():0),l.curveTo(r,s,a,u,v,y);break;case 31:for(;f.length>0&&(r=v+f.shift(),s=y,a=r+f.shift(),u=s+f.shift(),y=u+f.shift(),v=a+(f.length===1?f.shift():0),l.curveTo(r,s,a,u,v,y),f.length!==0);)r=v,s=y+f.shift(),a=r+f.shift(),u=s+f.shift(),v=a+f.shift(),y=u+(f.length===1?f.shift():0),l.curveTo(r,s,a,u,v,y);break;default:Ie<32?console.log("Glyph "+e.index+": unknown operator "+Ie):Ie<247?f.push(Ie-139):Ie<251?(K=q[be],be+=1,f.push((Ie-247)*256+K+108)):Ie<255?(K=q[be],be+=1,f.push(-(Ie-251)*256-K-108)):(K=q[be],ee=q[be+1],ne=q[be+2],oe=q[be+3],be+=4,f.push((K<<24|ee<<16|ne<<8|oe)/65536))}}}return V(n),e.advanceWidth=U,l}function m2(t,e,n,r){var s=[],a,u=new ye.Parser(t,e),l=u.parseCard8();if(l===0)for(var f=0;f<n;f++){if(a=u.parseCard8(),a>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+r+")");s.push(a)}else if(l===3){var h=u.parseCard16(),p=u.parseCard16();if(p!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+p);for(var g,v=0;v<h;v++){if(a=u.parseCard8(),g=u.parseCard16(),a>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+r+")");if(g>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;p<g;p++)s.push(a);p=g}if(g!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return s}function y2(t,e,n,r){n.tables.cff={};var s=p2(t,e),a=_n(t,s.endOffset,ye.bytesToString),u=_n(t,a.endOffset),l=_n(t,u.endOffset,ye.bytesToString),f=_n(t,l.endOffset);n.gsubrs=f.objects,n.gsubrsBias=_o(n.gsubrs);var h=Vc(t,e,u.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var p=h[0];if(n.tables.cff.topDict=p,p._privateDict&&(n.defaultWidthX=p._privateDict.defaultWidthX,n.nominalWidthX=p._privateDict.nominalWidthX),p.ros[0]!==void 0&&p.ros[1]!==void 0&&(n.isCIDFont=!0),n.isCIDFont){var g=p.fdArray,v=p.fdSelect;if(g===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var y=_n(t,g),w=Vc(t,e,y.objects,l.objects);p._fdArray=w,v+=e,p._fdSelect=m2(t,v,n.numGlyphs,w.length)}var T=e+p.private[1],S=hh(t,T,p.private[0],l.objects);if(n.defaultWidthX=S.defaultWidthX,n.nominalWidthX=S.nominalWidthX,S.subrs!==0){var O=T+S.subrs,C=_n(t,O);n.subrs=C.objects,n.subrsBias=_o(n.subrs)}else n.subrs=[],n.subrsBias=0;var F;r.lowMemory?(F=u2(t,e+p.charStrings),n.nGlyphs=F.offsets.length):(F=_n(t,e+p.charStrings),n.nGlyphs=F.objects.length);var U=v2(t,e+p.charset,n.nGlyphs,l.objects);if(p.encoding===0?n.cffEncoding=new Fs(t2,U):p.encoding===1?n.cffEncoding=new Fs(n2,U):n.cffEncoding=g2(t,e+p.encoding,U),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new sn.GlyphSet(n),r.lowMemory)n._push=function(V){var q=l2(V,F.offsets,t,e+p.charStrings);n.glyphs.push(V,sn.cffGlyphLoader(n,V,Xc,q))};else for(var _=0;_<n.nGlyphs;_+=1){var z=F.objects[_];n.glyphs.push(_,sn.cffGlyphLoader(n,_,Xc,z))}}function ph(t,e){var n,r=ds.indexOf(t);return r>=0&&(n=r),r=e.indexOf(t),r>=0?n=r+ds.length:(n=ds.length+e.length,e.push(t)),n}function x2(){return new Q.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function b2(t){var e=new Q.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var n=0;n<t.length;n+=1)e.names.push({name:"name_"+n,type:"NAME",value:t[n]});return e}function dh(t,e,n){for(var r={},s=0;s<t.length;s+=1){var a=t[s],u=e[a.name];u!==void 0&&!oh(u,a.value)&&(a.type==="SID"&&(u=ph(u,n)),r[a.op]={name:a.name,type:a.type,value:u})}return r}function Yc(t,e){var n=new Q.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=dh(ch,t,e),n}function Kc(t){var e=new Q.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function w2(t){var e=new Q.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var n=0;n<t.length;n+=1)e.strings.push({name:"string_"+n,type:"STRING",value:t[n]});return e}function S2(){return new Q.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function T2(t,e){for(var n=new Q.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<t.length;r+=1){var s=t[r],a=ph(s,e);n.fields.push({name:"glyph_"+r,type:"SID",value:a})}return n}function E2(t){var e=[],n=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var r=0,s=0,a=0;a<n.commands.length;a+=1){var u=void 0,l=void 0,f=n.commands[a];if(f.type==="Q"){var h=.3333333333333333,p=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(h*r+p*f.x1),y1:Math.round(h*s+p*f.y1),x2:Math.round(h*f.x+p*f.x1),y2:Math.round(h*f.y+p*f.y1)}}if(f.type==="M")u=Math.round(f.x-r),l=Math.round(f.y-s),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(f.x),s=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-r),l=Math.round(f.y-s),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),r=Math.round(f.x),s=Math.round(f.y);else if(f.type==="C"){var g=Math.round(f.x1-r),v=Math.round(f.y1-s),y=Math.round(f.x2-f.x1),w=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),l=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:y}),e.push({name:"dy2",type:"NUMBER",value:w}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(f.x),s=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function O2(t){for(var e=new Q.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<t.length;n+=1){var r=t.get(n),s=E2(r);e.charStrings.push({name:r.name,type:"CHARSTRING",value:s})}return e}function C2(t,e){var n=new Q.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=dh(fh,t,e),n}function F2(t,e){for(var n=new Q.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),r=1/e.unitsPerEm,s={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[r,0,0,r,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},a={},u=[],l,f=1;f<t.length;f+=1)l=t.get(f),u.push(l.name);var h=[];n.header=x2(),n.nameIndex=b2([e.postScriptName]);var p=Yc(s,h);n.topDictIndex=Kc(p),n.globalSubrIndex=S2(),n.charsets=T2(u,h),n.charStringsIndex=O2(t),n.privateDict=C2(a,h),n.stringIndex=w2(h);var g=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return s.charset=g,s.encoding=0,s.charStrings=s.charset+n.charsets.sizeOf(),s.private[1]=s.charStrings+n.charStringsIndex.sizeOf(),p=Yc(s,h),n.topDictIndex=Kc(p),n}var A2={parse:y2,make:F2};function R2(t,e){var n={},r=new ye.Parser(t,e);return n.version=r.parseVersion(),n.fontRevision=Math.round(r.parseFixed()*1e3)/1e3,n.checkSumAdjustment=r.parseULong(),n.magicNumber=r.parseULong(),he.argument(n.magicNumber===1594834165,"Font header has wrong magic number."),n.flags=r.parseUShort(),n.unitsPerEm=r.parseUShort(),n.created=r.parseLongDateTime(),n.modified=r.parseLongDateTime(),n.xMin=r.parseShort(),n.yMin=r.parseShort(),n.xMax=r.parseShort(),n.yMax=r.parseShort(),n.macStyle=r.parseUShort(),n.lowestRecPPEM=r.parseUShort(),n.fontDirectionHint=r.parseShort(),n.indexToLocFormat=r.parseShort(),n.glyphDataFormat=r.parseShort(),n}function L2(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,n=e;return t.createdTimestamp&&(n=t.createdTimestamp+2082844800),new Q.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var _2={parse:R2,make:L2};function U2(t,e){var n={},r=new ye.Parser(t,e);return n.version=r.parseVersion(),n.ascender=r.parseShort(),n.descender=r.parseShort(),n.lineGap=r.parseShort(),n.advanceWidthMax=r.parseUShort(),n.minLeftSideBearing=r.parseShort(),n.minRightSideBearing=r.parseShort(),n.xMaxExtent=r.parseShort(),n.caretSlopeRise=r.parseShort(),n.caretSlopeRun=r.parseShort(),n.caretOffset=r.parseShort(),r.relativeOffset+=8,n.metricDataFormat=r.parseShort(),n.numberOfHMetrics=r.parseUShort(),n}function k2(t){return new Q.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var M2={parse:U2,make:k2};function B2(t,e,n,r,s){for(var a,u,l=new ye.Parser(t,e),f=0;f<r;f+=1){f<n&&(a=l.parseUShort(),u=l.parseShort());var h=s.get(f);h.advanceWidth=a,h.leftSideBearing=u}}function P2(t,e,n,r,s){t._hmtxTableData={};for(var a,u,l=new ye.Parser(e,n),f=0;f<s;f+=1)f<r&&(a=l.parseUShort(),u=l.parseShort()),t._hmtxTableData[f]={advanceWidth:a,leftSideBearing:u}}function D2(t,e,n,r,s,a,u){u.lowMemory?P2(t,e,n,r,s):B2(e,n,r,s,a)}function I2(t){for(var e=new Q.Table("hmtx",[]),n=0;n<t.length;n+=1){var r=t.get(n),s=r.advanceWidth||0,a=r.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:s}),e.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:a})}return e}var N2={parse:D2,make:I2};function G2(t){for(var e=new Q.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),n="",r=12+t.length*4,s=0;s<t.length;++s){var a=n.indexOf(t[s]);a<0&&(a=n.length,n+=t[s]),e.fields.push({name:"offset "+s,type:"USHORT",value:r+a}),e.fields.push({name:"length "+s,type:"USHORT",value:t[s].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),e}function z2(t,e){var n=new ye.Parser(t,e),r=n.parseULong();he.argument(r===1,"Unsupported ltag table version."),n.skip("uLong",1);for(var s=n.parseULong(),a=[],u=0;u<s;u++){for(var l="",f=e+n.parseUShort(),h=n.parseUShort(),p=f;p<f+h;++p)l+=String.fromCharCode(t.getInt8(p));a.push(l)}return a}var H2={make:G2,parse:z2};function q2(t,e){var n={},r=new ye.Parser(t,e);return n.version=r.parseVersion(),n.numGlyphs=r.parseUShort(),n.version===1&&(n.maxPoints=r.parseUShort(),n.maxContours=r.parseUShort(),n.maxCompositePoints=r.parseUShort(),n.maxCompositeContours=r.parseUShort(),n.maxZones=r.parseUShort(),n.maxTwilightPoints=r.parseUShort(),n.maxStorage=r.parseUShort(),n.maxFunctionDefs=r.parseUShort(),n.maxInstructionDefs=r.parseUShort(),n.maxStackElements=r.parseUShort(),n.maxSizeOfInstructions=r.parseUShort(),n.maxComponentElements=r.parseUShort(),n.maxComponentDepth=r.parseUShort()),n}function W2(t){return new Q.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var V2={parse:q2,make:W2},vh=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],gh={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},X2={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},mh={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Y2(t,e,n){switch(t){case 0:if(e===65535)return"und";if(n)return n[e];break;case 1:return gh[e];case 3:return mh[e]}}var Uo="utf-16",K2={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Z2={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function yh(t,e,n){switch(t){case 0:return Uo;case 1:return Z2[n]||K2[e];case 3:if(e===1||e===10)return Uo;break}}function $2(t,e,n){for(var r={},s=new ye.Parser(t,e),a=s.parseUShort(),u=s.parseUShort(),l=s.offset+s.parseUShort(),f=0;f<u;f++){var h=s.parseUShort(),p=s.parseUShort(),g=s.parseUShort(),v=s.parseUShort(),y=vh[v]||v,w=s.parseUShort(),T=s.parseUShort(),S=Y2(h,g,n),O=yh(h,p,g);if(O!==void 0&&S!==void 0){var C=void 0;if(O===Uo?C=Tr.UTF16(t,l+T,w):C=Tr.MACSTRING(t,l+T,w,O),C){var F=r[y];F===void 0&&(F=r[y]={}),F[S]=C}}}return a===1&&s.parseUShort(),r}function lo(t){var e={};for(var n in t)e[t[n]]=parseInt(n);return e}function Zc(t,e,n,r,s,a){return new Q.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:s},{name:"offset",type:"USHORT",value:a}])}function J2(t,e){var n=t.length,r=e.length-n+1;e:for(var s=0;s<r;s++)for(;s<r;s++){for(var a=0;a<n;a++)if(e[s+a]!==t[a])continue e;return s}return-1}function $c(t,e){var n=J2(t,e);if(n<0){n=e.length;for(var r=0,s=t.length;r<s;++r)e.push(t[r])}return n}function Q2(t,e){var n,r=[],s={},a=lo(vh);for(var u in t){var l=a[u];if(l===void 0&&(l=u),n=parseInt(l),isNaN(n))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');s[n]=t[u],r.push(n)}for(var f=lo(gh),h=lo(mh),p=[],g=[],v=0;v<r.length;v++){n=r[v];var y=s[n];for(var w in y){var T=y[w],S=1,O=f[w],C=X2[O],F=yh(S,C,O),U=X.MACSTRING(T,F);U===void 0&&(S=0,O=e.indexOf(w),O<0&&(O=e.length,e.push(w)),C=4,U=X.UTF16(T));var _=$c(U,g);p.push(Zc(S,C,O,n,U.length,_));var z=h[w];if(z!==void 0){var V=X.UTF16(T),q=$c(V,g);p.push(Zc(3,1,z,n,V.length,q))}}}p.sort(function(ne,oe){return ne.platformID-oe.platformID||ne.encodingID-oe.encodingID||ne.languageID-oe.languageID||ne.nameID-oe.nameID});for(var K=new Q.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:p.length},{name:"stringOffset",type:"USHORT",value:6+p.length*12}]),ee=0;ee<p.length;ee++)K.fields.push({name:"record_"+ee,type:"RECORD",value:p[ee]});return K.fields.push({name:"strings",type:"LITERAL",value:g}),K}var j2={parse:$2,make:Q2},ko=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function eb(t){for(var e=0;e<ko.length;e+=1){var n=ko[e];if(t>=n.begin&&t<n.end)return e}return-1}function tb(t,e){var n={},r=new ye.Parser(t,e);n.version=r.parseUShort(),n.xAvgCharWidth=r.parseShort(),n.usWeightClass=r.parseUShort(),n.usWidthClass=r.parseUShort(),n.fsType=r.parseUShort(),n.ySubscriptXSize=r.parseShort(),n.ySubscriptYSize=r.parseShort(),n.ySubscriptXOffset=r.parseShort(),n.ySubscriptYOffset=r.parseShort(),n.ySuperscriptXSize=r.parseShort(),n.ySuperscriptYSize=r.parseShort(),n.ySuperscriptXOffset=r.parseShort(),n.ySuperscriptYOffset=r.parseShort(),n.yStrikeoutSize=r.parseShort(),n.yStrikeoutPosition=r.parseShort(),n.sFamilyClass=r.parseShort(),n.panose=[];for(var s=0;s<10;s++)n.panose[s]=r.parseByte();return n.ulUnicodeRange1=r.parseULong(),n.ulUnicodeRange2=r.parseULong(),n.ulUnicodeRange3=r.parseULong(),n.ulUnicodeRange4=r.parseULong(),n.achVendID=String.fromCharCode(r.parseByte(),r.parseByte(),r.parseByte(),r.parseByte()),n.fsSelection=r.parseUShort(),n.usFirstCharIndex=r.parseUShort(),n.usLastCharIndex=r.parseUShort(),n.sTypoAscender=r.parseShort(),n.sTypoDescender=r.parseShort(),n.sTypoLineGap=r.parseShort(),n.usWinAscent=r.parseUShort(),n.usWinDescent=r.parseUShort(),n.version>=1&&(n.ulCodePageRange1=r.parseULong(),n.ulCodePageRange2=r.parseULong()),n.version>=2&&(n.sxHeight=r.parseShort(),n.sCapHeight=r.parseShort(),n.usDefaultChar=r.parseUShort(),n.usBreakChar=r.parseUShort(),n.usMaxContent=r.parseUShort()),n}function nb(t){return new Q.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var Jc={parse:tb,make:nb,unicodeRanges:ko,getUnicodeRange:eb};function rb(t,e){var n={},r=new ye.Parser(t,e);switch(n.version=r.parseVersion(),n.italicAngle=r.parseFixed(),n.underlinePosition=r.parseShort(),n.underlineThickness=r.parseShort(),n.isFixedPitch=r.parseULong(),n.minMemType42=r.parseULong(),n.maxMemType42=r.parseULong(),n.minMemType1=r.parseULong(),n.maxMemType1=r.parseULong(),n.version){case 1:n.names=Wc.slice();break;case 2:n.numberOfGlyphs=r.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var s=0;s<n.numberOfGlyphs;s++)n.glyphNameIndex[s]=r.parseUShort();n.names=[];for(var a=0;a<n.numberOfGlyphs;a++)if(n.glyphNameIndex[a]>=Wc.length){var u=r.parseChar();n.names.push(r.parseString(u))}break;case 2.5:n.numberOfGlyphs=r.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var l=0;l<n.numberOfGlyphs;l++)n.offset[l]=r.parseChar();break}return n}function ib(){return new Q.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var sb={parse:rb,make:ib},Yt=new Array(9);Yt[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(B.coverage),deltaGlyphId:this.parseUShort()};if(n===2)return{substFormat:2,coverage:this.parsePointer(B.coverage),substitute:this.parseOffset16List()};he.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Yt[2]=function(){var e=this.parseUShort();return he.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(B.coverage),sequences:this.parseListOfLists()}};Yt[3]=function(){var e=this.parseUShort();return he.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(B.coverage),alternateSets:this.parseListOfLists()}};Yt[4]=function(){var e=this.parseUShort();return he.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(B.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Sr={sequenceIndex:B.uShort,lookupListIndex:B.uShort};Yt[5]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:n,coverage:this.parsePointer(B.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(u,Sr)}})};if(n===2)return{substFormat:n,coverage:this.parsePointer(B.coverage),classDef:this.parsePointer(B.classDef),classSets:this.parseListOfLists(function(){var a=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(u,Sr)}})};if(n===3){var r=this.parseUShort(),s=this.parseUShort();return{substFormat:n,coverages:this.parseList(r,B.pointer(B.coverage)),lookupRecords:this.parseRecordList(s,Sr)}}he.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Yt[6]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(B.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Sr)}})};if(n===2)return{substFormat:2,coverage:this.parsePointer(B.coverage),backtrackClassDef:this.parsePointer(B.classDef),inputClassDef:this.parsePointer(B.classDef),lookaheadClassDef:this.parsePointer(B.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Sr)}})};if(n===3)return{substFormat:3,backtrackCoverage:this.parseList(B.pointer(B.coverage)),inputCoverage:this.parseList(B.pointer(B.coverage)),lookaheadCoverage:this.parseList(B.pointer(B.coverage)),lookupRecords:this.parseRecordList(Sr)};he.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Yt[7]=function(){var e=this.parseUShort();he.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var n=this.parseUShort(),r=new B(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:n,extension:Yt[n].call(r)}};Yt[8]=function(){var e=this.parseUShort();return he.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(B.coverage),backtrackCoverage:this.parseList(B.pointer(B.coverage)),lookaheadCoverage:this.parseList(B.pointer(B.coverage)),substitutes:this.parseUShortList()}};function ab(t,e){e=e||0;var n=new B(t,e),r=n.parseVersion(1);return he.argument(r===1||r===1.1,"Unsupported GSUB table version."),r===1?{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(Yt)}:{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(Yt),variations:n.parseFeatureVariationsList()}}var Er=new Array(9);Er[1]=function(e){return e.substFormat===1?new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)}].concat(Q.ushortList("substitute",e.substitute)))};Er[2]=function(e){return he.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)}].concat(Q.tableList("seqSet",e.sequences,function(n){return new Q.Table("sequenceSetTable",Q.ushortList("sequence",n))})))};Er[3]=function(e){return he.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)}].concat(Q.tableList("altSet",e.alternateSets,function(n){return new Q.Table("alternateSetTable",Q.ushortList("alternate",n))})))};Er[4]=function(e){return he.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Q.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)}].concat(Q.tableList("ligSet",e.ligatureSets,function(n){return new Q.Table("ligatureSetTable",Q.tableList("ligature",n,function(r){return new Q.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:r.ligGlyph}].concat(Q.ushortList("component",r.components,r.components.length+1)))}))})))};Er[6]=function(e){if(e.substFormat===1){var n=new Q.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Q.Coverage(e.coverage)}].concat(Q.tableList("chainRuleSet",e.chainRuleSets,function(a){return new Q.Table("chainRuleSetTable",Q.tableList("chainRule",a,function(u){var l=Q.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(Q.ushortList("inputGlyph",u.input,u.input.length+1)).concat(Q.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(Q.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:f.lookupListIndex})}),new Q.Table("chainRuleTable",l)}))})));return n}else if(e.substFormat===2)he.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var r=[{name:"substFormat",type:"USHORT",value:e.substFormat}];r.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(a,u){r.push({name:"backtrackCoverage"+u,type:"TABLE",value:new Q.Coverage(a)})}),r.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(a,u){r.push({name:"inputCoverage"+u,type:"TABLE",value:new Q.Coverage(a)})}),r.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(a,u){r.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new Q.Coverage(a)})}),r.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(a,u){r=r.concat({name:"sequenceIndex"+u,type:"USHORT",value:a.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:a.lookupListIndex})});var s=new Q.Table("chainContextTable",r);return s}he.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function ob(t){return new Q.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Q.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new Q.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new Q.LookupList(t.lookups,Er)}])}var ub={parse:ab,make:ob};function lb(t,e){var n=new ye.Parser(t,e),r=n.parseULong();he.argument(r===1,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var s=n.parseULong(),a={},u=0;u<s;u++){var l=n.parseTag(),f=n.parseULong(),h=n.parseULong(),p=Tr.UTF8(t,e+f,h);a[l]=p}return a}function cb(t){var e=Object.keys(t).length,n="",r=16+e*12,s=new Q.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:r},{name:"numTags",type:"ULONG",value:e}]);for(var a in t){var u=n.length;n+=t[a],s.fields.push({name:"tag "+a,type:"TAG",value:a}),s.fields.push({name:"offset "+a,type:"ULONG",value:r+u}),s.fields.push({name:"length "+a,type:"ULONG",value:t[a].length})}return s.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),s}var fb={parse:lb,make:cb};function Qc(t){return Math.log(t)/Math.log(2)|0}function Vo(t){for(;t.length%4!==0;)t.push(0);for(var e=0,n=0;n<t.length;n+=4)e+=(t[n]<<24)+(t[n+1]<<16)+(t[n+2]<<8)+t[n+3];return e%=Math.pow(2,32),e}function jc(t,e,n,r){return new Q.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:n!==void 0?n:0},{name:"length",type:"ULONG",value:r!==void 0?r:0}])}function xh(t){var e=new Q.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var n=Math.pow(2,Qc(e.numTables));e.searchRange=16*n,e.entrySelector=Qc(n),e.rangeShift=e.numTables*16-e.searchRange;for(var r=[],s=[],a=e.sizeOf()+jc().sizeOf()*e.numTables;a%4!==0;)a+=1,s.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var l=t[u];he.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var f=l.sizeOf(),h=jc(l.tableName,Vo(l.encode()),a,f);for(r.push({name:h.tag+" Table Record",type:"RECORD",value:h}),s.push({name:l.tableName+" table",type:"RECORD",value:l}),a+=f,he.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!==0;)a+=1,s.push({name:"padding",type:"BYTE",value:0})}return r.sort(function(p,g){return p.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(r),e.fields=e.fields.concat(s),e}function ef(t,e,n){for(var r=0;r<e.length;r+=1){var s=t.charToGlyphIndex(e[r]);if(s>0){var a=t.glyphs.get(s);return a.getMetrics()}}return n}function hb(t){for(var e=0,n=0;n<t.length;n+=1)e+=t[n];return e/t.length}function pb(t){for(var e=[],n=[],r=[],s=[],a=[],u=[],l=[],f,h=0,p=0,g=0,v=0,y=0,w=0;w<t.glyphs.length;w+=1){var T=t.glyphs.get(w),S=T.unicode|0;if(isNaN(T.advanceWidth))throw new Error("Glyph "+T.name+" ("+w+"): advanceWidth is not a number.");(f>S||f===void 0)&&S>0&&(f=S),h<S&&(h=S);var O=Jc.getUnicodeRange(S);if(O<32)p|=1<<O;else if(O<64)g|=1<<O-32;else if(O<96)v|=1<<O-64;else if(O<123)y|=1<<O-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(T.name!==".notdef"){var C=T.getMetrics();e.push(C.xMin),n.push(C.yMin),r.push(C.xMax),s.push(C.yMax),u.push(C.leftSideBearing),l.push(C.rightSideBearing),a.push(T.advanceWidth)}}var F={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,a),advanceWidthAvg:hb(a),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,l)};F.ascender=t.ascender,F.descender=t.descender;var U=_2.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:F.xMin,yMin:F.yMin,xMax:F.xMax,yMax:F.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),_=M2.make({ascender:F.ascender,descender:F.descender,advanceWidthMax:F.advanceWidthMax,minLeftSideBearing:F.minLeftSideBearing,minRightSideBearing:F.minRightSideBearing,xMaxExtent:F.maxLeftSideBearing+(F.xMax-F.xMin),numberOfHMetrics:t.glyphs.length}),z=V2.make(t.glyphs.length),V=Jc.make(Object.assign({xAvgCharWidth:Math.round(F.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:h,ulUnicodeRange1:p,ulUnicodeRange2:g,ulUnicodeRange3:v,ulUnicodeRange4:y,sTypoAscender:F.ascender,sTypoDescender:F.descender,sTypoLineGap:0,usWinAscent:F.yMax,usWinDescent:Math.abs(F.yMin),ulCodePageRange1:1,sxHeight:ef(t,"xyvw",{yMax:Math.round(F.ascender/2)}).yMax,sCapHeight:ef(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",F).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),q=N2.make(t.glyphs),K=e2.make(t.glyphs),ee=t.getEnglishName("fontFamily"),ne=t.getEnglishName("fontSubfamily"),oe=ee+" "+ne,ie=t.getEnglishName("postScriptName");ie||(ie=ee.replace(/\s/g,"")+"-"+ne);var ue={};for(var pe in t.names)ue[pe]=t.names[pe];ue.uniqueID||(ue.uniqueID={en:t.getEnglishName("manufacturer")+":"+oe}),ue.postScriptName||(ue.postScriptName={en:ie}),ue.preferredFamily||(ue.preferredFamily=t.names.fontFamily),ue.preferredSubfamily||(ue.preferredSubfamily=t.names.fontSubfamily);var ge=[],le=j2.make(ue,ge),Ce=ge.length>0?H2.make(ge):void 0,Le=sb.make(),Ee=A2.make(t.glyphs,{version:t.getEnglishName("version"),fullName:oe,familyName:ee,weightName:ne,postScriptName:ie,unitsPerEm:t.unitsPerEm,fontBBox:[0,F.yMin,F.ascender,F.advanceWidthMax]}),be=t.metas&&Object.keys(t.metas).length>0?fb.make(t.metas):void 0,Ie=[U,_,z,V,le,K,Le,Ee,q];Ce&&Ie.push(Ce),t.tables.gsub&&Ie.push(ub.make(t.tables.gsub)),be&&Ie.push(be);for(var Ze=xh(Ie),Lt=Ze.encode(),Je=Vo(Lt),Pe=Ze.fields,ft=!1,$e=0;$e<Pe.length;$e+=1)if(Pe[$e].name==="head table"){Pe[$e].value.checkSumAdjustment=2981146554-Je,ft=!0;break}if(!ft)throw new Error("Could not find head table with checkSum to adjust.");return Ze}var db={make:xh,fontToTable:pb,computeCheckSum:Vo};function co(t,e){for(var n=0,r=t.length-1;n<=r;){var s=n+r>>>1,a=t[s].tag;if(a===e)return s;a<e?n=s+1:r=s-1}return-n-1}function tf(t,e){for(var n=0,r=t.length-1;n<=r;){var s=n+r>>>1,a=t[s];if(a===e)return s;a<e?n=s+1:r=s-1}return-n-1}function nf(t,e){for(var n,r=0,s=t.length-1;r<=s;){var a=r+s>>>1;n=t[a];var u=n.start;if(u===e)return n;u<e?r=a+1:s=a-1}if(r>0)return n=t[r-1],e>n.end?0:n}function ui(t,e){this.font=t,this.tableName=e}ui.prototype={searchTag:co,binSearch:tf,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,n=0;n<t.scripts.length;n++){var r=t.scripts[n].tag;if(r==="DFLT")return r;r==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var n=this.getTable(e);if(n){t=t||"DFLT";var r=n.scripts,s=co(n.scripts,t);if(s>=0)return r[s].script;if(e){var a={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return r.splice(-1-s,0,a),a.script}}},getLangSysTable:function(t,e,n){var r=this.getScriptTable(t,n);if(r){if(!e||e==="dflt"||e==="DFLT")return r.defaultLangSys;var s=co(r.langSysRecords,e);if(s>=0)return r.langSysRecords[s].langSys;if(n){var a={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return r.langSysRecords.splice(-1-s,0,a),a.langSys}}},getFeatureTable:function(t,e,n,r){var s=this.getLangSysTable(t,e,r);if(s){for(var a,u=s.featureIndexes,l=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(a=l[u[f]],a.tag===n)return a.feature;if(r){var h=l.length;return he.assert(h===0||n>=l[h-1].tag,"Features must be added in alphabetical order."),a={tag:n,feature:{params:0,lookupListIndexes:[]}},l.push(a),u.push(h),a.feature}}},getLookupTables:function(t,e,n,r,s){var a=this.getFeatureTable(t,e,n,s),u=[];if(a){for(var l,f=a.lookupListIndexes,h=this.font.tables[this.tableName].lookups,p=0;p<f.length;p++)l=h[f[p]],l.lookupType===r&&u.push(l);if(u.length===0&&s){l={lookupType:r,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),f.push(g),[l]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var n=nf(t.ranges,e);return n?n.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var n=tf(t.glyphs,e);return n>=0?n:-1;case 2:var r=nf(t.ranges,e);return r?r.index+e-r.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],n=t.ranges,r=0;r<n.length;r++)for(var s=n[r],a=s.start,u=s.end,l=a;l<=u;l++)e.push(l);return e}};function li(t){ui.call(this,t,"gpos")}li.prototype=ui.prototype;li.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};li.prototype.getKerningValue=function(t,e,n){for(var r=0;r<t.length;r++)for(var s=t[r].subtables,a=0;a<s.length;a++){var u=s[a],l=this.getCoverageIndex(u.coverage,e);if(!(l<0))switch(u.posFormat){case 1:for(var f=u.pairSets[l],h=0;h<f.length;h++){var p=f[h];if(p.secondGlyph===n)return p.value1&&p.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(u.classDef1,e),v=this.getGlyphClass(u.classDef2,n),y=u.classRecords[g][v];return y.value1&&y.value1.xAdvance||0}}return 0};li.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function At(t){ui.call(this,t,"gsub")}function vb(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function Xo(t,e,n){for(var r=t.subtables,s=0;s<r.length;s++){var a=r[s];if(a.substFormat===e)return a}if(n)return r.push(n),n}At.prototype=ui.prototype;At.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};At.prototype.getSingle=function(t,e,n){for(var r=[],s=this.getLookupTables(e,n,t,1),a=0;a<s.length;a++)for(var u=s[a].subtables,l=0;l<u.length;l++){var f=u[l],h=this.expandCoverage(f.coverage),p=void 0;if(f.substFormat===1){var g=f.deltaGlyphId;for(p=0;p<h.length;p++){var v=h[p];r.push({sub:v,by:v+g})}}else{var y=f.substitute;for(p=0;p<h.length;p++)r.push({sub:h[p],by:y[p]})}}return r};At.prototype.getMultiple=function(t,e,n){for(var r=[],s=this.getLookupTables(e,n,t,2),a=0;a<s.length;a++)for(var u=s[a].subtables,l=0;l<u.length;l++){var f=u[l],h=this.expandCoverage(f.coverage),p=void 0;for(p=0;p<h.length;p++){var g=h[p],v=f.sequences[p];r.push({sub:g,by:v})}}return r};At.prototype.getAlternates=function(t,e,n){for(var r=[],s=this.getLookupTables(e,n,t,3),a=0;a<s.length;a++)for(var u=s[a].subtables,l=0;l<u.length;l++)for(var f=u[l],h=this.expandCoverage(f.coverage),p=f.alternateSets,g=0;g<h.length;g++)r.push({sub:h[g],by:p[g]});return r};At.prototype.getLigatures=function(t,e,n){for(var r=[],s=this.getLookupTables(e,n,t,4),a=0;a<s.length;a++)for(var u=s[a].subtables,l=0;l<u.length;l++)for(var f=u[l],h=this.expandCoverage(f.coverage),p=f.ligatureSets,g=0;g<h.length;g++)for(var v=h[g],y=p[g],w=0;w<y.length;w++){var T=y[w];r.push({sub:[v].concat(T.components),by:T.ligGlyph})}return r};At.prototype.addSingle=function(t,e,n,r){var s=this.getLookupTables(n,r,t,1,!0)[0],a=Xo(s,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});he.assert(a.coverage.format===1,"Single: unable to modify coverage table format "+a.coverage.format);var u=e.sub,l=this.binSearch(a.coverage.glyphs,u);l<0&&(l=-1-l,a.coverage.glyphs.splice(l,0,u),a.substitute.splice(l,0,0)),a.substitute[l]=e.by};At.prototype.addMultiple=function(t,e,n,r){he.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var s=this.getLookupTables(n,r,t,2,!0)[0],a=Xo(s,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});he.assert(a.coverage.format===1,"Multiple: unable to modify coverage table format "+a.coverage.format);var u=e.sub,l=this.binSearch(a.coverage.glyphs,u);l<0&&(l=-1-l,a.coverage.glyphs.splice(l,0,u),a.sequences.splice(l,0,0)),a.sequences[l]=e.by};At.prototype.addAlternate=function(t,e,n,r){var s=this.getLookupTables(n,r,t,3,!0)[0],a=Xo(s,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});he.assert(a.coverage.format===1,"Alternate: unable to modify coverage table format "+a.coverage.format);var u=e.sub,l=this.binSearch(a.coverage.glyphs,u);l<0&&(l=-1-l,a.coverage.glyphs.splice(l,0,u),a.alternateSets.splice(l,0,0)),a.alternateSets[l]=e.by};At.prototype.addLigature=function(t,e,n,r){var s=this.getLookupTables(n,r,t,4,!0)[0],a=s.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},s.subtables[0]=a),he.assert(a.coverage.format===1,"Ligature: unable to modify coverage table format "+a.coverage.format);var u=e.sub[0],l=e.sub.slice(1),f={ligGlyph:e.by,components:l},h=this.binSearch(a.coverage.glyphs,u);if(h>=0){for(var p=a.ligatureSets[h],g=0;g<p.length;g++)if(vb(p[g].components,l))return;p.push(f)}else h=-1-h,a.coverage.glyphs.splice(h,0,u),a.ligatureSets.splice(h,0,[f])};At.prototype.getFeature=function(t,e,n){if(/ss\d\d/.test(t))return this.getSingle(t,e,n);switch(t){case"aalt":case"salt":return this.getSingle(t,e,n).concat(this.getAlternates(t,e,n));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,n);case"ccmp":return this.getMultiple(t,e,n).concat(this.getLigatures(t,e,n));case"stch":return this.getMultiple(t,e,n)}};At.prototype.add=function(t,e,n,r){if(/ss\d\d/.test(t))return this.addSingle(t,e,n,r);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,n,r):this.addAlternate(t,e,n,r);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,n,r);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,n,r):this.addLigature(t,e,n,r)}};function gb(){return typeof window<"u"}function mb(t){for(var e=new Buffer(t.byteLength),n=new Uint8Array(t),r=0;r<e.length;++r)e[r]=n[r];return e}function Zr(t,e){if(!t)throw e}function rf(t,e,n,r,s){var a;return(e&r)>0?(a=t.parseByte(),e&s||(a=-a),a=n+a):(e&s)>0?a=n:a=n+t.parseShort(),a}function bh(t,e,n){var r=new ye.Parser(e,n);t.numberOfContours=r.parseShort(),t._xMin=r.parseShort(),t._yMin=r.parseShort(),t._xMax=r.parseShort(),t._yMax=r.parseShort();var s,a;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)u.push(r.parseUShort());t.instructionLength=r.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(r.parseByte());var h=u[u.length-1]+1;s=[];for(var p=0;p<h;p+=1)if(a=r.parseByte(),s.push(a),(a&8)>0)for(var g=r.parseByte(),v=0;v<g;v+=1)s.push(a),p+=1;if(he.argument(s.length===h,"Bad flags."),u.length>0){var y=[],w;if(h>0){for(var T=0;T<h;T+=1)a=s[T],w={},w.onCurve=!!(a&1),w.lastPointOfContour=u.indexOf(T)>=0,y.push(w);for(var S=0,O=0;O<h;O+=1)a=s[O],w=y[O],w.x=rf(r,a,S,2,16),S=w.x;for(var C=0,F=0;F<h;F+=1)a=s[F],w=y[F],w.y=rf(r,a,C,4,32),C=w.y}t.points=y}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var U=!0;U;){s=r.parseUShort();var _={glyphIndex:r.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(s&1)>0?(s&2)>0?(_.dx=r.parseShort(),_.dy=r.parseShort()):_.matchedPoints=[r.parseUShort(),r.parseUShort()]:(s&2)>0?(_.dx=r.parseChar(),_.dy=r.parseChar()):_.matchedPoints=[r.parseByte(),r.parseByte()],(s&8)>0?_.xScale=_.yScale=r.parseF2Dot14():(s&64)>0?(_.xScale=r.parseF2Dot14(),_.yScale=r.parseF2Dot14()):(s&128)>0&&(_.xScale=r.parseF2Dot14(),_.scale01=r.parseF2Dot14(),_.scale10=r.parseF2Dot14(),_.yScale=r.parseF2Dot14()),t.components.push(_),U=!!(s&32)}if(s&256){t.instructionLength=r.parseUShort(),t.instructions=[];for(var z=0;z<t.instructionLength;z+=1)t.instructions.push(r.parseByte())}}}function fo(t,e){for(var n=[],r=0;r<t.length;r+=1){var s=t[r],a={x:e.xScale*s.x+e.scale01*s.y+e.dx,y:e.scale10*s.x+e.yScale*s.y+e.dy,onCurve:s.onCurve,lastPointOfContour:s.lastPointOfContour};n.push(a)}return n}function yb(t){for(var e=[],n=[],r=0;r<t.length;r+=1){var s=t[r];n.push(s),s.lastPointOfContour&&(e.push(n),n=[])}return he.argument(n.length===0,"There are still points left in the current contour."),e}function wh(t){var e=new tt;if(!t)return e;for(var n=yb(t),r=0;r<n.length;++r){var s=n[r],a=null,u=s[s.length-1],l=s[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var f={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5};e.moveTo(f.x,f.y)}for(var h=0;h<s.length;++h)if(a=u,u=l,l=s[(h+1)%s.length],u.onCurve)e.lineTo(u.x,u.y);else{var p=l;a.onCurve||((u.x+a.x)*.5,(u.y+a.y)*.5),l.onCurve||(p={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5}),e.quadraticCurveTo(u.x,u.y,p.x,p.y)}e.closePath()}return e}function Sh(t,e){if(e.isComposite)for(var n=0;n<e.components.length;n+=1){var r=e.components[n],s=t.get(r.glyphIndex);if(s.getPath(),s.points){var a=void 0;if(r.matchedPoints===void 0)a=fo(s.points,r);else{if(r.matchedPoints[0]>e.points.length-1||r.matchedPoints[1]>s.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[r.matchedPoints[0]],l=s.points[r.matchedPoints[1]],f={xScale:r.xScale,scale01:r.scale01,scale10:r.scale10,yScale:r.yScale,dx:0,dy:0};l=fo([l],f)[0],f.dx=u.x-l.x,f.dy=u.y-l.y,a=fo(s.points,f)}e.points=e.points.concat(a)}}return wh(e.points)}function xb(t,e,n,r){for(var s=new sn.GlyphSet(r),a=0;a<n.length-1;a+=1){var u=n[a],l=n[a+1];u!==l?s.push(a,sn.ttfGlyphLoader(r,a,bh,t,e+u,Sh)):s.push(a,sn.glyphLoader(r,a))}return s}function bb(t,e,n,r){var s=new sn.GlyphSet(r);return r._push=function(a){var u=n[a],l=n[a+1];u!==l?s.push(a,sn.ttfGlyphLoader(r,a,bh,t,e+u,Sh)):s.push(a,sn.glyphLoader(r,a))},s}function wb(t,e,n,r,s){return s.lowMemory?bb(t,e,n,r):xb(t,e,n,r)}var Sb={getPath:wh,parse:wb},Th,jn,Eh,Mo;function Oh(t){this.font=t,this.getCommands=function(e){return Sb.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Tb(t){return t}function Ch(t){return Math.sign(t)*Math.round(Math.abs(t))}function Eb(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Ob(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Cb(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Fb(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Fh=function(t){var e=this.srPeriod,n=this.srPhase,r=this.srThreshold,s=1;return t<0&&(t=-t,s=-1),t+=r-n,t=Math.trunc(t/e)*e,t+=n,t<0?n*s:t*s},nn={x:1,y:0,axis:"x",distance:function(t,e,n,r){return(n?t.xo:t.x)-(r?e.xo:e.x)},interpolate:function(t,e,n,r){var s,a,u,l,f,h,p;if(!r||r===this){if(s=t.xo-e.xo,a=t.xo-n.xo,f=e.x-e.xo,h=n.x-n.xo,u=Math.abs(s),l=Math.abs(a),p=u+l,p===0){t.x=t.xo+(f+h)/2;return}t.x=t.xo+(f*l+h*u)/p;return}if(s=r.distance(t,e,!0,!0),a=r.distance(t,n,!0,!0),f=r.distance(e,e,!1,!0),h=r.distance(n,n,!1,!0),u=Math.abs(s),l=Math.abs(a),p=u+l,p===0){nn.setRelative(t,t,(f+h)/2,r,!0);return}nn.setRelative(t,t,(f*l+h*u)/p,r,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,n,r,s){if(!r||r===this){t.x=(s?e.xo:e.x)+n;return}var a=s?e.xo:e.x,u=s?e.yo:e.y,l=a+n*r.x,f=u+n*r.y;t.x=l+(t.y-f)/r.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},gn={x:0,y:1,axis:"y",distance:function(t,e,n,r){return(n?t.yo:t.y)-(r?e.yo:e.y)},interpolate:function(t,e,n,r){var s,a,u,l,f,h,p;if(!r||r===this){if(s=t.yo-e.yo,a=t.yo-n.yo,f=e.y-e.yo,h=n.y-n.yo,u=Math.abs(s),l=Math.abs(a),p=u+l,p===0){t.y=t.yo+(f+h)/2;return}t.y=t.yo+(f*l+h*u)/p;return}if(s=r.distance(t,e,!0,!0),a=r.distance(t,n,!0,!0),f=r.distance(e,e,!1,!0),h=r.distance(n,n,!1,!0),u=Math.abs(s),l=Math.abs(a),p=u+l,p===0){gn.setRelative(t,t,(f+h)/2,r,!0);return}gn.setRelative(t,t,(f*l+h*u)/p,r,!0)},normalSlope:0,setRelative:function(t,e,n,r,s){if(!r||r===this){t.y=(s?e.yo:e.y)+n;return}var a=s?e.xo:e.x,u=s?e.yo:e.y,l=a+n*r.x,f=u+n*r.y;t.y=f+r.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(nn);Object.freeze(gn);function ci(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}ci.prototype.distance=function(t,e,n,r){return this.x*nn.distance(t,e,n,r)+this.y*gn.distance(t,e,n,r)};ci.prototype.interpolate=function(t,e,n,r){var s,a,u,l,f,h,p;if(u=r.distance(t,e,!0,!0),l=r.distance(t,n,!0,!0),s=r.distance(e,e,!1,!0),a=r.distance(n,n,!1,!0),f=Math.abs(u),h=Math.abs(l),p=f+h,p===0){this.setRelative(t,t,(s+a)/2,r,!0);return}this.setRelative(t,t,(s*h+a*f)/p,r,!0)};ci.prototype.setRelative=function(t,e,n,r,s){r=r||this;var a=s?e.xo:e.x,u=s?e.yo:e.y,l=a+n*r.x,f=u+n*r.y,h=r.normalSlope,p=this.slope,g=t.x,v=t.y;t.x=(p*g-h*l+f-v)/(p-h),t.y=p*(t.x-g)+v};ci.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function fi(t,e){var n=Math.sqrt(t*t+e*e);return t/=n,e/=n,t===1&&e===0?nn:t===0&&e===1?gn:new ci(t,e)}function mn(t,e,n,r){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=n,this.onCurve=r,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}mn.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};mn.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var si=Object.freeze(new mn(0,0)),Ab={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Un(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=nn,this.round=Ch}}Oh.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,r=this._prepState;if(!r||r.ppem!==e){var s=this._fpgmState;if(!s){Un.prototype=Ab,s=this._fpgmState=new Un("fpgm",n.tables.fpgm),s.funcs=[],s.font=n,N.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{jn(s)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}Un.prototype=s,r=this._prepState=new Un("prep",n.tables.prep),r.ppem=e;var a=n.tables.cvt;if(a)for(var u=r.cvt=new Array(a.length),l=e/n.unitsPerEm,f=0;f<a.length;f++)u[f]=a[f]*l;else r.cvt=[];N.DEBUG&&(console.log("---EXEC PREP---"),r.step=-1);try{jn(r)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return Eh(t,r)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Eh=function(t,e){var n=e.ppem/e.font.unitsPerEm,r=n,s=t.components,a,u,l;if(Un.prototype=e,!s)l=new Un("glyf",t.instructions),N.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),Mo(t,l,n,r),u=l.gZone;else{var f=e.font;u=[],a=[];for(var h=0;h<s.length;h++){var p=s[h],g=f.glyphs.get(p.glyphIndex);l=new Un("glyf",g.instructions),N.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),Mo(g,l,n,r);for(var v=Math.round(p.dx*n),y=Math.round(p.dy*r),w=l.gZone,T=l.contours,S=0;S<w.length;S++){var O=w[S];O.xTouched=O.yTouched=!1,O.xo=O.x=O.x+v,O.yo=O.y=O.y+y}var C=u.length;u.push.apply(u,w);for(var F=0;F<T.length;F++)a.push(T[F]+C)}t.instructions&&!l.inhibitGridFit&&(l=new Un("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=u,l.contours=a,u.push(new mn(0,0),new mn(Math.round(t.advanceWidth*n),0)),N.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),jn(l),u.length-=2)}return u};Mo=function(t,e,n,r){for(var s=t.points||[],a=s.length,u=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],f,h=0;h<a;h++)f=s[h],u[h]=new mn(f.x*n,f.y*r,f.lastPointOfContour,f.onCurve);for(var p,g,v=0;v<a;v++)f=u[v],p||(p=f,l.push(v)),f.lastPointOfContour?(f.nextPointOnContour=p,p.prevPointOnContour=f,p=void 0):(g=u[v+1],f.nextPointOnContour=g,g.prevPointOnContour=f);if(!e.inhibitGridFit){if(N.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var y=0;y<a;y++)console.log(y,u[y].x,u[y].y)}if(u.push(new mn(0,0),new mn(Math.round(t.advanceWidth*n),0)),jn(e),u.length-=2,N.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var w=0;w<a;w++)console.log(w,u[w].x,u[w].y)}}};jn=function(t){var e=t.prog;if(e){var n=e.length,r;for(t.ip=0;t.ip<n;t.ip++){if(N.DEBUG&&t.step++,r=Th[e[t.ip]],!r)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));r(t)}}};function Us(t){for(var e=t.tZone=new Array(t.gZone.length),n=0;n<e.length;n++)e[n]=new mn(0,0)}function Ah(t,e){var n=t.prog,r=t.ip,s=1,a;do if(a=n[++r],a===88)s++;else if(a===89)s--;else if(a===64)r+=n[r+1]+1;else if(a===65)r+=2*n[r+1]+1;else if(a>=176&&a<=183)r+=a-176+1;else if(a>=184&&a<=191)r+=(a-184+1)*2;else if(e&&s===1&&a===27)break;while(s>0);t.ip=r}function sf(t,e){N.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function af(t,e){N.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function of(t,e){N.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function uf(t,e){var n=e.stack,r=n.pop(),s=n.pop(),a=e.z2[r],u=e.z1[s];N.DEBUG&&console.log("SPVTL["+t+"]",r,s);var l,f;t?(l=a.y-u.y,f=u.x-a.x):(l=u.x-a.x,f=u.y-a.y),e.pv=e.dpv=fi(l,f)}function lf(t,e){var n=e.stack,r=n.pop(),s=n.pop(),a=e.z2[r],u=e.z1[s];N.DEBUG&&console.log("SFVTL["+t+"]",r,s);var l,f;t?(l=a.y-u.y,f=u.x-a.x):(l=u.x-a.x,f=u.y-a.y),e.fv=fi(l,f)}function Rb(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"SPVFS[]",n,r),t.pv=t.dpv=fi(r,n)}function Lb(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"SPVFS[]",n,r),t.fv=fi(r,n)}function _b(t){var e=t.stack,n=t.pv;N.DEBUG&&console.log(t.step,"GPV[]"),e.push(n.x*16384),e.push(n.y*16384)}function Ub(t){var e=t.stack,n=t.fv;N.DEBUG&&console.log(t.step,"GFV[]"),e.push(n.x*16384),e.push(n.y*16384)}function kb(t){t.fv=t.pv,N.DEBUG&&console.log(t.step,"SFVTPV[]")}function Mb(t){var e=t.stack,n=e.pop(),r=e.pop(),s=e.pop(),a=e.pop(),u=e.pop(),l=t.z0,f=t.z1,h=l[n],p=l[r],g=f[s],v=f[a],y=t.z2[u];N.DEBUG&&console.log("ISECT[], ",n,r,s,a,u);var w=h.x,T=h.y,S=p.x,O=p.y,C=g.x,F=g.y,U=v.x,_=v.y,z=(w-S)*(F-_)-(T-O)*(C-U),V=w*O-T*S,q=C*_-F*U;y.x=(V*(C-U)-q*(w-S))/z,y.y=(V*(F-_)-q*(T-O))/z}function Bb(t){t.rp0=t.stack.pop(),N.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Pb(t){t.rp1=t.stack.pop(),N.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Db(t){t.rp2=t.stack.pop(),N.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Ib(t){var e=t.stack.pop();switch(N.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Us(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Nb(t){var e=t.stack.pop();switch(N.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Us(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Gb(t){var e=t.stack.pop();switch(N.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Us(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function zb(t){var e=t.stack.pop();switch(N.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Us(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Hb(t){t.loop=t.stack.pop(),N.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function qb(t){N.DEBUG&&console.log(t.step,"RTG[]"),t.round=Ch}function Wb(t){N.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Ob}function Vb(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Xb(t){N.DEBUG&&console.log(t.step,"ELSE[]"),Ah(t,!1)}function Yb(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Kb(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Zb(t){var e=t.stack;N.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ho(t){N.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function $b(t){N.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Jb(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"SWAP[]"),e.push(n),e.push(r)}function Qb(t){var e=t.stack;N.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function jb(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"LOOPCALL[]",n,r);var s=t.ip,a=t.prog;t.prog=t.funcs[n];for(var u=0;u<r;u++)jn(t),N.DEBUG&&console.log(++t.step,u+1<r?"next loopcall":"done loopcall",u);t.ip=s,t.prog=a}function ew(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"CALL[]",e);var n=t.ip,r=t.prog;t.prog=t.funcs[e],jn(t),t.ip=n,t.prog=r,N.DEBUG&&console.log(++t.step,"returning from",e)}function tw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"CINDEX[]",n),e.push(e[e.length-n])}function nw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"MINDEX[]",n),e.push(e.splice(e.length-n,1)[0])}function rw(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,n=t.prog,r=t.ip,s=e.pop(),a=r;for(N.DEBUG&&console.log(t.step,"FDEF[]",s);n[++r]!==45;);t.ip=r,t.funcs[s]=n.slice(a+1,r)}function cf(t,e){var n=e.stack.pop(),r=e.z0[n],s=e.fv,a=e.pv;N.DEBUG&&console.log(e.step,"MDAP["+t+"]",n);var u=a.distance(r,si);t&&(u=e.round(u)),s.setRelative(r,si,u,a),s.touch(r),e.rp0=e.rp1=n}function ff(t,e){var n=e.z2,r=n.length-2,s,a,u;N.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<r;l++)s=n[l],!t.touched(s)&&(a=s.prevTouched(t),a!==s&&(u=s.nextTouched(t),a===u&&t.setRelative(s,s,t.distance(a,a,!1,!0),t,!0),t.interpolate(s,a,u,t)))}function hf(t,e){for(var n=e.stack,r=t?e.rp1:e.rp2,s=(t?e.z0:e.z1)[r],a=e.fv,u=e.pv,l=e.loop,f=e.z2;l--;){var h=n.pop(),p=f[h],g=u.distance(s,s,!1,!0);a.setRelative(p,p,g,u),a.touch(p),N.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function pf(t,e){var n=e.stack,r=t?e.rp1:e.rp2,s=(t?e.z0:e.z1)[r],a=e.fv,u=e.pv,l=n.pop(),f=e.z2[e.contours[l]],h=f;N.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var p=u.distance(s,s,!1,!0);do h!==s&&a.setRelative(h,h,p,u),h=h.nextPointOnContour;while(h!==f)}function df(t,e){var n=e.stack,r=t?e.rp1:e.rp2,s=(t?e.z0:e.z1)[r],a=e.fv,u=e.pv,l=n.pop();N.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var f;switch(l){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,p=u.distance(s,s,!1,!0),g=f.length-2,v=0;v<g;v++)h=f[v],a.setRelative(h,h,p,u)}function iw(t){for(var e=t.stack,n=t.loop,r=t.fv,s=e.pop()/64,a=t.z2;n--;){var u=e.pop(),l=a[u];N.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-n)+": ":"")+"SHPIX[]",u,s),r.setRelative(l,l,s),r.touch(l)}t.loop=1}function sw(t){for(var e=t.stack,n=t.rp1,r=t.rp2,s=t.loop,a=t.z0[n],u=t.z1[r],l=t.fv,f=t.dpv,h=t.z2;s--;){var p=e.pop(),g=h[p];N.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-s)+": ":"")+"IP[]",p,n,"<->",r),l.interpolate(g,a,u,f),l.touch(g)}t.loop=1}function vf(t,e){var n=e.stack,r=n.pop()/64,s=n.pop(),a=e.z1[s],u=e.z0[e.rp0],l=e.fv,f=e.pv;l.setRelative(a,u,r,f),l.touch(a),N.DEBUG&&console.log(e.step,"MSIRP["+t+"]",r,s),e.rp1=e.rp0,e.rp2=s,t&&(e.rp0=s)}function aw(t){for(var e=t.stack,n=t.rp0,r=t.z0[n],s=t.loop,a=t.fv,u=t.pv,l=t.z1;s--;){var f=e.pop(),h=l[f];N.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-s)+": ":"")+"ALIGNRP[]",f),a.setRelative(h,r,0,u),a.touch(h)}t.loop=1}function ow(t){N.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Eb}function gf(t,e){var n=e.stack,r=n.pop(),s=n.pop(),a=e.z0[s],u=e.fv,l=e.pv,f=e.cvt[r];N.DEBUG&&console.log(e.step,"MIAP["+t+"]",r,"(",f,")",s);var h=l.distance(a,si);t&&(Math.abs(h-f)<e.cvCutIn&&(h=f),h=e.round(h)),u.setRelative(a,si,h,l),e.zp0===0&&(a.xo=a.x,a.yo=a.y),u.touch(a),e.rp0=e.rp1=s}function uw(t){var e=t.prog,n=t.ip,r=t.stack,s=e[++n];N.DEBUG&&console.log(t.step,"NPUSHB[]",s);for(var a=0;a<s;a++)r.push(e[++n]);t.ip=n}function lw(t){var e=t.ip,n=t.prog,r=t.stack,s=n[++e];N.DEBUG&&console.log(t.step,"NPUSHW[]",s);for(var a=0;a<s;a++){var u=n[++e]<<8|n[++e];u&32768&&(u=-((u^65535)+1)),r.push(u)}t.ip=e}function cw(t){var e=t.stack,n=t.store;n||(n=t.store=[]);var r=e.pop(),s=e.pop();N.DEBUG&&console.log(t.step,"WS",r,s),n[s]=r}function fw(t){var e=t.stack,n=t.store,r=e.pop();N.DEBUG&&console.log(t.step,"RS",r);var s=n&&n[r]||0;e.push(s)}function hw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"WCVTP",n,r),t.cvt[r]=n/64}function pw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"RCVT",n),e.push(t.cvt[n]*64)}function mf(t,e){var n=e.stack,r=n.pop(),s=e.z2[r];N.DEBUG&&console.log(e.step,"GC["+t+"]",r),n.push(e.dpv.distance(s,si,t,!1)*64)}function yf(t,e){var n=e.stack,r=n.pop(),s=n.pop(),a=e.z1[r],u=e.z0[s],l=e.dpv.distance(u,a,t,t);N.DEBUG&&console.log(e.step,"MD["+t+"]",r,s,"->",l),e.stack.push(Math.round(l*64))}function dw(t){N.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function vw(t){N.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function gw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"LT[]",n,r),e.push(r<n?1:0)}function mw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"LTEQ[]",n,r),e.push(r<=n?1:0)}function yw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"GT[]",n,r),e.push(r>n?1:0)}function xw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"GTEQ[]",n,r),e.push(r>=n?1:0)}function bw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"EQ[]",n,r),e.push(n===r?1:0)}function ww(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"NEQ[]",n,r),e.push(n!==r?1:0)}function Sw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"ODD[]",n),e.push(Math.trunc(n)%2?1:0)}function Tw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"EVEN[]",n),e.push(Math.trunc(n)%2?0:1)}function Ew(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"IF[]",e),e||(Ah(t,!0),N.DEBUG&&console.log(t.step,"EIF[]"))}function Ow(t){N.DEBUG&&console.log(t.step,"EIF[]")}function Cw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"AND[]",n,r),e.push(n&&r?1:0)}function Fw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"OR[]",n,r),e.push(n||r?1:0)}function Aw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"NOT[]",n),e.push(n?0:1)}function po(t,e){var n=e.stack,r=n.pop(),s=e.fv,a=e.pv,u=e.ppem,l=e.deltaBase+(t-1)*16,f=e.deltaShift,h=e.z0;N.DEBUG&&console.log(e.step,"DELTAP["+t+"]",r,n);for(var p=0;p<r;p++){var g=n.pop(),v=n.pop(),y=l+((v&240)>>4);if(y===u){var w=(v&15)-8;w>=0&&w++,N.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",w*f);var T=h[g];s.setRelative(T,T,w*f,a)}}}function Rw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"SDB[]",n),t.deltaBase=n}function Lw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"SDS[]",n),t.deltaShift=Math.pow(.5,n)}function _w(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"ADD[]",n,r),e.push(r+n)}function Uw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"SUB[]",n,r),e.push(r-n)}function kw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"DIV[]",n,r),e.push(r*64/n)}function Mw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"MUL[]",n,r),e.push(r*n/64)}function Bw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"ABS[]",n),e.push(Math.abs(n))}function Pw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"NEG[]",n),e.push(-n)}function Dw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"FLOOR[]",n),e.push(Math.floor(n/64)*64)}function Iw(t){var e=t.stack,n=e.pop();N.DEBUG&&console.log(t.step,"CEILING[]",n),e.push(Math.ceil(n/64)*64)}function cs(t,e){var n=e.stack,r=n.pop();N.DEBUG&&console.log(e.step,"ROUND[]"),n.push(e.round(r/64)*64)}function Nw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"WCVTF[]",n,r),t.cvt[r]=n*t.ppem/t.font.unitsPerEm}function vo(t,e){var n=e.stack,r=n.pop(),s=e.ppem,a=e.deltaBase+(t-1)*16,u=e.deltaShift;N.DEBUG&&console.log(e.step,"DELTAC["+t+"]",r,n);for(var l=0;l<r;l++){var f=n.pop(),h=n.pop(),p=a+((h&240)>>4);if(p===s){var g=(h&15)-8;g>=0&&g++;var v=g*u;N.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",v),e.cvt[f]+=v}}}function Gw(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Fh;var n;switch(e&192){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=n,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*n}function zw(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Fh;var n;switch(e&192){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=n,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*n;break;case 32:t.srPhase=.5*n;break;case 48:t.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*n}function Hw(t){N.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Tb}function qw(t){N.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Cb}function Ww(t){N.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Fb}function Vw(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function xf(t,e){var n=e.stack,r=n.pop(),s=n.pop(),a=e.z2[r],u=e.z1[s];N.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",r,s);var l,f;t?(l=a.y-u.y,f=u.x-a.x):(l=u.x-a.x,f=u.y-a.y),e.dpv=fi(l,f)}function Xw(t){var e=t.stack,n=e.pop(),r=0;N.DEBUG&&console.log(t.step,"GETINFO[]",n),n&1&&(r=35),n&32&&(r|=4096),e.push(r)}function Yw(t){var e=t.stack,n=e.pop(),r=e.pop(),s=e.pop();N.DEBUG&&console.log(t.step,"ROLL[]"),e.push(r),e.push(n),e.push(s)}function Kw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"MAX[]",n,r),e.push(Math.max(r,n))}function Zw(t){var e=t.stack,n=e.pop(),r=e.pop();N.DEBUG&&console.log(t.step,"MIN[]",n,r),e.push(Math.min(r,n))}function $w(t){var e=t.stack.pop();N.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Jw(t){var e=t.stack.pop(),n=t.stack.pop();switch(N.DEBUG&&console.log(t.step,"INSTCTRL[]",e,n),e){case 1:t.inhibitGridFit=!!n;return;case 2:t.ignoreCvt=!!n;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Rn(t,e){var n=e.stack,r=e.prog,s=e.ip;N.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var a=0;a<t;a++)n.push(r[++s]);e.ip=s}function Ln(t,e){var n=e.ip,r=e.prog,s=e.stack;N.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var a=0;a<t;a++){var u=r[++n]<<8|r[++n];u&32768&&(u=-((u^65535)+1)),s.push(u)}e.ip=n}function $(t,e,n,r,s,a){var u=a.stack,l=t&&u.pop(),f=u.pop(),h=a.rp0,p=a.z0[h],g=a.z1[f],v=a.minDis,y=a.fv,w=a.dpv,T,S,O,C;S=T=w.distance(g,p,!0,!0),O=S>=0?1:-1,S=Math.abs(S),t&&(C=a.cvt[l],r&&Math.abs(S-C)<a.cvCutIn&&(S=C)),n&&S<v&&(S=v),r&&(S=a.round(S)),y.setRelative(g,p,O*S,w),y.touch(g),N.DEBUG&&console.log(a.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(n?">":"_")+(r?"R":"_")+(s===0?"Gr":s===1?"Bl":s===2?"Wh":"")+"]",t?l+"("+a.cvt[l]+","+C+")":"",f,"(d =",T,"->",O*S,")"),a.rp1=a.rp0,a.rp2=f,e&&(a.rp0=f)}Th=[sf.bind(void 0,gn),sf.bind(void 0,nn),af.bind(void 0,gn),af.bind(void 0,nn),of.bind(void 0,gn),of.bind(void 0,nn),uf.bind(void 0,0),uf.bind(void 0,1),lf.bind(void 0,0),lf.bind(void 0,1),Rb,Lb,_b,Ub,kb,Mb,Bb,Pb,Db,Ib,Nb,Gb,zb,Hb,qb,Wb,Vb,Xb,Yb,Kb,void 0,void 0,Zb,ho,$b,Jb,Qb,tw,nw,void 0,void 0,void 0,jb,ew,rw,void 0,cf.bind(void 0,0),cf.bind(void 0,1),ff.bind(void 0,gn),ff.bind(void 0,nn),hf.bind(void 0,0),hf.bind(void 0,1),pf.bind(void 0,0),pf.bind(void 0,1),df.bind(void 0,0),df.bind(void 0,1),iw,sw,vf.bind(void 0,0),vf.bind(void 0,1),aw,ow,gf.bind(void 0,0),gf.bind(void 0,1),uw,lw,cw,fw,hw,pw,mf.bind(void 0,0),mf.bind(void 0,1),void 0,yf.bind(void 0,0),yf.bind(void 0,1),dw,void 0,vw,void 0,void 0,gw,mw,yw,xw,bw,ww,Sw,Tw,Ew,Ow,Cw,Fw,Aw,po.bind(void 0,1),Rw,Lw,_w,Uw,kw,Mw,Bw,Pw,Dw,Iw,cs.bind(void 0,0),cs.bind(void 0,1),cs.bind(void 0,2),cs.bind(void 0,3),void 0,void 0,void 0,void 0,Nw,po.bind(void 0,2),po.bind(void 0,3),vo.bind(void 0,1),vo.bind(void 0,2),vo.bind(void 0,3),Gw,zw,void 0,void 0,Hw,void 0,qw,Ww,ho,ho,void 0,void 0,void 0,void 0,void 0,Vw,xf.bind(void 0,0),xf.bind(void 0,1),Xw,void 0,Yw,Kw,Zw,$w,Jw,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Rn.bind(void 0,1),Rn.bind(void 0,2),Rn.bind(void 0,3),Rn.bind(void 0,4),Rn.bind(void 0,5),Rn.bind(void 0,6),Rn.bind(void 0,7),Rn.bind(void 0,8),Ln.bind(void 0,1),Ln.bind(void 0,2),Ln.bind(void 0,3),Ln.bind(void 0,4),Ln.bind(void 0,5),Ln.bind(void 0,6),Ln.bind(void 0,7),Ln.bind(void 0,8),$.bind(void 0,0,0,0,0,0),$.bind(void 0,0,0,0,0,1),$.bind(void 0,0,0,0,0,2),$.bind(void 0,0,0,0,0,3),$.bind(void 0,0,0,0,1,0),$.bind(void 0,0,0,0,1,1),$.bind(void 0,0,0,0,1,2),$.bind(void 0,0,0,0,1,3),$.bind(void 0,0,0,1,0,0),$.bind(void 0,0,0,1,0,1),$.bind(void 0,0,0,1,0,2),$.bind(void 0,0,0,1,0,3),$.bind(void 0,0,0,1,1,0),$.bind(void 0,0,0,1,1,1),$.bind(void 0,0,0,1,1,2),$.bind(void 0,0,0,1,1,3),$.bind(void 0,0,1,0,0,0),$.bind(void 0,0,1,0,0,1),$.bind(void 0,0,1,0,0,2),$.bind(void 0,0,1,0,0,3),$.bind(void 0,0,1,0,1,0),$.bind(void 0,0,1,0,1,1),$.bind(void 0,0,1,0,1,2),$.bind(void 0,0,1,0,1,3),$.bind(void 0,0,1,1,0,0),$.bind(void 0,0,1,1,0,1),$.bind(void 0,0,1,1,0,2),$.bind(void 0,0,1,1,0,3),$.bind(void 0,0,1,1,1,0),$.bind(void 0,0,1,1,1,1),$.bind(void 0,0,1,1,1,2),$.bind(void 0,0,1,1,1,3),$.bind(void 0,1,0,0,0,0),$.bind(void 0,1,0,0,0,1),$.bind(void 0,1,0,0,0,2),$.bind(void 0,1,0,0,0,3),$.bind(void 0,1,0,0,1,0),$.bind(void 0,1,0,0,1,1),$.bind(void 0,1,0,0,1,2),$.bind(void 0,1,0,0,1,3),$.bind(void 0,1,0,1,0,0),$.bind(void 0,1,0,1,0,1),$.bind(void 0,1,0,1,0,2),$.bind(void 0,1,0,1,0,3),$.bind(void 0,1,0,1,1,0),$.bind(void 0,1,0,1,1,1),$.bind(void 0,1,0,1,1,2),$.bind(void 0,1,0,1,1,3),$.bind(void 0,1,1,0,0,0),$.bind(void 0,1,1,0,0,1),$.bind(void 0,1,1,0,0,2),$.bind(void 0,1,1,0,0,3),$.bind(void 0,1,1,0,1,0),$.bind(void 0,1,1,0,1,1),$.bind(void 0,1,1,0,1,2),$.bind(void 0,1,1,0,1,3),$.bind(void 0,1,1,1,0,0),$.bind(void 0,1,1,1,0,1),$.bind(void 0,1,1,1,0,2),$.bind(void 0,1,1,1,0,3),$.bind(void 0,1,1,1,1,0),$.bind(void 0,1,1,1,1,1),$.bind(void 0,1,1,1,1,2),$.bind(void 0,1,1,1,1,3)];function Or(t){this.char=t,this.state={},this.activeState=null}function Yo(t,e,n){this.contextName=n,this.startIndex=t,this.endOffset=e}function Qw(t,e,n){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=n}function Kt(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function ks(t){this.eventId=t,this.subscribers=[]}function jw(t){var e=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach(function(s){Object.defineProperty(e.events,s,{value:new ks(s)})}),t&&n.forEach(function(s){var a=t[s];typeof a=="function"&&e.events[s].subscribe(a)});var r=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];r.forEach(function(s){e.events[s].subscribe(e.updateContextsRanges)})}function Ve(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],jw.call(this,t)}Or.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};Or.prototype.getState=function(t){return this.state[t]||null};Ve.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Ve.prototype.composeRUD=function(t){var e=this,n=!0,r=t.map(function(a){return e[a[0]].apply(e,a.slice(1).concat(n))}),s=function(a){return typeof a=="object"&&a.hasOwnProperty("FAIL")};if(r.every(s))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(s)};this.dispatch("composeRUD",[r.filter(function(a){return!s(a)})])};Ve.prototype.replaceRange=function(t,e,n,r){e=e!==null?e:this.tokens.length;var s=n.every(function(u){return u instanceof Or});if(!isNaN(t)&&this.inboundIndex(t)&&s){var a=this.tokens.splice.apply(this.tokens,[t,e].concat(n));return r||this.dispatch("replaceToken",[t,e,n]),[a,n]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Ve.prototype.replaceToken=function(t,e,n){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Or){var r=this.tokens.splice(t,1,e);return n||this.dispatch("replaceToken",[t,e]),[r[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Ve.prototype.removeRange=function(t,e,n){e=isNaN(e)?this.tokens.length:e;var r=this.tokens.splice(t,e);return n||this.dispatch("removeRange",[r,t,e]),r};Ve.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var n=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[n,t]),n}else return{FAIL:"removeToken: invalid token index."}};Ve.prototype.insertToken=function(t,e,n){var r=t.every(function(s){return s instanceof Or});return r?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),n||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Ve.prototype.registerModifier=function(t,e,n){this.events.newToken.subscribe(function(r,s){var a=[r,s],u=e===null||e.apply(this,a)===!0,l=[r,s];if(u){var f=n.apply(this,l);r.setState(t,f)}}),this.registeredModifiers.push(t)};ks.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};ks.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Kt.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Kt.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Ve.prototype.rangeToText=function(t){if(t instanceof Yo)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Ve.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Ve.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Ve.prototype.on=function(t,e){var n=this.events[t];return n?n.subscribe(e):null};Ve.prototype.dispatch=function(t,e){var n=this,r=this.events[t];r instanceof ks&&r.subscribers.forEach(function(s){s.apply(n,e||[])})};Ve.prototype.registerContextChecker=function(t,e,n){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof n!="function")return{FAIL:"missing context end check."};var r=new Qw(t,e,n);return this.registeredContexts[t]=r,this.contextCheckers.push(r),r};Ve.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Ve.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Ve.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];n.ranges=[]}};Ve.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(r){return r.char}),e=0;e<t.length;e++){var n=new Kt(t,e);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Ve.prototype.setEndOffset=function(t,e){var n=this.getContext(e).openRange.startIndex,r=new Yo(n,t,e),s=this.getContext(e).ranges;return r.rangeId=e+"."+s.length,s.push(r),this.getContext(e).openRange=null,r};Ve.prototype.runContextCheck=function(t){var e=this,n=t.index;this.contextCheckers.forEach(function(r){var s=r.contextName,a=e.getContext(s).openRange;if(!a&&r.checkStart(t)&&(a=new Yo(n,null,s),e.getContext(s).openRange=a,e.dispatch("contextStart",[s,n])),a&&r.checkEnd(t)){var u=n-a.startIndex+1,l=e.setEndOffset(u,s);e.dispatch("contextEnd",[s,l])}})};Ve.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var n=0;n<e.length;n++){var r=e[n],s=new Kt(e,n);this.dispatch("next",[s]),this.runContextCheck(s);var a=new Or(r);this.tokens.push(a),this.dispatch("newToken",[a,s])}return this.dispatch("end",[this.tokens]),this.tokens};function Mn(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Rh(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function Bn(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function vs(t){return/[A-z]/.test(t)}function eS(t){return/\s/.test(t)}function Rt(t){this.font=t,this.features={}}function $n(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function hi(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var n=e.ranges,r=0;r<n.length;r++){var s=n[r];if(t>=s.start&&t<=s.end){var a=t-s.start;return s.index+a}}break;default:return-1}return-1}function tS(t,e){var n=hi(t,e.coverage);return n===-1?null:t+e.deltaGlyphId}function nS(t,e){var n=hi(t,e.coverage);return n===-1?null:e.substitute[n]}function go(t,e){for(var n=[],r=0;r<t.length;r++){var s=t[r],a=e.current;a=Array.isArray(a)?a[0]:a;var u=hi(a,s);u!==-1&&n.push(u)}return n.length!==t.length?-1:n}function rS(t,e){var n=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<n)return[];var r=go(e.inputCoverage,t);if(r===-1)return[];var s=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var a=t.lookahead.slice(s);a.length&&Bn(a[0].char);)a.shift();var u=new Kt(a,0),l=go(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&Bn(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var h=new Kt(f,0),p=go(e.backtrackCoverage,h),g=r.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&p.length===e.backtrackCoverage.length,v=[];if(g)for(var y=0;y<e.lookupRecords.length;y++)for(var w=e.lookupRecords[y],T=w.lookupListIndex,S=this.getLookupByIndex(T),O=0;O<S.subtables.length;O++){var C=S.subtables[O],F=this.getLookupMethod(S,C),U=this.getSubstitutionType(S,C);if(U==="12")for(var _=0;_<r.length;_++){var z=t.get(_),V=F(z);V&&v.push(V)}}return v}function iS(t,e){var n=t.current,r=hi(n,e.coverage);if(r===-1)return null;for(var s,a=e.ligatureSets[r],u=0;u<a.length;u++){s=a[u];for(var l=0;l<s.components.length;l++){var f=t.lookahead[l],h=s.components[l];if(f!==h)break;if(l===s.components.length-1)return s}}return null}function sS(t,e){var n=hi(t,e.coverage);return n===-1?null:e.sequences[n]}Rt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var n=t[e];if(n.tag==="DFLT")return n.script.defaultLangSys.featureIndexes}return[]};Rt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var n=this.font.tables.gsub.scripts,r=0;r<n.length;r++){var s=n[r];if(s.tag===t&&s.script.defaultLangSys)return s.script.defaultLangSys.featureIndexes;var a=s.langSysRecords;if(a)for(var u=0;u<a.length;u++){var l=a[u];if(l.tag===t){var f=l.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};Rt.prototype.mapTagsToFeatures=function(t,e){for(var n={},r=0;r<t.length;r++){var s=t[r].tag,a=t[r].feature;n[s]=a}this.features[e].tags=n};Rt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var n=this.getScriptFeaturesIndexes(t);if(!n)return null;var r=this.font.tables.gsub;return e=n.map(function(s){return r.features[s]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};Rt.prototype.getSubstitutionType=function(t,e){var n=t.lookupType.toString(),r=e.substFormat.toString();return n+r};Rt.prototype.getLookupMethod=function(t,e){var n=this,r=this.getSubstitutionType(t,e);switch(r){case"11":return function(s){return tS.apply(n,[s,e])};case"12":return function(s){return nS.apply(n,[s,e])};case"63":return function(s){return rS.apply(n,[s,e])};case"41":return function(s){return iS.apply(n,[s,e])};case"21":return function(s){return sS.apply(n,[s,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};Rt.prototype.lookupFeature=function(t){var e=t.contextParams,n=e.index,r=this.getFeature({tag:t.tag,script:t.script});if(!r)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var s=this.getFeatureLookups(r),a=[].concat(e.context),u=0;u<s.length;u++)for(var l=s[u],f=this.getLookupSubtables(l),h=0;h<f.length;h++){var p=f[h],g=this.getSubstitutionType(l,p),v=this.getLookupMethod(l,p),y=void 0;switch(g){case"11":y=v(e.current),y&&a.splice(n,1,new $n({id:11,tag:t.tag,substitution:y}));break;case"12":y=v(e.current),y&&a.splice(n,1,new $n({id:12,tag:t.tag,substitution:y}));break;case"63":y=v(e),Array.isArray(y)&&y.length&&a.splice(n,1,new $n({id:63,tag:t.tag,substitution:y}));break;case"41":y=v(e),y&&a.splice(n,1,new $n({id:41,tag:t.tag,substitution:y}));break;case"21":y=v(e.current),y&&a.splice(n,1,new $n({id:21,tag:t.tag,substitution:y}));break}e=new Kt(a,n),!(Array.isArray(y)&&!y.length)&&(y=null)}return a.length?a:null};Rt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var n=this.features[t.script].some(function(r){return r.tag===t.tag});return e&&n};Rt.prototype.getLookupSubtables=function(t){return t.subtables||null};Rt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};Rt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};Rt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var n=this.features[e.script];return n?n.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function aS(t){var e=t.current,n=t.get(-1);return n===null&&Mn(e)||!Mn(n)&&Mn(e)}function oS(t){var e=t.get(1);return e===null||!Mn(e)}var uS={startCheck:aS,endCheck:oS};function lS(t){var e=t.current,n=t.get(-1);return(Mn(e)||Bn(e))&&!Mn(n)}function cS(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Mn(e)&&!Bn(e)):var n=eS(e);if(!n)return!0;if(n){var r=!1;if(r=t.lookahead.some(function(s){return Mn(s)||Bn(s)}),!r)return!0}break;default:return!1}}var fS={startCheck:lS,endCheck:cS};function hS(t,e,n){e[n].setState(t.tag,t.substitution)}function pS(t,e,n){e[n].setState(t.tag,t.substitution)}function dS(t,e,n){t.substitution.forEach(function(r,s){var a=e[n+s];a.setState(t.tag,r)})}function vS(t,e,n){var r=e[n];r.setState(t.tag,t.substitution.ligGlyph);for(var s=t.substitution.components.length,a=0;a<s;a++)r=e[n+a+1],r.setState("deleted",!0)}var bf={11:hS,12:pS,63:dS,41:vS};function Ko(t,e,n){t instanceof $n&&bf[t.id]&&bf[t.id](t,e,n)}function gS(t){for(var e=[].concat(t.backtrack),n=e.length-1;n>=0;n--){var r=e[n],s=Rh(r),a=Bn(r);if(!s&&!a)return!0;if(s)return!1}return!1}function mS(t){if(Rh(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var n=t.lookahead[e],r=Bn(n);if(!r)return!0}return!1}function yS(t){var e=this,n="arab",r=this.featuresTags[n],s=this.tokenizer.getRangeTokens(t);if(s.length!==1){var a=new Kt(s.map(function(l){return l.getState("glyphIndex")}),0),u=new Kt(s.map(function(l){return l.char}),0);s.forEach(function(l,f){if(!Bn(l.char)){a.setCurrentIndex(f),u.setCurrentIndex(f);var h=0;gS(u)&&(h|=1),mS(u)&&(h|=2);var p;switch(h){case 1:p="fina";break;case 2:p="init";break;case 3:p="medi";break}if(r.indexOf(p)!==-1){var g=e.query.lookupFeature({tag:p,script:n,contextParams:a});if(g instanceof Error)return console.info(g.message);g.forEach(function(v,y){v instanceof $n&&(Ko(v,s,y),a.context[y]=v.substitution)})}}})}}function wf(t,e){var n=t.map(function(r){return r.activeState.value});return new Kt(n,0)}function xS(t){var e=this,n="arab",r=this.tokenizer.getRangeTokens(t),s=wf(r);s.context.forEach(function(a,u){s.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"rlig",script:n,contextParams:s});l.length&&(l.forEach(function(f){return Ko(f,r,u)}),s=wf(r))})}function bS(t){var e=t.current,n=t.get(-1);return n===null&&vs(e)||!vs(n)&&vs(e)}function wS(t){var e=t.get(1);return e===null||!vs(e)}var SS={startCheck:bS,endCheck:wS};function Sf(t,e){var n=t.map(function(r){return r.activeState.value});return new Kt(n,0)}function TS(t){var e=this,n="latn",r=this.tokenizer.getRangeTokens(t),s=Sf(r);s.context.forEach(function(a,u){s.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"liga",script:n,contextParams:s});l.length&&(l.forEach(function(f){return Ko(f,r,u)}),s=Sf(r))})}function $t(t){this.baseDir=t||"ltr",this.tokenizer=new Ve,this.featuresTags={}}$t.prototype.setText=function(t){this.text=t};$t.prototype.contextChecks={latinWordCheck:SS,arabicWordCheck:uS,arabicSentenceCheck:fS};function mo(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function ES(){return mo.call(this,"latinWord"),mo.call(this,"arabicWord"),mo.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function OS(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(n){var r=t.tokenizer.getRangeTokens(n);t.tokenizer.replaceRange(n.startIndex,n.endOffset,r.reverse())})}$t.prototype.registerFeatures=function(t,e){var n=this,r=e.filter(function(s){return n.query.supports({script:t,tag:s})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(r):this.featuresTags[t]=r};$t.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Rt(t));for(var n=0;n<e.length;n++){var r=e[n];this.query.supports({script:r.script})&&this.registerFeatures(r.script,r.tags)}};$t.prototype.registerModifier=function(t,e,n){this.tokenizer.registerModifier(t,e,n)};function Zo(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function CS(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Zo.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(r){yS.call(t,r)})}}function FS(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("rlig")!==-1){Zo.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(s){xS.call(t,s)})}}}function AS(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("liga")!==-1){Zo.call(this);var r=this.tokenizer.getContextRanges("latinWord");r.forEach(function(s){TS.call(t,s)})}}}$t.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};$t.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(CS.call(this),FS.call(this)),this.checkContextReady("latinWord")&&AS.call(this),this.checkContextReady("arabicSentence")&&OS.call(this)};$t.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),ES.call(this),this.applyFeaturesToContexts())};$t.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};$t.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],n=0;n<this.tokenizer.tokens.length;n++){var r=this.tokenizer.tokens[n];if(!r.state.deleted){var s=r.activeState.value;e.push(Array.isArray(s)?s[0]:s)}}return e};function Be(t){t=t||{},t.tables=t.tables||{},t.empty||(Zr(t.familyName,"When creating a new Font object, familyName is required."),Zr(t.styleName,"When creating a new Font object, styleName is required."),Zr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Zr(t.ascender,"When creating a new Font object, ascender is required."),Zr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new sn.GlyphSet(this,t.glyphs||[]),this.encoding=new ah(this),this.position=new li(this),this.substitution=new At(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Oh(this)}})}Be.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Be.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Be.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n};Be.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(n){return t[n]})}:e})};Be.prototype.stringToGlyphs=function(t,e){var n=this,r=new $t,s=function(g){return n.charToGlyphIndex(g.char)};r.registerModifier("glyphIndex",null,s);var a=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;r.applyFeatures(this,a);for(var u=r.getTextGlyphs(t),l=u.length,f=new Array(l),h=this.glyphs.get(0),p=0;p<l;p+=1)f[p]=this.glyphs.get(u[p])||h;return f};Be.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Be.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n};Be.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Be.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,t,e):this.kerningPairs[t+","+e]||0};Be.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Be.prototype.forEachGlyph=function(t,e,n,r,s,a){e=e!==void 0?e:0,n=n!==void 0?n:0,r=r!==void 0?r:72,s=Object.assign({},this.defaultRenderOptions,s);var u=1/this.unitsPerEm*r,l=this.stringToGlyphs(t,s),f;if(s.kerning){var h=s.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(h,s.language)}for(var p=0;p<l.length;p+=1){var g=l[p];if(a.call(this,g,e,n,r,s),g.advanceWidth&&(e+=g.advanceWidth*u),s.kerning&&p<l.length-1){var v=f?this.position.getKerningValue(f,g.index,l[p+1].index):this.getKerningValue(g,l[p+1]);e+=v*u}s.letterSpacing?e+=s.letterSpacing*r:s.tracking&&(e+=s.tracking/1e3*r)}return e};Be.prototype.getPath=function(t,e,n,r,s){var a=new tt;return this.forEachGlyph(t,e,n,r,s,function(u,l,f,h){var p=u.getPath(l,f,h,s,this);a.extend(p)}),a};Be.prototype.getPaths=function(t,e,n,r,s){var a=[];return this.forEachGlyph(t,e,n,r,s,function(u,l,f,h){var p=u.getPath(l,f,h,s,this);a.push(p)}),a};Be.prototype.getAdvanceWidth=function(t,e,n){return this.forEachGlyph(t,0,0,e,n,function(){})};Be.prototype.draw=function(t,e,n,r,s,a){this.getPath(e,n,r,s,a).draw(t)};Be.prototype.drawPoints=function(t,e,n,r,s,a){this.forEachGlyph(e,n,r,s,a,function(u,l,f,h){u.drawPoints(t,l,f,h)})};Be.prototype.drawMetrics=function(t,e,n,r,s,a){this.forEachGlyph(e,n,r,s,a,function(u,l,f,h){u.drawMetrics(t,l,f,h)})};Be.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Be.prototype.validate=function(){var t=this;function e(r,s){}function n(r){var s=t.getEnglishName(r);s&&s.trim().length>0}n("fontFamily"),n("weightName"),n("manufacturer"),n("copyright"),n("version"),this.unitsPerEm>0};Be.prototype.toTables=function(){return db.fontToTable(this)};Be.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Be.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),n=new ArrayBuffer(e.length),r=new Uint8Array(n),s=0;s<e.length;s++)r[s]=e[s];return n};Be.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+n+".otf";var r=this.toArrayBuffer();if(gb())if(window.URL=window.URL||window.webkitURL,window.URL){var s=new DataView(r),a=new Blob([s],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(a),u.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),u.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),h=mb(r);f.writeFileSync(t,h)}};Be.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Be.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Be.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var yn=new Array(10);yn[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{posFormat:1,coverage:this.parsePointer(B.coverage),value:this.parseValueRecord()};if(n===2)return{posFormat:2,coverage:this.parsePointer(B.coverage),values:this.parseValueRecordList()};he.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};yn[2]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();he.assert(n===1||n===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(B.coverage),s=this.parseUShort(),a=this.parseUShort();if(n===1)return{posFormat:n,coverage:r,valueFormat1:s,valueFormat2:a,pairSets:this.parseList(B.pointer(B.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(s),value2:this.parseValueRecord(a)}})))};if(n===2){var u=this.parsePointer(B.classDef),l=this.parsePointer(B.classDef),f=this.parseUShort(),h=this.parseUShort();return{posFormat:n,coverage:r,valueFormat1:s,valueFormat2:a,classDef1:u,classDef2:l,class1Count:f,class2Count:h,classRecords:this.parseList(f,B.list(h,function(){return{value1:this.parseValueRecord(s),value2:this.parseValueRecord(a)}}))}}};yn[3]=function(){return{error:"GPOS Lookup 3 not supported"}};yn[4]=function(){return{error:"GPOS Lookup 4 not supported"}};yn[5]=function(){return{error:"GPOS Lookup 5 not supported"}};yn[6]=function(){return{error:"GPOS Lookup 6 not supported"}};yn[7]=function(){return{error:"GPOS Lookup 7 not supported"}};yn[8]=function(){return{error:"GPOS Lookup 8 not supported"}};yn[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);var $r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};const RS=1e-6;function yo(t,e){var n=new Float32Array(2);return n[0]=t,n[1]=e,n}function pi(){return We.isObject(arguments[0])?yo(...Object.values(arguments[0])):We.isArray(arguments[0])?yo(...arguments[0]):We.isNumber(arguments[0])?yo(...arguments):new Float32Array(2)}function Pn(t){let e=pi();var n=t[0],r=t[1],s=n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e}const Vt=Pn;function Lh(t,e){let n=pi();return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}const rt=Lh;function LS(t,e){let n=pi();return n[0]=t[0]*e,n[1]=t[1]*e,n}function _S(t,e){return t[0]*e[0]+t[1]*e[1]}function rn(t,e,n){let r=pi();return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function $o(t,e,n){let r=pi(),s=t[0]-e[0],a=t[1]-e[1],u=Math.sin(n),l=Math.cos(n);return r[0]=s*l-a*u+e[0],r[1]=s*u+a*l+e[1],r}function Jo(t,e,n=RS){let r=t[0],s=t[1],a=e[0],u=e[1];return Math.abs(r-a)<=n*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-u)<=n*Math.max(1,Math.abs(s),Math.abs(u))}function Bo(t,e){let n=t[0],r=t[1],s=e[0],a=e[1],u=Math.sqrt(n*n+r*r)*Math.sqrt(s*s+a*a),l=u&&(n*s+r*a)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function ai(t,e){let n=Bo(t,e),r=Pn($o(t,[0,0],n));return Jo(r,Pn(e))?n:-n+Math.PI*2}function _h(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function US(t,e){return e=Pn(e),LS(e,_S(t,e))}function kS(t,e){let n=US(t,e);return Lh(t,n)}const kn=kS,MS=1e-6,Cr={isNumber(t){return typeof t=="number"&&!isNaN(t)}};class H{constructor(e,n,r=8){if(e==null||n==null)debugger;this.x=e,this.y=n}equals(e,n=.001){if(e instanceof H)return Math.hypot(Math.abs(this.x-e.x),Math.abs(this.y-e.y))<=n}exactEquals(e){if(e instanceof H)return Math.fround(this.x)==Math.fround(e.x)&&Math.fround(this.y)==Math.fround(e.y)}valueOf(){return[this.x,this.y]}move(e,n){this.x+=e,this.y+=n}moveTo(e,n){return new H(this.x+e,this.y+n)}rotate(e,n){if(e instanceof H){let r=this.x-e.x,s=this.y-e.y,a=Math.sin(n),u=Math.cos(n);const l=r*u-s*a+e.x,f=r*a+s*u+e.y;return new H(l,f)}}translate(e,n){const r=this.x+e[0]*n,s=this.y+e[1]*n;return new H(r,s)}distanceFrom(e){if(e instanceof H){const n=this.x-e.x,r=this.y-e.y;return Math.hypot(n,r)}}}class Ge{constructor(){this.points=Array.from(arguments)}static Lerp(e,n){const r=[];return e.length>1?(e.forEach((s,a,u)=>{if(a<u.length-1){const l=u[a+1],f=ws(s.x,l.x,n),h=ws(s.y,l.y,n);r.push(new H(f,h))}}),Ge.Lerp(r,n)):e[0]}lerp(e){if(Cr.isNumber(e))return Ge.Lerp(this.points,e);console.error("%cnot a number: ","color:orange",e)}toReversed(){return new this.constructor(...this.points.toReversed())}reverse(){this.points.reverse()}getBoundingBox(){if(this instanceof te||this instanceof Xt||this instanceof ze){const e=[this.extremeX().map(u=>this.lerp(u)),this.extremeY().map(u=>this.lerp(u))].flat(),n=Math.min(...e.map(u=>u.x)),r=Math.max(...e.map(u=>u.x)),s=Math.min(...e.map(u=>u.y)),a=Math.max(...e.map(u=>u.y));return this.boundingBox={x:n,y:s,w:r-n,h:a-s},this.boundingBox}}isBoundingBoxOverlapped(e){const n=this.boundingBox??this.getBoundingBox(),r=e.boundingBox??e.getBoundingBox();if(r&&n)return!(n.x>r.x+r.w||r.x>n.x+n.w||n.y>r.y+r.h||r.y>n.y+n.h);throw n==null?new Error("boxA undifined"):new Error("boxB undifined")}endPoints(){return this.points.toSpliced(1,this.points.length-2)}isPoint(){return this.points.every(e=>this.points.every(n=>n==e||n.equals(e,.001)))}length(){let e=0;const n=20;for(let r=0;r<n;r++){const s=this.lerp(r/n),a=this.lerp((r+1)/n);e+=s.distanceFrom(a)}return e}}class ot extends Ge{constructor(e,n){super(e,n)}intersect(e){let n=[];if(e instanceof ot){const[[r,s],[a,u]]=this.points.map((function(_){return _.valueOf()}).bind(this)),[[l,f],[h,p]]=e.points.map((function(_){return _.valueOf()}).bind(this)),g=a-r,v=r,y=h-l,w=l,T=u-s,S=s,O=p-f,C=f,F=T*y-g*O;if(F!=0){const U=((C-S)*y-(w-v)*O)/F,_=((S-C)*g-(v-w)*T)/-F;n=[[U,_]]}}else if(e instanceof Xt){const[[r,s],[a,u]]=this.points.map(ne=>ne.valueOf()),[[l,f],[h,p],[g,v]]=e.points.map(ne=>ne.valueOf()),y=a-r,w=r,T=l-2*h+g,S=-2*l+2*h,O=l,C=u-s,F=s,U=f-2*p+v,_=-2*f+2*p,z=f,V=C*T-y*U,q=C*S-y*_,K=C*(O-w)-y*(z-F),ee=q**2-4*V*K;if(V==0){const ne=-K/q;y!=0?n=[[(new J([T,S,O]).valueOf(ne)-w)/y,ne]]:C!=0&&(n=[[(new J([U,_,z]).valueOf(ne)-F)/C,ne]])}else if(ee>0)n=[(-q+Math.sqrt(ee))/V/2,(-q-Math.sqrt(ee))/V/2].map(oe=>{if(y!=0)return[(new J([T,S,O]).valueOf(oe)-w)/y,oe];if(C!=0)return[(new J([U,_,z]).valueOf(oe)-F)/C,oe]});else if(ee==0){const ne=-q/V/2;y!=0?n=[[(new J([T,S,O]).valueOf(ne)-w)/y,ne]]:C!=0&&(n=[[(new J([U,_,z]).valueOf(ne)-F)/C,ne]])}}else if(e instanceof ze){const[[r,s],[a,u]]=this.points.map(pe=>pe.valueOf()),[[l,f],[h,p],[g,v],[y,w]]=e.points.map(pe=>pe.valueOf()),T=a-r,S=r,O=-l+3*h-3*g+y,C=3*l-6*h+3*g,F=-3*l+3*h,U=l,_=u-s,z=s,V=-f+3*p-3*v+w,q=3*f-6*p+3*v,K=-3*f+3*p,ee=f,ne=_*O-T*V,oe=_*C-T*q,ie=_*F-T*K,ue=_*(U-S)-T*(ee-z);ne!=0?n=new J(ne,oe,ie,ue).roots(-.001,1.001).map(ge=>{if(T!=0)return[(new J([O,C,F,U]).valueOf(ge)-S)/T,ge];if(_!=0)return[(new J([V,q,K,ee]).valueOf(ge)-z)/_,ge]}):oe!=0?n=new J(oe,ie,ue).roots(0,1).map(ge=>{const le=new J([O,C,F,U]).valueOf(ge);if(T!=0)return[(le-S)/T,ge]}):ie!=0&&(n=[-ue/ie].map(ge=>{const le=new J([O,C,F,U]).valueOf(ge);if(T!=0)return[(le-S)/T,ge]}))}return n.filter(r=>Array.isArray(r)&&r.length==2&&this.valid(r[0])&&e.valid(r[1]))}tangent(){const[e,n]=this.points,[r,s]=e.valueOf(),[a,u]=n.valueOf(),l=u-s,f=a-r;return Pn([f,l])}theta(){const[e,n]=this.points,r=Pn(rt(n.valueOf(),e.valueOf()));return ai([1,0],r)}split(){if(arguments.length>1){const e=Array.from(arguments);if(e.every(n=>this.valid(n))){const n=[];return e.filter((r,s,a)=>a.indexOf(r)==s).toSorted((r,s)=>r-s).forEach((r,s,a)=>{s==0?(n.push(new wr(this.lerp(r),this.lerp(r-1))),n.push(new te(this.lerp(r),this.lerp(a[s+1])))):s==a.length-1?n.push(new wr(this.lerp(r),this.lerp(r+1))):n.push(new te(this.lerp(r),this.lerp(a[s+1])))}),n}}else if(arguments.length==1){const e=arguments[0];if(this.valid(e)){const[n,r]=this.points,s=Ge.Lerp([n,r],e),a=Ge.Lerp([n,r],e-1),u=Ge.Lerp([n,r],e+1),l=new wr(s,a),f=new wr(s,u);return[l,f]}}}valid(e){return Cr.isNumber(e)}equals(e){return e.constructor===this.constructor?e.points.every(n=>this.contains(n)):!1}contains(e,n=1e-14){if(e instanceof H){const[r,s]=this.points,[a,u]=r.valueOf(),[l,f]=s.valueOf(),[h,p]=e.valueOf();if(l-a!==0){const g=(h-a)/(l-a);if(this.valid(g)){const[v,y]=this.lerp(g);return Math.abs(p-y)<n}}else if(f-u!==0){const g=(p-u)/(f-u);if(this.valid(g)){const[v,y]=this.lerp(g);return Math.abs(h-v)<n}}}return!1}}class wr extends ot{constructor(e,n){super(e,n)}valid(e){return Cr.isNumber(e)&&e>=0}split(){if(arguments.length==1){const e=arguments[0];if(e>0){const[n,r]=this.points,s=Ge.Lerp([n,r],e),a=Ge.Lerp([n,r],e+1),u=new te(n,s),l=new wr(s,a);return[u,l]}else return[this]}else if(arguments.length>1){const e=Array.from(arguments);if(e.every(n=>this.valid(n)))return e.toSorted((n,r)=>n-r).reduce((n,r,s,a)=>{const u=a[s-1]??0,l=r-u;return n.push(...n.pop().split(l)),n},[this])}}equals(e){return e.constructor===this.constructor?e.points.at(0).equals(this.points.at(0))&&Jo(this.tangent(0),e.tangent(0)):!1}}class te extends ot{constructor(e,n){super(e,n)}valid(e){return Cr.isNumber(e)&&e>=0&&e<=1}split(){if(arguments.length==1){const e=arguments[0];if(e>0&&e<1){const[n,r]=this.points,s=Ge.Lerp([n,r],e),a=new te(n,s),u=new te(s,r);return[a,u]}else return[this]}else if(arguments.length>1){const e=Array.from(arguments);if(e.every(n=>this.valid(n)))return e.toSorted((n,r)=>n-r).reduce((n,r,s,a)=>{const u=a[s-1]??0,l=(r-u)/(1-u);return n.push(...n.pop().split(l)),n},[this])}}equals(e){if(e.constructor===this.constructor){const n=e.points.every((s,a)=>s.equals(this.points.at(a))),r=e.points.toReversed().every((s,a)=>s.equals(this.points.at(a)));return n||r}return!1}extremeY(){return[0,1]}extremeX(){return[0,1]}segmentation(e=20){const n=[];for(let r=0;r<=e;r++)if(r!=e){const s=this.lerp(r/e),a=this.lerp((r+1)/e),u=new te(s,a);n.push(u)}return n}}class Xt extends Ge{constructor(e,n,r){super(e,n,r)}intersect(e){let n=[];if(!this.isBoundingBoxOverlapped(e))return n;if(e instanceof ot)n=e.intersect(this).map(r=>r.toReversed());else if(e instanceof Xt){const[[r,s],[a,u],[l,f]]=this.points.map(ie=>ie.valueOf()),[[h,p],[g,v],[y,w]]=e.points.map(ie=>ie.valueOf()),T=r-2*a+l,S=-2*r+2*a,O=r,C=h-2*g+y,F=-2*h+2*g,U=h,_=s-2*u+f,z=-2*s+2*u,V=s,q=p-2*v+w,K=-2*p+2*v,ee=p,ne=xr([[[C],[F],[-T,-S,U-O]],[[q],[K],[-_,-z,ee-V]]]),oe=xr([[[T],[S],[-C,-F,O-U]],[[_],[z],[-q,-K,V-ee]]]);n=ne.map(ie=>{const ue=this.lerp(ie),pe=oe.find(ge=>{const le=e.lerp(ge);return ue.equals(le)});return[ie,pe]})}else if(e instanceof ze){const[[r,s],[a,u],[l,f]]=this.points.map(le=>le.valueOf()),[[h,p],[g,v],[y,w],[T,S]]=e.points.map(le=>le.valueOf()),O=r-2*a+l,C=-2*r+2*a,F=r,U=-h+3*g-3*y+T,_=3*h-6*g+3*y,z=-3*h+3*g,V=h,q=s-2*u+f,K=-2*s+2*u,ee=s,ne=-p+3*v-3*w+S,oe=3*p-6*v+3*w,ie=-3*p+3*v,ue=p,pe=xr([[[U],[_],[z],[-O,-C,V-F]],[[ne],[oe],[ie],[-q,-K,ue-ee]]]),ge=xr([[[O],[C],[-U,-_,-z,F-V]],[[q],[K],[-ne,-oe,-ie,ee-ue]]]);n=pe.map(le=>{const Ce=this.lerp(le),Le=ge.find(Ee=>{const be=e.lerp(Ee);return Ce.equals(be)});return[le,Le]})}return n.filter(r=>Array.isArray(r)&&r.length==2&&this.valid(r[0])&&e.valid(r[1]))}split(){if(arguments.length==1){const e=arguments[0];if(e>0&&e<1){const[n,r,s]=this.points;let a=n,u=Ge.Lerp([n,r],e),l=Ge.Lerp([n,r,s],e),f=Ge.Lerp([s,r,n],1-e),h=Ge.Lerp([s,r],1-e),p=s,g=new Xt(a,u,l),v=new Xt(f,h,p);return[g,v]}else return[this]}else if(arguments.length>1){const e=Array.from(arguments);if(e.every(n=>this.valid(n)))return e.toSorted((n,r)=>n-r).reduce((n,r,s,a)=>{const u=a[s-1]??0,l=(r-u)/(1-u);return n.push(...n.pop().split(l)),n},[this])}}toCubic(){const[e,n,r]=this.points,s=e,a=Ge.Lerp([e,n],2/3),u=Ge.Lerp([r,n],2/3),l=r;return new ze(s,a,u,l)}extremeY(){}extremeX(){}valid(e){return Cr.isNumber(e)&&e>=0&&e<=1}equals(e){if(e.constructor===this.constructor){const n=e.points.every((s,a)=>s.equals(this.points.at(a))),r=e.points.toReversed().every((s,a)=>s.equals(this.points.at(a)));return n||r}return!1}contains(e){const[n,r]=e,s=new ot(e,[n+1,r]);return this.intersect(s).map(l=>new H(this.lerp(l[0]))).some(l=>l.equals(new H(e)))}segmentation(e=20){const n=[];for(let r=0;r<=e;r++)if(r!=e){const s=this.lerp(r/e),a=this.lerp((r+1)/e),u=new te(s,a);n.push(u)}return n}tangent(e){const[[n,r],[s,a],[u,l]]=this.points.map(S=>S.valueOf()),f=(n-2*s+u)*2,h=-2*n+2*s,g=new J(f,h).valueOf(e),v=(r-2*a+l)*2,y=-2*r+2*a,T=new J(v,y).valueOf(e);return Pn([g,T])}}class ze extends Ge{constructor(e,n,r,s){super(e,n,r,s)}intersect(e){let n=[];if((e instanceof te||e instanceof Xt||e instanceof ze)&&!this.isBoundingBoxOverlapped(e))return n;let r=!1;const[s,a]=this.endPoints(),[u,l]=e.endPoints();if(s.equals(u)&&(r=!0,n.push([0,0])),s.equals(l)&&(r=!0,n.push([0,1])),a.equals(u)&&(r=!0,n.push([1,0])),a.equals(l)&&(r=!0,n.push([1,1])),r)return n;if(e instanceof ot)n=e.intersect(this).map(f=>f.toReversed());else if(e instanceof Xt)n=e.intersect(this).map(f=>f.toReversed());else if(e instanceof ze){const[[f,h],[p,g],[v,y],[w,T]]=this.points.map(Pe=>Pe.valueOf()),[[S,O],[C,F],[U,_],[z,V]]=e.points.map(Pe=>Pe.valueOf()),q=-f+3*p-3*v+w,K=3*f-6*p+3*v,ee=-3*f+3*p,ne=f,oe=-h+3*g-3*y+T,ie=3*h-6*g+3*y,ue=-3*h+3*g,pe=h,ge=-S+3*C-3*U+z,le=3*S-6*C+3*U,Ce=-3*S+3*C,Le=S,Ee=-O+3*F-3*_+V,be=3*O-6*F+3*_,Ie=-3*O+3*F,Ze=O,Lt=xr([[[ge],[le],[Ce],[-q,-K,-ee,Le-ne]],[[Ee],[be],[Ie],[-oe,-ie,-ue,Ze-pe]]]),Je=xr([[[q],[K],[ee],[-ge,-le,-Ce,ne-Le]],[[oe],[ie],[ue],[-Ee,-be,-Ie,pe-Ze]]]);n=Lt.map(Pe=>{const ft=this.lerp(Pe),$e=Je.find(Qe=>{const In=e.lerp(Qe);return ft.equals(In)});return[Pe,$e]})}return n.filter(f=>Array.isArray(f)&&f.length==2&&this.valid(f[0])&&e.valid(f[1]))}split(){if(arguments.length==1){const e=arguments[0];if(ti(e)&&e>0&&e<1){const[n,r,s,a]=this.points;let u=n,l=Ge.Lerp([n,r],e),f=Ge.Lerp([n,r,s],e),h=Ge.Lerp([n,r,s,a],e),p=Ge.Lerp([a,s,r,n],1-e),g=Ge.Lerp([a,s,r],1-e),v=Ge.Lerp([a,s],1-e),y=a,w=new ze(u,l,f,h),T=new ze(p,g,v,y);return[w,T]}}else if(arguments.length>1){const e=Array.from(arguments);if(e.every(n=>this.valid(n)))return e.filter((n,r,s)=>s.indexOf(n)==r).toSorted((n,r)=>n-r).reduce((n,r,s,a)=>{const u=a[s-1]??0,l=(r-u)/(1-u);return n.push(...n.pop().split(l)),n},[this])}return[this]}extremeY(){const[[e,n],[r,s],[a,u],[l,f]]=this.points.map(C=>C.valueOf()),h=-n+3*s-3*u+f,p=3*n-6*s+3*u,g=-3*n+3*s,v=n,y=3*h,w=2*p,T=g,S=Math.abs(y)>MS?Kr(y,w,T):-T/w;return new J(h,p,g,v),[0,1,S].flat().filter((C,F,U)=>U.indexOf(C)==F&&C>=0&&C<=1)}extremeX(){const[[e,n],[r,s],[a,u],[l,f]]=this.points.map(C=>C.valueOf()),h=-e+3*r-3*a+l,p=3*e-6*r+3*a,g=-3*e+3*r,v=e,y=3*h,w=2*p,S=Kr(y,w,g);return new J(h,p,g,v),[0,1,S].flat().filter((C,F,U)=>U.indexOf(C)==F&&C>=0&&C<=1)}valid(e){return Cr.isNumber(e)&&e>=0&&e<=1}equals(e){if(e.constructor===this.constructor){const n=e.points.every((s,a)=>s.equals(this.points.at(a))),r=e.points.toReversed().every((s,a)=>s.equals(this.points.at(a)));return n||r}return!1}contains(e){const[n,r]=e,s=new ot(e,[n+1,r]);return this.intersect(s).map(l=>new H(this.lerp(l[0]))).some(l=>l.equals(new H(e)))}segmentation(e=20){const n=[];for(let r=0;r<=e;r++)if(r!=e){const s=this.lerp(r/e),a=this.lerp((r+1)/e),u=new te(s,a);n.push(u)}return n}tangent(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(U=>U.valueOf()),p=parseFloat(-n+3*s-3*u+f),g=parseFloat(3*n-6*s+3*u),v=parseFloat(-3*n+3*s);let w=new J(p*3,g*2,v*1).valueOf(e);const T=parseFloat(-r+3*a-3*l+h),S=parseFloat(3*r-6*a+3*l),O=parseFloat(-3*r+3*a);let F=new J(T*3,S*2,O*1).valueOf(e);return e==1&&l==h&&u==f?this.tangent(e-1e-8):e==0&&r==a&&n==s?this.tangent(e+1e-8):Array.from(Pn([w,F]))}normal(e,n=-90){const r=this.tangent(e);return this.derivative(e),this.derivative2(e),$o(r,[0,0],ve(n))}derivative(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(U=>U.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,w=new J(p*3,g*2,v*1).valueOf(e),T=-r+3*a-3*l+h,S=3*r-6*a+3*l,O=-3*r+3*a;return new J(T*3,S*2,O*1).valueOf(e)/w}aDerivative(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(S=>S.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,y=-r+3*a-3*l+h,w=3*r-6*a+3*l,T=-3*r+3*a;return new J(y*3,w*2,T*1),new J(p*3,g*2,v*1),isFinite(e)?e==0?Kr(y*3,w*2,T*1).filter(S=>this.valid(S)):Kr(3*(y-p*e),2*(w-g*e),T-v*e).filter(S=>this.valid(S)):Kr(p*3,g*2,v*1).filter(S=>this.valid(S))}derivative2(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(U=>U.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,y=-r+3*a-3*l+h,w=3*r-6*a+3*l,T=-3*r+3*a,S=new J(y*3,w*2,T*1),O=new J(p*3,g*2,v*1),C=new J(y*6,w*2),F=new J(p*6,g*2);return C.mul(O).sub(S.mul(F)).valueOf(e)/O.valueOf(e)**2}aDerivative2(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(_=>_.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,y=-r+3*a-3*l+h,w=3*r-6*a+3*l,T=-3*r+3*a,S=new J(y*3,w*2,T*1),O=new J(p*3,g*2,v*1),C=new J(y*6,w*2),F=new J(p*6,g*2);return C.mul(O).sub(S.mul(F)).roots().filter(_=>Math.abs(this.derivative2(_))<1e-6)}splitMonotonously(){const e=this.aDerivative2();if(e.length!=0){const n=this.split(...e);return console.log("单调分割:",this,e,n),n}else return[this]}offset(e=10,n=-90,r=0,s=1,a=[]){let u,l;if(s==1)u=this;else{const Ze=this.split(s);u=Ze[0],l=Ze[1]}const f=u.tangent(0),h=u.tangent(1),p=u.normal(0,n),g=u.normal(1,n),[v,y,w,T]=u.points,[S,O]=v.valueOf(),[C,F]=y.valueOf(),[U,_]=w.valueOf(),[z,V]=T.valueOf(),q=v.translate(p,e),K=T.translate(g,e),ee=-S+3*C-3*U+z,ne=3*S-6*C+3*U,oe=-3*S+3*C,ie=S,ue=-O+3*F-3*_+V,pe=3*O-6*F+3*_,ge=-3*O+3*F,le=O,Ce=new J(ee*3,ne*2,oe*1),Le=new J(ue*3,pe*2,ge*1),Ee=[q];if(v.equals(y))Ee.push(q);else{const Ze=new J(ue,pe,ge,le-F),Lt=new J(ee,ne,oe,ie-C),Je=Ce.mul(Lt).add(Le.mul(Ze)).roots().filter(Pe=>Pe!=0);if(Je.length!=0){const Pe=new ot(u.lerp(Je[0]),y),ft=new ot(q,q.translate(f,1)),$e=Pe.intersect(ft);if($e.length!=0){const Qe=ft.lerp($e[0][1]);Ee.push(Qe)}else{const Qe=y.translate(p,e);Ee.push(Qe)}}else Ee.push(q)}if(w.equals(T))Ee.push(K);else{const Ze=new J(ue,pe,ge,le-_),Lt=new J(ee,ne,oe,ie-U),Je=Ce.mul(Lt).add(Le.mul(Ze)).roots().filter(Pe=>Pe!=0);if(Je.length!=0){const Pe=new ot(u.lerp(Je[0]),w),ft=new ot(K,K.translate(h,1)),$e=Pe.intersect(ft);if($e.length!=0){const Qe=ft.lerp($e[0][1]);Ee.push(Qe)}else{const Qe=w.translate(g,e);Ee.push(Qe)}}else Ee.push(K)}Ee.push(K);const be=new ze(...Ee);function Ie(Ze,Lt,Je,Pe,ft=10,$e=.05){if(Ze.length()<.001)return console.log("christttttttttttttt"),!0;let Qe=0;for(let In=1;In<ft;In++){const xn=In/ft,nr=Ze.derivative(xn),gi=Ze.lerp(xn).translate(Ze.normal(xn,Pe),Je),vt=Lt.aDerivative(nr);if(vt.length==0)continue;const Nn=Lt.lerp(vt[0]),Gs=gi.distanceFrom(Nn);Qe=(Qe+Gs)/2}return Qe/Je<=$e}return Ie(u,be,e,n)?(a.push(be),s!=1?l.offset(e,n,0,1,a):a):this.offset(e,n,r,(s-r)/2,a)}outlineShape(e=20){console.log("%coutlineShape start","color:pink",this.points.map(a=>a.valueOf())),e/=2;const n=this.aDerivative2(0);let r=this.split(...n);console.log("单调分割:",r),r=r.flatMap(a=>{let u=a.aCurvature(1/e).filter(h=>h!=0&&h!=1);console.log("曲率分割点:",a,u),a.split(...u).forEach((h,p,g)=>{h.length()<.001&&(u[p==0?0:p-1]=null)});const f=u.filter(h=>h!=null);return a.split(...f)}),console.log("曲率分割:",r),console.log("---- ---- ---- ---- ---- ---- ---- ---- ---- ----");let s=[];return r.forEach((a,u,l)=>{u==0&&s.push(new te(a.points.at(0),a.points.at(0).translate(a.normal(0,-90),e)));const f=a.isClockwise(.5),h=a.radius(.5);if(isNaN(h))return console.error("very very important"),!1;let p=[];h>=e||f?p=a.offset(e,-90):p=[new te(a.points.at(0).translate(a.normal(0,-90),e),a.points.at(-1).translate(a.normal(1,-90),e))],console.log(`%c${u+1}/${l.length} -90° ${h>=e} ${f}`,"color:lightblue",p),s.push(...p),u==l.length-1&&s.push(new te(a.points.at(-1).translate(a.normal(1,-90),e),a.points.at(-1)))}),r.forEach((a,u,l)=>{u==0&&s.push(new te(a.points.at(0),a.points.at(0).translate(a.normal(0,90),e)));const f=a.isClockwise(.5),h=a.radius(.5);if(isNaN(h))return;let p=[];h>=e||!f?p=a.offset(e,90):p=[new te(a.points.at(0).translate(a.normal(0,90),e),a.points.at(-1).translate(a.normal(1,90),e))],console.log(`%c${u+1}/${l.length} +90° ${h>=e} ${!f}`,"color:lightblue",p),s.push(...p),u==l.length-1&&s.push(new te(a.points.at(-1).translate(a.normal(1,90),e),a.points.at(-1)))}),console.log("%coutlineShape result","color:pink",s.map(a=>new a.constructor(...a.points))),s=gs(s),s=Rs(s),console.log("%coutlineShape final","color:pink",s),s[0]}curvature(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(U=>U.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,y=-r+3*a-3*l+h,w=3*r-6*a+3*l,T=-3*r+3*a,S=new J(3*p,2*g,v).valueOf(e),O=new J(3*y,2*w,T).valueOf(e),C=new J(6*p,2*g).valueOf(e),F=new J(6*y,2*w).valueOf(e);return Math.abs(S*F-O*C)/(S**2+O**2)**(3/2)}aCurvature(e,n=6){const[[r,s],[a,u],[l,f],[h,p]]=this.points.map(q=>q.valueOf()),g=-r+3*a-3*l+h,v=3*r-6*a+3*l,y=-3*r+3*a,w=-s+3*u-3*f+p,T=3*s-6*u+3*f,S=-3*s+3*u,O=new J(3*g,2*v,y),C=new J(3*w,2*T,S),F=new J(6*g,2*v),U=new J(6*w,2*T),_=O.mul(U).sub(C.mul(F)),z=O.pow(2).add(C.pow(2));return _.pow(2).sub(z.pow(3).mul(e**2)).roots(0,1,n)}radius(e){return 1/this.curvature(e)}isClockwise(e){const[[n,r],[s,a],[u,l],[f,h]]=this.points.map(_=>_.valueOf()),p=-n+3*s-3*u+f,g=3*n-6*s+3*u,v=-3*n+3*s,y=-r+3*a-3*l+h,w=3*r-6*a+3*l,T=-3*r+3*a,S=new J(3*p,2*g,v).valueOf(e),O=new J(3*y,2*w,T).valueOf(e),C=new J(6*p,2*g).valueOf(e),F=new J(6*y,2*w).valueOf(e),U=Math.sign((S*F-O*C)/(S**2+O**2)**(3/2));return U>0?!0:U<0?!1:null}curvatureList(e=10){for(let n=0;n<=e;n++){const r=n/e,s=this.curvature(r),a=this.radius(r),u=this.isClockwise(r);console.log(`%c${r.toFixed(3)}`,"color: yellowgreen","曲率: "+s.toFixed(4),"顺时针: "+u,"半径: "+a.toFixed(2))}}}function gs(t){return t=xo(t),t=t.reduce((e,n,r)=>{if(r==0)return[n];{const s=e.reduce((a,u,l,f)=>{if(!n.equals(u)){const h=n.intersect(u);if(h.length!==0){const p=h.map(g=>{const[v,y]=g;if(v!=0&&v!=1&&a.push({value:v,substitute:n.lerp(v)}),y!=0&&y!=1)return{value:y,substitute:n.lerp(v)}}).filter(g=>g).toSorted((g,v)=>g.value-v.value);if(p.length!==0){const g=u.split(...p.map(v=>v.value));g.forEach((v,y,w)=>{v.pathId=u.pathId,y!=0&&v.points.splice(0,1,p[y-1].substitute),y!=w.length-1&&v.points.splice(-1,1,p[y].substitute)}),f[l]=g}}}return a},[]).filter((a,u,l)=>l.findIndex(f=>f.value==a.value)==u).toSorted((a,u)=>a.value-u.value);if(s.length!==0){const a=n.split(...s.map(u=>u.value));a.forEach((u,l,f)=>{u.pathId=n.pathId,l!=0&&u.points.splice(0,1,s[l-1].substitute),l!=f.length-1&&u.points.splice(-1,1,s[l].substitute)}),a.forEach(u=>{e.push(u)})}else e.push(n);return xo(e.flat())}},[]),t=xo(t),t=BS(t),t}function xo(t){return t.forEach((e,n,r)=>{var a;let s=r.findIndex(u=>u.equals(e));if(s!=n){(a=r[s]).pathId??(a.pathId=[]),e.pathId??(e.pathId=[]);let u=[...r[s].pathId,...e.pathId];r[s].pathId=Array.from(new Set(u)),e.deleted=!0}}),t=t.filter(e=>!e.deleted),t}function BS(t){return t.filter(e=>!e.points.at(0).equals(e.points.at(-1)))}var As={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */As.exports;(function(t,e){(function(){var n,r="4.17.21",s=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",l="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",h=500,p="__lodash_placeholder__",g=1,v=2,y=4,w=1,T=2,S=1,O=2,C=4,F=8,U=16,_=32,z=64,V=128,q=256,K=512,ee=30,ne="...",oe=800,ie=16,ue=1,pe=2,ge=3,le=1/0,Ce=9007199254740991,Le=17976931348623157e292,Ee=NaN,be=4294967295,Ie=be-1,Ze=be>>>1,Lt=[["ary",V],["bind",S],["bindKey",O],["curry",F],["curryRight",U],["flip",K],["partial",_],["partialRight",z],["rearg",q]],Je="[object Arguments]",Pe="[object Array]",ft="[object AsyncFunction]",$e="[object Boolean]",Qe="[object Date]",In="[object DOMException]",xn="[object Error]",nr="[object Function]",gi="[object GeneratorFunction]",vt="[object Map]",Nn="[object Number]",Gs="[object Null]",an="[object Object]",ru="[object Promise]",np="[object Proxy]",Rr="[object RegExp]",Gt="[object Set]",Lr="[object String]",mi="[object Symbol]",rp="[object Undefined]",_r="[object WeakMap]",ip="[object WeakSet]",Ur="[object ArrayBuffer]",rr="[object DataView]",zs="[object Float32Array]",Hs="[object Float64Array]",qs="[object Int8Array]",Ws="[object Int16Array]",Vs="[object Int32Array]",Xs="[object Uint8Array]",Ys="[object Uint8ClampedArray]",Ks="[object Uint16Array]",Zs="[object Uint32Array]",sp=/\b__p \+= '';/g,ap=/\b(__p \+=) '' \+/g,op=/(__e\(.*?\)|\b__t\)) \+\n'';/g,iu=/&(?:amp|lt|gt|quot|#39);/g,su=/[&<>"']/g,up=RegExp(iu.source),lp=RegExp(su.source),cp=/<%-([\s\S]+?)%>/g,fp=/<%([\s\S]+?)%>/g,au=/<%=([\s\S]+?)%>/g,hp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pp=/^\w*$/,dp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$s=/[\\^$.*+?()[\]{}|]/g,vp=RegExp($s.source),Js=/^\s+/,gp=/\s/,mp=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,yp=/\{\n\/\* \[wrapped with (.+)\] \*/,xp=/,? & /,bp=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,wp=/[()=,{}\[\]\/\s]/,Sp=/\\(\\)?/g,Tp=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ou=/\w*$/,Ep=/^[-+]0x[0-9a-f]+$/i,Op=/^0b[01]+$/i,Cp=/^\[object .+?Constructor\]$/,Fp=/^0o[0-7]+$/i,Ap=/^(?:0|[1-9]\d*)$/,Rp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,yi=/($^)/,Lp=/['\n\r\u2028\u2029\\]/g,xi="\\ud800-\\udfff",_p="\\u0300-\\u036f",Up="\\ufe20-\\ufe2f",kp="\\u20d0-\\u20ff",uu=_p+Up+kp,lu="\\u2700-\\u27bf",cu="a-z\\xdf-\\xf6\\xf8-\\xff",Mp="\\xac\\xb1\\xd7\\xf7",Bp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Pp="\\u2000-\\u206f",Dp=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fu="A-Z\\xc0-\\xd6\\xd8-\\xde",hu="\\ufe0e\\ufe0f",pu=Mp+Bp+Pp+Dp,Qs="['’]",Ip="["+xi+"]",du="["+pu+"]",bi="["+uu+"]",vu="\\d+",Np="["+lu+"]",gu="["+cu+"]",mu="[^"+xi+pu+vu+lu+cu+fu+"]",js="\\ud83c[\\udffb-\\udfff]",Gp="(?:"+bi+"|"+js+")",yu="[^"+xi+"]",ea="(?:\\ud83c[\\udde6-\\uddff]){2}",ta="[\\ud800-\\udbff][\\udc00-\\udfff]",ir="["+fu+"]",xu="\\u200d",bu="(?:"+gu+"|"+mu+")",zp="(?:"+ir+"|"+mu+")",wu="(?:"+Qs+"(?:d|ll|m|re|s|t|ve))?",Su="(?:"+Qs+"(?:D|LL|M|RE|S|T|VE))?",Tu=Gp+"?",Eu="["+hu+"]?",Hp="(?:"+xu+"(?:"+[yu,ea,ta].join("|")+")"+Eu+Tu+")*",qp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Wp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ou=Eu+Tu+Hp,Vp="(?:"+[Np,ea,ta].join("|")+")"+Ou,Xp="(?:"+[yu+bi+"?",bi,ea,ta,Ip].join("|")+")",Yp=RegExp(Qs,"g"),Kp=RegExp(bi,"g"),na=RegExp(js+"(?="+js+")|"+Xp+Ou,"g"),Zp=RegExp([ir+"?"+gu+"+"+wu+"(?="+[du,ir,"$"].join("|")+")",zp+"+"+Su+"(?="+[du,ir+bu,"$"].join("|")+")",ir+"?"+bu+"+"+wu,ir+"+"+Su,Wp,qp,vu,Vp].join("|"),"g"),$p=RegExp("["+xu+xi+uu+hu+"]"),Jp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Qp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],jp=-1,De={};De[zs]=De[Hs]=De[qs]=De[Ws]=De[Vs]=De[Xs]=De[Ys]=De[Ks]=De[Zs]=!0,De[Je]=De[Pe]=De[Ur]=De[$e]=De[rr]=De[Qe]=De[xn]=De[nr]=De[vt]=De[Nn]=De[an]=De[Rr]=De[Gt]=De[Lr]=De[_r]=!1;var ke={};ke[Je]=ke[Pe]=ke[Ur]=ke[rr]=ke[$e]=ke[Qe]=ke[zs]=ke[Hs]=ke[qs]=ke[Ws]=ke[Vs]=ke[vt]=ke[Nn]=ke[an]=ke[Rr]=ke[Gt]=ke[Lr]=ke[mi]=ke[Xs]=ke[Ys]=ke[Ks]=ke[Zs]=!0,ke[xn]=ke[nr]=ke[_r]=!1;var e0={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},t0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},n0={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},r0={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},i0=parseFloat,s0=parseInt,Cu=typeof $r=="object"&&$r&&$r.Object===Object&&$r,a0=typeof self=="object"&&self&&self.Object===Object&&self,st=Cu||a0||Function("return this")(),ra=e&&!e.nodeType&&e,Gn=ra&&!0&&t&&!t.nodeType&&t,Fu=Gn&&Gn.exports===ra,ia=Fu&&Cu.process,_t=function(){try{var R=Gn&&Gn.require&&Gn.require("util").types;return R||ia&&ia.binding&&ia.binding("util")}catch{}}(),Au=_t&&_t.isArrayBuffer,Ru=_t&&_t.isDate,Lu=_t&&_t.isMap,_u=_t&&_t.isRegExp,Uu=_t&&_t.isSet,ku=_t&&_t.isTypedArray;function wt(R,P,k){switch(k.length){case 0:return R.call(P);case 1:return R.call(P,k[0]);case 2:return R.call(P,k[0],k[1]);case 3:return R.call(P,k[0],k[1],k[2])}return R.apply(P,k)}function o0(R,P,k,Z){for(var fe=-1,Ae=R==null?0:R.length;++fe<Ae;){var je=R[fe];P(Z,je,k(je),R)}return Z}function Ut(R,P){for(var k=-1,Z=R==null?0:R.length;++k<Z&&P(R[k],k,R)!==!1;);return R}function u0(R,P){for(var k=R==null?0:R.length;k--&&P(R[k],k,R)!==!1;);return R}function Mu(R,P){for(var k=-1,Z=R==null?0:R.length;++k<Z;)if(!P(R[k],k,R))return!1;return!0}function bn(R,P){for(var k=-1,Z=R==null?0:R.length,fe=0,Ae=[];++k<Z;){var je=R[k];P(je,k,R)&&(Ae[fe++]=je)}return Ae}function wi(R,P){var k=R==null?0:R.length;return!!k&&sr(R,P,0)>-1}function sa(R,P,k){for(var Z=-1,fe=R==null?0:R.length;++Z<fe;)if(k(P,R[Z]))return!0;return!1}function Ne(R,P){for(var k=-1,Z=R==null?0:R.length,fe=Array(Z);++k<Z;)fe[k]=P(R[k],k,R);return fe}function wn(R,P){for(var k=-1,Z=P.length,fe=R.length;++k<Z;)R[fe+k]=P[k];return R}function aa(R,P,k,Z){var fe=-1,Ae=R==null?0:R.length;for(Z&&Ae&&(k=R[++fe]);++fe<Ae;)k=P(k,R[fe],fe,R);return k}function l0(R,P,k,Z){var fe=R==null?0:R.length;for(Z&&fe&&(k=R[--fe]);fe--;)k=P(k,R[fe],fe,R);return k}function oa(R,P){for(var k=-1,Z=R==null?0:R.length;++k<Z;)if(P(R[k],k,R))return!0;return!1}var c0=ua("length");function f0(R){return R.split("")}function h0(R){return R.match(bp)||[]}function Bu(R,P,k){var Z;return k(R,function(fe,Ae,je){if(P(fe,Ae,je))return Z=Ae,!1}),Z}function Si(R,P,k,Z){for(var fe=R.length,Ae=k+(Z?1:-1);Z?Ae--:++Ae<fe;)if(P(R[Ae],Ae,R))return Ae;return-1}function sr(R,P,k){return P===P?E0(R,P,k):Si(R,Pu,k)}function p0(R,P,k,Z){for(var fe=k-1,Ae=R.length;++fe<Ae;)if(Z(R[fe],P))return fe;return-1}function Pu(R){return R!==R}function Du(R,P){var k=R==null?0:R.length;return k?ca(R,P)/k:Ee}function ua(R){return function(P){return P==null?n:P[R]}}function la(R){return function(P){return R==null?n:R[P]}}function Iu(R,P,k,Z,fe){return fe(R,function(Ae,je,Ue){k=Z?(Z=!1,Ae):P(k,Ae,je,Ue)}),k}function d0(R,P){var k=R.length;for(R.sort(P);k--;)R[k]=R[k].value;return R}function ca(R,P){for(var k,Z=-1,fe=R.length;++Z<fe;){var Ae=P(R[Z]);Ae!==n&&(k=k===n?Ae:k+Ae)}return k}function fa(R,P){for(var k=-1,Z=Array(R);++k<R;)Z[k]=P(k);return Z}function v0(R,P){return Ne(P,function(k){return[k,R[k]]})}function Nu(R){return R&&R.slice(0,qu(R)+1).replace(Js,"")}function St(R){return function(P){return R(P)}}function ha(R,P){return Ne(P,function(k){return R[k]})}function kr(R,P){return R.has(P)}function Gu(R,P){for(var k=-1,Z=R.length;++k<Z&&sr(P,R[k],0)>-1;);return k}function zu(R,P){for(var k=R.length;k--&&sr(P,R[k],0)>-1;);return k}function g0(R,P){for(var k=R.length,Z=0;k--;)R[k]===P&&++Z;return Z}var m0=la(e0),y0=la(t0);function x0(R){return"\\"+r0[R]}function b0(R,P){return R==null?n:R[P]}function ar(R){return $p.test(R)}function w0(R){return Jp.test(R)}function S0(R){for(var P,k=[];!(P=R.next()).done;)k.push(P.value);return k}function pa(R){var P=-1,k=Array(R.size);return R.forEach(function(Z,fe){k[++P]=[fe,Z]}),k}function Hu(R,P){return function(k){return R(P(k))}}function Sn(R,P){for(var k=-1,Z=R.length,fe=0,Ae=[];++k<Z;){var je=R[k];(je===P||je===p)&&(R[k]=p,Ae[fe++]=k)}return Ae}function Ti(R){var P=-1,k=Array(R.size);return R.forEach(function(Z){k[++P]=Z}),k}function T0(R){var P=-1,k=Array(R.size);return R.forEach(function(Z){k[++P]=[Z,Z]}),k}function E0(R,P,k){for(var Z=k-1,fe=R.length;++Z<fe;)if(R[Z]===P)return Z;return-1}function O0(R,P,k){for(var Z=k+1;Z--;)if(R[Z]===P)return Z;return Z}function or(R){return ar(R)?F0(R):c0(R)}function zt(R){return ar(R)?A0(R):f0(R)}function qu(R){for(var P=R.length;P--&&gp.test(R.charAt(P)););return P}var C0=la(n0);function F0(R){for(var P=na.lastIndex=0;na.test(R);)++P;return P}function A0(R){return R.match(na)||[]}function R0(R){return R.match(Zp)||[]}var L0=function R(P){P=P==null?st:ur.defaults(st.Object(),P,ur.pick(st,Qp));var k=P.Array,Z=P.Date,fe=P.Error,Ae=P.Function,je=P.Math,Ue=P.Object,da=P.RegExp,_0=P.String,kt=P.TypeError,Ei=k.prototype,U0=Ae.prototype,lr=Ue.prototype,Oi=P["__core-js_shared__"],Ci=U0.toString,_e=lr.hasOwnProperty,k0=0,Wu=function(){var i=/[^.]+$/.exec(Oi&&Oi.keys&&Oi.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Fi=lr.toString,M0=Ci.call(Ue),B0=st._,P0=da("^"+Ci.call(_e).replace($s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ai=Fu?P.Buffer:n,Tn=P.Symbol,Ri=P.Uint8Array,Vu=Ai?Ai.allocUnsafe:n,Li=Hu(Ue.getPrototypeOf,Ue),Xu=Ue.create,Yu=lr.propertyIsEnumerable,_i=Ei.splice,Ku=Tn?Tn.isConcatSpreadable:n,Mr=Tn?Tn.iterator:n,zn=Tn?Tn.toStringTag:n,Ui=function(){try{var i=Xn(Ue,"defineProperty");return i({},"",{}),i}catch{}}(),D0=P.clearTimeout!==st.clearTimeout&&P.clearTimeout,I0=Z&&Z.now!==st.Date.now&&Z.now,N0=P.setTimeout!==st.setTimeout&&P.setTimeout,ki=je.ceil,Mi=je.floor,va=Ue.getOwnPropertySymbols,G0=Ai?Ai.isBuffer:n,Zu=P.isFinite,z0=Ei.join,H0=Hu(Ue.keys,Ue),et=je.max,ut=je.min,q0=Z.now,W0=P.parseInt,$u=je.random,V0=Ei.reverse,ga=Xn(P,"DataView"),Br=Xn(P,"Map"),ma=Xn(P,"Promise"),cr=Xn(P,"Set"),Pr=Xn(P,"WeakMap"),Dr=Xn(Ue,"create"),Bi=Pr&&new Pr,fr={},X0=Yn(ga),Y0=Yn(Br),K0=Yn(ma),Z0=Yn(cr),$0=Yn(Pr),Pi=Tn?Tn.prototype:n,Ir=Pi?Pi.valueOf:n,Ju=Pi?Pi.toString:n;function x(i){if(qe(i)&&!de(i)&&!(i instanceof Oe)){if(i instanceof Mt)return i;if(_e.call(i,"__wrapped__"))return Ql(i)}return new Mt(i)}var hr=function(){function i(){}return function(o){if(!He(o))return{};if(Xu)return Xu(o);i.prototype=o;var c=new i;return i.prototype=n,c}}();function Di(){}function Mt(i,o){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=n}x.templateSettings={escape:cp,evaluate:fp,interpolate:au,variable:"",imports:{_:x}},x.prototype=Di.prototype,x.prototype.constructor=x,Mt.prototype=hr(Di.prototype),Mt.prototype.constructor=Mt;function Oe(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=be,this.__views__=[]}function J0(){var i=new Oe(this.__wrapped__);return i.__actions__=gt(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=gt(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=gt(this.__views__),i}function Q0(){if(this.__filtered__){var i=new Oe(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function j0(){var i=this.__wrapped__.value(),o=this.__dir__,c=de(i),d=o<0,m=c?i.length:0,b=fv(0,m,this.__views__),E=b.start,A=b.end,L=A-E,D=d?A:E-1,I=this.__iteratees__,G=I.length,Y=0,j=ut(L,this.__takeCount__);if(!c||!d&&m==L&&j==L)return wl(i,this.__actions__);var se=[];e:for(;L--&&Y<j;){D+=o;for(var we=-1,ae=i[D];++we<G;){var Te=I[we],Fe=Te.iteratee,Ot=Te.type,dt=Fe(ae);if(Ot==pe)ae=dt;else if(!dt){if(Ot==ue)continue e;break e}}se[Y++]=ae}return se}Oe.prototype=hr(Di.prototype),Oe.prototype.constructor=Oe;function Hn(i){var o=-1,c=i==null?0:i.length;for(this.clear();++o<c;){var d=i[o];this.set(d[0],d[1])}}function ed(){this.__data__=Dr?Dr(null):{},this.size=0}function td(i){var o=this.has(i)&&delete this.__data__[i];return this.size-=o?1:0,o}function nd(i){var o=this.__data__;if(Dr){var c=o[i];return c===f?n:c}return _e.call(o,i)?o[i]:n}function rd(i){var o=this.__data__;return Dr?o[i]!==n:_e.call(o,i)}function id(i,o){var c=this.__data__;return this.size+=this.has(i)?0:1,c[i]=Dr&&o===n?f:o,this}Hn.prototype.clear=ed,Hn.prototype.delete=td,Hn.prototype.get=nd,Hn.prototype.has=rd,Hn.prototype.set=id;function on(i){var o=-1,c=i==null?0:i.length;for(this.clear();++o<c;){var d=i[o];this.set(d[0],d[1])}}function sd(){this.__data__=[],this.size=0}function ad(i){var o=this.__data__,c=Ii(o,i);if(c<0)return!1;var d=o.length-1;return c==d?o.pop():_i.call(o,c,1),--this.size,!0}function od(i){var o=this.__data__,c=Ii(o,i);return c<0?n:o[c][1]}function ud(i){return Ii(this.__data__,i)>-1}function ld(i,o){var c=this.__data__,d=Ii(c,i);return d<0?(++this.size,c.push([i,o])):c[d][1]=o,this}on.prototype.clear=sd,on.prototype.delete=ad,on.prototype.get=od,on.prototype.has=ud,on.prototype.set=ld;function un(i){var o=-1,c=i==null?0:i.length;for(this.clear();++o<c;){var d=i[o];this.set(d[0],d[1])}}function cd(){this.size=0,this.__data__={hash:new Hn,map:new(Br||on),string:new Hn}}function fd(i){var o=$i(this,i).delete(i);return this.size-=o?1:0,o}function hd(i){return $i(this,i).get(i)}function pd(i){return $i(this,i).has(i)}function dd(i,o){var c=$i(this,i),d=c.size;return c.set(i,o),this.size+=c.size==d?0:1,this}un.prototype.clear=cd,un.prototype.delete=fd,un.prototype.get=hd,un.prototype.has=pd,un.prototype.set=dd;function qn(i){var o=-1,c=i==null?0:i.length;for(this.__data__=new un;++o<c;)this.add(i[o])}function vd(i){return this.__data__.set(i,f),this}function gd(i){return this.__data__.has(i)}qn.prototype.add=qn.prototype.push=vd,qn.prototype.has=gd;function Ht(i){var o=this.__data__=new on(i);this.size=o.size}function md(){this.__data__=new on,this.size=0}function yd(i){var o=this.__data__,c=o.delete(i);return this.size=o.size,c}function xd(i){return this.__data__.get(i)}function bd(i){return this.__data__.has(i)}function wd(i,o){var c=this.__data__;if(c instanceof on){var d=c.__data__;if(!Br||d.length<s-1)return d.push([i,o]),this.size=++c.size,this;c=this.__data__=new un(d)}return c.set(i,o),this.size=c.size,this}Ht.prototype.clear=md,Ht.prototype.delete=yd,Ht.prototype.get=xd,Ht.prototype.has=bd,Ht.prototype.set=wd;function Qu(i,o){var c=de(i),d=!c&&Kn(i),m=!c&&!d&&An(i),b=!c&&!d&&!m&&gr(i),E=c||d||m||b,A=E?fa(i.length,_0):[],L=A.length;for(var D in i)(o||_e.call(i,D))&&!(E&&(D=="length"||m&&(D=="offset"||D=="parent")||b&&(D=="buffer"||D=="byteLength"||D=="byteOffset")||hn(D,L)))&&A.push(D);return A}function ju(i){var o=i.length;return o?i[Aa(0,o-1)]:n}function Sd(i,o){return Ji(gt(i),Wn(o,0,i.length))}function Td(i){return Ji(gt(i))}function ya(i,o,c){(c!==n&&!qt(i[o],c)||c===n&&!(o in i))&&ln(i,o,c)}function Nr(i,o,c){var d=i[o];(!(_e.call(i,o)&&qt(d,c))||c===n&&!(o in i))&&ln(i,o,c)}function Ii(i,o){for(var c=i.length;c--;)if(qt(i[c][0],o))return c;return-1}function Ed(i,o,c,d){return En(i,function(m,b,E){o(d,m,c(m),E)}),d}function el(i,o){return i&&jt(o,nt(o),i)}function Od(i,o){return i&&jt(o,yt(o),i)}function ln(i,o,c){o=="__proto__"&&Ui?Ui(i,o,{configurable:!0,enumerable:!0,value:c,writable:!0}):i[o]=c}function xa(i,o){for(var c=-1,d=o.length,m=k(d),b=i==null;++c<d;)m[c]=b?n:ja(i,o[c]);return m}function Wn(i,o,c){return i===i&&(c!==n&&(i=i<=c?i:c),o!==n&&(i=i>=o?i:o)),i}function Bt(i,o,c,d,m,b){var E,A=o&g,L=o&v,D=o&y;if(c&&(E=m?c(i,d,m,b):c(i)),E!==n)return E;if(!He(i))return i;var I=de(i);if(I){if(E=pv(i),!A)return gt(i,E)}else{var G=lt(i),Y=G==nr||G==gi;if(An(i))return El(i,A);if(G==an||G==Je||Y&&!m){if(E=L||Y?{}:ql(i),!A)return L?nv(i,Od(E,i)):tv(i,el(E,i))}else{if(!ke[G])return m?i:{};E=dv(i,G,A)}}b||(b=new Ht);var j=b.get(i);if(j)return j;b.set(i,E),yc(i)?i.forEach(function(ae){E.add(Bt(ae,o,c,ae,i,b))}):gc(i)&&i.forEach(function(ae,Te){E.set(Te,Bt(ae,o,c,Te,i,b))});var se=D?L?Na:Ia:L?yt:nt,we=I?n:se(i);return Ut(we||i,function(ae,Te){we&&(Te=ae,ae=i[Te]),Nr(E,Te,Bt(ae,o,c,Te,i,b))}),E}function Cd(i){var o=nt(i);return function(c){return tl(c,i,o)}}function tl(i,o,c){var d=c.length;if(i==null)return!d;for(i=Ue(i);d--;){var m=c[d],b=o[m],E=i[m];if(E===n&&!(m in i)||!b(E))return!1}return!0}function nl(i,o,c){if(typeof i!="function")throw new kt(u);return Xr(function(){i.apply(n,c)},o)}function Gr(i,o,c,d){var m=-1,b=wi,E=!0,A=i.length,L=[],D=o.length;if(!A)return L;c&&(o=Ne(o,St(c))),d?(b=sa,E=!1):o.length>=s&&(b=kr,E=!1,o=new qn(o));e:for(;++m<A;){var I=i[m],G=c==null?I:c(I);if(I=d||I!==0?I:0,E&&G===G){for(var Y=D;Y--;)if(o[Y]===G)continue e;L.push(I)}else b(o,G,d)||L.push(I)}return L}var En=Rl(Qt),rl=Rl(wa,!0);function Fd(i,o){var c=!0;return En(i,function(d,m,b){return c=!!o(d,m,b),c}),c}function Ni(i,o,c){for(var d=-1,m=i.length;++d<m;){var b=i[d],E=o(b);if(E!=null&&(A===n?E===E&&!Et(E):c(E,A)))var A=E,L=b}return L}function Ad(i,o,c,d){var m=i.length;for(c=xe(c),c<0&&(c=-c>m?0:m+c),d=d===n||d>m?m:xe(d),d<0&&(d+=m),d=c>d?0:bc(d);c<d;)i[c++]=o;return i}function il(i,o){var c=[];return En(i,function(d,m,b){o(d,m,b)&&c.push(d)}),c}function at(i,o,c,d,m){var b=-1,E=i.length;for(c||(c=gv),m||(m=[]);++b<E;){var A=i[b];o>0&&c(A)?o>1?at(A,o-1,c,d,m):wn(m,A):d||(m[m.length]=A)}return m}var ba=Ll(),sl=Ll(!0);function Qt(i,o){return i&&ba(i,o,nt)}function wa(i,o){return i&&sl(i,o,nt)}function Gi(i,o){return bn(o,function(c){return pn(i[c])})}function Vn(i,o){o=Cn(o,i);for(var c=0,d=o.length;i!=null&&c<d;)i=i[en(o[c++])];return c&&c==d?i:n}function al(i,o,c){var d=o(i);return de(i)?d:wn(d,c(i))}function ht(i){return i==null?i===n?rp:Gs:zn&&zn in Ue(i)?cv(i):Tv(i)}function Sa(i,o){return i>o}function Rd(i,o){return i!=null&&_e.call(i,o)}function Ld(i,o){return i!=null&&o in Ue(i)}function _d(i,o,c){return i>=ut(o,c)&&i<et(o,c)}function Ta(i,o,c){for(var d=c?sa:wi,m=i[0].length,b=i.length,E=b,A=k(b),L=1/0,D=[];E--;){var I=i[E];E&&o&&(I=Ne(I,St(o))),L=ut(I.length,L),A[E]=!c&&(o||m>=120&&I.length>=120)?new qn(E&&I):n}I=i[0];var G=-1,Y=A[0];e:for(;++G<m&&D.length<L;){var j=I[G],se=o?o(j):j;if(j=c||j!==0?j:0,!(Y?kr(Y,se):d(D,se,c))){for(E=b;--E;){var we=A[E];if(!(we?kr(we,se):d(i[E],se,c)))continue e}Y&&Y.push(se),D.push(j)}}return D}function Ud(i,o,c,d){return Qt(i,function(m,b,E){o(d,c(m),b,E)}),d}function zr(i,o,c){o=Cn(o,i),i=Yl(i,o);var d=i==null?i:i[en(Dt(o))];return d==null?n:wt(d,i,c)}function ol(i){return qe(i)&&ht(i)==Je}function kd(i){return qe(i)&&ht(i)==Ur}function Md(i){return qe(i)&&ht(i)==Qe}function Hr(i,o,c,d,m){return i===o?!0:i==null||o==null||!qe(i)&&!qe(o)?i!==i&&o!==o:Bd(i,o,c,d,Hr,m)}function Bd(i,o,c,d,m,b){var E=de(i),A=de(o),L=E?Pe:lt(i),D=A?Pe:lt(o);L=L==Je?an:L,D=D==Je?an:D;var I=L==an,G=D==an,Y=L==D;if(Y&&An(i)){if(!An(o))return!1;E=!0,I=!1}if(Y&&!I)return b||(b=new Ht),E||gr(i)?Gl(i,o,c,d,m,b):uv(i,o,L,c,d,m,b);if(!(c&w)){var j=I&&_e.call(i,"__wrapped__"),se=G&&_e.call(o,"__wrapped__");if(j||se){var we=j?i.value():i,ae=se?o.value():o;return b||(b=new Ht),m(we,ae,c,d,b)}}return Y?(b||(b=new Ht),lv(i,o,c,d,m,b)):!1}function Pd(i){return qe(i)&&lt(i)==vt}function Ea(i,o,c,d){var m=c.length,b=m,E=!d;if(i==null)return!b;for(i=Ue(i);m--;){var A=c[m];if(E&&A[2]?A[1]!==i[A[0]]:!(A[0]in i))return!1}for(;++m<b;){A=c[m];var L=A[0],D=i[L],I=A[1];if(E&&A[2]){if(D===n&&!(L in i))return!1}else{var G=new Ht;if(d)var Y=d(D,I,L,i,o,G);if(!(Y===n?Hr(I,D,w|T,d,G):Y))return!1}}return!0}function ul(i){if(!He(i)||yv(i))return!1;var o=pn(i)?P0:Cp;return o.test(Yn(i))}function Dd(i){return qe(i)&&ht(i)==Rr}function Id(i){return qe(i)&&lt(i)==Gt}function Nd(i){return qe(i)&&rs(i.length)&&!!De[ht(i)]}function ll(i){return typeof i=="function"?i:i==null?xt:typeof i=="object"?de(i)?hl(i[0],i[1]):fl(i):_c(i)}function Oa(i){if(!Vr(i))return H0(i);var o=[];for(var c in Ue(i))_e.call(i,c)&&c!="constructor"&&o.push(c);return o}function Gd(i){if(!He(i))return Sv(i);var o=Vr(i),c=[];for(var d in i)d=="constructor"&&(o||!_e.call(i,d))||c.push(d);return c}function Ca(i,o){return i<o}function cl(i,o){var c=-1,d=mt(i)?k(i.length):[];return En(i,function(m,b,E){d[++c]=o(m,b,E)}),d}function fl(i){var o=za(i);return o.length==1&&o[0][2]?Vl(o[0][0],o[0][1]):function(c){return c===i||Ea(c,i,o)}}function hl(i,o){return qa(i)&&Wl(o)?Vl(en(i),o):function(c){var d=ja(c,i);return d===n&&d===o?eo(c,i):Hr(o,d,w|T)}}function zi(i,o,c,d,m){i!==o&&ba(o,function(b,E){if(m||(m=new Ht),He(b))zd(i,o,E,c,zi,d,m);else{var A=d?d(Va(i,E),b,E+"",i,o,m):n;A===n&&(A=b),ya(i,E,A)}},yt)}function zd(i,o,c,d,m,b,E){var A=Va(i,c),L=Va(o,c),D=E.get(L);if(D){ya(i,c,D);return}var I=b?b(A,L,c+"",i,o,E):n,G=I===n;if(G){var Y=de(L),j=!Y&&An(L),se=!Y&&!j&&gr(L);I=L,Y||j||se?de(A)?I=A:Xe(A)?I=gt(A):j?(G=!1,I=El(L,!0)):se?(G=!1,I=Ol(L,!0)):I=[]:Yr(L)||Kn(L)?(I=A,Kn(A)?I=wc(A):(!He(A)||pn(A))&&(I=ql(L))):G=!1}G&&(E.set(L,I),m(I,L,d,b,E),E.delete(L)),ya(i,c,I)}function pl(i,o){var c=i.length;if(c)return o+=o<0?c:0,hn(o,c)?i[o]:n}function dl(i,o,c){o.length?o=Ne(o,function(b){return de(b)?function(E){return Vn(E,b.length===1?b[0]:b)}:b}):o=[xt];var d=-1;o=Ne(o,St(re()));var m=cl(i,function(b,E,A){var L=Ne(o,function(D){return D(b)});return{criteria:L,index:++d,value:b}});return d0(m,function(b,E){return ev(b,E,c)})}function Hd(i,o){return vl(i,o,function(c,d){return eo(i,d)})}function vl(i,o,c){for(var d=-1,m=o.length,b={};++d<m;){var E=o[d],A=Vn(i,E);c(A,E)&&qr(b,Cn(E,i),A)}return b}function qd(i){return function(o){return Vn(o,i)}}function Fa(i,o,c,d){var m=d?p0:sr,b=-1,E=o.length,A=i;for(i===o&&(o=gt(o)),c&&(A=Ne(i,St(c)));++b<E;)for(var L=0,D=o[b],I=c?c(D):D;(L=m(A,I,L,d))>-1;)A!==i&&_i.call(A,L,1),_i.call(i,L,1);return i}function gl(i,o){for(var c=i?o.length:0,d=c-1;c--;){var m=o[c];if(c==d||m!==b){var b=m;hn(m)?_i.call(i,m,1):_a(i,m)}}return i}function Aa(i,o){return i+Mi($u()*(o-i+1))}function Wd(i,o,c,d){for(var m=-1,b=et(ki((o-i)/(c||1)),0),E=k(b);b--;)E[d?b:++m]=i,i+=c;return E}function Ra(i,o){var c="";if(!i||o<1||o>Ce)return c;do o%2&&(c+=i),o=Mi(o/2),o&&(i+=i);while(o);return c}function Se(i,o){return Xa(Xl(i,o,xt),i+"")}function Vd(i){return ju(mr(i))}function Xd(i,o){var c=mr(i);return Ji(c,Wn(o,0,c.length))}function qr(i,o,c,d){if(!He(i))return i;o=Cn(o,i);for(var m=-1,b=o.length,E=b-1,A=i;A!=null&&++m<b;){var L=en(o[m]),D=c;if(L==="__proto__"||L==="constructor"||L==="prototype")return i;if(m!=E){var I=A[L];D=d?d(I,L,A):n,D===n&&(D=He(I)?I:hn(o[m+1])?[]:{})}Nr(A,L,D),A=A[L]}return i}var ml=Bi?function(i,o){return Bi.set(i,o),i}:xt,Yd=Ui?function(i,o){return Ui(i,"toString",{configurable:!0,enumerable:!1,value:no(o),writable:!0})}:xt;function Kd(i){return Ji(mr(i))}function Pt(i,o,c){var d=-1,m=i.length;o<0&&(o=-o>m?0:m+o),c=c>m?m:c,c<0&&(c+=m),m=o>c?0:c-o>>>0,o>>>=0;for(var b=k(m);++d<m;)b[d]=i[d+o];return b}function Zd(i,o){var c;return En(i,function(d,m,b){return c=o(d,m,b),!c}),!!c}function Hi(i,o,c){var d=0,m=i==null?d:i.length;if(typeof o=="number"&&o===o&&m<=Ze){for(;d<m;){var b=d+m>>>1,E=i[b];E!==null&&!Et(E)&&(c?E<=o:E<o)?d=b+1:m=b}return m}return La(i,o,xt,c)}function La(i,o,c,d){var m=0,b=i==null?0:i.length;if(b===0)return 0;o=c(o);for(var E=o!==o,A=o===null,L=Et(o),D=o===n;m<b;){var I=Mi((m+b)/2),G=c(i[I]),Y=G!==n,j=G===null,se=G===G,we=Et(G);if(E)var ae=d||se;else D?ae=se&&(d||Y):A?ae=se&&Y&&(d||!j):L?ae=se&&Y&&!j&&(d||!we):j||we?ae=!1:ae=d?G<=o:G<o;ae?m=I+1:b=I}return ut(b,Ie)}function yl(i,o){for(var c=-1,d=i.length,m=0,b=[];++c<d;){var E=i[c],A=o?o(E):E;if(!c||!qt(A,L)){var L=A;b[m++]=E===0?0:E}}return b}function xl(i){return typeof i=="number"?i:Et(i)?Ee:+i}function Tt(i){if(typeof i=="string")return i;if(de(i))return Ne(i,Tt)+"";if(Et(i))return Ju?Ju.call(i):"";var o=i+"";return o=="0"&&1/i==-le?"-0":o}function On(i,o,c){var d=-1,m=wi,b=i.length,E=!0,A=[],L=A;if(c)E=!1,m=sa;else if(b>=s){var D=o?null:av(i);if(D)return Ti(D);E=!1,m=kr,L=new qn}else L=o?[]:A;e:for(;++d<b;){var I=i[d],G=o?o(I):I;if(I=c||I!==0?I:0,E&&G===G){for(var Y=L.length;Y--;)if(L[Y]===G)continue e;o&&L.push(G),A.push(I)}else m(L,G,c)||(L!==A&&L.push(G),A.push(I))}return A}function _a(i,o){return o=Cn(o,i),i=Yl(i,o),i==null||delete i[en(Dt(o))]}function bl(i,o,c,d){return qr(i,o,c(Vn(i,o)),d)}function qi(i,o,c,d){for(var m=i.length,b=d?m:-1;(d?b--:++b<m)&&o(i[b],b,i););return c?Pt(i,d?0:b,d?b+1:m):Pt(i,d?b+1:0,d?m:b)}function wl(i,o){var c=i;return c instanceof Oe&&(c=c.value()),aa(o,function(d,m){return m.func.apply(m.thisArg,wn([d],m.args))},c)}function Ua(i,o,c){var d=i.length;if(d<2)return d?On(i[0]):[];for(var m=-1,b=k(d);++m<d;)for(var E=i[m],A=-1;++A<d;)A!=m&&(b[m]=Gr(b[m]||E,i[A],o,c));return On(at(b,1),o,c)}function Sl(i,o,c){for(var d=-1,m=i.length,b=o.length,E={};++d<m;){var A=d<b?o[d]:n;c(E,i[d],A)}return E}function ka(i){return Xe(i)?i:[]}function Ma(i){return typeof i=="function"?i:xt}function Cn(i,o){return de(i)?i:qa(i,o)?[i]:Jl(Re(i))}var $d=Se;function Fn(i,o,c){var d=i.length;return c=c===n?d:c,!o&&c>=d?i:Pt(i,o,c)}var Tl=D0||function(i){return st.clearTimeout(i)};function El(i,o){if(o)return i.slice();var c=i.length,d=Vu?Vu(c):new i.constructor(c);return i.copy(d),d}function Ba(i){var o=new i.constructor(i.byteLength);return new Ri(o).set(new Ri(i)),o}function Jd(i,o){var c=o?Ba(i.buffer):i.buffer;return new i.constructor(c,i.byteOffset,i.byteLength)}function Qd(i){var o=new i.constructor(i.source,ou.exec(i));return o.lastIndex=i.lastIndex,o}function jd(i){return Ir?Ue(Ir.call(i)):{}}function Ol(i,o){var c=o?Ba(i.buffer):i.buffer;return new i.constructor(c,i.byteOffset,i.length)}function Cl(i,o){if(i!==o){var c=i!==n,d=i===null,m=i===i,b=Et(i),E=o!==n,A=o===null,L=o===o,D=Et(o);if(!A&&!D&&!b&&i>o||b&&E&&L&&!A&&!D||d&&E&&L||!c&&L||!m)return 1;if(!d&&!b&&!D&&i<o||D&&c&&m&&!d&&!b||A&&c&&m||!E&&m||!L)return-1}return 0}function ev(i,o,c){for(var d=-1,m=i.criteria,b=o.criteria,E=m.length,A=c.length;++d<E;){var L=Cl(m[d],b[d]);if(L){if(d>=A)return L;var D=c[d];return L*(D=="desc"?-1:1)}}return i.index-o.index}function Fl(i,o,c,d){for(var m=-1,b=i.length,E=c.length,A=-1,L=o.length,D=et(b-E,0),I=k(L+D),G=!d;++A<L;)I[A]=o[A];for(;++m<E;)(G||m<b)&&(I[c[m]]=i[m]);for(;D--;)I[A++]=i[m++];return I}function Al(i,o,c,d){for(var m=-1,b=i.length,E=-1,A=c.length,L=-1,D=o.length,I=et(b-A,0),G=k(I+D),Y=!d;++m<I;)G[m]=i[m];for(var j=m;++L<D;)G[j+L]=o[L];for(;++E<A;)(Y||m<b)&&(G[j+c[E]]=i[m++]);return G}function gt(i,o){var c=-1,d=i.length;for(o||(o=k(d));++c<d;)o[c]=i[c];return o}function jt(i,o,c,d){var m=!c;c||(c={});for(var b=-1,E=o.length;++b<E;){var A=o[b],L=d?d(c[A],i[A],A,c,i):n;L===n&&(L=i[A]),m?ln(c,A,L):Nr(c,A,L)}return c}function tv(i,o){return jt(i,Ha(i),o)}function nv(i,o){return jt(i,zl(i),o)}function Wi(i,o){return function(c,d){var m=de(c)?o0:Ed,b=o?o():{};return m(c,i,re(d,2),b)}}function pr(i){return Se(function(o,c){var d=-1,m=c.length,b=m>1?c[m-1]:n,E=m>2?c[2]:n;for(b=i.length>3&&typeof b=="function"?(m--,b):n,E&&pt(c[0],c[1],E)&&(b=m<3?n:b,m=1),o=Ue(o);++d<m;){var A=c[d];A&&i(o,A,d,b)}return o})}function Rl(i,o){return function(c,d){if(c==null)return c;if(!mt(c))return i(c,d);for(var m=c.length,b=o?m:-1,E=Ue(c);(o?b--:++b<m)&&d(E[b],b,E)!==!1;);return c}}function Ll(i){return function(o,c,d){for(var m=-1,b=Ue(o),E=d(o),A=E.length;A--;){var L=E[i?A:++m];if(c(b[L],L,b)===!1)break}return o}}function rv(i,o,c){var d=o&S,m=Wr(i);function b(){var E=this&&this!==st&&this instanceof b?m:i;return E.apply(d?c:this,arguments)}return b}function _l(i){return function(o){o=Re(o);var c=ar(o)?zt(o):n,d=c?c[0]:o.charAt(0),m=c?Fn(c,1).join(""):o.slice(1);return d[i]()+m}}function dr(i){return function(o){return aa(Rc(Ac(o).replace(Yp,"")),i,"")}}function Wr(i){return function(){var o=arguments;switch(o.length){case 0:return new i;case 1:return new i(o[0]);case 2:return new i(o[0],o[1]);case 3:return new i(o[0],o[1],o[2]);case 4:return new i(o[0],o[1],o[2],o[3]);case 5:return new i(o[0],o[1],o[2],o[3],o[4]);case 6:return new i(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new i(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var c=hr(i.prototype),d=i.apply(c,o);return He(d)?d:c}}function iv(i,o,c){var d=Wr(i);function m(){for(var b=arguments.length,E=k(b),A=b,L=vr(m);A--;)E[A]=arguments[A];var D=b<3&&E[0]!==L&&E[b-1]!==L?[]:Sn(E,L);if(b-=D.length,b<c)return Pl(i,o,Vi,m.placeholder,n,E,D,n,n,c-b);var I=this&&this!==st&&this instanceof m?d:i;return wt(I,this,E)}return m}function Ul(i){return function(o,c,d){var m=Ue(o);if(!mt(o)){var b=re(c,3);o=nt(o),c=function(A){return b(m[A],A,m)}}var E=i(o,c,d);return E>-1?m[b?o[E]:E]:n}}function kl(i){return fn(function(o){var c=o.length,d=c,m=Mt.prototype.thru;for(i&&o.reverse();d--;){var b=o[d];if(typeof b!="function")throw new kt(u);if(m&&!E&&Zi(b)=="wrapper")var E=new Mt([],!0)}for(d=E?d:c;++d<c;){b=o[d];var A=Zi(b),L=A=="wrapper"?Ga(b):n;L&&Wa(L[0])&&L[1]==(V|F|_|q)&&!L[4].length&&L[9]==1?E=E[Zi(L[0])].apply(E,L[3]):E=b.length==1&&Wa(b)?E[A]():E.thru(b)}return function(){var D=arguments,I=D[0];if(E&&D.length==1&&de(I))return E.plant(I).value();for(var G=0,Y=c?o[G].apply(this,D):I;++G<c;)Y=o[G].call(this,Y);return Y}})}function Vi(i,o,c,d,m,b,E,A,L,D){var I=o&V,G=o&S,Y=o&O,j=o&(F|U),se=o&K,we=Y?n:Wr(i);function ae(){for(var Te=arguments.length,Fe=k(Te),Ot=Te;Ot--;)Fe[Ot]=arguments[Ot];if(j)var dt=vr(ae),Ct=g0(Fe,dt);if(d&&(Fe=Fl(Fe,d,m,j)),b&&(Fe=Al(Fe,b,E,j)),Te-=Ct,j&&Te<D){var Ye=Sn(Fe,dt);return Pl(i,o,Vi,ae.placeholder,c,Fe,Ye,A,L,D-Te)}var Wt=G?c:this,vn=Y?Wt[i]:i;return Te=Fe.length,A?Fe=Ev(Fe,A):se&&Te>1&&Fe.reverse(),I&&L<Te&&(Fe.length=L),this&&this!==st&&this instanceof ae&&(vn=we||Wr(vn)),vn.apply(Wt,Fe)}return ae}function Ml(i,o){return function(c,d){return Ud(c,i,o(d),{})}}function Xi(i,o){return function(c,d){var m;if(c===n&&d===n)return o;if(c!==n&&(m=c),d!==n){if(m===n)return d;typeof c=="string"||typeof d=="string"?(c=Tt(c),d=Tt(d)):(c=xl(c),d=xl(d)),m=i(c,d)}return m}}function Pa(i){return fn(function(o){return o=Ne(o,St(re())),Se(function(c){var d=this;return i(o,function(m){return wt(m,d,c)})})})}function Yi(i,o){o=o===n?" ":Tt(o);var c=o.length;if(c<2)return c?Ra(o,i):o;var d=Ra(o,ki(i/or(o)));return ar(o)?Fn(zt(d),0,i).join(""):d.slice(0,i)}function sv(i,o,c,d){var m=o&S,b=Wr(i);function E(){for(var A=-1,L=arguments.length,D=-1,I=d.length,G=k(I+L),Y=this&&this!==st&&this instanceof E?b:i;++D<I;)G[D]=d[D];for(;L--;)G[D++]=arguments[++A];return wt(Y,m?c:this,G)}return E}function Bl(i){return function(o,c,d){return d&&typeof d!="number"&&pt(o,c,d)&&(c=d=n),o=dn(o),c===n?(c=o,o=0):c=dn(c),d=d===n?o<c?1:-1:dn(d),Wd(o,c,d,i)}}function Ki(i){return function(o,c){return typeof o=="string"&&typeof c=="string"||(o=It(o),c=It(c)),i(o,c)}}function Pl(i,o,c,d,m,b,E,A,L,D){var I=o&F,G=I?E:n,Y=I?n:E,j=I?b:n,se=I?n:b;o|=I?_:z,o&=~(I?z:_),o&C||(o&=~(S|O));var we=[i,o,m,j,G,se,Y,A,L,D],ae=c.apply(n,we);return Wa(i)&&Kl(ae,we),ae.placeholder=d,Zl(ae,i,o)}function Da(i){var o=je[i];return function(c,d){if(c=It(c),d=d==null?0:ut(xe(d),292),d&&Zu(c)){var m=(Re(c)+"e").split("e"),b=o(m[0]+"e"+(+m[1]+d));return m=(Re(b)+"e").split("e"),+(m[0]+"e"+(+m[1]-d))}return o(c)}}var av=cr&&1/Ti(new cr([,-0]))[1]==le?function(i){return new cr(i)}:so;function Dl(i){return function(o){var c=lt(o);return c==vt?pa(o):c==Gt?T0(o):v0(o,i(o))}}function cn(i,o,c,d,m,b,E,A){var L=o&O;if(!L&&typeof i!="function")throw new kt(u);var D=d?d.length:0;if(D||(o&=~(_|z),d=m=n),E=E===n?E:et(xe(E),0),A=A===n?A:xe(A),D-=m?m.length:0,o&z){var I=d,G=m;d=m=n}var Y=L?n:Ga(i),j=[i,o,c,d,m,I,G,b,E,A];if(Y&&wv(j,Y),i=j[0],o=j[1],c=j[2],d=j[3],m=j[4],A=j[9]=j[9]===n?L?0:i.length:et(j[9]-D,0),!A&&o&(F|U)&&(o&=~(F|U)),!o||o==S)var se=rv(i,o,c);else o==F||o==U?se=iv(i,o,A):(o==_||o==(S|_))&&!m.length?se=sv(i,o,c,d):se=Vi.apply(n,j);var we=Y?ml:Kl;return Zl(we(se,j),i,o)}function Il(i,o,c,d){return i===n||qt(i,lr[c])&&!_e.call(d,c)?o:i}function Nl(i,o,c,d,m,b){return He(i)&&He(o)&&(b.set(o,i),zi(i,o,n,Nl,b),b.delete(o)),i}function ov(i){return Yr(i)?n:i}function Gl(i,o,c,d,m,b){var E=c&w,A=i.length,L=o.length;if(A!=L&&!(E&&L>A))return!1;var D=b.get(i),I=b.get(o);if(D&&I)return D==o&&I==i;var G=-1,Y=!0,j=c&T?new qn:n;for(b.set(i,o),b.set(o,i);++G<A;){var se=i[G],we=o[G];if(d)var ae=E?d(we,se,G,o,i,b):d(se,we,G,i,o,b);if(ae!==n){if(ae)continue;Y=!1;break}if(j){if(!oa(o,function(Te,Fe){if(!kr(j,Fe)&&(se===Te||m(se,Te,c,d,b)))return j.push(Fe)})){Y=!1;break}}else if(!(se===we||m(se,we,c,d,b))){Y=!1;break}}return b.delete(i),b.delete(o),Y}function uv(i,o,c,d,m,b,E){switch(c){case rr:if(i.byteLength!=o.byteLength||i.byteOffset!=o.byteOffset)return!1;i=i.buffer,o=o.buffer;case Ur:return!(i.byteLength!=o.byteLength||!b(new Ri(i),new Ri(o)));case $e:case Qe:case Nn:return qt(+i,+o);case xn:return i.name==o.name&&i.message==o.message;case Rr:case Lr:return i==o+"";case vt:var A=pa;case Gt:var L=d&w;if(A||(A=Ti),i.size!=o.size&&!L)return!1;var D=E.get(i);if(D)return D==o;d|=T,E.set(i,o);var I=Gl(A(i),A(o),d,m,b,E);return E.delete(i),I;case mi:if(Ir)return Ir.call(i)==Ir.call(o)}return!1}function lv(i,o,c,d,m,b){var E=c&w,A=Ia(i),L=A.length,D=Ia(o),I=D.length;if(L!=I&&!E)return!1;for(var G=L;G--;){var Y=A[G];if(!(E?Y in o:_e.call(o,Y)))return!1}var j=b.get(i),se=b.get(o);if(j&&se)return j==o&&se==i;var we=!0;b.set(i,o),b.set(o,i);for(var ae=E;++G<L;){Y=A[G];var Te=i[Y],Fe=o[Y];if(d)var Ot=E?d(Fe,Te,Y,o,i,b):d(Te,Fe,Y,i,o,b);if(!(Ot===n?Te===Fe||m(Te,Fe,c,d,b):Ot)){we=!1;break}ae||(ae=Y=="constructor")}if(we&&!ae){var dt=i.constructor,Ct=o.constructor;dt!=Ct&&"constructor"in i&&"constructor"in o&&!(typeof dt=="function"&&dt instanceof dt&&typeof Ct=="function"&&Ct instanceof Ct)&&(we=!1)}return b.delete(i),b.delete(o),we}function fn(i){return Xa(Xl(i,n,tc),i+"")}function Ia(i){return al(i,nt,Ha)}function Na(i){return al(i,yt,zl)}var Ga=Bi?function(i){return Bi.get(i)}:so;function Zi(i){for(var o=i.name+"",c=fr[o],d=_e.call(fr,o)?c.length:0;d--;){var m=c[d],b=m.func;if(b==null||b==i)return m.name}return o}function vr(i){var o=_e.call(x,"placeholder")?x:i;return o.placeholder}function re(){var i=x.iteratee||ro;return i=i===ro?ll:i,arguments.length?i(arguments[0],arguments[1]):i}function $i(i,o){var c=i.__data__;return mv(o)?c[typeof o=="string"?"string":"hash"]:c.map}function za(i){for(var o=nt(i),c=o.length;c--;){var d=o[c],m=i[d];o[c]=[d,m,Wl(m)]}return o}function Xn(i,o){var c=b0(i,o);return ul(c)?c:n}function cv(i){var o=_e.call(i,zn),c=i[zn];try{i[zn]=n;var d=!0}catch{}var m=Fi.call(i);return d&&(o?i[zn]=c:delete i[zn]),m}var Ha=va?function(i){return i==null?[]:(i=Ue(i),bn(va(i),function(o){return Yu.call(i,o)}))}:ao,zl=va?function(i){for(var o=[];i;)wn(o,Ha(i)),i=Li(i);return o}:ao,lt=ht;(ga&&lt(new ga(new ArrayBuffer(1)))!=rr||Br&&lt(new Br)!=vt||ma&&lt(ma.resolve())!=ru||cr&&lt(new cr)!=Gt||Pr&&lt(new Pr)!=_r)&&(lt=function(i){var o=ht(i),c=o==an?i.constructor:n,d=c?Yn(c):"";if(d)switch(d){case X0:return rr;case Y0:return vt;case K0:return ru;case Z0:return Gt;case $0:return _r}return o});function fv(i,o,c){for(var d=-1,m=c.length;++d<m;){var b=c[d],E=b.size;switch(b.type){case"drop":i+=E;break;case"dropRight":o-=E;break;case"take":o=ut(o,i+E);break;case"takeRight":i=et(i,o-E);break}}return{start:i,end:o}}function hv(i){var o=i.match(yp);return o?o[1].split(xp):[]}function Hl(i,o,c){o=Cn(o,i);for(var d=-1,m=o.length,b=!1;++d<m;){var E=en(o[d]);if(!(b=i!=null&&c(i,E)))break;i=i[E]}return b||++d!=m?b:(m=i==null?0:i.length,!!m&&rs(m)&&hn(E,m)&&(de(i)||Kn(i)))}function pv(i){var o=i.length,c=new i.constructor(o);return o&&typeof i[0]=="string"&&_e.call(i,"index")&&(c.index=i.index,c.input=i.input),c}function ql(i){return typeof i.constructor=="function"&&!Vr(i)?hr(Li(i)):{}}function dv(i,o,c){var d=i.constructor;switch(o){case Ur:return Ba(i);case $e:case Qe:return new d(+i);case rr:return Jd(i,c);case zs:case Hs:case qs:case Ws:case Vs:case Xs:case Ys:case Ks:case Zs:return Ol(i,c);case vt:return new d;case Nn:case Lr:return new d(i);case Rr:return Qd(i);case Gt:return new d;case mi:return jd(i)}}function vv(i,o){var c=o.length;if(!c)return i;var d=c-1;return o[d]=(c>1?"& ":"")+o[d],o=o.join(c>2?", ":" "),i.replace(mp,`{
/* [wrapped with `+o+`] */
`)}function gv(i){return de(i)||Kn(i)||!!(Ku&&i&&i[Ku])}function hn(i,o){var c=typeof i;return o=o??Ce,!!o&&(c=="number"||c!="symbol"&&Ap.test(i))&&i>-1&&i%1==0&&i<o}function pt(i,o,c){if(!He(c))return!1;var d=typeof o;return(d=="number"?mt(c)&&hn(o,c.length):d=="string"&&o in c)?qt(c[o],i):!1}function qa(i,o){if(de(i))return!1;var c=typeof i;return c=="number"||c=="symbol"||c=="boolean"||i==null||Et(i)?!0:pp.test(i)||!hp.test(i)||o!=null&&i in Ue(o)}function mv(i){var o=typeof i;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?i!=="__proto__":i===null}function Wa(i){var o=Zi(i),c=x[o];if(typeof c!="function"||!(o in Oe.prototype))return!1;if(i===c)return!0;var d=Ga(c);return!!d&&i===d[0]}function yv(i){return!!Wu&&Wu in i}var xv=Oi?pn:oo;function Vr(i){var o=i&&i.constructor,c=typeof o=="function"&&o.prototype||lr;return i===c}function Wl(i){return i===i&&!He(i)}function Vl(i,o){return function(c){return c==null?!1:c[i]===o&&(o!==n||i in Ue(c))}}function bv(i){var o=ts(i,function(d){return c.size===h&&c.clear(),d}),c=o.cache;return o}function wv(i,o){var c=i[1],d=o[1],m=c|d,b=m<(S|O|V),E=d==V&&c==F||d==V&&c==q&&i[7].length<=o[8]||d==(V|q)&&o[7].length<=o[8]&&c==F;if(!(b||E))return i;d&S&&(i[2]=o[2],m|=c&S?0:C);var A=o[3];if(A){var L=i[3];i[3]=L?Fl(L,A,o[4]):A,i[4]=L?Sn(i[3],p):o[4]}return A=o[5],A&&(L=i[5],i[5]=L?Al(L,A,o[6]):A,i[6]=L?Sn(i[5],p):o[6]),A=o[7],A&&(i[7]=A),d&V&&(i[8]=i[8]==null?o[8]:ut(i[8],o[8])),i[9]==null&&(i[9]=o[9]),i[0]=o[0],i[1]=m,i}function Sv(i){var o=[];if(i!=null)for(var c in Ue(i))o.push(c);return o}function Tv(i){return Fi.call(i)}function Xl(i,o,c){return o=et(o===n?i.length-1:o,0),function(){for(var d=arguments,m=-1,b=et(d.length-o,0),E=k(b);++m<b;)E[m]=d[o+m];m=-1;for(var A=k(o+1);++m<o;)A[m]=d[m];return A[o]=c(E),wt(i,this,A)}}function Yl(i,o){return o.length<2?i:Vn(i,Pt(o,0,-1))}function Ev(i,o){for(var c=i.length,d=ut(o.length,c),m=gt(i);d--;){var b=o[d];i[d]=hn(b,c)?m[b]:n}return i}function Va(i,o){if(!(o==="constructor"&&typeof i[o]=="function")&&o!="__proto__")return i[o]}var Kl=$l(ml),Xr=N0||function(i,o){return st.setTimeout(i,o)},Xa=$l(Yd);function Zl(i,o,c){var d=o+"";return Xa(i,vv(d,Ov(hv(d),c)))}function $l(i){var o=0,c=0;return function(){var d=q0(),m=ie-(d-c);if(c=d,m>0){if(++o>=oe)return arguments[0]}else o=0;return i.apply(n,arguments)}}function Ji(i,o){var c=-1,d=i.length,m=d-1;for(o=o===n?d:o;++c<o;){var b=Aa(c,m),E=i[b];i[b]=i[c],i[c]=E}return i.length=o,i}var Jl=bv(function(i){var o=[];return i.charCodeAt(0)===46&&o.push(""),i.replace(dp,function(c,d,m,b){o.push(m?b.replace(Sp,"$1"):d||c)}),o});function en(i){if(typeof i=="string"||Et(i))return i;var o=i+"";return o=="0"&&1/i==-le?"-0":o}function Yn(i){if(i!=null){try{return Ci.call(i)}catch{}try{return i+""}catch{}}return""}function Ov(i,o){return Ut(Lt,function(c){var d="_."+c[0];o&c[1]&&!wi(i,d)&&i.push(d)}),i.sort()}function Ql(i){if(i instanceof Oe)return i.clone();var o=new Mt(i.__wrapped__,i.__chain__);return o.__actions__=gt(i.__actions__),o.__index__=i.__index__,o.__values__=i.__values__,o}function Cv(i,o,c){(c?pt(i,o,c):o===n)?o=1:o=et(xe(o),0);var d=i==null?0:i.length;if(!d||o<1)return[];for(var m=0,b=0,E=k(ki(d/o));m<d;)E[b++]=Pt(i,m,m+=o);return E}function Fv(i){for(var o=-1,c=i==null?0:i.length,d=0,m=[];++o<c;){var b=i[o];b&&(m[d++]=b)}return m}function Av(){var i=arguments.length;if(!i)return[];for(var o=k(i-1),c=arguments[0],d=i;d--;)o[d-1]=arguments[d];return wn(de(c)?gt(c):[c],at(o,1))}var Rv=Se(function(i,o){return Xe(i)?Gr(i,at(o,1,Xe,!0)):[]}),Lv=Se(function(i,o){var c=Dt(o);return Xe(c)&&(c=n),Xe(i)?Gr(i,at(o,1,Xe,!0),re(c,2)):[]}),_v=Se(function(i,o){var c=Dt(o);return Xe(c)&&(c=n),Xe(i)?Gr(i,at(o,1,Xe,!0),n,c):[]});function Uv(i,o,c){var d=i==null?0:i.length;return d?(o=c||o===n?1:xe(o),Pt(i,o<0?0:o,d)):[]}function kv(i,o,c){var d=i==null?0:i.length;return d?(o=c||o===n?1:xe(o),o=d-o,Pt(i,0,o<0?0:o)):[]}function Mv(i,o){return i&&i.length?qi(i,re(o,3),!0,!0):[]}function Bv(i,o){return i&&i.length?qi(i,re(o,3),!0):[]}function Pv(i,o,c,d){var m=i==null?0:i.length;return m?(c&&typeof c!="number"&&pt(i,o,c)&&(c=0,d=m),Ad(i,o,c,d)):[]}function jl(i,o,c){var d=i==null?0:i.length;if(!d)return-1;var m=c==null?0:xe(c);return m<0&&(m=et(d+m,0)),Si(i,re(o,3),m)}function ec(i,o,c){var d=i==null?0:i.length;if(!d)return-1;var m=d-1;return c!==n&&(m=xe(c),m=c<0?et(d+m,0):ut(m,d-1)),Si(i,re(o,3),m,!0)}function tc(i){var o=i==null?0:i.length;return o?at(i,1):[]}function Dv(i){var o=i==null?0:i.length;return o?at(i,le):[]}function Iv(i,o){var c=i==null?0:i.length;return c?(o=o===n?1:xe(o),at(i,o)):[]}function Nv(i){for(var o=-1,c=i==null?0:i.length,d={};++o<c;){var m=i[o];d[m[0]]=m[1]}return d}function nc(i){return i&&i.length?i[0]:n}function Gv(i,o,c){var d=i==null?0:i.length;if(!d)return-1;var m=c==null?0:xe(c);return m<0&&(m=et(d+m,0)),sr(i,o,m)}function zv(i){var o=i==null?0:i.length;return o?Pt(i,0,-1):[]}var Hv=Se(function(i){var o=Ne(i,ka);return o.length&&o[0]===i[0]?Ta(o):[]}),qv=Se(function(i){var o=Dt(i),c=Ne(i,ka);return o===Dt(c)?o=n:c.pop(),c.length&&c[0]===i[0]?Ta(c,re(o,2)):[]}),Wv=Se(function(i){var o=Dt(i),c=Ne(i,ka);return o=typeof o=="function"?o:n,o&&c.pop(),c.length&&c[0]===i[0]?Ta(c,n,o):[]});function Vv(i,o){return i==null?"":z0.call(i,o)}function Dt(i){var o=i==null?0:i.length;return o?i[o-1]:n}function Xv(i,o,c){var d=i==null?0:i.length;if(!d)return-1;var m=d;return c!==n&&(m=xe(c),m=m<0?et(d+m,0):ut(m,d-1)),o===o?O0(i,o,m):Si(i,Pu,m,!0)}function Yv(i,o){return i&&i.length?pl(i,xe(o)):n}var Kv=Se(rc);function rc(i,o){return i&&i.length&&o&&o.length?Fa(i,o):i}function Zv(i,o,c){return i&&i.length&&o&&o.length?Fa(i,o,re(c,2)):i}function $v(i,o,c){return i&&i.length&&o&&o.length?Fa(i,o,n,c):i}var Jv=fn(function(i,o){var c=i==null?0:i.length,d=xa(i,o);return gl(i,Ne(o,function(m){return hn(m,c)?+m:m}).sort(Cl)),d});function Qv(i,o){var c=[];if(!(i&&i.length))return c;var d=-1,m=[],b=i.length;for(o=re(o,3);++d<b;){var E=i[d];o(E,d,i)&&(c.push(E),m.push(d))}return gl(i,m),c}function Ya(i){return i==null?i:V0.call(i)}function jv(i,o,c){var d=i==null?0:i.length;return d?(c&&typeof c!="number"&&pt(i,o,c)?(o=0,c=d):(o=o==null?0:xe(o),c=c===n?d:xe(c)),Pt(i,o,c)):[]}function eg(i,o){return Hi(i,o)}function tg(i,o,c){return La(i,o,re(c,2))}function ng(i,o){var c=i==null?0:i.length;if(c){var d=Hi(i,o);if(d<c&&qt(i[d],o))return d}return-1}function rg(i,o){return Hi(i,o,!0)}function ig(i,o,c){return La(i,o,re(c,2),!0)}function sg(i,o){var c=i==null?0:i.length;if(c){var d=Hi(i,o,!0)-1;if(qt(i[d],o))return d}return-1}function ag(i){return i&&i.length?yl(i):[]}function og(i,o){return i&&i.length?yl(i,re(o,2)):[]}function ug(i){var o=i==null?0:i.length;return o?Pt(i,1,o):[]}function lg(i,o,c){return i&&i.length?(o=c||o===n?1:xe(o),Pt(i,0,o<0?0:o)):[]}function cg(i,o,c){var d=i==null?0:i.length;return d?(o=c||o===n?1:xe(o),o=d-o,Pt(i,o<0?0:o,d)):[]}function fg(i,o){return i&&i.length?qi(i,re(o,3),!1,!0):[]}function hg(i,o){return i&&i.length?qi(i,re(o,3)):[]}var pg=Se(function(i){return On(at(i,1,Xe,!0))}),dg=Se(function(i){var o=Dt(i);return Xe(o)&&(o=n),On(at(i,1,Xe,!0),re(o,2))}),vg=Se(function(i){var o=Dt(i);return o=typeof o=="function"?o:n,On(at(i,1,Xe,!0),n,o)});function gg(i){return i&&i.length?On(i):[]}function mg(i,o){return i&&i.length?On(i,re(o,2)):[]}function yg(i,o){return o=typeof o=="function"?o:n,i&&i.length?On(i,n,o):[]}function Ka(i){if(!(i&&i.length))return[];var o=0;return i=bn(i,function(c){if(Xe(c))return o=et(c.length,o),!0}),fa(o,function(c){return Ne(i,ua(c))})}function ic(i,o){if(!(i&&i.length))return[];var c=Ka(i);return o==null?c:Ne(c,function(d){return wt(o,n,d)})}var xg=Se(function(i,o){return Xe(i)?Gr(i,o):[]}),bg=Se(function(i){return Ua(bn(i,Xe))}),wg=Se(function(i){var o=Dt(i);return Xe(o)&&(o=n),Ua(bn(i,Xe),re(o,2))}),Sg=Se(function(i){var o=Dt(i);return o=typeof o=="function"?o:n,Ua(bn(i,Xe),n,o)}),Tg=Se(Ka);function Eg(i,o){return Sl(i||[],o||[],Nr)}function Og(i,o){return Sl(i||[],o||[],qr)}var Cg=Se(function(i){var o=i.length,c=o>1?i[o-1]:n;return c=typeof c=="function"?(i.pop(),c):n,ic(i,c)});function sc(i){var o=x(i);return o.__chain__=!0,o}function Fg(i,o){return o(i),i}function Qi(i,o){return o(i)}var Ag=fn(function(i){var o=i.length,c=o?i[0]:0,d=this.__wrapped__,m=function(b){return xa(b,i)};return o>1||this.__actions__.length||!(d instanceof Oe)||!hn(c)?this.thru(m):(d=d.slice(c,+c+(o?1:0)),d.__actions__.push({func:Qi,args:[m],thisArg:n}),new Mt(d,this.__chain__).thru(function(b){return o&&!b.length&&b.push(n),b}))});function Rg(){return sc(this)}function Lg(){return new Mt(this.value(),this.__chain__)}function _g(){this.__values__===n&&(this.__values__=xc(this.value()));var i=this.__index__>=this.__values__.length,o=i?n:this.__values__[this.__index__++];return{done:i,value:o}}function Ug(){return this}function kg(i){for(var o,c=this;c instanceof Di;){var d=Ql(c);d.__index__=0,d.__values__=n,o?m.__wrapped__=d:o=d;var m=d;c=c.__wrapped__}return m.__wrapped__=i,o}function Mg(){var i=this.__wrapped__;if(i instanceof Oe){var o=i;return this.__actions__.length&&(o=new Oe(this)),o=o.reverse(),o.__actions__.push({func:Qi,args:[Ya],thisArg:n}),new Mt(o,this.__chain__)}return this.thru(Ya)}function Bg(){return wl(this.__wrapped__,this.__actions__)}var Pg=Wi(function(i,o,c){_e.call(i,c)?++i[c]:ln(i,c,1)});function Dg(i,o,c){var d=de(i)?Mu:Fd;return c&&pt(i,o,c)&&(o=n),d(i,re(o,3))}function Ig(i,o){var c=de(i)?bn:il;return c(i,re(o,3))}var Ng=Ul(jl),Gg=Ul(ec);function zg(i,o){return at(ji(i,o),1)}function Hg(i,o){return at(ji(i,o),le)}function qg(i,o,c){return c=c===n?1:xe(c),at(ji(i,o),c)}function ac(i,o){var c=de(i)?Ut:En;return c(i,re(o,3))}function oc(i,o){var c=de(i)?u0:rl;return c(i,re(o,3))}var Wg=Wi(function(i,o,c){_e.call(i,c)?i[c].push(o):ln(i,c,[o])});function Vg(i,o,c,d){i=mt(i)?i:mr(i),c=c&&!d?xe(c):0;var m=i.length;return c<0&&(c=et(m+c,0)),is(i)?c<=m&&i.indexOf(o,c)>-1:!!m&&sr(i,o,c)>-1}var Xg=Se(function(i,o,c){var d=-1,m=typeof o=="function",b=mt(i)?k(i.length):[];return En(i,function(E){b[++d]=m?wt(o,E,c):zr(E,o,c)}),b}),Yg=Wi(function(i,o,c){ln(i,c,o)});function ji(i,o){var c=de(i)?Ne:cl;return c(i,re(o,3))}function Kg(i,o,c,d){return i==null?[]:(de(o)||(o=o==null?[]:[o]),c=d?n:c,de(c)||(c=c==null?[]:[c]),dl(i,o,c))}var Zg=Wi(function(i,o,c){i[c?0:1].push(o)},function(){return[[],[]]});function $g(i,o,c){var d=de(i)?aa:Iu,m=arguments.length<3;return d(i,re(o,4),c,m,En)}function Jg(i,o,c){var d=de(i)?l0:Iu,m=arguments.length<3;return d(i,re(o,4),c,m,rl)}function Qg(i,o){var c=de(i)?bn:il;return c(i,ns(re(o,3)))}function jg(i){var o=de(i)?ju:Vd;return o(i)}function e1(i,o,c){(c?pt(i,o,c):o===n)?o=1:o=xe(o);var d=de(i)?Sd:Xd;return d(i,o)}function t1(i){var o=de(i)?Td:Kd;return o(i)}function n1(i){if(i==null)return 0;if(mt(i))return is(i)?or(i):i.length;var o=lt(i);return o==vt||o==Gt?i.size:Oa(i).length}function r1(i,o,c){var d=de(i)?oa:Zd;return c&&pt(i,o,c)&&(o=n),d(i,re(o,3))}var i1=Se(function(i,o){if(i==null)return[];var c=o.length;return c>1&&pt(i,o[0],o[1])?o=[]:c>2&&pt(o[0],o[1],o[2])&&(o=[o[0]]),dl(i,at(o,1),[])}),es=I0||function(){return st.Date.now()};function s1(i,o){if(typeof o!="function")throw new kt(u);return i=xe(i),function(){if(--i<1)return o.apply(this,arguments)}}function uc(i,o,c){return o=c?n:o,o=i&&o==null?i.length:o,cn(i,V,n,n,n,n,o)}function lc(i,o){var c;if(typeof o!="function")throw new kt(u);return i=xe(i),function(){return--i>0&&(c=o.apply(this,arguments)),i<=1&&(o=n),c}}var Za=Se(function(i,o,c){var d=S;if(c.length){var m=Sn(c,vr(Za));d|=_}return cn(i,d,o,c,m)}),cc=Se(function(i,o,c){var d=S|O;if(c.length){var m=Sn(c,vr(cc));d|=_}return cn(o,d,i,c,m)});function fc(i,o,c){o=c?n:o;var d=cn(i,F,n,n,n,n,n,o);return d.placeholder=fc.placeholder,d}function hc(i,o,c){o=c?n:o;var d=cn(i,U,n,n,n,n,n,o);return d.placeholder=hc.placeholder,d}function pc(i,o,c){var d,m,b,E,A,L,D=0,I=!1,G=!1,Y=!0;if(typeof i!="function")throw new kt(u);o=It(o)||0,He(c)&&(I=!!c.leading,G="maxWait"in c,b=G?et(It(c.maxWait)||0,o):b,Y="trailing"in c?!!c.trailing:Y);function j(Ye){var Wt=d,vn=m;return d=m=n,D=Ye,E=i.apply(vn,Wt),E}function se(Ye){return D=Ye,A=Xr(Te,o),I?j(Ye):E}function we(Ye){var Wt=Ye-L,vn=Ye-D,Uc=o-Wt;return G?ut(Uc,b-vn):Uc}function ae(Ye){var Wt=Ye-L,vn=Ye-D;return L===n||Wt>=o||Wt<0||G&&vn>=b}function Te(){var Ye=es();if(ae(Ye))return Fe(Ye);A=Xr(Te,we(Ye))}function Fe(Ye){return A=n,Y&&d?j(Ye):(d=m=n,E)}function Ot(){A!==n&&Tl(A),D=0,d=L=m=A=n}function dt(){return A===n?E:Fe(es())}function Ct(){var Ye=es(),Wt=ae(Ye);if(d=arguments,m=this,L=Ye,Wt){if(A===n)return se(L);if(G)return Tl(A),A=Xr(Te,o),j(L)}return A===n&&(A=Xr(Te,o)),E}return Ct.cancel=Ot,Ct.flush=dt,Ct}var a1=Se(function(i,o){return nl(i,1,o)}),o1=Se(function(i,o,c){return nl(i,It(o)||0,c)});function u1(i){return cn(i,K)}function ts(i,o){if(typeof i!="function"||o!=null&&typeof o!="function")throw new kt(u);var c=function(){var d=arguments,m=o?o.apply(this,d):d[0],b=c.cache;if(b.has(m))return b.get(m);var E=i.apply(this,d);return c.cache=b.set(m,E)||b,E};return c.cache=new(ts.Cache||un),c}ts.Cache=un;function ns(i){if(typeof i!="function")throw new kt(u);return function(){var o=arguments;switch(o.length){case 0:return!i.call(this);case 1:return!i.call(this,o[0]);case 2:return!i.call(this,o[0],o[1]);case 3:return!i.call(this,o[0],o[1],o[2])}return!i.apply(this,o)}}function l1(i){return lc(2,i)}var c1=$d(function(i,o){o=o.length==1&&de(o[0])?Ne(o[0],St(re())):Ne(at(o,1),St(re()));var c=o.length;return Se(function(d){for(var m=-1,b=ut(d.length,c);++m<b;)d[m]=o[m].call(this,d[m]);return wt(i,this,d)})}),$a=Se(function(i,o){var c=Sn(o,vr($a));return cn(i,_,n,o,c)}),dc=Se(function(i,o){var c=Sn(o,vr(dc));return cn(i,z,n,o,c)}),f1=fn(function(i,o){return cn(i,q,n,n,n,o)});function h1(i,o){if(typeof i!="function")throw new kt(u);return o=o===n?o:xe(o),Se(i,o)}function p1(i,o){if(typeof i!="function")throw new kt(u);return o=o==null?0:et(xe(o),0),Se(function(c){var d=c[o],m=Fn(c,0,o);return d&&wn(m,d),wt(i,this,m)})}function d1(i,o,c){var d=!0,m=!0;if(typeof i!="function")throw new kt(u);return He(c)&&(d="leading"in c?!!c.leading:d,m="trailing"in c?!!c.trailing:m),pc(i,o,{leading:d,maxWait:o,trailing:m})}function v1(i){return uc(i,1)}function g1(i,o){return $a(Ma(o),i)}function m1(){if(!arguments.length)return[];var i=arguments[0];return de(i)?i:[i]}function y1(i){return Bt(i,y)}function x1(i,o){return o=typeof o=="function"?o:n,Bt(i,y,o)}function b1(i){return Bt(i,g|y)}function w1(i,o){return o=typeof o=="function"?o:n,Bt(i,g|y,o)}function S1(i,o){return o==null||tl(i,o,nt(o))}function qt(i,o){return i===o||i!==i&&o!==o}var T1=Ki(Sa),E1=Ki(function(i,o){return i>=o}),Kn=ol(function(){return arguments}())?ol:function(i){return qe(i)&&_e.call(i,"callee")&&!Yu.call(i,"callee")},de=k.isArray,O1=Au?St(Au):kd;function mt(i){return i!=null&&rs(i.length)&&!pn(i)}function Xe(i){return qe(i)&&mt(i)}function C1(i){return i===!0||i===!1||qe(i)&&ht(i)==$e}var An=G0||oo,F1=Ru?St(Ru):Md;function A1(i){return qe(i)&&i.nodeType===1&&!Yr(i)}function R1(i){if(i==null)return!0;if(mt(i)&&(de(i)||typeof i=="string"||typeof i.splice=="function"||An(i)||gr(i)||Kn(i)))return!i.length;var o=lt(i);if(o==vt||o==Gt)return!i.size;if(Vr(i))return!Oa(i).length;for(var c in i)if(_e.call(i,c))return!1;return!0}function L1(i,o){return Hr(i,o)}function _1(i,o,c){c=typeof c=="function"?c:n;var d=c?c(i,o):n;return d===n?Hr(i,o,n,c):!!d}function Ja(i){if(!qe(i))return!1;var o=ht(i);return o==xn||o==In||typeof i.message=="string"&&typeof i.name=="string"&&!Yr(i)}function U1(i){return typeof i=="number"&&Zu(i)}function pn(i){if(!He(i))return!1;var o=ht(i);return o==nr||o==gi||o==ft||o==np}function vc(i){return typeof i=="number"&&i==xe(i)}function rs(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Ce}function He(i){var o=typeof i;return i!=null&&(o=="object"||o=="function")}function qe(i){return i!=null&&typeof i=="object"}var gc=Lu?St(Lu):Pd;function k1(i,o){return i===o||Ea(i,o,za(o))}function M1(i,o,c){return c=typeof c=="function"?c:n,Ea(i,o,za(o),c)}function B1(i){return mc(i)&&i!=+i}function P1(i){if(xv(i))throw new fe(a);return ul(i)}function D1(i){return i===null}function I1(i){return i==null}function mc(i){return typeof i=="number"||qe(i)&&ht(i)==Nn}function Yr(i){if(!qe(i)||ht(i)!=an)return!1;var o=Li(i);if(o===null)return!0;var c=_e.call(o,"constructor")&&o.constructor;return typeof c=="function"&&c instanceof c&&Ci.call(c)==M0}var Qa=_u?St(_u):Dd;function N1(i){return vc(i)&&i>=-Ce&&i<=Ce}var yc=Uu?St(Uu):Id;function is(i){return typeof i=="string"||!de(i)&&qe(i)&&ht(i)==Lr}function Et(i){return typeof i=="symbol"||qe(i)&&ht(i)==mi}var gr=ku?St(ku):Nd;function G1(i){return i===n}function z1(i){return qe(i)&&lt(i)==_r}function H1(i){return qe(i)&&ht(i)==ip}var q1=Ki(Ca),W1=Ki(function(i,o){return i<=o});function xc(i){if(!i)return[];if(mt(i))return is(i)?zt(i):gt(i);if(Mr&&i[Mr])return S0(i[Mr]());var o=lt(i),c=o==vt?pa:o==Gt?Ti:mr;return c(i)}function dn(i){if(!i)return i===0?i:0;if(i=It(i),i===le||i===-le){var o=i<0?-1:1;return o*Le}return i===i?i:0}function xe(i){var o=dn(i),c=o%1;return o===o?c?o-c:o:0}function bc(i){return i?Wn(xe(i),0,be):0}function It(i){if(typeof i=="number")return i;if(Et(i))return Ee;if(He(i)){var o=typeof i.valueOf=="function"?i.valueOf():i;i=He(o)?o+"":o}if(typeof i!="string")return i===0?i:+i;i=Nu(i);var c=Op.test(i);return c||Fp.test(i)?s0(i.slice(2),c?2:8):Ep.test(i)?Ee:+i}function wc(i){return jt(i,yt(i))}function V1(i){return i?Wn(xe(i),-Ce,Ce):i===0?i:0}function Re(i){return i==null?"":Tt(i)}var X1=pr(function(i,o){if(Vr(o)||mt(o)){jt(o,nt(o),i);return}for(var c in o)_e.call(o,c)&&Nr(i,c,o[c])}),Sc=pr(function(i,o){jt(o,yt(o),i)}),ss=pr(function(i,o,c,d){jt(o,yt(o),i,d)}),Y1=pr(function(i,o,c,d){jt(o,nt(o),i,d)}),K1=fn(xa);function Z1(i,o){var c=hr(i);return o==null?c:el(c,o)}var $1=Se(function(i,o){i=Ue(i);var c=-1,d=o.length,m=d>2?o[2]:n;for(m&&pt(o[0],o[1],m)&&(d=1);++c<d;)for(var b=o[c],E=yt(b),A=-1,L=E.length;++A<L;){var D=E[A],I=i[D];(I===n||qt(I,lr[D])&&!_e.call(i,D))&&(i[D]=b[D])}return i}),J1=Se(function(i){return i.push(n,Nl),wt(Tc,n,i)});function Q1(i,o){return Bu(i,re(o,3),Qt)}function j1(i,o){return Bu(i,re(o,3),wa)}function em(i,o){return i==null?i:ba(i,re(o,3),yt)}function tm(i,o){return i==null?i:sl(i,re(o,3),yt)}function nm(i,o){return i&&Qt(i,re(o,3))}function rm(i,o){return i&&wa(i,re(o,3))}function im(i){return i==null?[]:Gi(i,nt(i))}function sm(i){return i==null?[]:Gi(i,yt(i))}function ja(i,o,c){var d=i==null?n:Vn(i,o);return d===n?c:d}function am(i,o){return i!=null&&Hl(i,o,Rd)}function eo(i,o){return i!=null&&Hl(i,o,Ld)}var om=Ml(function(i,o,c){o!=null&&typeof o.toString!="function"&&(o=Fi.call(o)),i[o]=c},no(xt)),um=Ml(function(i,o,c){o!=null&&typeof o.toString!="function"&&(o=Fi.call(o)),_e.call(i,o)?i[o].push(c):i[o]=[c]},re),lm=Se(zr);function nt(i){return mt(i)?Qu(i):Oa(i)}function yt(i){return mt(i)?Qu(i,!0):Gd(i)}function cm(i,o){var c={};return o=re(o,3),Qt(i,function(d,m,b){ln(c,o(d,m,b),d)}),c}function fm(i,o){var c={};return o=re(o,3),Qt(i,function(d,m,b){ln(c,m,o(d,m,b))}),c}var hm=pr(function(i,o,c){zi(i,o,c)}),Tc=pr(function(i,o,c,d){zi(i,o,c,d)}),pm=fn(function(i,o){var c={};if(i==null)return c;var d=!1;o=Ne(o,function(b){return b=Cn(b,i),d||(d=b.length>1),b}),jt(i,Na(i),c),d&&(c=Bt(c,g|v|y,ov));for(var m=o.length;m--;)_a(c,o[m]);return c});function dm(i,o){return Ec(i,ns(re(o)))}var vm=fn(function(i,o){return i==null?{}:Hd(i,o)});function Ec(i,o){if(i==null)return{};var c=Ne(Na(i),function(d){return[d]});return o=re(o),vl(i,c,function(d,m){return o(d,m[0])})}function gm(i,o,c){o=Cn(o,i);var d=-1,m=o.length;for(m||(m=1,i=n);++d<m;){var b=i==null?n:i[en(o[d])];b===n&&(d=m,b=c),i=pn(b)?b.call(i):b}return i}function mm(i,o,c){return i==null?i:qr(i,o,c)}function ym(i,o,c,d){return d=typeof d=="function"?d:n,i==null?i:qr(i,o,c,d)}var Oc=Dl(nt),Cc=Dl(yt);function xm(i,o,c){var d=de(i),m=d||An(i)||gr(i);if(o=re(o,4),c==null){var b=i&&i.constructor;m?c=d?new b:[]:He(i)?c=pn(b)?hr(Li(i)):{}:c={}}return(m?Ut:Qt)(i,function(E,A,L){return o(c,E,A,L)}),c}function bm(i,o){return i==null?!0:_a(i,o)}function wm(i,o,c){return i==null?i:bl(i,o,Ma(c))}function Sm(i,o,c,d){return d=typeof d=="function"?d:n,i==null?i:bl(i,o,Ma(c),d)}function mr(i){return i==null?[]:ha(i,nt(i))}function Tm(i){return i==null?[]:ha(i,yt(i))}function Em(i,o,c){return c===n&&(c=o,o=n),c!==n&&(c=It(c),c=c===c?c:0),o!==n&&(o=It(o),o=o===o?o:0),Wn(It(i),o,c)}function Om(i,o,c){return o=dn(o),c===n?(c=o,o=0):c=dn(c),i=It(i),_d(i,o,c)}function Cm(i,o,c){if(c&&typeof c!="boolean"&&pt(i,o,c)&&(o=c=n),c===n&&(typeof o=="boolean"?(c=o,o=n):typeof i=="boolean"&&(c=i,i=n)),i===n&&o===n?(i=0,o=1):(i=dn(i),o===n?(o=i,i=0):o=dn(o)),i>o){var d=i;i=o,o=d}if(c||i%1||o%1){var m=$u();return ut(i+m*(o-i+i0("1e-"+((m+"").length-1))),o)}return Aa(i,o)}var Fm=dr(function(i,o,c){return o=o.toLowerCase(),i+(c?Fc(o):o)});function Fc(i){return to(Re(i).toLowerCase())}function Ac(i){return i=Re(i),i&&i.replace(Rp,m0).replace(Kp,"")}function Am(i,o,c){i=Re(i),o=Tt(o);var d=i.length;c=c===n?d:Wn(xe(c),0,d);var m=c;return c-=o.length,c>=0&&i.slice(c,m)==o}function Rm(i){return i=Re(i),i&&lp.test(i)?i.replace(su,y0):i}function Lm(i){return i=Re(i),i&&vp.test(i)?i.replace($s,"\\$&"):i}var _m=dr(function(i,o,c){return i+(c?"-":"")+o.toLowerCase()}),Um=dr(function(i,o,c){return i+(c?" ":"")+o.toLowerCase()}),km=_l("toLowerCase");function Mm(i,o,c){i=Re(i),o=xe(o);var d=o?or(i):0;if(!o||d>=o)return i;var m=(o-d)/2;return Yi(Mi(m),c)+i+Yi(ki(m),c)}function Bm(i,o,c){i=Re(i),o=xe(o);var d=o?or(i):0;return o&&d<o?i+Yi(o-d,c):i}function Pm(i,o,c){i=Re(i),o=xe(o);var d=o?or(i):0;return o&&d<o?Yi(o-d,c)+i:i}function Dm(i,o,c){return c||o==null?o=0:o&&(o=+o),W0(Re(i).replace(Js,""),o||0)}function Im(i,o,c){return(c?pt(i,o,c):o===n)?o=1:o=xe(o),Ra(Re(i),o)}function Nm(){var i=arguments,o=Re(i[0]);return i.length<3?o:o.replace(i[1],i[2])}var Gm=dr(function(i,o,c){return i+(c?"_":"")+o.toLowerCase()});function zm(i,o,c){return c&&typeof c!="number"&&pt(i,o,c)&&(o=c=n),c=c===n?be:c>>>0,c?(i=Re(i),i&&(typeof o=="string"||o!=null&&!Qa(o))&&(o=Tt(o),!o&&ar(i))?Fn(zt(i),0,c):i.split(o,c)):[]}var Hm=dr(function(i,o,c){return i+(c?" ":"")+to(o)});function qm(i,o,c){return i=Re(i),c=c==null?0:Wn(xe(c),0,i.length),o=Tt(o),i.slice(c,c+o.length)==o}function Wm(i,o,c){var d=x.templateSettings;c&&pt(i,o,c)&&(o=n),i=Re(i),o=ss({},o,d,Il);var m=ss({},o.imports,d.imports,Il),b=nt(m),E=ha(m,b),A,L,D=0,I=o.interpolate||yi,G="__p += '",Y=da((o.escape||yi).source+"|"+I.source+"|"+(I===au?Tp:yi).source+"|"+(o.evaluate||yi).source+"|$","g"),j="//# sourceURL="+(_e.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++jp+"]")+`
`;i.replace(Y,function(ae,Te,Fe,Ot,dt,Ct){return Fe||(Fe=Ot),G+=i.slice(D,Ct).replace(Lp,x0),Te&&(A=!0,G+=`' +
__e(`+Te+`) +
'`),dt&&(L=!0,G+=`';
`+dt+`;
__p += '`),Fe&&(G+=`' +
((__t = (`+Fe+`)) == null ? '' : __t) +
'`),D=Ct+ae.length,ae}),G+=`';
`;var se=_e.call(o,"variable")&&o.variable;if(!se)G=`with (obj) {
`+G+`
}
`;else if(wp.test(se))throw new fe(l);G=(L?G.replace(sp,""):G).replace(ap,"$1").replace(op,"$1;"),G="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(A?", __e = _.escape":"")+(L?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=Lc(function(){return Ae(b,j+"return "+G).apply(n,E)});if(we.source=G,Ja(we))throw we;return we}function Vm(i){return Re(i).toLowerCase()}function Xm(i){return Re(i).toUpperCase()}function Ym(i,o,c){if(i=Re(i),i&&(c||o===n))return Nu(i);if(!i||!(o=Tt(o)))return i;var d=zt(i),m=zt(o),b=Gu(d,m),E=zu(d,m)+1;return Fn(d,b,E).join("")}function Km(i,o,c){if(i=Re(i),i&&(c||o===n))return i.slice(0,qu(i)+1);if(!i||!(o=Tt(o)))return i;var d=zt(i),m=zu(d,zt(o))+1;return Fn(d,0,m).join("")}function Zm(i,o,c){if(i=Re(i),i&&(c||o===n))return i.replace(Js,"");if(!i||!(o=Tt(o)))return i;var d=zt(i),m=Gu(d,zt(o));return Fn(d,m).join("")}function $m(i,o){var c=ee,d=ne;if(He(o)){var m="separator"in o?o.separator:m;c="length"in o?xe(o.length):c,d="omission"in o?Tt(o.omission):d}i=Re(i);var b=i.length;if(ar(i)){var E=zt(i);b=E.length}if(c>=b)return i;var A=c-or(d);if(A<1)return d;var L=E?Fn(E,0,A).join(""):i.slice(0,A);if(m===n)return L+d;if(E&&(A+=L.length-A),Qa(m)){if(i.slice(A).search(m)){var D,I=L;for(m.global||(m=da(m.source,Re(ou.exec(m))+"g")),m.lastIndex=0;D=m.exec(I);)var G=D.index;L=L.slice(0,G===n?A:G)}}else if(i.indexOf(Tt(m),A)!=A){var Y=L.lastIndexOf(m);Y>-1&&(L=L.slice(0,Y))}return L+d}function Jm(i){return i=Re(i),i&&up.test(i)?i.replace(iu,C0):i}var Qm=dr(function(i,o,c){return i+(c?" ":"")+o.toUpperCase()}),to=_l("toUpperCase");function Rc(i,o,c){return i=Re(i),o=c?n:o,o===n?w0(i)?R0(i):h0(i):i.match(o)||[]}var Lc=Se(function(i,o){try{return wt(i,n,o)}catch(c){return Ja(c)?c:new fe(c)}}),jm=fn(function(i,o){return Ut(o,function(c){c=en(c),ln(i,c,Za(i[c],i))}),i});function ey(i){var o=i==null?0:i.length,c=re();return i=o?Ne(i,function(d){if(typeof d[1]!="function")throw new kt(u);return[c(d[0]),d[1]]}):[],Se(function(d){for(var m=-1;++m<o;){var b=i[m];if(wt(b[0],this,d))return wt(b[1],this,d)}})}function ty(i){return Cd(Bt(i,g))}function no(i){return function(){return i}}function ny(i,o){return i==null||i!==i?o:i}var ry=kl(),iy=kl(!0);function xt(i){return i}function ro(i){return ll(typeof i=="function"?i:Bt(i,g))}function sy(i){return fl(Bt(i,g))}function ay(i,o){return hl(i,Bt(o,g))}var oy=Se(function(i,o){return function(c){return zr(c,i,o)}}),uy=Se(function(i,o){return function(c){return zr(i,c,o)}});function io(i,o,c){var d=nt(o),m=Gi(o,d);c==null&&!(He(o)&&(m.length||!d.length))&&(c=o,o=i,i=this,m=Gi(o,nt(o)));var b=!(He(c)&&"chain"in c)||!!c.chain,E=pn(i);return Ut(m,function(A){var L=o[A];i[A]=L,E&&(i.prototype[A]=function(){var D=this.__chain__;if(b||D){var I=i(this.__wrapped__),G=I.__actions__=gt(this.__actions__);return G.push({func:L,args:arguments,thisArg:i}),I.__chain__=D,I}return L.apply(i,wn([this.value()],arguments))})}),i}function ly(){return st._===this&&(st._=B0),this}function so(){}function cy(i){return i=xe(i),Se(function(o){return pl(o,i)})}var fy=Pa(Ne),hy=Pa(Mu),py=Pa(oa);function _c(i){return qa(i)?ua(en(i)):qd(i)}function dy(i){return function(o){return i==null?n:Vn(i,o)}}var vy=Bl(),gy=Bl(!0);function ao(){return[]}function oo(){return!1}function my(){return{}}function yy(){return""}function xy(){return!0}function by(i,o){if(i=xe(i),i<1||i>Ce)return[];var c=be,d=ut(i,be);o=re(o),i-=be;for(var m=fa(d,o);++c<i;)o(c);return m}function wy(i){return de(i)?Ne(i,en):Et(i)?[i]:gt(Jl(Re(i)))}function Sy(i){var o=++k0;return Re(i)+o}var Ty=Xi(function(i,o){return i+o},0),Ey=Da("ceil"),Oy=Xi(function(i,o){return i/o},1),Cy=Da("floor");function Fy(i){return i&&i.length?Ni(i,xt,Sa):n}function Ay(i,o){return i&&i.length?Ni(i,re(o,2),Sa):n}function Ry(i){return Du(i,xt)}function Ly(i,o){return Du(i,re(o,2))}function _y(i){return i&&i.length?Ni(i,xt,Ca):n}function Uy(i,o){return i&&i.length?Ni(i,re(o,2),Ca):n}var ky=Xi(function(i,o){return i*o},1),My=Da("round"),By=Xi(function(i,o){return i-o},0);function Py(i){return i&&i.length?ca(i,xt):0}function Dy(i,o){return i&&i.length?ca(i,re(o,2)):0}return x.after=s1,x.ary=uc,x.assign=X1,x.assignIn=Sc,x.assignInWith=ss,x.assignWith=Y1,x.at=K1,x.before=lc,x.bind=Za,x.bindAll=jm,x.bindKey=cc,x.castArray=m1,x.chain=sc,x.chunk=Cv,x.compact=Fv,x.concat=Av,x.cond=ey,x.conforms=ty,x.constant=no,x.countBy=Pg,x.create=Z1,x.curry=fc,x.curryRight=hc,x.debounce=pc,x.defaults=$1,x.defaultsDeep=J1,x.defer=a1,x.delay=o1,x.difference=Rv,x.differenceBy=Lv,x.differenceWith=_v,x.drop=Uv,x.dropRight=kv,x.dropRightWhile=Mv,x.dropWhile=Bv,x.fill=Pv,x.filter=Ig,x.flatMap=zg,x.flatMapDeep=Hg,x.flatMapDepth=qg,x.flatten=tc,x.flattenDeep=Dv,x.flattenDepth=Iv,x.flip=u1,x.flow=ry,x.flowRight=iy,x.fromPairs=Nv,x.functions=im,x.functionsIn=sm,x.groupBy=Wg,x.initial=zv,x.intersection=Hv,x.intersectionBy=qv,x.intersectionWith=Wv,x.invert=om,x.invertBy=um,x.invokeMap=Xg,x.iteratee=ro,x.keyBy=Yg,x.keys=nt,x.keysIn=yt,x.map=ji,x.mapKeys=cm,x.mapValues=fm,x.matches=sy,x.matchesProperty=ay,x.memoize=ts,x.merge=hm,x.mergeWith=Tc,x.method=oy,x.methodOf=uy,x.mixin=io,x.negate=ns,x.nthArg=cy,x.omit=pm,x.omitBy=dm,x.once=l1,x.orderBy=Kg,x.over=fy,x.overArgs=c1,x.overEvery=hy,x.overSome=py,x.partial=$a,x.partialRight=dc,x.partition=Zg,x.pick=vm,x.pickBy=Ec,x.property=_c,x.propertyOf=dy,x.pull=Kv,x.pullAll=rc,x.pullAllBy=Zv,x.pullAllWith=$v,x.pullAt=Jv,x.range=vy,x.rangeRight=gy,x.rearg=f1,x.reject=Qg,x.remove=Qv,x.rest=h1,x.reverse=Ya,x.sampleSize=e1,x.set=mm,x.setWith=ym,x.shuffle=t1,x.slice=jv,x.sortBy=i1,x.sortedUniq=ag,x.sortedUniqBy=og,x.split=zm,x.spread=p1,x.tail=ug,x.take=lg,x.takeRight=cg,x.takeRightWhile=fg,x.takeWhile=hg,x.tap=Fg,x.throttle=d1,x.thru=Qi,x.toArray=xc,x.toPairs=Oc,x.toPairsIn=Cc,x.toPath=wy,x.toPlainObject=wc,x.transform=xm,x.unary=v1,x.union=pg,x.unionBy=dg,x.unionWith=vg,x.uniq=gg,x.uniqBy=mg,x.uniqWith=yg,x.unset=bm,x.unzip=Ka,x.unzipWith=ic,x.update=wm,x.updateWith=Sm,x.values=mr,x.valuesIn=Tm,x.without=xg,x.words=Rc,x.wrap=g1,x.xor=bg,x.xorBy=wg,x.xorWith=Sg,x.zip=Tg,x.zipObject=Eg,x.zipObjectDeep=Og,x.zipWith=Cg,x.entries=Oc,x.entriesIn=Cc,x.extend=Sc,x.extendWith=ss,io(x,x),x.add=Ty,x.attempt=Lc,x.camelCase=Fm,x.capitalize=Fc,x.ceil=Ey,x.clamp=Em,x.clone=y1,x.cloneDeep=b1,x.cloneDeepWith=w1,x.cloneWith=x1,x.conformsTo=S1,x.deburr=Ac,x.defaultTo=ny,x.divide=Oy,x.endsWith=Am,x.eq=qt,x.escape=Rm,x.escapeRegExp=Lm,x.every=Dg,x.find=Ng,x.findIndex=jl,x.findKey=Q1,x.findLast=Gg,x.findLastIndex=ec,x.findLastKey=j1,x.floor=Cy,x.forEach=ac,x.forEachRight=oc,x.forIn=em,x.forInRight=tm,x.forOwn=nm,x.forOwnRight=rm,x.get=ja,x.gt=T1,x.gte=E1,x.has=am,x.hasIn=eo,x.head=nc,x.identity=xt,x.includes=Vg,x.indexOf=Gv,x.inRange=Om,x.invoke=lm,x.isArguments=Kn,x.isArray=de,x.isArrayBuffer=O1,x.isArrayLike=mt,x.isArrayLikeObject=Xe,x.isBoolean=C1,x.isBuffer=An,x.isDate=F1,x.isElement=A1,x.isEmpty=R1,x.isEqual=L1,x.isEqualWith=_1,x.isError=Ja,x.isFinite=U1,x.isFunction=pn,x.isInteger=vc,x.isLength=rs,x.isMap=gc,x.isMatch=k1,x.isMatchWith=M1,x.isNaN=B1,x.isNative=P1,x.isNil=I1,x.isNull=D1,x.isNumber=mc,x.isObject=He,x.isObjectLike=qe,x.isPlainObject=Yr,x.isRegExp=Qa,x.isSafeInteger=N1,x.isSet=yc,x.isString=is,x.isSymbol=Et,x.isTypedArray=gr,x.isUndefined=G1,x.isWeakMap=z1,x.isWeakSet=H1,x.join=Vv,x.kebabCase=_m,x.last=Dt,x.lastIndexOf=Xv,x.lowerCase=Um,x.lowerFirst=km,x.lt=q1,x.lte=W1,x.max=Fy,x.maxBy=Ay,x.mean=Ry,x.meanBy=Ly,x.min=_y,x.minBy=Uy,x.stubArray=ao,x.stubFalse=oo,x.stubObject=my,x.stubString=yy,x.stubTrue=xy,x.multiply=ky,x.nth=Yv,x.noConflict=ly,x.noop=so,x.now=es,x.pad=Mm,x.padEnd=Bm,x.padStart=Pm,x.parseInt=Dm,x.random=Cm,x.reduce=$g,x.reduceRight=Jg,x.repeat=Im,x.replace=Nm,x.result=gm,x.round=My,x.runInContext=R,x.sample=jg,x.size=n1,x.snakeCase=Gm,x.some=r1,x.sortedIndex=eg,x.sortedIndexBy=tg,x.sortedIndexOf=ng,x.sortedLastIndex=rg,x.sortedLastIndexBy=ig,x.sortedLastIndexOf=sg,x.startCase=Hm,x.startsWith=qm,x.subtract=By,x.sum=Py,x.sumBy=Dy,x.template=Wm,x.times=by,x.toFinite=dn,x.toInteger=xe,x.toLength=bc,x.toLower=Vm,x.toNumber=It,x.toSafeInteger=V1,x.toString=Re,x.toUpper=Xm,x.trim=Ym,x.trimEnd=Km,x.trimStart=Zm,x.truncate=$m,x.unescape=Jm,x.uniqueId=Sy,x.upperCase=Qm,x.upperFirst=to,x.each=ac,x.eachRight=oc,x.first=nc,io(x,function(){var i={};return Qt(x,function(o,c){_e.call(x.prototype,c)||(i[c]=o)}),i}(),{chain:!1}),x.VERSION=r,Ut(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){x[i].placeholder=x}),Ut(["drop","take"],function(i,o){Oe.prototype[i]=function(c){c=c===n?1:et(xe(c),0);var d=this.__filtered__&&!o?new Oe(this):this.clone();return d.__filtered__?d.__takeCount__=ut(c,d.__takeCount__):d.__views__.push({size:ut(c,be),type:i+(d.__dir__<0?"Right":"")}),d},Oe.prototype[i+"Right"]=function(c){return this.reverse()[i](c).reverse()}}),Ut(["filter","map","takeWhile"],function(i,o){var c=o+1,d=c==ue||c==ge;Oe.prototype[i]=function(m){var b=this.clone();return b.__iteratees__.push({iteratee:re(m,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),Ut(["head","last"],function(i,o){var c="take"+(o?"Right":"");Oe.prototype[i]=function(){return this[c](1).value()[0]}}),Ut(["initial","tail"],function(i,o){var c="drop"+(o?"":"Right");Oe.prototype[i]=function(){return this.__filtered__?new Oe(this):this[c](1)}}),Oe.prototype.compact=function(){return this.filter(xt)},Oe.prototype.find=function(i){return this.filter(i).head()},Oe.prototype.findLast=function(i){return this.reverse().find(i)},Oe.prototype.invokeMap=Se(function(i,o){return typeof i=="function"?new Oe(this):this.map(function(c){return zr(c,i,o)})}),Oe.prototype.reject=function(i){return this.filter(ns(re(i)))},Oe.prototype.slice=function(i,o){i=xe(i);var c=this;return c.__filtered__&&(i>0||o<0)?new Oe(c):(i<0?c=c.takeRight(-i):i&&(c=c.drop(i)),o!==n&&(o=xe(o),c=o<0?c.dropRight(-o):c.take(o-i)),c)},Oe.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},Oe.prototype.toArray=function(){return this.take(be)},Qt(Oe.prototype,function(i,o){var c=/^(?:filter|find|map|reject)|While$/.test(o),d=/^(?:head|last)$/.test(o),m=x[d?"take"+(o=="last"?"Right":""):o],b=d||/^find/.test(o);m&&(x.prototype[o]=function(){var E=this.__wrapped__,A=d?[1]:arguments,L=E instanceof Oe,D=A[0],I=L||de(E),G=function(Te){var Fe=m.apply(x,wn([Te],A));return d&&Y?Fe[0]:Fe};I&&c&&typeof D=="function"&&D.length!=1&&(L=I=!1);var Y=this.__chain__,j=!!this.__actions__.length,se=b&&!Y,we=L&&!j;if(!b&&I){E=we?E:new Oe(this);var ae=i.apply(E,A);return ae.__actions__.push({func:Qi,args:[G],thisArg:n}),new Mt(ae,Y)}return se&&we?i.apply(this,A):(ae=this.thru(G),se?d?ae.value()[0]:ae.value():ae)})}),Ut(["pop","push","shift","sort","splice","unshift"],function(i){var o=Ei[i],c=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",d=/^(?:pop|shift)$/.test(i);x.prototype[i]=function(){var m=arguments;if(d&&!this.__chain__){var b=this.value();return o.apply(de(b)?b:[],m)}return this[c](function(E){return o.apply(de(E)?E:[],m)})}}),Qt(Oe.prototype,function(i,o){var c=x[o];if(c){var d=c.name+"";_e.call(fr,d)||(fr[d]=[]),fr[d].push({name:o,func:c})}}),fr[Vi(n,O).name]=[{name:"wrapper",func:n}],Oe.prototype.clone=J0,Oe.prototype.reverse=Q0,Oe.prototype.value=j0,x.prototype.at=Ag,x.prototype.chain=Rg,x.prototype.commit=Lg,x.prototype.next=_g,x.prototype.plant=kg,x.prototype.reverse=Mg,x.prototype.toJSON=x.prototype.valueOf=x.prototype.value=Bg,x.prototype.first=x.prototype.head,Mr&&(x.prototype[Mr]=Ug),x},ur=L0();Gn?((Gn.exports=ur)._=ur,ra._=ur):st._=ur}).call($r)})(As,As.exports);As.exports;class Qo{constructor(e){this.data=e,console.log("%c---- ---- ---- ---- ---- new SVG ---- ---- ---- ---- ----","color:orange"),this.paths=this.parse(),console.log("%c1. 绘制命令: ","color:orange",this.paths),this.curveSets=this.paths.map(n=>{const r=Kf(),s=DS(n);return s.forEach(a=>a.pathId=[r]),s}),console.log("%c2. 绘制线条 :","color:orange",this.curveSets.map(n=>n.map(r=>r.points.map(s=>s.valueOf()))))}parse(){const e=[];this.data.matchAll(/ d="([^"]+)"/g).forEach(r=>{if(Array.isArray(r)&&r.length>=2){const s=r[1],a=[];let u=null,l=[];const f=s.match(/[a-df-z]|[\-+]?\d*\.?\d+(?:e[\-+]?\d+)?/ig);if(!f)return a;f.forEach(h=>{h.match(/[a-df-z]/i)?(u!==null&&a.push({type:u,points:l}),u=h,l=[]):l.push(parseFloat(h))}),u!==null&&a.push({type:u,points:l}),e.push(a.map(h=>{const{type:p}=h;return p=="H"||p=="h"?l=[new H(h.points[0],0)]:p=="V"||p=="v"?l=[new H(0,h.points[0])]:p=="Z"||p=="z"?l=[]:l=ei(h.points,2).map(([g,v])=>new H(g,v)),{type:p,points:l}}))}}),this.data.matchAll(/<rect\b[^>]*>/g).forEach(r=>{var h,p,g,v;const s=r[0],a=Number(((h=s.match(/ x="([^"]+)"/))==null?void 0:h.at(1))??0),u=Number(((p=s.match(/ y="([^"]+)"/))==null?void 0:p.at(1))??0),l=Number(((g=s.match(/ width="([^"]+)"/))==null?void 0:g.at(1))??0),f=Number(((v=s.match(/ height="([^"]+)"/))==null?void 0:v.at(1))??0);e.push([{type:"M",points:[new H(a,u)]},{type:"h",points:[new H(l,0)]},{type:"v",points:[new H(0,f)]},{type:"h",points:[new H(-l,0)]},{type:"v",points:[new H(0,-f)]},{type:"z",points:[]}])}),this.data.matchAll(/<circle\b[^>]*>/g).forEach(r=>{var g,v,y;const s=r[0],a=Number(((g=s.match(/ cx="([^"]+)"/))==null?void 0:g.at(1))??0),u=Number(((v=s.match(/ cy="([^"]+)"/))==null?void 0:v.at(1))??0),l=Number(((y=s.match(/ r="([^"]+)"/))==null?void 0:y.at(1))??0),f=l,h=l,p=(Math.sqrt(2)-1)*4/3;e.push([{type:"M",points:[new H(a,u-h)]},{type:"c",points:[new H(f*p,0),new H(f,h*(1-p)),new H(f,h)]},{type:"s",points:[new H(f*(p-1),h),new H(-f,h)]},{type:"s",points:[new H(-f,h*(p-1)),new H(-f,-h)]},{type:"s",points:[new H(f*(1-p),-h),new H(f,-h)]},{type:"Z",points:[]}])}),this.data.matchAll(/<ellipse\b[^>]*>/g).forEach(r=>{var p,g,v,y;const s=r[0],a=Number(((p=s.match(/ cx="([^"]+)"/))==null?void 0:p.at(1))??0),u=Number(((g=s.match(/ cy="([^"]+)"/))==null?void 0:g.at(1))??0),l=Number(((v=s.match(/ rx="([^"]+)"/))==null?void 0:v.at(1))??0),f=Number(((y=s.match(/ ry="([^"]+)"/))==null?void 0:y.at(1))??0),h=(Math.sqrt(2)-1)*4/3;e.push([{type:"M",points:[new H(a,u-f)]},{type:"c",points:[new H(l*h,0),new H(l,f*(1-h)),new H(l,f)]},{type:"s",points:[new H(l*(h-1),f),new H(-l,f)]},{type:"s",points:[new H(-l,f*(h-1)),new H(-l,-f)]},{type:"s",points:[new H(l*(1-h),-f),new H(l,-f)]},{type:"Z",points:[]}])});{const n=this.data.matchAll(/<arc\b[^>]*>/g);n.length!==0&&n.forEach(r=>{var _,z,V,q,K;const s=r[0],a=Number(((_=s.match(/ cx="([^"]+)"/))==null?void 0:_.at(1))??0),u=Number(((z=s.match(/ cy="([^"]+)"/))==null?void 0:z.at(1))??0),l=Number(((V=s.match(/ r="([^"]+)"/))==null?void 0:V.at(1))??0),f=Number(((q=s.match(/ a="([^"]+)"/))==null?void 0:q.at(1))??0),h=Number(((K=s.match(/ b="([^"]+)"/))==null?void 0:K.at(1))??0),p=(Math.sqrt(2)-1)*4/3,g=(h-f)%360,v=Math.sign(h-f),y=g!==0?g:360*v,w=y%90,T=parseInt(y/90),S=new H(a,u),O=new H(a+l,u),C=O.rotate(S,ve(Mc(f))),F=O.rotate(S,ve(Mc(h))),U=[];U.push({type:"M",points:[S]}),U.push({type:"L",points:[C]});for(let ee=0;ee<Math.abs(T);ee++){const ne=C.rotate(S,ve(ee*90*v)),oe=C.rotate(S,ve((ee+1)*90*v)),ie=C.rotate(S,ve((ee+1/2)*90*v)),ue=rt(ie.valueOf(),S.valueOf()),pe=rt(ne.valueOf(),S.valueOf()),ge=rt(oe.valueOf(),S.valueOf()),le=Vt(kn(ue,pe)),Ce=Vt(kn(ue,ge)),Le=new H(...rn(ne.valueOf(),le,l*p)),Ee=new H(...rn(oe.valueOf(),Ce,l*p));U.push({type:"C",points:[Le,Ee,oe]})}if(w!==0){const ee=C.rotate(S,ve(T*90)),ne=F,oe=C.rotate(S,ve(T*90+w/2)),ie=rt(oe.valueOf(),S.valueOf()),ue=rt(ee.valueOf(),S.valueOf()),pe=rt(ne.valueOf(),S.valueOf()),ge=Vt(kn(ie,ue)),le=Vt(kn(ie,pe)),Ce=new H(...rn(ee.valueOf(),ge,l*p*(Math.abs(w)/90))),Le=new H(...rn(ne.valueOf(),le,l*p*(Math.abs(w)/90)));U.push({type:"C",points:[Ce,Le,ne]})}U.push({type:"L",points:[S]}),U.push({type:"Z",points:[]}),e.push(U)})}return e}getGeometry(e=20){const n=this.curveSets.flatMap(s=>{s=gs(s),console.log("%c3. 交点切割 :","color:orange",s),s=Tf(s),console.log("%c6. 轴线分割 :","color:orange",s);const a=Ef(s);console.log("%c7. 填充图形 :","color:orange",a);const u=Of(a.flat(),e);return console.log("%c8. 三角面:","color:orange",u.length),u});return Cf(n)}getBorderGeometry(e=10,n=20,r){const s=this.curveSets.flatMap(u=>{u=gs(u);const l=Rs(u);console.log("%c9. 需要描边的图形: ","color:rgb(255,0,80)",l);const f=l.map(p=>PS(p,e,r));console.log("%c10. 边框的图形组: ","color:rgb(255,0,80)",f),u=gs(f.flat(2)),console.log("%c10.1. 交点切割: ","color:rgb(255,0,80)",Rf(u)),u=Tf(u),console.log("%c10.2. 轴线分割: ","color:rgb(255,0,80)",Rf(u));const h=Ef(u,"union",!1);return console.log("%c11. 填充片元: ","color:rgb(255,0,80)",h),Of(h.flat(),10)});return console.log("%c12. 边框三角面:","color:rgb(255,0,80)",s.length),Cf(s)}static Contour(e,n=[]){function r(l){function f(p){const[g,v]=p.points;return g.y<=v.y?p:p.toReversed()}const h=l.toSorted((p,g)=>{const v=f(p),y=f(g),w=v.points.at(0),T=y.points.at(0);if(T.y<w.y)return 1;if(T.y==w.y){if(T.x>w.x)return 1;if(T.x==w.x){const S=v.theta();if(y.theta()<S)return 1}}return-1});return f(h.at(0))}let s;if(n.length>1){const l=n.at(0).points.at(0),f=n.at(-1).points.at(-1);if(l.equals(f))return n;s=n.at(-1)}else s=r(e),n.push(s);const a=s.points.at(-1);let u=e.filter(l=>!l.equals(s)&&l.points.some(f=>a.equals(f))).map(l=>a.equals(l.points.at(0))?l:l.toReversed());if(u.length>1){const l=u.toSorted((f,h)=>f.theta()-h.theta());n.push(l[0])}else if(u.length==1){const l=u[0];n.push(l)}else return;return Qo.Contour(e,n)}}function PS(t,e=10,n="beveled"){const r=[];return t.forEach((s,a,u)=>{const l=u.length-1,f=a!=l?a+1:0,h=u[f],[p,g]=s.endPoints();if(h.endPoints(),p.equals(g))return;if(s instanceof te){const[S,O]=Af(p,g,e/2,-90),[C,F]=Af(p,g,e/2,90),U=[new te(S,O),new te(O,F),new te(F,C),new te(C,S)];r.push(U)}else if(s instanceof ze){const S=s.outlineShape(e);S==null?console.log("shittttt",a,s,e):r.push(S)}const v=s.tangent(1),y=h.tangent(0),w=Ho(ai(v,y));let T=[];if(w>0&&w<180){const S=g.translate(v,e/2).rotate(g,ve(-90)),O=g.translate(y,e/2).rotate(g,ve(-90)),C=S.translate(v,Math.tan(Bo(v,y)/2)*e/2);switch(n){case"mitered":{T=[new te(g,S),new te(S,C),new te(C,O),new te(O,g)];break}case"rounded":{T=Ff(g,S,O,15).flatMap(F=>F.segmentation(1)),T.push(new te(T.at(-1).points.at(-1),g)),T.push(new te(g,T.at(0).points.at(0)));break}case"beveled":{T=[new te(g,S),new te(S,O),new te(O,g)];break}}}else if(w>180){const S=g.translate(v,e/2).rotate(g,ve(90)),O=g.translate(y,e/2).rotate(g,ve(90)),C=S.translate(v,Math.tan(Bo(v,y)/2)*e/2);switch(n){case"mitered":{T=[new te(g,S),new te(S,C),new te(C,O),new te(O,g)];break}case"rounded":{T=Ff(g,S,O,15).flatMap(F=>F.segmentation(1)),T.push(new te(T.at(-1).points.at(-1),g)),T.push(new te(g,T.at(0).points.at(0)));break}case"beveled":{T=[new te(g,S),new te(S,O),new te(O,g)];break}}}T.length!=0&&r.push(T)}),r.map(s=>{let a=Kf();return s.forEach(u=>u.pathId=[a]),s})}function DS(t){const e=[];let n,r;return t.forEach((s,a,u)=>{const{type:l,points:f}=s;switch(l){case"m":case"M":{n=r=f.at(0);break}case"l":case"L":{f.forEach(h=>{const p=new te(r,l==="L"?h:new H(h.x+r.x,h.y+r.y));e.push(p),r=p.points.at(-1)});break}case"q":case"Q":{f.split(2).forEach(h=>{const p=new Xt(r,...h.map(g=>l==="Q"?g:new H(g.x+r.x,g.y+r.y)));e.push(p),r=p.points.at(-1)});break}case"c":case"C":{f.split(3).forEach(h=>{const p=new ze(r,...h.map(g=>l==="C"?g:new H(g.x+r.x,g.y+r.y)));e.push(p),r=p.points.at(-1)});break}case"s":case"S":{f.forEach((h,p,g)=>{if(p%2==0){let v;const y=e.at(-1);y instanceof te?v=y.points.at(-1):(y instanceof Xt||y instanceof ze)&&(v=y.points.at(-2));const w=new H(2*r.x-v.x,2*r.y-v.y),T=h,S=g[p+1],O=new ze(r,w,l==="S"?T:T.moveTo(r.x,r.y),l==="S"?S:S.moveTo(r.x,r.y));e.push(O),r=O.points.at(-1)}});break}case"t":case"T":{f.forEach((h,p,g)=>{const v=e.at(-1);let y;v instanceof te?y=v.points.at(-1):(v instanceof Xt||v instanceof ze)&&(y=v.points.at(-2));const w=new H(2*r.x-y.x,2*r.y-y.y),T=h,S=new ze(r,w,l==="T"?T:new H(T.x+r.x,T.y+r.y));e.push(S),r=S.points.at(-1)});break}case"h":case"H":{f.forEach(h=>{const p=new te(r,l==="H"?new H(h.x,r.y):new H(h.x+r.x,r.y));e.push(p),r=p.points.at(-1)});break}case"v":case"V":{f.forEach(h=>{const p=new te(r,l==="V"?new H(r.x,h.y):new H(r.x,h.y+r.y));e.push(p),r=p.points.at(-1)});break}case"z":case"Z":{if(!r.equals(n)){const h=new te(r,n);e.push(h)}break}}}),e}function Tf(t){t=t.flatMap(n=>{const r=n.extremeY(),s=n.split(...r.filter(a=>a!=0&&a!=1));return Array.isArray(s)&&s.length!=0?(s.forEach(a=>a.pathId=n.pathId),s):n}),console.log("%c自身极值点切割: ","color:orange",t);const e=t.flatMap(n=>[n.points.at(0),n.points.at(-1)]).filter((n,r,s)=>s.findIndex(a=>n.y==a.y)==r).toSorted((n,r)=>n.y-r.y).map(n=>new ot(new H(0,n.y),new H(1,n.y)));return console.log("%c5. 分割线: ","color:orange",e.map(n=>n.points[0].y)),e.forEach((n,r,s)=>{if(r!=0){const a=s[r-1],u=n;t=t.flat(),t.forEach((l,f,h)=>{if(l.scanned||l.points.at(0).y==l.points.at(-1).y)return;let p=[],g=[],v=[];if(a.points.at(0).y==l.points.at(0).y?g.push([0,l.points.at(0).x]):a.points.at(0).y==l.points.at(-1).y?g.push([1,l.points.at(-1).x]):g=l.intersect(a),u.points.at(0).y==l.points.at(0).y?v.push([0,l.points.at(0).x]):u.points.at(0).y==l.points.at(-1).y?v.push([1,l.points.at(-1).x]):v=l.intersect(u),g.length!=0&&g.forEach(y=>p.push({value:y[0],substitute:a.lerp(y[1])})),v.length!=0&&v.forEach(y=>p.push({value:y[0],substitute:u.lerp(y[1])})),p.length==2)if(p.sort((y,w)=>y.value-w.value),p[0].value==0&&p[1].value==1)l.scanned=!0;else{const y=p.filter(w=>w.value!=0&&w.value!=1);if(y.length!=0){const w=l.split(...y.map(T=>T.value));w.forEach((T,S,O)=>{T.pathId=l.pathId;const C=O.length-1;S!=0&&T.points.splice(0,1,y[S-1].substitute),S!=C&&T.points.splice(-1,1,y[S].substitute);const F=T.points.at(0),U=T.points.at(-1);F.y!=U.y&&[a,u].some(_=>_.points.at(0).y==F.y)&&[a,u].some(_=>_.points.at(0).y==U.y)&&(T.scanned=!0)}),h[f]=w}}})}}),t=t.flat(),t.forEach(n=>delete n.scanned),t}function Ef(t,e="evenodd",n){const r=[],s=t.flatMap(l=>[l.points.at(0),l.points.at(-1)]).filter((l,f,h)=>h.findIndex(p=>l.y==p.y)==f).toSorted((l,f)=>l.y-f.y).map(l=>new ot(new H(0,l.y),new H(1,l.y)));if(t.forEach(l=>{const[f,h]=l.endPoints();h.y<f.y&&l.reverse()}),n){let l=function(f,h){const p=document.body,g=window.devicePixelRatio,v=document.createElement("div");v.id=h,v.title=`${h}: ${f}`;const y={backgroundColor:"orange",width:"100%",height:"1px",position:"absolute",top:`${(f*4+300)/g}px`};for(const w in y){const T=y[w];v.style[w]=T}p.appendChild(v)};var u=l;s.forEach((f,h)=>{const p=f.points[0].y;l(p,`line(${h})`)})}return s.forEach((l,f,h)=>{if(f!=h.length-1){const p=[],g=h[f+1];t.forEach(v=>{const[y,w]=v.endPoints();w.y!=y.y&&Math.abs(y.y-l.points[0].y)<=1e-4&&Math.abs(w.y-g.points[0].y)<=1e-4&&p.push(v)}),p.length>1&&r.push(p)}}),r.sort((l,f)=>{if(l.length==0)debugger;if(f.length==0)debugger;return l[0].points.at(0).y-f[0].points.at(0).y}),r.map((l,f)=>{const h=[];l.sort((v,y)=>{const w=v.points.at(0),T=y.points.at(0);return Math.abs(w.x-T.x)<.001?y.lerp(.5).x-v.lerp(.5).x:T.x-w.x});const g=l.flatMap(v=>v.pathId).filter((v,y,w)=>w.indexOf(v)==y).map(v=>l.filter(y=>y.pathId.indexOf(v)!=-1));return l.forEach((v,y,w)=>{if(y!=w.length-1){const C=w[y+1];let F=!1;if(e=="evenodd")F=y%2==0||y==1&&w.length==3;else if(e=="union"){let U=function(V,q){const K=V.points.at(0),ee=q.points.at(0);return K.x==ee.x?V.lerp(.5).x<=q.lerp(.5).x:K.x<=ee.x},_=function(V,q){return V<0?!1:V%2==0||V==1&&q==3},z=function(V,q,K){if(q!=K.length-1){const ee=K[q+1];let ne=U(v,V),oe=U(ee,v),ie=U(C,V),ue=U(ee,C);return ne&&oe&&ie&&ue}};var T=U,S=_,O=z;F=g.reduce((V,q)=>{let K=q.findIndex((ne,oe,ie)=>z(ne,oe,ie));return _(K)||V},!1)}if(F){const[U,_]=v.endPoints(),[z,V]=C.endPoints(),q=[];U.equals(_,1e-6)||q.push(v),_.equals(V,1e-6)||q.push(new te(_,V)),V.equals(z,1e-6)||q.push(C.toReversed()),z.equals(U,1e-6)||q.push(new te(z,U)),h.push(q)}}}),h})}function IS(t){if(Array.isArray(t)){const e=t.filter(n=>!n.points.at(0).equals(n.points.at(-1)));if(e.length>=3)return e.every((n,r,s)=>{const a=s.length-1,u=r==a?0:r+1,l=n.points.at(-1),f=s[u].points.at(0);return l.equals(f)})}return!1}function Of(t,e){t=t.map(r=>r.map(s=>new s.constructor(...s.points)));const n=[];return t.forEach(r=>{if(IS(r))if(r.every(s=>s instanceof te)){if(r.length===3)n.push(r.map(s=>s.points.at(0)));else if(r.length===4){const[s,a,u,l]=r.map(f=>f.points.at(0));n.push([s,a,u]),n.push([s,u,l])}}else{let a=r.filter(u=>u.points.at(0).y!=u.points.at(-1).y).flatMap(u=>u.segmentation(e));a.flatMap(u=>u.points).filter((u,l,f)=>f.findIndex(h=>h.y==u.y)==l).toSorted((u,l)=>u.y-l.y).forEach((u,l,f)=>{if(l!=f.length-1){const h=f[l+1],p=new ot(new H(0,u.y),new H(1,u.y)),g=new ot(new H(0,h.y),new H(1,h.y)),v=[];if(a.flat().forEach((C,F,U)=>{if(C.scanned||C.points.at(0).y==C.points.at(-1).y)return;let _=[],z=[];if(p.points.at(0).y==C.points.at(0).y?_.push([0,C.points.at(0).x]):p.points.at(0).y==C.points.at(-1).y?_.push([1,C.points.at(-1).x]):_=C.intersect(p),g.points.at(0).y==C.points.at(0).y?z.push([0,C.points.at(0).x]):g.points.at(0).y==C.points.at(-1).y?z.push([1,C.points.at(-1).x]):z=C.intersect(g),_.length==1&&z.length==1){let V=[];if(V.push({value:_[0][0],substitute:p.lerp(_[0][1])}),V.push({value:z[0][0],substitute:g.lerp(z[0][1])}),V=V.filter(q=>q.value!=0&&q.value!=1),V.length==0)C.scanned=!0,v.push(C);else{const q=C.split(...V.map(K=>K.value));q.forEach((K,ee,ne)=>{const oe=ne.length-1;ee!=0&&K.points.splice(0,1,V[ee-1].substitute),ee!=oe&&K.points.splice(-1,1,V[ee].substitute);const ie=K.points.at(0),ue=K.points.at(-1);ie.y!=ue.y&&[p,g].some(pe=>pe.points.at(0).y==ie.y)&&[p,g].some(pe=>pe.points.at(0).y==ue.y)&&(K.scanned=!0,v.push(K))}),U[F]=q}}}),v.length!=2)return;v.forEach(C=>{const[F,U]=C.endPoints();U.y<F.y&&C.reverse()}),v.sort((C,F)=>{const U=C.points.at(0),_=F.points.at(0);return _.x==U.x?F.lerp(.5).x-C.lerp(.5).x:_.x-U.x});const y=v[0].points.at(0),w=v[0].points.at(-1),T=v[1].points.at(-1),S=v[1].points.at(0),O=[];if(y.equals(w,1e-6)||O.push(new te(y,w)),w.equals(T,1e-6)||O.push(new te(w,T)),T.equals(S,1e-6)||O.push(new te(T,S)),S.equals(y,1e-6)||O.push(new te(S,y)),O.length===3)n.push(O.map(C=>C.points.at(0)));else if(O.length===4){const[C,F,U,_]=O.map(z=>z.points.at(0));n.push([C,F,U]),n.push([C,U,_])}}})}}),n}function Cf(t){const e={vertices:[],normals:[],uvs:[],indices:[]},n=t.flat(),r=Math.min(...n.map(h=>h[0])),s=Math.max(...n.map(h=>h[0])),a=Math.min(...n.map(h=>h[1])),u=Math.max(...n.map(h=>h[1])),l=s-r,f=u-a;return t.forEach((h,p)=>{h.forEach(g=>{const{x:v,y}=g;e.vertices.push(v,y,0),e.normals.push(0,0,1);const w=(v-r)/l,T=(y-a)/f;e.uvs.push(w,T)}),e.indices.push(p*3,p*3+1,p*3+2)}),e}function Rs(t,e=[],n=[]){t=t.filter(a=>!a.isPoint());function r(a){return a.forEach(l=>{const[f,h]=l.endPoints();h.y<f.y&&l.reverse()}),a.toSorted((l,f)=>{const h=l.points.at(0),p=f.points.at(0);if(p.y<h.y)return 1;if(p.y==h.y){if(p.x>h.x)return 1;if(p.x==h.x&&f.lerp(.5).x>l.lerp(.5).x)return 1}return-1})[0]}const s=t.filter(a=>!a.resolved);if(s.length==0)return n.length==0?(t.forEach(a=>delete a.resolved),e):(n.shift(),n.forEach(a=>delete a.resolved),Rs(t,e,[]));{let a;n.length===0?(a=r(s),a.resolved=!0,n.push(a)):a=n.at(-1);const u=a.points.at(-1);let l=s.filter((f,h,p)=>!a.equals(f)&&f.endPoints().some((g,v)=>u.equals(g,.001)?(v==1&&f.reverse(),!0):!1));if(l.length==1)l[0].resolved=!0,n.push(l[0]);else if(l.length>1){const f=a.toReversed().tangent(0),h=l.toSorted((p,g)=>{const v=p.tangent(0),y=g.tangent(0);if(Jo(v,y))return g.lerp(.5).x-p.lerp(.5).x;{const w=ai(f,v),T=ai(f,y);return w-T}});h[0].resolved=!0,n.push(h[0])}else n.pop();if(n.length>1){const f=n.at(0).points.at(0),h=n.at(-1).points.at(-1);f.equals(h,.001)&&(n.forEach((p,g,v)=>{if(g==v.length-1)return;const y=g+1;p instanceof te&&v[y]instanceof te&&p.points.at(-1).equals(v[y].points.at(0))&&(v[g]=null,v[y]=new te(p.points.at(0),v[y].points.at(-1)))}),e.push(n.filter(p=>p!=null)),n=[])}return Rs(t,e,n)}}function Ff(t,e,n,r=90){const s=_h(rt(e.valueOf(),t.valueOf())),a=Vt(rt(e.valueOf(),t.valueOf())),u=Vt(rt(n.valueOf(),t.valueOf())),l=Ho(ai(u,a)),f=(Math.sqrt(2)-1)*4/3,h=l%360,p=Math.sign(l),g=h!==0?h:360*p,v=Math.min(r,90),y=g%v,w=parseInt(g/v),T=[];for(let S=0;S<Math.abs(w);S++){const O=e.rotate(t,ve(S*v*p)),C=e.rotate(t,ve((S+1)*v*p)),F=e.rotate(t,ve((S+1/2)*v*p)),U=rt(F.valueOf(),t.valueOf()),_=rt(O.valueOf(),t.valueOf()),z=rt(C.valueOf(),t.valueOf()),V=Vt(kn(U,_)),q=Vt(kn(U,z)),K=new H(...rn(O.valueOf(),V,s*f*(Math.abs(y)/90))),ee=new H(...rn(C.valueOf(),q,s*f*(Math.abs(y)/90)));T.push(new ze(O,K,ee,C))}if(y!==0){const S=e.rotate(t,ve(w*v)),O=n,C=e.rotate(t,ve(w*v+y/2)),F=rt(C.valueOf(),t.valueOf()),U=rt(S.valueOf(),t.valueOf()),_=rt(O.valueOf(),t.valueOf()),z=Vt(kn(F,U)),V=Vt(kn(F,_)),q=new H(...rn(S.valueOf(),z,s*f*(Math.abs(y)/90))),K=new H(...rn(O.valueOf(),V,s*f*(Math.abs(y)/90)));T.push(new ze(S,q,K,O))}return T}function Af(t,e,n,r){t=t.valueOf(),e=e.valueOf();const s=$o(e,t,ve(r)),a=Vt(rt(s,t)),u=new H(...rn(t,a,n)),l=new H(...rn(e,a,n));return[u,l]}function Rf(t){return t.map(e=>new e.constructor(...e.points.map(n=>new H(n.x,n.y))))}const Lf=`@group(0) @binding(0) var<uniform> scene: Scene;\r
\r
struct Scene {\r
    resolution: vec2<f32>,\r
}\r
\r
// 在这里添加的属性，需要再vertexShader代码里面输出到VertexOutput\r
struct VertexInput {\r
    @builtin(instance_index) index: u32,\r
    @location(0) position : vec3f,\r
    @location(1) normal : vec3f,\r
    @location(2) uv : vec2f,\r
    @location(3) color : vec4f\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) Position: vec4<f32>,\r
    @location(0) normal: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) color: vec4f,\r
    @interpolate(flat)\r
    @location(3) index: u32\r
}\r
\r
struct FragmentInput {\r
    @location(0) normal: vec3f,\r
    @location(1) uv: vec2f,\r
    @location(2) color: vec4f,\r
    @interpolate(flat)\r
    @location(3) index: u32\r
}\r
\r
struct FragmentOutput {\r
  @location(0) color: vec4f,\r
}\r
\r
@vertex\r
fn main_vert(in: VertexInput) -> VertexOutput {\r
    var out: VertexOutput;\r
    let x = in.position.x;\r
    let y = in.position.y;\r
    out.Position = vec4f((vec2f(x, y) / (scene.resolution / 2) - 1) * vec2f(1, -1), 0.0, 1.0);\r
    out.normal = in.normal;\r
    out.color = in.color;\r
    out.uv = in.uv;\r
    out.index = in.index;\r
    return out;\r
}\r
\r
\r
@fragment\r
fn main_frag(in: FragmentInput) -> FragmentOutput {\r
    var out: FragmentOutput; // 返回值\r
    var red = vec4f(1, 0, 0, 1);\r
    var green = vec4f(0, 1, 0, 1);\r
    var blue = vec4f(0, 0, 1, 1);\r
    var purple = vec4f(1, 0, 1, 1);\r
    var blank = vec4f(0,0,0,0);\r
    var white = vec4f(1,1,1,1);\r
\r
    var u = in.uv.x;\r
    var v = in.uv.y;\r
    out.color = in.color;\r
    return out;\r
}`;function Uh(t,e){return function(){return t.apply(e,arguments)}}const{toString:NS}=Object.prototype,{getPrototypeOf:jo}=Object,Ms=(t=>e=>{const n=NS.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Jt=t=>(t=t.toLowerCase(),e=>Ms(e)===t),Bs=t=>e=>typeof e===t,{isArray:Fr}=Array,oi=Bs("undefined");function GS(t){return t!==null&&!oi(t)&&t.constructor!==null&&!oi(t.constructor)&&Ft(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const kh=Jt("ArrayBuffer");function zS(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&kh(t.buffer),e}const HS=Bs("string"),Ft=Bs("function"),Mh=Bs("number"),Ps=t=>t!==null&&typeof t=="object",qS=t=>t===!0||t===!1,ms=t=>{if(Ms(t)!=="object")return!1;const e=jo(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},WS=Jt("Date"),VS=Jt("File"),XS=Jt("Blob"),YS=Jt("FileList"),KS=t=>Ps(t)&&Ft(t.pipe),ZS=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ft(t.append)&&((e=Ms(t))==="formdata"||e==="object"&&Ft(t.toString)&&t.toString()==="[object FormData]"))},$S=Jt("URLSearchParams"),[JS,QS,jS,e3]=["ReadableStream","Request","Response","Headers"].map(Jt),t3=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function di(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),Fr(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),u=a.length;let l;for(r=0;r<u;r++)l=a[r],e.call(null,t[l],l,t)}}function Bh(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const Jn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ph=t=>!oi(t)&&t!==Jn;function Po(){const{caseless:t}=Ph(this)&&this||{},e={},n=(r,s)=>{const a=t&&Bh(e,s)||s;ms(e[a])&&ms(r)?e[a]=Po(e[a],r):ms(r)?e[a]=Po({},r):Fr(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&di(arguments[r],n);return e}const n3=(t,e,n,{allOwnKeys:r}={})=>(di(e,(s,a)=>{n&&Ft(s)?t[a]=Uh(s,n):t[a]=s},{allOwnKeys:r}),t),r3=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),i3=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},s3=(t,e,n,r)=>{let s,a,u;const l={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)u=s[a],(!r||r(u,t,e))&&!l[u]&&(e[u]=t[u],l[u]=!0);t=n!==!1&&jo(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},a3=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},o3=t=>{if(!t)return null;if(Fr(t))return t;let e=t.length;if(!Mh(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},u3=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&jo(Uint8Array)),l3=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const a=s.value;e.call(t,a[0],a[1])}},c3=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},f3=Jt("HTMLFormElement"),h3=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),_f=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),p3=Jt("RegExp"),Dh=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};di(n,(s,a)=>{let u;(u=e(s,a,t))!==!1&&(r[a]=u||s)}),Object.defineProperties(t,r)},d3=t=>{Dh(t,(e,n)=>{if(Ft(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(Ft(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},v3=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return Fr(t)?r(t):r(String(t).split(e)),n},g3=()=>{},m3=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,bo="abcdefghijklmnopqrstuvwxyz",Uf="0123456789",Ih={DIGIT:Uf,ALPHA:bo,ALPHA_DIGIT:bo+bo.toUpperCase()+Uf},y3=(t=16,e=Ih.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function x3(t){return!!(t&&Ft(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const b3=t=>{const e=new Array(10),n=(r,s)=>{if(Ps(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=Fr(r)?[]:{};return di(r,(u,l)=>{const f=n(u,s+1);!oi(f)&&(a[l]=f)}),e[s]=void 0,a}}return r};return n(t,0)},w3=Jt("AsyncFunction"),S3=t=>t&&(Ps(t)||Ft(t))&&Ft(t.then)&&Ft(t.catch),Nh=((t,e)=>t?setImmediate:e?((n,r)=>(Jn.addEventListener("message",({source:s,data:a})=>{s===Jn&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),Jn.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ft(Jn.postMessage)),T3=typeof queueMicrotask<"u"?queueMicrotask.bind(Jn):typeof process<"u"&&process.nextTick||Nh,M={isArray:Fr,isArrayBuffer:kh,isBuffer:GS,isFormData:ZS,isArrayBufferView:zS,isString:HS,isNumber:Mh,isBoolean:qS,isObject:Ps,isPlainObject:ms,isReadableStream:JS,isRequest:QS,isResponse:jS,isHeaders:e3,isUndefined:oi,isDate:WS,isFile:VS,isBlob:XS,isRegExp:p3,isFunction:Ft,isStream:KS,isURLSearchParams:$S,isTypedArray:u3,isFileList:YS,forEach:di,merge:Po,extend:n3,trim:t3,stripBOM:r3,inherits:i3,toFlatObject:s3,kindOf:Ms,kindOfTest:Jt,endsWith:a3,toArray:o3,forEachEntry:l3,matchAll:c3,isHTMLForm:f3,hasOwnProperty:_f,hasOwnProp:_f,reduceDescriptors:Dh,freezeMethods:d3,toObjectSet:v3,toCamelCase:h3,noop:g3,toFiniteNumber:m3,findKey:Bh,global:Jn,isContextDefined:Ph,ALPHABET:Ih,generateString:y3,isSpecCompliantForm:x3,toJSONObject:b3,isAsyncFn:w3,isThenable:S3,setImmediate:Nh,asap:T3};function me(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}M.inherits(me,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:M.toJSONObject(this.config),code:this.code,status:this.status}}});const Gh=me.prototype,zh={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{zh[t]={value:t}});Object.defineProperties(me,zh);Object.defineProperty(Gh,"isAxiosError",{value:!0});me.from=(t,e,n,r,s,a)=>{const u=Object.create(Gh);return M.toFlatObject(t,u,function(f){return f!==Error.prototype},l=>l!=="isAxiosError"),me.call(u,t.message,e,n,r,s),u.cause=t,u.name=t.name,a&&Object.assign(u,a),u};const E3=null;function Do(t){return M.isPlainObject(t)||M.isArray(t)}function Hh(t){return M.endsWith(t,"[]")?t.slice(0,-2):t}function kf(t,e,n){return t?t.concat(e).map(function(s,a){return s=Hh(s),!n&&a?"["+s+"]":s}).join(n?".":""):e}function O3(t){return M.isArray(t)&&!t.some(Do)}const C3=M.toFlatObject(M,{},null,function(e){return/^is[A-Z]/.test(e)});function Ds(t,e,n){if(!M.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=M.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,S){return!M.isUndefined(S[T])});const r=n.metaTokens,s=n.visitor||p,a=n.dots,u=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&M.isSpecCompliantForm(e);if(!M.isFunction(s))throw new TypeError("visitor must be a function");function h(w){if(w===null)return"";if(M.isDate(w))return w.toISOString();if(!f&&M.isBlob(w))throw new me("Blob is not supported. Use a Buffer instead.");return M.isArrayBuffer(w)||M.isTypedArray(w)?f&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function p(w,T,S){let O=w;if(w&&!S&&typeof w=="object"){if(M.endsWith(T,"{}"))T=r?T:T.slice(0,-2),w=JSON.stringify(w);else if(M.isArray(w)&&O3(w)||(M.isFileList(w)||M.endsWith(T,"[]"))&&(O=M.toArray(w)))return T=Hh(T),O.forEach(function(F,U){!(M.isUndefined(F)||F===null)&&e.append(u===!0?kf([T],U,a):u===null?T:T+"[]",h(F))}),!1}return Do(w)?!0:(e.append(kf(S,T,a),h(w)),!1)}const g=[],v=Object.assign(C3,{defaultVisitor:p,convertValue:h,isVisitable:Do});function y(w,T){if(!M.isUndefined(w)){if(g.indexOf(w)!==-1)throw Error("Circular reference detected in "+T.join("."));g.push(w),M.forEach(w,function(O,C){(!(M.isUndefined(O)||O===null)&&s.call(e,O,M.isString(C)?C.trim():C,T,v))===!0&&y(O,T?T.concat(C):[C])}),g.pop()}}if(!M.isObject(t))throw new TypeError("data must be an object");return y(t),e}function Mf(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function eu(t,e){this._pairs=[],t&&Ds(t,this,e)}const qh=eu.prototype;qh.append=function(e,n){this._pairs.push([e,n])};qh.toString=function(e){const n=e?function(r){return e.call(this,r,Mf)}:Mf;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function F3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Wh(t,e,n){if(!e)return t;const r=n&&n.encode||F3;M.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let a;if(s?a=s(e,n):a=M.isURLSearchParams(e)?e.toString():new eu(e,n).toString(r),a){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class Bf{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){M.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Vh={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},A3=typeof URLSearchParams<"u"?URLSearchParams:eu,R3=typeof FormData<"u"?FormData:null,L3=typeof Blob<"u"?Blob:null,_3={isBrowser:!0,classes:{URLSearchParams:A3,FormData:R3,Blob:L3},protocols:["http","https","file","blob","url","data"]},tu=typeof window<"u"&&typeof document<"u",Io=typeof navigator=="object"&&navigator||void 0,U3=tu&&(!Io||["ReactNative","NativeScript","NS"].indexOf(Io.product)<0),k3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",M3=tu&&window.location.href||"http://localhost",B3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tu,hasStandardBrowserEnv:U3,hasStandardBrowserWebWorkerEnv:k3,navigator:Io,origin:M3},Symbol.toStringTag,{value:"Module"})),ct={...B3,..._3};function P3(t,e){return Ds(t,new ct.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return ct.isNode&&M.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function D3(t){return M.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function I3(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function Xh(t){function e(n,r,s,a){let u=n[a++];if(u==="__proto__")return!0;const l=Number.isFinite(+u),f=a>=n.length;return u=!u&&M.isArray(s)?s.length:u,f?(M.hasOwnProp(s,u)?s[u]=[s[u],r]:s[u]=r,!l):((!s[u]||!M.isObject(s[u]))&&(s[u]=[]),e(n,r,s[u],a)&&M.isArray(s[u])&&(s[u]=I3(s[u])),!l)}if(M.isFormData(t)&&M.isFunction(t.entries)){const n={};return M.forEachEntry(t,(r,s)=>{e(D3(r),s,n,0)}),n}return null}function N3(t,e,n){if(M.isString(t))try{return(e||JSON.parse)(t),M.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const vi={transitional:Vh,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,a=M.isObject(e);if(a&&M.isHTMLForm(e)&&(e=new FormData(e)),M.isFormData(e))return s?JSON.stringify(Xh(e)):e;if(M.isArrayBuffer(e)||M.isBuffer(e)||M.isStream(e)||M.isFile(e)||M.isBlob(e)||M.isReadableStream(e))return e;if(M.isArrayBufferView(e))return e.buffer;if(M.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return P3(e,this.formSerializer).toString();if((l=M.isFileList(e))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Ds(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return a||s?(n.setContentType("application/json",!1),N3(e)):e}],transformResponse:[function(e){const n=this.transitional||vi.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(M.isResponse(e)||M.isReadableStream(e))return e;if(e&&M.isString(e)&&(r&&!this.responseType||s)){const u=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(l){if(u)throw l.name==="SyntaxError"?me.from(l,me.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ct.classes.FormData,Blob:ct.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};M.forEach(["delete","get","head","post","put","patch"],t=>{vi.headers[t]={}});const G3=M.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),z3=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(u){s=u.indexOf(":"),n=u.substring(0,s).trim().toLowerCase(),r=u.substring(s+1).trim(),!(!n||e[n]&&G3[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},Pf=Symbol("internals");function Jr(t){return t&&String(t).trim().toLowerCase()}function ys(t){return t===!1||t==null?t:M.isArray(t)?t.map(ys):String(t)}function H3(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const q3=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function wo(t,e,n,r,s){if(M.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!M.isString(e)){if(M.isString(r))return e.indexOf(r)!==-1;if(M.isRegExp(r))return r.test(e)}}function W3(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function V3(t,e){const n=M.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,u){return this[r].call(this,e,s,a,u)},configurable:!0})})}class bt{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function a(l,f,h){const p=Jr(f);if(!p)throw new Error("header name must be a non-empty string");const g=M.findKey(s,p);(!g||s[g]===void 0||h===!0||h===void 0&&s[g]!==!1)&&(s[g||f]=ys(l))}const u=(l,f)=>M.forEach(l,(h,p)=>a(h,p,f));if(M.isPlainObject(e)||e instanceof this.constructor)u(e,n);else if(M.isString(e)&&(e=e.trim())&&!q3(e))u(z3(e),n);else if(M.isHeaders(e))for(const[l,f]of e.entries())a(f,l,r);else e!=null&&a(n,e,r);return this}get(e,n){if(e=Jr(e),e){const r=M.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return H3(s);if(M.isFunction(n))return n.call(this,s,r);if(M.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Jr(e),e){const r=M.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||wo(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function a(u){if(u=Jr(u),u){const l=M.findKey(r,u);l&&(!n||wo(r,r[l],l,n))&&(delete r[l],s=!0)}}return M.isArray(e)?e.forEach(a):a(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const a=n[r];(!e||wo(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){const n=this,r={};return M.forEach(this,(s,a)=>{const u=M.findKey(r,a);if(u){n[u]=ys(s),delete n[a];return}const l=e?W3(a):String(a).trim();l!==a&&delete n[a],n[l]=ys(s),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return M.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&M.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Pf]=this[Pf]={accessors:{}}).accessors,s=this.prototype;function a(u){const l=Jr(u);r[l]||(V3(s,u),r[l]=!0)}return M.isArray(e)?e.forEach(a):a(e),this}}bt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);M.reduceDescriptors(bt.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});M.freezeMethods(bt);function So(t,e){const n=this||vi,r=e||n,s=bt.from(r.headers);let a=r.data;return M.forEach(t,function(l){a=l.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function Yh(t){return!!(t&&t.__CANCEL__)}function Ar(t,e,n){me.call(this,t??"canceled",me.ERR_CANCELED,e,n),this.name="CanceledError"}M.inherits(Ar,me,{__CANCEL__:!0});function Kh(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new me("Request failed with status code "+n.status,[me.ERR_BAD_REQUEST,me.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function X3(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Y3(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,u;return e=e!==void 0?e:1e3,function(f){const h=Date.now(),p=r[a];u||(u=h),n[s]=f,r[s]=h;let g=a,v=0;for(;g!==s;)v+=n[g++],g=g%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),h-u<e)return;const y=p&&h-p;return y?Math.round(v*1e3/y):void 0}}function K3(t,e){let n=0,r=1e3/e,s,a;const u=(h,p=Date.now())=>{n=p,s=null,a&&(clearTimeout(a),a=null),t.apply(null,h)};return[(...h)=>{const p=Date.now(),g=p-n;g>=r?u(h,p):(s=h,a||(a=setTimeout(()=>{a=null,u(s)},r-g)))},()=>s&&u(s)]}const Ls=(t,e,n=3)=>{let r=0;const s=Y3(50,250);return K3(a=>{const u=a.loaded,l=a.lengthComputable?a.total:void 0,f=u-r,h=s(f),p=u<=l;r=u;const g={loaded:u,total:l,progress:l?u/l:void 0,bytes:f,rate:h||void 0,estimated:h&&l&&p?(l-u)/h:void 0,event:a,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(g)},n)},Df=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},If=t=>(...e)=>M.asap(()=>t(...e)),Z3=ct.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,ct.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(ct.origin),ct.navigator&&/(msie|trident)/i.test(ct.navigator.userAgent)):()=>!0,$3=ct.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const u=[t+"="+encodeURIComponent(e)];M.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),M.isString(r)&&u.push("path="+r),M.isString(s)&&u.push("domain="+s),a===!0&&u.push("secure"),document.cookie=u.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function J3(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Q3(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Zh(t,e){return t&&!J3(e)?Q3(t,e):e}const Nf=t=>t instanceof bt?{...t}:t;function er(t,e){e=e||{};const n={};function r(h,p,g,v){return M.isPlainObject(h)&&M.isPlainObject(p)?M.merge.call({caseless:v},h,p):M.isPlainObject(p)?M.merge({},p):M.isArray(p)?p.slice():p}function s(h,p,g,v){if(M.isUndefined(p)){if(!M.isUndefined(h))return r(void 0,h,g,v)}else return r(h,p,g,v)}function a(h,p){if(!M.isUndefined(p))return r(void 0,p)}function u(h,p){if(M.isUndefined(p)){if(!M.isUndefined(h))return r(void 0,h)}else return r(void 0,p)}function l(h,p,g){if(g in e)return r(h,p);if(g in t)return r(void 0,h)}const f={url:a,method:a,data:a,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:l,headers:(h,p,g)=>s(Nf(h),Nf(p),g,!0)};return M.forEach(Object.keys(Object.assign({},t,e)),function(p){const g=f[p]||s,v=g(t[p],e[p],p);M.isUndefined(v)&&g!==l||(n[p]=v)}),n}const $h=t=>{const e=er({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:u,auth:l}=e;e.headers=u=bt.from(u),e.url=Wh(Zh(e.baseURL,e.url),t.params,t.paramsSerializer),l&&u.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let f;if(M.isFormData(n)){if(ct.hasStandardBrowserEnv||ct.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((f=u.getContentType())!==!1){const[h,...p]=f?f.split(";").map(g=>g.trim()).filter(Boolean):[];u.setContentType([h||"multipart/form-data",...p].join("; "))}}if(ct.hasStandardBrowserEnv&&(r&&M.isFunction(r)&&(r=r(e)),r||r!==!1&&Z3(e.url))){const h=s&&a&&$3.read(a);h&&u.set(s,h)}return e},j3=typeof XMLHttpRequest<"u",eT=j3&&function(t){return new Promise(function(n,r){const s=$h(t);let a=s.data;const u=bt.from(s.headers).normalize();let{responseType:l,onUploadProgress:f,onDownloadProgress:h}=s,p,g,v,y,w;function T(){y&&y(),w&&w(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let S=new XMLHttpRequest;S.open(s.method.toUpperCase(),s.url,!0),S.timeout=s.timeout;function O(){if(!S)return;const F=bt.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),_={data:!l||l==="text"||l==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:F,config:t,request:S};Kh(function(V){n(V),T()},function(V){r(V),T()},_),S=null}"onloadend"in S?S.onloadend=O:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(O)},S.onabort=function(){S&&(r(new me("Request aborted",me.ECONNABORTED,t,S)),S=null)},S.onerror=function(){r(new me("Network Error",me.ERR_NETWORK,t,S)),S=null},S.ontimeout=function(){let U=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const _=s.transitional||Vh;s.timeoutErrorMessage&&(U=s.timeoutErrorMessage),r(new me(U,_.clarifyTimeoutError?me.ETIMEDOUT:me.ECONNABORTED,t,S)),S=null},a===void 0&&u.setContentType(null),"setRequestHeader"in S&&M.forEach(u.toJSON(),function(U,_){S.setRequestHeader(_,U)}),M.isUndefined(s.withCredentials)||(S.withCredentials=!!s.withCredentials),l&&l!=="json"&&(S.responseType=s.responseType),h&&([v,w]=Ls(h,!0),S.addEventListener("progress",v)),f&&S.upload&&([g,y]=Ls(f),S.upload.addEventListener("progress",g),S.upload.addEventListener("loadend",y)),(s.cancelToken||s.signal)&&(p=F=>{S&&(r(!F||F.type?new Ar(null,t,S):F),S.abort(),S=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const C=X3(s.url);if(C&&ct.protocols.indexOf(C)===-1){r(new me("Unsupported protocol "+C+":",me.ERR_BAD_REQUEST,t));return}S.send(a||null)})},tT=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(h){if(!s){s=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof me?p:new Ar(p instanceof Error?p.message:p))}};let u=e&&setTimeout(()=>{u=null,a(new me(`timeout ${e} of ms exceeded`,me.ETIMEDOUT))},e);const l=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),t=null)};t.forEach(h=>h.addEventListener("abort",a));const{signal:f}=r;return f.unsubscribe=()=>M.asap(l),f}},nT=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},rT=async function*(t,e){for await(const n of iT(t))yield*nT(n,e)},iT=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},Gf=(t,e,n,r)=>{const s=rT(t,e);let a=0,u,l=f=>{u||(u=!0,r&&r(f))};return new ReadableStream({async pull(f){try{const{done:h,value:p}=await s.next();if(h){l(),f.close();return}let g=p.byteLength;if(n){let v=a+=g;n(v)}f.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel(f){return l(f),s.return()}},{highWaterMark:2})},Is=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Jh=Is&&typeof ReadableStream=="function",sT=Is&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Qh=(t,...e)=>{try{return!!t(...e)}catch{return!1}},aT=Jh&&Qh(()=>{let t=!1;const e=new Request(ct.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),zf=64*1024,No=Jh&&Qh(()=>M.isReadableStream(new Response("").body)),_s={stream:No&&(t=>t.body)};Is&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!_s[e]&&(_s[e]=M.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new me(`Response type '${e}' is not supported`,me.ERR_NOT_SUPPORT,r)})})})(new Response);const oT=async t=>{if(t==null)return 0;if(M.isBlob(t))return t.size;if(M.isSpecCompliantForm(t))return(await new Request(ct.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(M.isArrayBufferView(t)||M.isArrayBuffer(t))return t.byteLength;if(M.isURLSearchParams(t)&&(t=t+""),M.isString(t))return(await sT(t)).byteLength},uT=async(t,e)=>{const n=M.toFiniteNumber(t.getContentLength());return n??oT(e)},lT=Is&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:u,onDownloadProgress:l,onUploadProgress:f,responseType:h,headers:p,withCredentials:g="same-origin",fetchOptions:v}=$h(t);h=h?(h+"").toLowerCase():"text";let y=tT([s,a&&a.toAbortSignal()],u),w;const T=y&&y.unsubscribe&&(()=>{y.unsubscribe()});let S;try{if(f&&aT&&n!=="get"&&n!=="head"&&(S=await uT(p,r))!==0){let _=new Request(e,{method:"POST",body:r,duplex:"half"}),z;if(M.isFormData(r)&&(z=_.headers.get("content-type"))&&p.setContentType(z),_.body){const[V,q]=Df(S,Ls(If(f)));r=Gf(_.body,zf,V,q)}}M.isString(g)||(g=g?"include":"omit");const O="credentials"in Request.prototype;w=new Request(e,{...v,signal:y,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:r,duplex:"half",credentials:O?g:void 0});let C=await fetch(w);const F=No&&(h==="stream"||h==="response");if(No&&(l||F&&T)){const _={};["status","statusText","headers"].forEach(K=>{_[K]=C[K]});const z=M.toFiniteNumber(C.headers.get("content-length")),[V,q]=l&&Df(z,Ls(If(l),!0))||[];C=new Response(Gf(C.body,zf,V,()=>{q&&q(),T&&T()}),_)}h=h||"text";let U=await _s[M.findKey(_s,h)||"text"](C,t);return!F&&T&&T(),await new Promise((_,z)=>{Kh(_,z,{data:U,headers:bt.from(C.headers),status:C.status,statusText:C.statusText,config:t,request:w})})}catch(O){throw T&&T(),O&&O.name==="TypeError"&&/fetch/i.test(O.message)?Object.assign(new me("Network Error",me.ERR_NETWORK,t,w),{cause:O.cause||O}):me.from(O,O&&O.code,t,w)}}),Go={http:E3,xhr:eT,fetch:lT};M.forEach(Go,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Hf=t=>`- ${t}`,cT=t=>M.isFunction(t)||t===null||t===!1,jh={getAdapter:t=>{t=M.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let u;if(r=n,!cT(n)&&(r=Go[(u=String(n)).toLowerCase()],r===void 0))throw new me(`Unknown adapter '${u}'`);if(r)break;s[u||"#"+a]=r}if(!r){const a=Object.entries(s).map(([l,f])=>`adapter ${l} `+(f===!1?"is not supported by the environment":"is not available in the build"));let u=e?a.length>1?`since :
`+a.map(Hf).join(`
`):" "+Hf(a[0]):"as no adapter specified";throw new me("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return r},adapters:Go};function To(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ar(null,t)}function qf(t){return To(t),t.headers=bt.from(t.headers),t.data=So.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),jh.getAdapter(t.adapter||vi.adapter)(t).then(function(r){return To(t),r.data=So.call(t,t.transformResponse,r),r.headers=bt.from(r.headers),r},function(r){return Yh(r)||(To(t),r&&r.response&&(r.response.data=So.call(t,t.transformResponse,r.response),r.response.headers=bt.from(r.response.headers))),Promise.reject(r)})}const ep="1.7.8",Ns={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ns[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Wf={};Ns.transitional=function(e,n,r){function s(a,u){return"[Axios v"+ep+"] Transitional option '"+a+"'"+u+(r?". "+r:"")}return(a,u,l)=>{if(e===!1)throw new me(s(u," has been removed"+(n?" in "+n:"")),me.ERR_DEPRECATED);return n&&!Wf[u]&&(Wf[u]=!0,console.warn(s(u," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(a,u,l):!0}};Ns.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function fT(t,e,n){if(typeof t!="object")throw new me("options must be an object",me.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],u=e[a];if(u){const l=t[a],f=l===void 0||u(l,a,t);if(f!==!0)throw new me("option "+a+" must be "+f,me.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new me("Unknown option "+a,me.ERR_BAD_OPTION)}}const xs={assertOptions:fT,validators:Ns},tn=xs.validators;class Qn{constructor(e){this.defaults=e,this.interceptors={request:new Bf,response:new Bf}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const a=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=er(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:a}=n;r!==void 0&&xs.assertOptions(r,{silentJSONParsing:tn.transitional(tn.boolean),forcedJSONParsing:tn.transitional(tn.boolean),clarifyTimeoutError:tn.transitional(tn.boolean)},!1),s!=null&&(M.isFunction(s)?n.paramsSerializer={serialize:s}:xs.assertOptions(s,{encode:tn.function,serialize:tn.function},!0)),xs.assertOptions(n,{baseUrl:tn.spelling("baseURL"),withXsrfToken:tn.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=a&&M.merge(a.common,a[n.method]);a&&M.forEach(["delete","get","head","post","put","patch","common"],w=>{delete a[w]}),n.headers=bt.concat(u,a);const l=[];let f=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(n)===!1||(f=f&&T.synchronous,l.unshift(T.fulfilled,T.rejected))});const h=[];this.interceptors.response.forEach(function(T){h.push(T.fulfilled,T.rejected)});let p,g=0,v;if(!f){const w=[qf.bind(this),void 0];for(w.unshift.apply(w,l),w.push.apply(w,h),v=w.length,p=Promise.resolve(n);g<v;)p=p.then(w[g++],w[g++]);return p}v=l.length;let y=n;for(g=0;g<v;){const w=l[g++],T=l[g++];try{y=w(y)}catch(S){T.call(this,S);break}}try{p=qf.call(this,y)}catch(w){return Promise.reject(w)}for(g=0,v=h.length;g<v;)p=p.then(h[g++],h[g++]);return p}getUri(e){e=er(this.defaults,e);const n=Zh(e.baseURL,e.url);return Wh(n,e.params,e.paramsSerializer)}}M.forEach(["delete","get","head","options"],function(e){Qn.prototype[e]=function(n,r){return this.request(er(r||{},{method:e,url:n,data:(r||{}).data}))}});M.forEach(["post","put","patch"],function(e){function n(r){return function(a,u,l){return this.request(er(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:u}))}}Qn.prototype[e]=n(),Qn.prototype[e+"Form"]=n(!0)});class nu{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(a){n=a});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const u=new Promise(l=>{r.subscribe(l),a=l}).then(s);return u.cancel=function(){r.unsubscribe(a)},u},e(function(a,u,l){r.reason||(r.reason=new Ar(a,u,l),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new nu(function(s){e=s}),cancel:e}}}function hT(t){return function(n){return t.apply(null,n)}}function pT(t){return M.isObject(t)&&t.isAxiosError===!0}const zo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zo).forEach(([t,e])=>{zo[e]=t});function tp(t){const e=new Qn(t),n=Uh(Qn.prototype.request,e);return M.extend(n,Qn.prototype,e,{allOwnKeys:!0}),M.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return tp(er(t,s))},n}const Ke=tp(vi);Ke.Axios=Qn;Ke.CanceledError=Ar;Ke.CancelToken=nu;Ke.isCancel=Yh;Ke.VERSION=ep;Ke.toFormData=Ds;Ke.AxiosError=me;Ke.Cancel=Ke.CanceledError;Ke.all=function(e){return Promise.all(e)};Ke.spread=hT;Ke.isAxiosError=pT;Ke.mergeConfig=er;Ke.AxiosHeaders=bt;Ke.formToJSON=t=>Xh(M.isHTMLForm(t)?new FormData(t):t);Ke.getAdapter=jh.getAdapter;Ke.HttpStatusCode=zo;Ke.default=Ke;Ke.interceptors.response.use(function(t){return t.data},function(t){return Promise.reject(t)});function Vf(){const[t,e,n,r]=Array.from(arguments);return[t/255,e/255,n/255,r]}class dT{constructor({device:e,scene:n,common:r,canvas:s,format:a,context:u}={}){this.device=e,this.scene=n,this.common=r,this.format=a,this.canvas=s,this.context=u,this.multisample=!0}async init(){let e=await Ke.get("file/shapes05-complicated.svg");this.meshes=[{id:Gy(),coords:[300,300],anchor:[0,0],color:Vf(255,255,255,1),scale:[4,4],svgData:e,svgData:'<path d="M0,0l0,163.1s-73.6-111.4,115.6-72.5,68.3-77.8,68.3-77.8Z"/>',borderColor:Vf(0,150,255,.4),borderWidth:20,borderStyle:"solid",borderCorner:"mitered"}],this.meshes&&this.meshes.forEachDeep(this.createMeshBuffer.bind(this)),this.uniformBuffer=this.device.createBuffer({size:4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.bindGroupLayouts=[this.device.createBindGroupLayout({entries:[{binding:0,buffer:{type:"uniform"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}]})],this.bindGroups=[this.device.createBindGroup({layout:this.bindGroupLayouts[0],entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]})],this.pipeline=await this.device.createRenderPipelineAsync({layout:this.device.createPipelineLayout({bindGroupLayouts:this.bindGroupLayouts}),vertex:{module:this.device.createShaderModule({code:Lf}),entryPoint:"main_vert",buffers:this.vertexBufferLayout},fragment:{module:this.device.createShaderModule({code:Lf}),entryPoint:"main_frag",targets:[{format:this.format,writeMask:GPUColorWrite.ALL,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"},multisample:{count:this.multisample?4:1}}),this.test7()}createMeshBuffer(e){const{color:n,svgData:r,coords:s,anchor:a,scale:u,borderColor:l,borderWidth:f=0,borderCorner:h}=e,p=new Qo(r),g=30,{vertices:v,normals:y,uvs:w,indices:T}=e.geometry=p.getGeometry(g),S=this.transform(v,s,a,u);if(e.vertexBuffer=this.createVertexBuffer(S,y,w,n),e.indexBuffer=this.createIndexBuffer(T),f!=0){const{vertices:O,normals:C,uvs:F,indices:U}=e.borderGeometry=p.getBorderGeometry(f,g,h),_=this.transform(O,s,a,u);e.borderVertexBuffer=this.createVertexBuffer(_,C,F,l),e.borderIndexBuffer=this.createIndexBuffer(U)}}getVertexBufferLayout(e=[]){let n=0;const r=e.reduce((a,u)=>a+u,0)*4,s=e.map((a,u)=>{const l={shaderLocation:u,offset:n,format:`float32x${a}`};return n+=a*4,l});return[{arrayStride:r,attributes:s}]}createVertexBuffer(e,n,r,...s){e=ei(e,3),n=ei(n,3),r=ei(r,2);const a=e.map((l,f)=>{const h=[l,n[f],r[f],...s];return this.vertexLayout=h.map(p=>p.length),h}).flat(2);this.vertexBufferLayout=this.getVertexBufferLayout(this.vertexLayout);const u=new Float32Array(a);return this.createMappedBuffer({size:u.byteLength,usage:GPUBufferUsage.VERTEX,source:u,typedArray:Float32Array})}createIndexBuffer(e){const n=new Uint32Array(e);return this.createMappedBuffer({size:n.byteLength,usage:GPUBufferUsage.INDEX,source:n,typedArray:Uint32Array})}createMappedBuffer({size:e=0,usage:n=GPUBufferUsage.VERTEX,source:r,typedArray:s=Float32Array}={}){const a=this.device.createBuffer({size:e,usage:n,mappedAtCreation:!0});return new s(a.getMappedRange()).set(r),a.unmap(),a}writeBuffer({buffer:e,index:n,values:r}={}){this.device.queue.writeBuffer(e,n,new Float32Array(r))}transform(e,n=[0,0],r=[0,0],s=[1,1]){const a=[...n,0],u=[...r,0],l=[...s,1],f=ei(e,3);let h=[];for(let p=0;p<3;p++){let g=f.map(w=>w[p]),v=Math.max(...g),y=Math.min(...g);h.push(v-y)}return f.map(p=>p.map((g,v)=>g*l[v]+a[v]-u[v]*h[v]*l[v])).flat()}runPass(e,n){if(this.meshes.length!=0){this.writeBuffer({buffer:this.uniformBuffer,index:0,values:[this.canvas.width,this.canvas.height]});{const r=e.beginRenderPass({colorAttachments:[{view:this.multisample?n:this.context.getCurrentTexture().createView(),resolveTarget:this.multisample?this.context.getCurrentTexture().createView():void 0,clearValue:[0,0,0,1],loadOp:"load",storeOp:"store"}]});r.setPipeline(this.pipeline),r.setBindGroup(0,this.bindGroups[0]),this.meshes.forEachDeep(s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(parseInt(s.indexBuffer.size/4),1,0,0,0),s.borderWidth!=0&&(r.setVertexBuffer(0,s.borderVertexBuffer),r.setIndexBuffer(s.borderIndexBuffer,"uint32"),r.drawIndexed(parseInt(s.borderIndexBuffer.size/4),1,0,0,0))}),r.end()}}}test(){const e=new ze(new H(0,100),new H(0,0),new H(100,300),new H(100,100)),n=e.aDerivative2();console.log("%cDE: ","color:pink",n);const r=1e3;for(let s=0;s<=r;s++){const a=(s/r).toFixed(3),u=e.derivative(s/r).toFixed(4),l=e.derivative2(s/r).toFixed(4);e.tangent(s/r),console.log(`%c${a}`,"color: yellowgreen",u,l)}}test2(){const e=new ze(new H(100,0),new H(100,200),new H(50,300),new H(0,300)),n=e.offset2(100);console.log("c1:",e),console.log("c2:",n);let r=0;const s=.25,a=e.derivative(s),u=e.lerp(s).translate(e.normal(s),100).valueOf(),l=n.aDerivative(a),f=n.lerp(l[0]).valueOf(),h=_h(rt(u,f));r+=h,console.log("t1:",s,"p1:",u,"p2:",f,"distance:",h),console.log("total:",r)}test3(){const e=new ze(new H(100,0),new H(100,200),new H(50,300),new H(0,300)).toReversed(),r=e.offset3(50);console.log("c1:",e),console.log("c2:",r)}test4(){const n=new ze(new H(0,100),new H(0,0),new H(100,300),new H(100,100)).splitToArcs();console.log("圆弧:",n);const r=n.flatMap((s,a)=>{const u=s.offset3(10);return console.log(a,u),u});console.log("outlines:",r)}test5(){const n=new ze(new H(0,0),new H(0,-100),new H(100,160),new H(100,0)).outlineShape(30);console.log("outlineShape:",n.map(r=>r.points.map(s=>s.valueOf())))}test6(){const e=new ze(new H(500,300),new H(500,300),new H(700,400),new H(500,400)),n=e.aCurvature(1/10);console.log(n),console.log(n.filter(r=>Math.abs(e.curvature(r)-1/10)<1e-4)),console.log(e.split(...n))}test7(){const e=new te(new H(0,0),new H(100,0));console.log(e instanceof te),console.log(e instanceof ot)}}const vT=`const red = vec3f(1,0,0);\r
const green = vec3f(0,1,0);\r
const blue = vec3f(0,0,1);\r
const yellow = vec3f(1,1,0);\r
const purple = vec3f(1,0,1);\r
const cyan = vec3f(0,1,1);\r
\r
const pi = 3.14159265359;\r
const kNoHit = 0xffffffff; // Value for Hit.index if no intersection occured.\r
\r
var<private> rnd : vec3<u32>;\r
\r
struct Scene {\r
    lightViewProjection: mat4x4<f32>,\r
    cameraViewProjection: mat4x4<f32>,\r
    center: vec4<f32>,\r
    lightPos: vec4<f32>,\r
    cameraPos: vec4<f32>,\r
    resolution: vec2<f32>,\r
    mouse: vec4<f32>,\r
    time: f32,\r
    date: vec4<f32>,\r
    fovy: f32,\r
    seed: vec3<u32>,\r
}\r
\r
struct Instance {\r
    modelTransform: mat4x4<f32>,\r
    color: vec4<f32>\r
}\r
\r
struct Triangle {\r
    a:                  vec3<f32>,   \r
    b:                  vec3<f32>,   \r
    c:                  vec3<f32>,   \r
    color:              vec3<f32>,\r
    instance_index:     f32,\r
}\r
\r
struct Ray {\r
    start : vec3<f32>,\r
    dir   : vec3<f32>,\r
}\r
\r
struct Plane {\r
    point: vec3<f32>,   // 平面内任意一点\r
    normal: vec3<f32>,  // 平面法线, 单位向量\r
}\r
\r
struct Hit { \r
    dist : f32,\r
    index : u32,\r
    pos : vec3<f32>,\r
    uv : vec2<f32>,\r
}\r
\r
// Initializes the random number generator.\r
fn init_rand(invocation_id : vec3<u32>) {\r
    const A = vec3(\r
        1741651 * 1009,\r
        140893  * 1609 * 13,\r
        6521    * 983  * 7 * 2\r
    );\r
    rnd = (invocation_id * A) ^ scene.seed;\r
}\r
\r
// 随机数，每一个线程调用都不一样 [0,1]\r
// Returns a random number between 0 and 1\r
fn rand() -> f32 {\r
    const C = vec3(\r
        60493  * 9377,\r
        11279  * 2539 * 23,\r
        7919   * 631  * 5 * 3\r
    );\r
    rnd = (rnd * C) ^ (rnd >> vec3(1));\r
    return f32(rnd.x ^ rnd.z) / f32(0xffffffff);\r
}\r
\r
// 在指定的球内，返回一个随机点\r
// Returns a random point within a sphere with certain radius and center.\r
fn rand_sphere(\r
    c: vec3<f32>,   // center\r
    r: f32,         // radius\r
) -> vec3<f32> {\r
    let x = (rand() * 2 - 1) * r;\r
    let y = (rand() * 2 - 1) * r;\r
    let z = (rand() * 2 - 1) * r;\r
    let p = vec3(x, y, z) + c;\r
    let l = length(p);\r
    return p  * max(max(abs(x), abs(y)), abs(z)) / l;\r
}\r
\r
// 在指定的半球内，返回一个随机点\r
fn rand_hemisphere(\r
    c: vec2<f32>,   // center\r
    r: f32,         // radius\r
    n: vec3<f32>    // normal\r
) -> vec3<f32> {\r
    let p = rand_circle(c, r);\r
    let z = sqrt(r * r - p.x * p.x - p.y * p.y);\r
    let N = normalize(n);\r
    let axis = normalize(cross(vec3(0, 0, 1), N));\r
    let angle = acos(dot(vec3(0, 0, 1), N));\r
    let m = fromRotation(angle, axis);\r
    return (m * vec4f(p,z,1.0)).xyz;\r
}\r
\r
fn rand_circle(\r
    c: vec2<f32>,   // center\r
    r: f32          // radius\r
) -> vec2<f32> {\r
    let x = (rand() * 2 - 1) * r;\r
    let y = (rand() * 2 - 1) * r;\r
    let p = vec2(x, y) + c;\r
    let l = length(p);\r
    return p  * max(abs(x), abs(y)) / l;\r
}\r
\r
// mat4.fromRotation\r
fn fromRotation(\r
    rad: f32,\r
    axis: vec3<f32>\r
) -> mat4x4<f32>{\r
    let len = length(axis);\r
    let x = axis.x / len;\r
    let y = axis.y / len;\r
    let z = axis.z/ len;\r
    let s = sin(rad);\r
    let c = cos(rad);\r
    let t = 1 - c;\r
    return  mat4x4<f32>(\r
        x * x * t + c,\r
        y * x * t + z * s,\r
        z * x * t - y * s,\r
        0,\r
        x * y * t - z * s,\r
        y * y * t + c,\r
        z * y * t + x * s,\r
        0,\r
        x * z * t + y * s,\r
        y * z * t - x * s,\r
        z * z * t + c,\r
        0,\r
        0,\r
        0,\r
        0,\r
        1\r
    );\r
}\r
\r
fn getShadow(\r
    posFromLight: vec3<f32>,\r
    shadowMap: texture_depth_2d,\r
    shadowSampler: sampler_comparison,\r
) -> f32 {\r
    let shadowMapSize = f32(textureDimensions(shadowMap).x); // 阴影纹理大小\r
    let shadowPos: vec3<f32> = vec3<f32>(\r
        posFromLight.x * 0.5 + 0.5,\r
        -posFromLight.y * 0.5 + 0.5,\r
        posFromLight.z\r
    ); // 阴影纹理坐标转换\r
    var shadow: f32 = 0.0;\r
    // PCF(percentage filtering)\r
    for (var y: i32 = -1; y <= 1; y++) {\r
        for (var x: i32 = -1; x <= 1; x++) {\r
            let offset = vec2<f32>(f32(x) / shadowMapSize, f32(y) / shadowMapSize);\r
            shadow += textureSampleCompare(\r
                shadowMap,\r
                shadowSampler,\r
                shadowPos.xy + offset,\r
                shadowPos.z - 0.00005\r
            ); // shadow bias: 0.0001\r
        }\r
    }\r
    shadow /= 9.0;\r
    return shadow;\r
}\r
\r
fn transform(\r
    t: Triangle\r
) -> Triangle{\r
    let m: mat4x4<f32> = instances[u32(t.instance_index)].modelTransform;\r
    return Triangle(\r
        (m * vec4f(t.a, 1.0)).xyz,\r
        (m * vec4f(t.b, 1.0)).xyz,   \r
        (m * vec4f(t.c, 1.0)).xyz,    \r
        t.color,\r
        t.instance_index,\r
    );\r
}\r
\r
// 求点到平面距离\r
fn distFromPlane(\r
    v: vec3<f32>,   // 任意一点\r
    p: Plane        // 平面\r
) -> f32 {\r
    return dot(v - p.point, p.normal);\r
}\r
\r
// 求线与平面交点\r
fn intersect(\r
    r: Ray,         // 射线, 需射向平面\r
    p: Plane        // 平面\r
) -> vec3<f32> {\r
    let plane_dist = distFromPlane(r.start, p);\r
    let unit_dist = dot(r.dir, -p.normal); \r
    let ray_dist = plane_dist / unit_dist;\r
    return r.start + r.dir * ray_dist;\r
}\r
\r
// 点是否在三角形内(包含边界)\r
fn insideTriangle(\r
    p: vec3<f32>,\r
    t: Triangle\r
) -> bool {\r
    let A = t.a;\r
    let B = t.b;\r
    let C = t.c;\r
    let AB = B - A;\r
    let BC = C - B;\r
    let CA = A - C;\r
    let N = normalize(cross(AB, BC));\r
    let N1 = normalize(cross(AB, p - A));\r
    let N2 = normalize(cross(BC, p - B));\r
    let N3 = normalize(cross(CA, p - C));\r
    let dot1 = dot(N, N1);\r
    let dot2 = dot(N, N2);\r
    let dot3 = dot(N, N3);\r
    if (dot1 < 0 || dot2 < 0 || dot3 < 0){\r
        return false;\r
    }else{\r
        return true;\r
    }\r
}\r
\r
// 点是否在三角形内(包含边界)\r
fn pointInTriangle(\r
    p: vec3<f32>,\r
    t: Triangle\r
) -> bool {\r
    let w = barycentric(p, t.a, t.b, t.c);\r
    return w.x + w.y + w.z <= 1;\r
}\r
\r
// uv插值\r
fn interpolateUV(\r
    p: vec3<f32>,\r
    t: Triangle,\r
    uv_a: vec2<f32>,\r
    uv_b: vec2<f32>,\r
    uv_c: vec2<f32>,\r
) -> vec2<f32> {\r
    let w = barycentric(p, t.a, t.b, t.c);\r
    let U = vec3f(uv_a.x, uv_b.x, uv_c.x);\r
    let V = vec3f(uv_a.y, uv_b.y, uv_c.y);\r
    let UP = dot(U, w);\r
    let VP = dot(V, w);\r
    return vec2<f32>(UP, VP);\r
}\r
\r
// 重心坐标\r
fn barycentric(\r
    p: vec3<f32>,\r
    a: vec3<f32>,\r
    b: vec3<f32>,\r
    c: vec3<f32>,\r
) -> vec3f{\r
    let ab = b - a;\r
    let bc = c - b;\r
    let ca = a - c;\r
    let ba = a - b;\r
    let cb = b - c;\r
    let ac = c - a;\r
    let ap = p - a;\r
    let bp = p - b;\r
    let cp = p - c;\r
    let wa = length(cross(normalize(bc), bp)) / length(cross(normalize(bc), ba));\r
    let wb = length(cross(normalize(ca), cp)) / length(cross(normalize(ca), cb));\r
    let wc = length(cross(normalize(ab), ap)) / length(cross(normalize(ab), ac));\r
    return vec3f(wa, wb, wc);\r
}\r
\r
// 返回纹素的基本元素索引\r
fn texelIndex(\r
    t: texture_storage_2d_array<rgba16float, write>,\r
    c : vec2<u32>,                                      // texel_coords\r
    i : u32,                                            // array layer index\r
) -> u32 {\r
    let dims = textureDimensions(t);\r
    //let c = min(vec2<u32>(dims) - 1, texel_coords);\r
    return 3 * (c.x + c.y * dims.x + dims.x * dims.y * i);\r
}`;class gT{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}getMipmapPipeline(e){let n=this.pipelines[e];return n||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({label:"Mipmap Generator",code:`
            var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
              vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));
            struct VertexOutput {
              @builtin(position) position : vec4<f32>,
              @location(0) texCoord : vec2<f32>,
            };
            @vertex
            fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
              var output : VertexOutput;
              output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
              output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
              return output;
            }
            @group(0) @binding(0) var imgSampler : sampler;
            @group(0) @binding(1) var img : texture_2d<f32>;
            @fragment
            fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
              return textureSample(img, imgSampler, texCoord);
            }
          `}),this.bindGroupLayout=this.device.createBindGroupLayout({label:"Mipmap Generator",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.pipelineLayout=this.device.createPipelineLayout({label:"Mipmap Generator",bindGroupLayouts:[this.bindGroupLayout]})),n=this.device.createRenderPipeline({layout:this.pipelineLayout,vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=n),n}generateMipmap(e){const n=this.getMipmapPipeline(e.format);if(e.dimension=="3d"||e.dimension=="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=e;const s=e.depthOrArrayLayers||1,a=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!a){const l={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:s},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};r=this.device.createTexture(l)}const u=this.device.createCommandEncoder({});for(let l=0;l<s;++l){let f=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),h=a?1:0;for(let p=1;p<e.mipLevelCount;++p){const g=r.createView({baseMipLevel:h++,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),v=u.beginRenderPass({colorAttachments:[{view:g,loadOp:"clear",storeOp:"store"}]}),y=this.device.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:this.sampler},{binding:1,resource:f}]});v.setPipeline(n),v.setBindGroup(0,y),v.draw(3,1,0,0),v.end(),f=g}}if(!a){const l={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:s};for(let f=1;f<e.mipLevelCount;++f)u.copyTextureToTexture({texture:r,mipLevel:f-1},{texture:e,mipLevel:f},l),l.width=Math.ceil(l.width/2),l.height=Math.ceil(l.height/2)}return this.device.queue.submit([u.finish()]),a||r.destroy(),e}}class mT{constructor({device:e,scene:n,canvas:r,mouse:s}={}){this.device=e,this.scene=n,this.canvas=r,this.mouse=s}async init(){this.uniformBuffer=this.device.createBuffer({size:17*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.instanceBuffer=this.device.createBuffer({label:"instance",size:5*4*4*this.scene.instances.length,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});const e=[{binding:0,buffer:{type:"uniform"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE},{binding:1,buffer:{type:"read-only-storage"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE},{binding:2,buffer:{type:"read-only-storage"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE}],n=[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.instanceBuffer}},{binding:2,resource:{buffer:this.scene.triangleBuffer}}];let r=`
@group(0) @binding(0) var<uniform> scene: Scene;
@group(0) @binding(1) var<storage> instances: array<Instance>;
@group(0) @binding(2) var<storage> triangles: array<Triangle>;`;this.bindGroupLayout=this.device.createBindGroupLayout({label:"common",entries:e}),this.bindGroup=this.device.createBindGroup({label:"common",layout:this.bindGroupLayout,entries:n}),this.shader=r+vT}update(e){const n=this.instanceBuffer.size/this.scene.instances.length/4;this.device.queue.writeBuffer(this.instanceBuffer,0,this.scene.instances.reduce((s,a,u)=>(s.set(We.getModelTransformMatrix(a),u*n),s.set(Object.values(We.colorFormat(a.color)),u*n+4*4),s),new Float32Array(this.instanceBuffer.size/4))),this.device.queue.writeBuffer(this.uniformBuffer,0,We.getLightViewProjectionMatrix({light:this.scene.light,center:this.scene.center,up:this.scene.up,left:-10,right:10,bottom:-10,top:10,near:0,far:300})),this.device.queue.writeBuffer(this.uniformBuffer,16*4,We.getCameraViewProjectionMatrix({aspect:this.canvas.width/this.canvas.height,eye:this.scene.eye,center:this.scene.center,up:this.scene.up,fovy:this.scene.fovy,near:.1,far:1e5})),this.device.queue.writeBuffer(this.uniformBuffer,32*4,new Float32Array(this.scene.center)),this.device.queue.writeBuffer(this.uniformBuffer,36*4,new Float32Array(this.scene.light)),this.device.queue.writeBuffer(this.uniformBuffer,40*4,new Float32Array(this.scene.eye)),this.device.queue.writeBuffer(this.uniformBuffer,44*4,new Float32Array([this.canvas.width,this.canvas.height])),this.device.queue.writeBuffer(this.uniformBuffer,48*4,new Float32Array([0,0,0,0])),this.device.queue.writeBuffer(this.uniformBuffer,52*4,new Float32Array([e/1e3])),this.device.queue.writeBuffer(this.uniformBuffer,56*4,new Float32Array([new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate(),new Date().getHours()*3600+new Date().getMinutes()*60+new Date().getSeconds()])),this.device.queue.writeBuffer(this.uniformBuffer,60*4,new Float32Array([this.scene.fovy]));const r=[4294967295*Math.random(),4294967295*Math.random(),4294967295*Math.random()];this.device.queue.writeBuffer(this.uniformBuffer,64*4,new Uint32Array(r))}async createBitmapTexture({url:e,label:n="",format:r="rgba8unorm",sampleCount:s=1,usage:a=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}={}){const u=Array.isArray(e)?await Promise.all(e.map(y=>this.getBitmap(y))):await this.getBitmap(e),l=Array.isArray(e)?u[0].width:u.width,f=Array.isArray(e)?u[0].height:u.height,h=[l,f,Array.isArray(e)?u.length:1],p=this.device.createTexture({label:n,size:h,format:r,mipLevelCount:Math.floor(Math.log2(l))+1,sampleCount:s,usage:a});return[u].flat().forEach((y,w)=>{this.device.queue.copyExternalImageToTexture({source:y},{texture:p,origin:[0,0,w]},[y.width,y.height])}),new gT(this.device).generateMipmap(p)}async getBitmap(e){let n=await fetch(e),r=await n.blob();return await createImageBitmap(r)}}const Xf=`\r
// bindings added in rasterizer.js\r
\r
struct VertexInput {\r
    @builtin(instance_index) index: u32,\r
    @location(0) position : vec3f,\r
    @location(1) normal : vec3f,\r
    @location(2) uv : vec2f,\r
    @location(3) color : vec4f,\r
    @location(4) emissive : f32,\r
    @location(5) triangle_index : f32,\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) Position: vec4<f32>,\r
    @location(0) posFromLight: vec3<f32>,\r
    @location(1) fragPos: vec3<f32>,\r
    @location(2) normal: vec3<f32>,\r
    @location(3) uv: vec2<f32>,\r
    @location(4) color: vec4f,\r
    @location(5) emissive : f32,\r
    @interpolate(flat)\r
    @location(6) triangle_index : u32,\r
}\r
\r
struct FragmentInput {\r
  @location(0) posFromLight: vec3<f32>,\r
  @location(1) fragPos: vec3<f32>,\r
  @location(2) normal: vec3<f32>,\r
  @location(3) uv: vec2<f32>,\r
  @location(4) color: vec4f,\r
  @location(5) emissive : f32,\r
  @interpolate(flat)\r
  @location(6) triangle_index : u32,\r
}\r
\r
struct FragmentOutput {\r
  @location(0) color: vec4<f32>,\r
}\r
\r
@vertex\r
fn main_vert(in: VertexInput) -> VertexOutput {\r
    var out: VertexOutput;\r
    let modelTransform: mat4x4<f32> = instances[in.index].modelTransform;\r
    let posFromCamera: vec4<f32> = scene.cameraViewProjection * modelTransform * vec4<f32>(in.position, 1.0);\r
    let posFromLight: vec4<f32> = scene.lightViewProjection * modelTransform * vec4<f32>(in.position, 1.0);\r
    let fragPos: vec4<f32> = modelTransform * vec4<f32>(in.position, 1.0); // very important mat4x4*vec4 != vec4*mat4x4\r
\r
    out.Position = posFromCamera;\r
    out.posFromLight = posFromLight.xyz;\r
    out.fragPos = fragPos.xyz;\r
    out.normal = in.normal;\r
    out.uv = in.uv;\r
    out.color = in.color;\r
    out.emissive = in.emissive;\r
    out.triangle_index = u32(in.triangle_index + 0.5);\r
\r
    return out;\r
}`,yT=`\r
// bindings added in rasterizer.js\r
\r
const ShadowMap = false;\r
\r
@fragment\r
fn main_frag(in: FragmentInput) -> FragmentOutput {\r
    var out: FragmentOutput; // 返回值\r
\r
    // -- 1\r
    // 灯光角度对着色的影响不明显，是因为加上ambient之后颜色值大于1了\r
    var ambient = 0.6;\r
    var diffuse: f32 = max(dot(normalize(scene.lightPos.xyz), in.normal), 0.0);\r
    var lightFactor = f32(0);\r
    if(ShadowMap){\r
        let shadow: f32 = getShadow(in.posFromLight, shadowmap, shadowSampler);\r
        lightFactor = min(ambient + shadow * diffuse, 1.0);   \r
    }else{\r
        lightFactor = min(ambient + diffuse, 1.0);\r
    }\r
    out.color = vec4<f32>(in.color.xyz * lightFactor, in.color.w);\r
\r
    // -- 2\r
    // out.color = vec4<f32>(in.color.xyz, in.color.w);\r
    \r
    return out;\r
}`,xT=`\r
// bindings added in rasterizer.js\r
\r
const Tonemap = true;\r
const TonemapExposure = 0.5;\r
const Gamma = 2.2;\r
\r
fn reinhard_tonemap(linearColor: vec3f) -> vec3f {\r
  let color = linearColor * TonemapExposure;\r
  let mapped = color / (1+color);\r
  return pow(mapped, vec3f(1 / Gamma));\r
}\r
\r
@fragment\r
fn main_frag(in: FragmentInput) -> FragmentOutput {\r
    var lightColor: vec3<f32> = vec3<f32>(1.0, 1.0, 1.0);\r
    var out: FragmentOutput; // 返回值\r
    let triangle = transform(triangles[in.triangle_index]);\r
    var uv = interpolateUV(in.fragPos, triangle, vec2f(0,0), vec2f(1,0), vec2f(1,1));\r
    var color = textureSample(lightmap, textureSampler, uv, in.triangle_index) + vec4f(in.color * in.emissive, 1);\r
    // var color = vec4f(0,0,0,1);\r
    // let a = textureSample(lightmap, textureSampler, in.uv, in.triangle_index-1);\r
    // let b = textureSample(lightmap, textureSampler, in.uv, in.triangle_index);\r
    // let c = textureSample(lightmap, textureSampler, in.uv, in.triangle_index+1);\r
    \r
    // if(in.triangle_index % 2 == 0){\r
    //     color = max(b, c) + vec4f(in.color * in.emissive, 1);\r
    // }else{\r
    //     color = max(a, b) + vec4f(in.color * in.emissive, 1);\r
    // }\r
    if(Tonemap){\r
        out.color = vec4<f32>(reinhard_tonemap(color.rgb), 1);\r
    }else{\r
        out.color = vec4<f32>(color.rgb, 1);\r
    }\r
    return out;\r
}`,bT=`@vertex\r
fn main(\r
  @builtin(instance_index) index : u32,\r
  @location(0) position: vec3<f32>\r
) -> @builtin(position) vec4<f32> {\r
  var modelTransform: mat4x4<f32> = instances[index].modelTransform;\r
  var posFromLight: vec4<f32> = scene.lightViewProjection * modelTransform * vec4<f32>(position, 1.0);\r
  return posFromLight;\r
}`;class wT{constructor({device:e,scene:n,common:r}={}){this.device=e,this.scene=n,this.common=r,this.init()}async init(){this.texture=this.device.createTexture({label:"shadow",size:[8192,8192,1],format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),this.pipeline=await this.device.createRenderPipelineAsync({label:"shadow",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.common.bindGroupLayout]}),vertex:{module:this.device.createShaderModule({code:this.common.shader+bT}),entryPoint:"main",buffers:this.scene.vertexBufferLayout},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"},primitive:{topology:"triangle-list",cullMode:"none"}})}runPass(e){const n=e.beginRenderPass({colorAttachments:[],depthStencilAttachment:{view:this.texture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});n.setPipeline(this.pipeline),n.setBindGroup(0,this.common.bindGroup),this.scene.instances.forEach((r,s)=>{n.setVertexBuffer(0,r.vertexBuffer),n.setIndexBuffer(r.indexBuffer,"uint32"),n.drawIndexed(r.mesh.triangles.length*3,1,0,0,s)}),n.end()}}const ST=`@group(1) @binding(0) var<uniform> uniforms : Uniforms;\r
@group(1) @binding(1) var<storage, read_write> accumulation : array<atomic<u32>>;\r
@group(1) @binding(2) var lightmap : texture_storage_2d_array<rgba16float, write>;\r
\r
struct Uniforms {\r
    accumulation_to_lightmap_scale :  f32,\r
    accumulation_buffer_scale :       f32,\r
    light_width :                     f32,\r
    light_height :                    f32,\r
    light_center :                    vec3<f32>,\r
}\r
// ---- overridable constants 大小写都可以，常量一般大写\r
override WorkgroupSizeX :              u32;        // -- 每个工作组发射的光子数量            256\r
override PhotonEnergy :                f32;        // -- 单个光子能添加到纹素缓冲区的最大值  100000\r
\r
const Bounce = 2;                                           // -- 反弹次数\r
const Absorbtion = 0.3;                                     // -- 每个光子反弹时吸收的光量\r
\r
struct ComputeInput {\r
    @builtin(global_invocation_id) invocation_id : vec3u,\r
    @builtin(workgroup_id)         workgroup_id  : vec3u\r
}\r
\r
// 辐射度计算着色器。每个调用从光源创建一个光子，并将反弹光照累积到“累积”缓冲区中。\r
@compute @workgroup_size(WorkgroupSizeX, 1, 1)\r
fn radiosity(in: ComputeInput) {\r
    init_rand(in.invocation_id);             // 初始化随机数生成器\r
    photon();\r
}\r
\r
fn photon() {\r
  var ray = new_light_ray();                  // 随机创建一条光线\r
  var light_color = vec3<f32>(1, 0.8, 0.6);   // 光子颜色\r
  var color = PhotonEnergy * light_color;     // 光子初始化能量值. 100000\r
\r
  // 光线弹射\r
  for (var i = 0; i < (Bounce + 1); i++) {\r
    let hit = raytrace(ray);                  // 找到最近的三角面\r
    let triangle = transform(triangles[hit.index]);\r
    let N = normalize(cross(triangle.b - triangle.a, triangle.c - triangle.a));\r
    ray.start = hit.pos + N * 1e-5; // 1e-5 科学计数法为0.00001\r
    ray.dir = normalize(reflect(ray.dir, N) + rand_sphere(vec3(0, 0, 0), 1) * 0.75);\r
    color *= triangle.color;\r
    accumulate(hit.uv, hit.index, color * Absorbtion);\r
    color *= 1 - Absorbtion;\r
  }\r
}\r
\r
fn new_light_ray() -> Ray {\r
    let center = uniforms.light_center;\r
    let pos = center + vec3<f32>(\r
        uniforms.light_width * (rand() - 0.5),\r
        0,\r
        uniforms.light_height * (rand() - 0.5)\r
    );\r
    let dir = rand_hemisphere(vec2(0, 0), 1, vec3(0, -1, 0));\r
    return Ray(pos, dir);\r
}\r
\r
fn raytrace(\r
    ray : Ray,\r
) -> Hit {\r
    var hit = Hit();\r
    hit.dist = 1e20;\r
    hit.index = kNoHit; // triangle index\r
    for (var i = 0u; i < arrayLength(&triangles); i++) {\r
        hit = intersect_ray_triangle(ray, i, hit);\r
    }\r
    return hit;\r
}\r
\r
fn intersect_ray_triangle(\r
    r : Ray, \r
    index : u32, // triangle index \r
    closest : Hit\r
) -> Hit {\r
    let triangle = transform(triangles[index]);\r
    let N = normalize(cross(triangle.b - triangle.a, triangle.c - triangle.a));\r
    let p = Plane(triangle.a, N);\r
    let plane_dist = distFromPlane(r.start, p);\r
    if(plane_dist > 0){\r
        let unit_dist = dot(r.dir, -N);\r
        if(unit_dist > 0){\r
            let ray_dist = plane_dist / unit_dist;\r
            if(ray_dist > 0 && ray_dist < closest.dist){\r
                let pos = intersect(r, p);\r
                let inside = insideTriangle(pos, triangle);\r
                if(inside){\r
                    var uv = interpolateUV(pos, triangle, vec2f(0,0), vec2f(1,0), vec2f(1,1));\r
                    return Hit(ray_dist, index, pos, uv);\r
                }\r
            }\r
        }\r
    }\r
    return closest;\r
}\r
\r
// 在'uv'和'triangle'的位置，使用'color'对'accumulation'缓冲区执行原子加法（atomicAdd()）操作。\r
fn accumulate(\r
    uv : vec2<f32>, \r
    index : u32,     // triangle index\r
    color : vec3<f32>\r
) {\r
    let dims = textureDimensions(lightmap); // 纹理的宽高，尺寸\r
    let texel_coords = vec2<u32>(uv * vec2<f32>(dims));\r
    let base_idx = texelIndex(lightmap, texel_coords, index);\r
    // if(texel_coords.x == texel_coords.y){\r
    //     for (var i = 1u; i <= texel_coords.x; i++) {\r
    //         let jesus = texelIndex(lightmap, vec2<u32>(i, texel_coords.y), index);\r
    //         atomicAdd(&accumulation[jesus + 0], u32(color.r + 0.5));\r
    //         atomicAdd(&accumulation[jesus + 1], u32(color.g + 0.5));\r
    //         atomicAdd(&accumulation[jesus + 2], u32(color.b + 0.5));\r
    //     }\r
    // }else{\r
        atomicAdd(&accumulation[base_idx + 0], u32(color.r + 0.5));\r
        atomicAdd(&accumulation[base_idx + 1], u32(color.g + 0.5));\r
        atomicAdd(&accumulation[base_idx + 2], u32(color.b + 0.5));\r
    // }\r
}`,TT=`@group(1) @binding(0) var<uniform> uniforms : Uniforms;\r
@group(1) @binding(1) var<storage, read_write> accumulation : array<atomic<u32>>;\r
@group(1) @binding(2) var lightmap : texture_storage_2d_array<rgba16float, write>;\r
\r
struct Uniforms {\r
    accumulation_to_lightmap_scale :  f32,\r
    accumulation_buffer_scale :       f32,\r
}\r
// ---- overridable constants 大小写都可以，常量一般大写\r
override WorkgroupSizeX : u32;        // -- workgroupSize2X\r
override WorkgroupSizeY : u32;        // -- workgroupSize2X\r
\r
const Bounce = 4;                                           // -- 反弹次数\r
const Absorbtion = 0.3;                                     // -- 每个光子反弹时吸收的光量\r
\r
struct ComputeInput {\r
    @builtin(global_invocation_id) invocation_id : vec3u,\r
    @builtin(workgroup_id)         workgroup_id  : vec3u\r
}\r
\r
// 用于将 'accumulation' 中的 atomic<u32> 数据复制到'lightmap' 的计算着色器。为了减少整数溢出，'accumulation' 可能也进行了缩放。\r
@compute @workgroup_size(WorkgroupSizeX, WorkgroupSizeY, 1)\r
fn accumulation_to_lightmap(in: ComputeInput) {\r
    let dims = textureDimensions(lightmap);\r
    let index = in.workgroup_id.z; // The workgroup 'z' value holds the triangle index.\r
    let texel_coords = in.invocation_id.xy;\r
    if (all(texel_coords < dims)) {\r
        // Load the color value out of 'accumulation'\r
        let base_idx = texelIndex(lightmap, texel_coords, index);\r
        let color = vec3(\r
            f32(atomicLoad(&accumulation[base_idx + 0])),\r
            f32(atomicLoad(&accumulation[base_idx + 1])),\r
            f32(atomicLoad(&accumulation[base_idx + 2]))\r
        );\r
\r
        // Multiply the color by 'uniforms.accumulation_to_lightmap_scale' and write it to\r
        // the lightmap.\r
        var scale = 1f;\r
        if(index > 11){\r
            scale = 100 / 4.5;\r
        }\r
        if(texel_coords.x == texel_coords.y){\r
            textureStore(lightmap, texel_coords, index, vec4(color * uniforms.accumulation_to_lightmap_scale * f32(scale) * 2, 1));\r
        }else{\r
            textureStore(lightmap, texel_coords, index, vec4(color * uniforms.accumulation_to_lightmap_scale * f32(scale), 1));\r
        }\r
        // textureStore(lightmap, texel_coords, index, vec4(color * uniforms.accumulation_to_lightmap_scale * f32(scale), 1));\r
        // If the 'accumulation' buffer is nearing saturation, then\r
        // 'uniforms.accumulation_buffer_scale' will be less than 1, scaling the values\r
        // to something less likely to overflow the u32.\r
        if (uniforms.accumulation_buffer_scale != 1.0) {\r
            let scaled = color * uniforms.accumulation_buffer_scale + 0.5;\r
            atomicStore(&accumulation[base_idx + 0], u32(scaled.r));\r
            atomicStore(&accumulation[base_idx + 1], u32(scaled.g));\r
            atomicStore(&accumulation[base_idx + 2], u32(scaled.b));\r
        }\r
    }\r
}`;class Yf{constructor({device:e,label:n,bindGroupLayouts:r,code:s,entryPoint:a,constants:u,workgroups:l}={}){this.constants=u,this.workgroups=l,this.pipeline=e.createComputePipeline({label:n,layout:e.createPipelineLayout({bindGroupLayouts:r}),compute:{module:e.createShaderModule({code:s}),entryPoint:a,constants:u}})}attachPassEncoder(e){e.setPipeline(this.pipeline),e.dispatchWorkgroups(...this.workgroups)}}class ET{constructor({device:e,scene:n,common:r}={}){this.device=e,this.scene=n,this.common=r,this.lightmapFormat="rgba16float",this.lightmapSize=[256,256],this.lightmapTexels=this.lightmapSize[0]*this.lightmapSize[1]*this.scene.triangles.length,this.accumulationToLightmapWorkgroupSize=[16,16],this.uniformBuffer=this.device.createBuffer({label:"uniformBuffer",size:8*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.texelBuffer=this.device.createBuffer({label:"texelBuffer",size:this.lightmapTexels*4*4,usage:GPUBufferUsage.STORAGE}),We.print("texelBuffer",this.texelBuffer.size),this.lightmap=this.device.createTexture({label:"lightmap",size:{width:this.lightmapSize[0],height:this.lightmapSize[1],depthOrArrayLayers:this.scene.triangles.length},format:this.lightmapFormat,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING}),this.bindGroupLayout=this.device.createBindGroupLayout({label:"bindGroupLayout",entries:[{buffer:{type:"uniform"}},{buffer:{type:"storage"}},{storageTexture:{access:"write-only",format:this.lightmapFormat,viewDimension:"2d-array"}}].map((a,u)=>(a.binding=u,a.visibility=GPUShaderStage.COMPUTE,a))}),this.bindGroup=this.device.createBindGroup({label:"bindGroup",layout:this.bindGroupLayout,entries:[{resource:{buffer:this.uniformBuffer}},{resource:{buffer:this.texelBuffer}},{resource:this.lightmap.createView()}].map((a,u)=>(a.binding=u,a))});const s=[this.common.bindGroupLayout,this.bindGroupLayout];this.computePipelines=[new Yf({device:this.device,label:"radiosity",bindGroupLayouts:s,code:this.common.shader+ST,entryPoint:"radiosity",constants:{WorkgroupSizeX:256,PhotonEnergy:1e3},workgroups:[1024,1,1]}),new Yf({device:this.device,label:"accumulationToLightmapPipeline",bindGroupLayouts:s,code:this.common.shader+TT,entryPoint:"accumulation_to_lightmap",constants:{WorkgroupSizeX:this.accumulationToLightmapWorkgroupSize[0],WorkgroupSizeY:this.accumulationToLightmapWorkgroupSize[1]},workgroups:[Math.ceil(this.lightmapSize[0]/this.accumulationToLightmapWorkgroupSize[0]),Math.ceil(this.lightmapSize[1]/this.accumulationToLightmapWorkgroupSize[1]),this.scene.triangles.length]})]}runPass(e){this.device.queue.writeBuffer(this.uniformBuffer,0*4,new Float32Array([this.getLightmapScale()])),this.device.queue.writeBuffer(this.uniformBuffer,1*4,new Float32Array([this.getTexelBufferScale()])),this.device.queue.writeBuffer(this.uniformBuffer,2*4,new Float32Array([this.scene.lightWidth,this.scene.lightHeight])),this.device.queue.writeBuffer(this.uniformBuffer,4*4,new Float32Array(this.scene.lightCenter));const n=e.beginComputePass();n.setBindGroup(0,this.common.bindGroup),n.setBindGroup(1,this.bindGroup),this.computePipelines.forEach(r=>{r.attachPassEncoder(n)}),n.end()}getLightmapScale(){this.mean??(this.mean=0);const e=this.computePipelines[0],n=e.constants,r=n.PhotonEnergy,s=n.WorkgroupSizeX,u=e.workgroups[0]*s;return this.mean+=u*r/this.lightmapTexels,1/this.mean}getTexelBufferScale(){const n=this.mean>572662306?.5:1;return this.mean*=n,n}createMappedBuffer({size:e=0,usage:n=GPUBufferUsage.VERTEX,source:r,typedArray:s=Float32Array}={}){const a=this.device.createBuffer({size:e,usage:n,mappedAtCreation:!0});return new s(a.getMappedRange()).set(r),a.unmap(),a}}class OT{constructor({device:e,canvas:n,scene:r,common:s,format:a,context:u}={}){this.device=e,this.canvas=n,this.scene=r,this.common=s,this.format=a,this.context=u,this.multisample=!0}async init(){if(this.depthBuffer=this.device.createTexture({label:"depthBuffer",size:[this.canvas.width,this.canvas.height],format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:this.multisample?4:1}),this.frameBuffer=this.device.createTexture({label:"frameBuffer",size:[this.canvas.width,this.canvas.height],format:this.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,sampleCount:this.multisample?4:1}),this.scene.lightingModel=="Blinn-Phong"){this.shadowMapper=new wT(this),await this.shadowMapper.init(),this.bindGroupLayoutEntries=[{binding:0,texture:{sampleType:"depth"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE},{binding:1,sampler:{type:"comparison"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE}],this.bindGroupEntries=[{binding:0,resource:this.shadowMapper.texture.createView()},{binding:1,resource:this.device.createSampler({compare:"less"})}];const e=`
@group(1) @binding(0) var shadowmap: texture_depth_2d;
@group(1) @binding(1) var shadowSampler: sampler_comparison;`;this.shaderCode=this.common.shader+e+Xf+yT}if(this.scene.lightingModel=="Ray-Tracing"){this.radiosity=new ET(this),this.bindGroupLayoutEntries=[{binding:0,sampler:{type:"filtering"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE},{binding:1,texture:{viewDimension:"2d-array"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE}],this.bindGroupEntries=[{binding:0,resource:this.device.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"linear",minFilter:"linear"})},{binding:1,resource:this.radiosity.lightmap.createView()}];const e=`
@group(1) @binding(0) var textureSampler: sampler;
@group(1) @binding(1) var lightmap: texture_2d_array<f32>;`;this.shaderCode=this.common.shader+e+Xf+xT}this.bindGroupLayout=this.device.createBindGroupLayout({label:"rasterizer",entries:this.bindGroupLayoutEntries}),this.bindGroup=this.device.createBindGroup({label:"rasterizer",layout:this.bindGroupLayout,entries:this.bindGroupEntries}),this.pipeline=await this.device.createRenderPipelineAsync({label:"solid",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.common.bindGroupLayout,this.bindGroupLayout]}),vertex:{module:this.device.createShaderModule({code:this.shaderCode}),entryPoint:"main_vert",buffers:this.scene.vertexBufferLayout},fragment:{module:this.device.createShaderModule({code:this.shaderCode}),entryPoint:"main_frag",targets:[{format:this.format,writeMask:GPUColorWrite.ALL}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},primitive:{topology:this.scene.topology,frontFace:this.scene.frontFace,cullMode:this.scene.cullMode},multisample:{count:this.multisample?4:1}}),this.pipelineAlpha=await this.device.createRenderPipelineAsync({label:"alpha",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.common.bindGroupLayout,this.bindGroupLayout]}),vertex:{module:this.device.createShaderModule({code:this.shaderCode}),entryPoint:"main_vert",buffers:this.scene.vertexBufferLayout},fragment:{module:this.device.createShaderModule({code:this.shaderCode}),entryPoint:"main_frag",targets:[{format:this.format,writeMask:GPUColorWrite.ALL,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},depthStencil:{depthWriteEnabled:!1,depthCompare:"less",format:"depth24plus-stencil8"},primitive:{topology:this.scene.topology,frontFace:this.scene.frontFace,cullMode:this.scene.cullMode},multisample:{count:this.multisample?4:1}}),this.resize({width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio}),window.onresize=()=>{this.resize({width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio})}}runPass(e,n){this.scene.lightingModel=="Blinn-Phong"&&this.shadowMapper.runPass(e),this.scene.lightingModel=="Ray-Tracing"&&this.radiosity.runPass(e);const r=e.beginRenderPass({colorAttachments:[{view:this.multisample?this.frameBuffer.createView():this.context.getCurrentTexture().createView(),resolveTarget:this.multisample?this.context.getCurrentTexture().createView():void 0,clearValue:We.colorFormat(this.scene.bgColor),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthBuffer.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:0,stencilLoadOp:"clear",stencilStoreOp:"store"}});r.setBindGroup(0,this.common.bindGroup),r.setBindGroup(1,this.bindGroup),r.setPipeline(this.pipeline);let s=this.scene.instances.filter(u=>u.color[3]==1),a=this.scene.instances.filter(u=>u.color[3]!=1);s.forEach((u,l)=>{r.setVertexBuffer(0,u.vertexBuffer),r.setIndexBuffer(u.indexBuffer,"uint32"),r.drawIndexed(u.mesh.triangles.length*3,1,0,0,l)}),r.setPipeline(this.pipelineAlpha),a.forEach((u,l)=>{l+=s.length,r.setVertexBuffer(0,u.vertexBuffer),r.setIndexBuffer(u.indexBuffer,"uint32"),r.drawIndexed(u.mesh.triangles.length*3,1,0,0,l)}),r.end()}resize({width:e,height:n}={}){this.canvas.width=e,this.canvas.height=n,this.frameBuffer=this.resizeTexture(this.frameBuffer,[e,n]),this.depthBuffer=this.resizeTexture(this.depthBuffer,[e,n])}resizeTexture(e,n){e.destroy();const r=Object.assign(e,{size:n});return this.device.createTexture(r)}}class Qr{constructor({duration:e=1e3,repeat:n=!1,delay:r=0,bezier:s=f=>f,startTime:a=null,action:u=f=>{},onFinish:l=()=>{}}={}){this.duration=e,this.bezier=s,this.repeat=n,this.startTime=a,this.action=u,this.onFinish=l,r!=null&&(r===0?this.start():this.timeout=setTimeout(()=>{this.start()},r))}start(e=performance.now()){if(!this.startTime)this.startTime=e;else{let n=this.passTime=e-this.startTime;if(n-this.duration<1e3/60){let r=n/this.duration;r>1&&(r=1),this.action(this.bezier(r))}else if(n-this.duration>=1e3/60&&this.repeat){let r=n/this.duration;this.action(this.bezier(r%1))}if(Math.abs(n-this.duration)<=1e3/60&&!this.repeat){this.endTime=e,this.action(this.bezier(1)),this.onFinish&&this.onFinish.call(this);return}}this.animationFrameId=requestAnimationFrame(this.start.bind(this))}stop(){this.timeout&&clearTimeout(this.timeout),this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId)}}var jr=Math.PI,fs=Math.pow,hs=Math.sin,bs={swing:function(t){return-Math.cos(t*jr)/2+.5},easeNone:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return(2-t)*t},easeBoth:function(t){return(t*=2)<1?.5*t*t:.5*(1- --t*(t-2))},easeInStrong:function(t){return t*t*t*t},easeOutStrong:function(t){return 1- --t*t*t*t},easeBothStrong:function(t){return(t*=2)<1?.5*t*t*t*t:.5*(2-(t-=2)*t*t*t)},elasticIn:function(t){var e=.3,n=e/4;return t===0||t===1?t:-(fs(2,10*(t-=1))*hs((t-n)*(2*jr)/e))},elasticOut:function(t){var e=.3,n=e/4;return t===0||t===1?t:fs(2,-10*t)*hs((t-n)*(2*jr)/e)+1},elasticBoth:function(t){var e=.45,n=e/4;return t===0||t===1?t:t<1?-.5*(fs(2,10*(t-=1))*hs((t-n)*(2*jr)/e)):fs(2,-10*(t-=1))*hs((t-n)*(2*jr)/e)*.5+1},backIn:function(t){if(t===1)return t;var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},backBoth:function(t){var e=1.70158;return(t*=2)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},bounceIn:function(t){return 1-bs.bounceOut(1-t)},bounceOut:function(t){var e=7.5625,n;return t<1/2.75?n=e*t*t:t<2/2.75?n=e*(t-=1.5/2.75)*t+.75:t<2.5/2.75?n=e*(t-=2.25/2.75)*t+.9375:n=e*(t-=2.625/2.75)*t+.984375,n},bounceBoth:function(t){return t<.5?bs.bounceIn(t*2)*.5:bs.bounceOut(t*2-1)*.5+.5},shine:function(t){return t<=.5?(t=2*t,t*t):(t=2*(1-t),t*t)},linear:function(t){return t}};class CT{constructor({ele:e,scene:n,smooth:r={enabled:!0,duration:500,friction:.05},mouseEventEnabled:s=!0,mouseButtonsMap:a={1:"rotate",4:"move",2:"rotateCenter"},keyboardEventEnabled:u=!0,keyMap:l={moveForward:"w",moveBackward:"s",moveLeft:"a",moveRight:"d",dive:"q",float:"e",turnUp:"arrowup",turnDown:"arrowdown",turnLeft:"arrowleft",turnRight:"arrowright",speedUp:"shift",reset:"r"},touchEventEnabled:f=!0,touchMap:h="move",wheelEventEnabled:p=!0,rotateSpeed:g=.1,rotateAround:v=[0,0,0],beforeRotate:y,moveSpeed:w=.01,moveCoords:T=["right","horizonFront"],beforeMove:S,wheelSpeed:O=.2,scaleType:C="percent",beforeScale:F,free:U=!1}={}){this.ele=e,this.free=U,this.smooth=r,this.rotateSpeed=g,this.moveSpeed=w,this.wheelSpeed=O,this.rotateAround=v,this.moveCoords=T,this.scaleType=C,this.keyMap=l,this.mouseButtonsMap=a,this.touchMap=h,this.beforeRotate=y,this.beforeMove=S,this.beforeScale=F,this.originalEye=n.getEye(),this.originalCenter=n.getCenter(),this.active=!0,this.keys=[],this.keysLog=[],this.moves=[],this.movesLog=[],this.getEye=n.getEye.bind(n),this.setEye=n.setEye.bind(n),this.getCenter=n.getCenter.bind(n),this.setCenter=n.setCenter.bind(n),s&&(this.ele.addEventListener("mousedown",this.mousedownListener.bind(this),{passive:!1}),this.ele.addEventListener("mousemove",this.mousemoveListener.bind(this),{passive:!1}),this.ele.addEventListener("mouseup",this.mouseupListener.bind(this),{passive:!1})),f&&(this.ele.addEventListener("touchstart",this.touchstartListener.bind(this),{passive:!1}),this.ele.addEventListener("touchend",this.touchendListener.bind(this),{passive:!1}),this.ele.addEventListener("touchmove",this.touchmoveListener.bind(this),{passive:!1})),p&&this.ele.addEventListener("wheel",this.wheelListener.bind(this)),u&&(window.addEventListener("keydown",this.keydownListener.bind(this),{passive:!1}),window.addEventListener("keyup",this.keyupListener.bind(this),{passive:!1})),document.oncontextmenu=()=>!1,this.frame()}touchstartListener(e){this.active&&(this.touchEvent=e,e.preventDefault())}touchendListener(e){this.active&&(this.touchEvent=e,e.preventDefault())}touchmoveListener(e){if(this.active&&this.touchEvent){if(e.touches.length===1){const n=e.touches[0],r=this.touchEvent.touches[0],s=n.clientX-r.clientX,a=n.clientY-r.clientY;switch(this.touchMap){case"rotateEye":this.rotate({x:s,y:a,around:"center",smooth:this.smooth.enabled});break;case"rotateCenter":this.rotate({x:s,y:a,around:"eye",smooth:this.smooth.enabled});break;case"rotate":this.rotate({x:s,y:a,around:this.rotateAround,smooth:this.smooth.enabled});break;case"move":this.move({x:s,y:a,coords:this.moveCoords,speed:5});break}this.touchEvent=e}if(e.touches.length===2){const n=u=>{let l=u.touches[0],f=u.touches[1];return Math.hypot(l.clientX-f.clientX,l.clientY-f.clientY)},r=u=>{let l=u.touches[0],f=u.touches[1];return Math.atan2(f.clientY-l.clientY,f.clientX-l.clientX)};let s=n(this.touchEvent)/n(e);this.scale(s);let a=Ho(r(this.touchEvent)-r(e));this.rotate({x:a/this.rotateSpeed,y:0,around:"center",smooth:this.smooth.enabled})}this.touchEvent=e,e.preventDefault()}}mousedownListener(e){this.active&&(this.move({clear:!0}),this.rotate({clear:!0}),this.moves=[],this.movesLog=[],this.mouseEvent=e,e.preventDefault())}mouseupListener(e){this.active&&(this.moves=[],this.mouseEvent=null,e.preventDefault())}mousemoveListener(e){if(!this.active||!this.mouseEvent)return;let n=e.clientX-this.mouseEvent.clientX,r=e.clientY-this.mouseEvent.clientY,s=this.mouseButtonsMap[e.buttons];this.moves.push({x:n,y:r,action:s}),this.mouseEvent=e,e.preventDefault()}wheelListener(e){this.active&&e.buttons===0&&(this.wheelEvent=e)}keydownListener(e){this.active&&this.addKey(e.key)}keyupListener(e){this.active&&this.removeKey(e.key)}addKey(e,n=!0){this.keys.findIndex(s=>s===e.toLowerCase())<0&&(this.keys.push(e.toLowerCase()),n&&this.keysLog.push(e.toLowerCase()))}removeKey(e){let n=this.keys.findIndex(r=>r===e.toLowerCase());n>=0&&this.keys.splice(n,1)}removeKeyLog(e){let n=this.keysLog.findIndex(r=>r===e.toLowerCase());n>=0&&this.keysLog.splice(n,1)}hasKey(e){return this.keys.indexOf(e.toLowerCase())>=0}hasKeyLog(e){return this.keysLog.indexOf(e.toLowerCase())>=0}frame(){if(this.moves.length>0){this.movesLog=new Array(...this.moves);let e=-this.movesLog.reduce((s,a)=>s+a.x,0),n=this.movesLog.reduce((s,a)=>s+a.y,0);switch(this.movesLog.at(-1).action){case"rotateEye":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:"center"});break;case"rotateCenter":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:"eye"});break;case"rotate":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:this.rotateAround});break;case"move":this.move({x:e*this.moveSpeed,y:n*this.moveSpeed,coords:this.moveCoords});break}this.moves=[]}else if(this.movesLog.length>0&&!this.mouseEvent){let e=-this.movesLog.reduce((s,a)=>s+a.x,0),n=this.movesLog.reduce((s,a)=>s+a.y,0);switch(this.movesLog.at(-1).action){case"rotateEye":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:"center",smooth:this.smooth.enabled});break;case"rotateCenter":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:"eye",smooth:this.smooth.enabled});break;case"rotate":this.rotate({x:ve(e)*this.rotateSpeed,y:ve(n)*this.rotateSpeed,around:this.rotateAround,smooth:this.smooth.enabled});break;case"move":this.move({x:e*this.moveSpeed,y:n*this.moveSpeed,coords:this.moveCoords,smooth:!0});break}this.movesLog=[]}this.wheelEvent&&(this.scaleSmoothAnim?this.lastWheelEvent&&this.wheelEvent.deltaY!==this.lastWheelEvent.deltaY&&(this.scaleSmoothAnim.stop(),this.scaleSmoothAnim=null):this.scaleInertiaAnim?(this.scaleInertiaAnim.stop(),this.scaleInertiaAnim=null,this.scale({value:this.wheelSpeed*Math.sign(this.wheelEvent.deltaY),type:this.scaleType,smooth:!0,inertia:!0})):this.scale({value:this.wheelSpeed*Math.sign(this.wheelEvent.deltaY),type:this.scaleType,smooth:!0,inertia:!0}),this.lastWheelEvent=this.wheelEvent,this.wheelEvent=null),this.hasKey(this.keyMap.speedUp)?this.speedUpEnabled||(this.speedUpEnabled=!0,this.moveSpeed*=2):(this.removeKeyLog(this.keyMap.speedUp),this.speedUpEnabled&&(this.speedUpEnabled=!1,this.moveSpeed/=2)),this.hasKey(this.keyMap.reset)?this.setView():this.removeKeyLog(this.keyMap.reset),this.hasKey(this.keyMap.moveForward)?this.move({x:0,y:25*this.moveSpeed,coords:this.free?["right","ray"]:["right","horizonFront"],clear:!0}):this.hasKeyLog(this.keyMap.moveForward)&&(this.removeKeyLog(this.keyMap.moveForward),this.move({x:0,y:25*this.moveSpeed,coords:this.free?["right","ray"]:["right","horizonFront"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.moveBackward)?this.move({x:0,y:-25*this.moveSpeed,coords:this.free?["right","ray"]:["right","horizonFront"],clear:!0}):this.hasKeyLog(this.keyMap.moveBackward)&&(this.removeKeyLog(this.keyMap.moveBackward),this.move({x:0,y:-25*this.moveSpeed,coords:this.free?["right","ray"]:["right","horizonFront"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.moveLeft)?this.move({x:-25*this.moveSpeed,y:0,coords:this.free?["right","ray"]:["right","horizonFront"],clear:!0}):this.hasKeyLog(this.keyMap.moveLeft)&&(this.removeKeyLog(this.keyMap.moveLeft),this.move({x:-25*this.moveSpeed,y:0,coords:this.free?["right","ray"]:["right","horizonFront"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.moveRight)?this.move({x:25*this.moveSpeed,y:0,coords:this.free?["right","ray"]:["right","horizonFront"],clear:!0}):this.hasKeyLog(this.keyMap.moveRight)&&(this.removeKeyLog(this.keyMap.moveRight),this.move({x:25*this.moveSpeed,y:0,coords:this.free?["right","ray"]:["right","horizonFront"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.float)?this.move({x:0,y:25*this.moveSpeed,coords:["right","up"],clear:!0}):this.hasKeyLog(this.keyMap.float)&&(this.removeKeyLog(this.keyMap.float),this.move({x:0,y:25*this.moveSpeed,coords:["right","up"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.dive)?this.move({x:0,y:-25*this.moveSpeed,coords:["right","up"],clear:!0}):this.hasKeyLog(this.keyMap.dive)&&(this.removeKeyLog(this.keyMap.dive),this.move({x:0,y:-25*this.moveSpeed,coords:["right","up"],smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.turnUp)?this.rotate({x:0,y:ve(-25)*this.rotateSpeed,around:"eye",clear:!0}):this.hasKeyLog(this.keyMap.turnUp)&&(this.removeKeyLog(this.keyMap.turnUp),this.rotate({x:0,y:ve(-25)*this.rotateSpeed,around:"eye",smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.turnDown)?this.rotate({x:0,y:ve(25)*this.rotateSpeed,around:"eye",clear:!0}):this.hasKeyLog(this.keyMap.turnDown)&&(this.removeKeyLog(this.keyMap.turnDown),this.rotate({x:0,y:ve(25)*this.rotateSpeed,around:"eye",smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.turnLeft)?this.rotate({x:ve(-25)*this.rotateSpeed,y:0,around:"eye",clear:!0}):this.hasKeyLog(this.keyMap.turnLeft)&&(this.removeKeyLog(this.keyMap.turnLeft),this.rotate({x:ve(-25)*this.rotateSpeed,y:0,around:"eye",smooth:this.smooth.enabled,clear:!0})),this.hasKey(this.keyMap.turnRight)?this.rotate({x:ve(25)*this.rotateSpeed,y:0,around:"eye",clear:!0}):this.hasKeyLog(this.keyMap.turnRight)&&(this.removeKeyLog(this.keyMap.turnRight),this.rotate({x:ve(25)*this.rotateSpeed,y:0,around:"eye",smooth:this.smooth.enabled,clear:!0})),requestAnimationFrame(this.frame.bind(this))}limitRotation(e,n){let r=n-Math.PI;return e>=n?e=n>ve(.1)?n-ve(.1):0:e<=r&&(e=r<-ve(.1)?r+ve(.1):0),e}rotate({eye:e=this.getEye(),center:n=this.getCenter(),x:r=0,y:s=0,around:a,speed:u=1,smooth:l=!1,clear:f=!1,smoothOnly:h=!1}={}){return new Promise(p=>{if(f&&this.rotateSmoothAnim&&(this.rotateSmoothAnim.stop(),this.rotateSmoothAnim=null),!h&&(r||s)){a==="center"?a=n:a==="eye"&&(a=e);let g=[0,1,0],v=W.sub(e,n),y=W.cross(v,g),w=Me.fromRotation(g,r*u),T=Me.fromRotation(y,this.limitRotation(s*u,W.angle(v,g))),S=Me.multiply(w,T),O=W.sub(e,a),C=W.sub(n,a);O=W.transformMat4(O,S),C=W.transformMat4(C,S),v=W.sub(O,C);let F=W.angle(v,g);if(F===0||F===Math.PI)return;if(e=W.add(a,O),n=W.add(a,C),this.isFunction(this.beforeRotate)){let U=this.beforeRotate(e,n);if(this.isObject(U)){const{eye:_,center:z}=U;this.setEye(_),this.setCenter(z)}}else this.setEye(e),this.setCenter(n)}if(l){const g=16.666666666666668,v=r/g,y=s/g,w=Math.hypot(v,y),T=this.smooth.duration??w/(this.smooth.friction/1e3),S=-v/T,O=-y/T;this.rotateSmoothAnim=new Qr({duration:T,bezier:C=>C,action:C=>{const F=T*C;this.rotate({eye:e,center:n,x:v*F+.5*S*F*F,y:y*F+.5*O*F*F,speed:u,around:a})},onFinish:()=>{p()}})}})}move({eye:e=this.getEye(),center:n=this.getCenter(),x:r,y:s,coords:a,smooth:u=!1,clear:l=!1,smoothOnly:f=!1}={}){return new Promise(h=>{if(l&&this.moveSmoothAnim&&(this.moveSmoothAnim.stop(),this.moveSmoothAnim=null),!f&&(r||s)&&a){let p=W.sub(e,n),g=[0,1,0],v=W.angle(p,g),y=W.scale(this.getDirection(a[0]),r),w=W.scale(this.getDirection(a[1]),v<=Math.PI/2?s:-s),T=W.add(y,w);if(e=W.add(e,T),n=W.add(n,T),this.isFunction(this.beforeMove)){let S=this.beforeMove(e,n);if(this.isObject(S)){const{eye:O,center:C}=S;this.setEye(O),this.setCenter(C)}}else this.setEye(e),this.setCenter(n)}if(u){const p=16.666666666666668,g=r/p,v=s/p,y=Math.hypot(g,v),w=this.smooth.duration??y/(this.smooth.friction/1e3),T=-g/w,S=-v/w;this.moveSmoothAnim=new Qr({duration:w,bezier:O=>O,action:O=>{let C=w*O;this.move({eye:e,center:n,x:g*C+.5*T*C*C,y:v*C+.5*S*C*C,coords:a})},onFinish:()=>{h()}})}})}scale({eye:e=this.getEye(),center:n=this.getCenter(),value:r=0,type:s="percent",smooth:a=!1,duration:u=250,bezier:l=h=>h,inertia:f=!1}={}){if(a)this.scaleSmoothAnim=new Qr({duration:u,bezier:l,action:h=>{this.scale({eye:e,center:n,value:r*h,type:s})},onFinish:()=>{if(this.scaleSmoothAnim=null,f){const h=this.getEye(),p=this.getCenter(),g=r/250,v=500,y=-g/v;this.scaleInertiaAnim=new Qr({duration:v,bezier:w=>w,action:w=>{let T=v*w;this.scale({eye:h,center:p,value:g*T+.5*y*T*T,type:this.scaleType})},onFinish:()=>{this.scaleInertiaAnim=null}})}}});else{let h=W.sub(e,n),p=W.len(h),g=s==="percent"?r+1:r/p+1;if(g<=0)return;if(e=W.scaleAndAdd(n,h,g),this.isFunction(this.beforeScale)){let v=this.beforeScale(e,n);if(this.isObject(v)){const{eye:y,center:w}=v;this.setEye(y)}}else this.setEye(e)}}activate(){this.active=!0}deactive(){this.active=!1}setView({eye:e=this.originalEye,center:n=this.originalCenter,duration:r=100,bezier:s=bs.easeOut}={}){if(this.viewChanging)return;this.viewChanging=!0;let a=this.getEye(),u=this.getCenter();new Qr({duration:r,bezier:s,action:l=>{Array.isArray(e)&&this.setEye(e.map((f,h)=>ws(a[h],f,l))),Array.isArray(n)&&this.setCenter(n.map((f,h)=>ws(u[h],f,l)))},onFinish:()=>{this.viewChanging=!1}})}isObject(e){return e==null?!1:typeof e=="object"&&e instanceof Object}isFunction(e){return e==null?!1:typeof e=="function"}isString(e){return e==null?!1:typeof e=="string"}isFloat32Array(e){return e==null?!1:e instanceof Float32Array}getDirection(e){let n=e;if(this.isString(e))switch(e){case"up":n=this.getUp();break;case"down":n=this.getDown();break;case"view":n=this.getView();break;case"ray":n=this.getRay();break;case"left":n=this.getLeft();break;case"right":n=this.getRight();break;case"cameraUp":n=this.getCameraUp();break;case"cameraDown":n=this.getCameraDown();break;case"horizonFront":n=this.getHorizonFront();break;case"horizonBack":n=this.getHorizonBack();break}return W.normalize(n)}getUp(){return[0,1,0]}getDown(){return[0,-1,0]}getView(){const e=this.getEye(),n=this.getCenter();return W.sub(e,n)}getRay(){const e=this.getEye(),n=this.getCenter();return W.sub(n,e)}getLeft(){let e=this.getView(),n=W.create(0,1,0);return W.cross(e,n)}getRight(){let e=this.getView(),n=W.create(0,1,0);return W.cross(n,e)}getCameraUp(){let e=this.getView(),n=this.getLeft();return W.cross(n,e)}getCameraDown(){let e=this.getView(),n=this.getLeft();return W.cross(e,n)}getHorizonFront(){let e=this.getLeft(),n=[0,1,0];return W.cross(e,n)}getHorizonBack(){let e=this.getLeft(),n=[0,1,0];return W.cross(n,e)}}const FT=`\r
// bindings added in rasterizer.js\r
\r
struct Scene {\r
    cameraViewProjection: mat4x4<f32>,\r
}\r
\r
struct Instance {\r
    modelTransform: mat4x4<f32>\r
}\r
\r
struct VertexInput {\r
    @builtin(instance_index) index: u32,\r
    @location(0) position : vec3f,\r
    @location(1) normal : vec3f,\r
    @location(2) uv : vec2f,\r
    @location(3) color : vec3f,\r
    @location(4) emissive : f32,\r
    @location(5) triangle_index : f32,\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) Position: vec4<f32>,\r
    @location(0) color: vec3<f32>\r
}\r
\r
struct FragmentInput {\r
  @location(0) color: vec3<f32>,\r
}\r
\r
struct FragmentOutput {\r
  @location(0) color: vec4<f32>,\r
}\r
\r
@vertex\r
fn main_vert(in: VertexInput) -> VertexOutput {\r
    var out: VertexOutput;\r
    let modelTransform: mat4x4<f32> = instances[in.index].modelTransform;\r
    let posFromCamera: vec4<f32> = scene.cameraViewProjection * modelTransform * vec4<f32>(in.position, 1.0);\r
\r
    out.Position = posFromCamera;\r
    out.color = in.color;\r
\r
    return out;\r
}\r
\r
@fragment\r
fn main_frag(in: FragmentInput) -> FragmentOutput {\r
    var out: FragmentOutput;\r
    \r
    out.color = vec4<f32>(in.color, 1);\r
    return out;\r
}`;class AT{constructor({device:e,scene:n,common:r,canvas:s,format:a,context:u}={}){this.device=e,this.scene=n,this.common=r,this.format=a,this.canvas=s,this.context=u,this.multisample=!0}async init(){this.instances=[{name:"x",position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],color:[1,.2,.2],mesh:{positions:[[0,0,0],[1,0,0]],primitives:[[0,1]]}},{name:"y",position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],color:[0,1,0],mesh:{positions:[[0,0,0],[0,1,0]],primitives:[[0,1]]}},{name:"z",position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],color:[0,.5,1],mesh:{positions:[[0,0,0],[0,0,1]],primitives:[[0,1]]}}],this.uniformBuffer=this.device.createBuffer({size:4*4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.instanceBuffer=this.device.createBuffer({label:"instance",size:4*4*4*this.instances.length,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.vertexBufferLayout=[{arrayStride:13*4,attributes:[{shaderLocation:0,offset:0*4,format:"float32x3"},{shaderLocation:1,offset:3*4,format:"float32x3"},{shaderLocation:2,offset:6*4,format:"float32x2"},{shaderLocation:3,offset:8*4,format:"float32x3"},{shaderLocation:4,offset:11*4,format:"float32"},{shaderLocation:5,offset:12*4,format:"float32"}]}],this.instances.forEach(a=>{const{color:u,mesh:l}=a,{positions:f,primitives:h}=l,p=new Float32Array(h.map(v=>v.map(y=>[...f[y],0,0,0,0,0,...u,1,0]).flat()).flat()),g=new Uint32Array(h.map((v,y)=>[y*2,y*2+1]).flat());a.vertexBuffer=this.createMappedBuffer({size:p.byteLength,usage:GPUBufferUsage.VERTEX,source:p,typedArray:Float32Array}),a.indexBuffer=this.createMappedBuffer({size:g.byteLength,usage:GPUBufferUsage.INDEX,source:g,typedArray:Uint32Array})});const e=[{binding:0,buffer:{type:"uniform"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT},{binding:1,buffer:{type:"read-only-storage"},visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}],n=[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.instanceBuffer}}];this.bindGroupLayout=this.device.createBindGroupLayout({entries:e}),this.bindGroup=this.device.createBindGroup({layout:this.bindGroupLayout,entries:n});const s=`
@group(0) @binding(0) var<uniform> scene: Scene;
@group(0) @binding(1) var<storage> instances: array<Instance>;`+FT;this.pipeline=await this.device.createRenderPipelineAsync({layout:this.device.createPipelineLayout({bindGroupLayouts:[this.bindGroupLayout]}),vertex:{module:this.device.createShaderModule({code:s}),entryPoint:"main_vert",buffers:this.vertexBufferLayout},fragment:{module:this.device.createShaderModule({code:s}),entryPoint:"main_frag",targets:[{format:this.format}]},primitive:{topology:"line-list"},multisample:{count:this.multisample?4:1}})}writeBuffer(){const e=We.getCameraViewProjectionMatrix({aspect:this.canvas.width/this.canvas.height,eye:W.sub(this.scene.eye,this.scene.center),center:[0,0,0],up:this.scene.up,fovy:1,near:.1,far:1e5});this.device.queue.writeBuffer(this.uniformBuffer,0,e),this.device.queue.writeBuffer(this.instanceBuffer,0,this.instances.reduce((n,r,s)=>{r.position=this.invertRasterizeByOffset({canvas:this.canvas,eye:this.scene.eye,center:this.scene.center,up:this.scene.up,viewProjection:e,x:this.canvas.width/2-60,y:this.canvas.height/2-60});let a=W.sub(this.scene.eye,this.scene.center),u=W.length(a)/this.canvas.height/120*30;return r.scale=[u,u,u],n.set(We.getModelTransformMatrix(r),s*16),n},new Float32Array(this.instanceBuffer.size/4)))}invertRasterizeByOffset({canvas:e,eye:n,center:r,up:s=[0,1,0],viewProjection:a,x:u,y:l}={}){n=W.create(n),r=W.create(r),s=W.create(s);let f=W.sub(n,r),h=W.scale(f,.5),p=W.normalize(W.cross(s,f)),g=Math.atan(l/u),v=Me.fromRotation(f,g),y=W.transformMat4(p,v),w=W.add(h,y),T=W.transformMat4(w,a),S=Math.abs(u)/(e.width/2)/T[0];return Math.abs(l)/(e.height/2)/T[0],y=W.scale(y,S),w=W.add(h,y),w}runPass(e,n){this.writeBuffer();const r=e.beginRenderPass({colorAttachments:[{view:this.multisample?n:this.context.getCurrentTexture().createView(),resolveTarget:this.multisample?this.context.getCurrentTexture().createView():void 0,clearValue:[0,0,0,1],loadOp:"load",storeOp:"store"}]});r.setPipeline(this.pipeline),r.setBindGroup(0,this.bindGroup),this.instances.forEach((s,a)=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.mesh.primitives.length*2,1,0,0,a)}),r.end()}createMappedBuffer({size:e=0,usage:n=GPUBufferUsage.VERTEX,source:r,typedArray:s=Float32Array}={}){const a=this.device.createBuffer({size:e,usage:n,mappedAtCreation:!0});return new s(a.getMappedRange()).set(r),a.unmap(),a}}const RT=`
@vertex
fn main(
  @builtin(vertex_index) VertexIndex : u32
) -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 6>(
    vec2(0.5, 0.5),
    vec2(-0.5, 0.5),
    vec2(-0.5, -0.5),
    vec2(0.5, 0.5),
    vec2(-0.5, -0.5),
    vec2(0.5, -0.5)
  );

  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);
}`,LT=`
@fragment
fn main() -> @location(0) vec4<f32> {
  return vec4(1.0, 0.0, 0.0, 0.5);
}`;class _T{constructor({device:e,scene:n,common:r,canvas:s,format:a,context:u}={}){this.device=e,this.scene=n,this.common=r,this.format=a,this.canvas=s,this.context=u,this.multisample=!0,this.init()}init(){this.pipeline=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.device.createShaderModule({code:RT}),entryPoint:"main"},fragment:{module:this.device.createShaderModule({code:LT}),entryPoint:"main",targets:[{format:this.format,writeMask:GPUColorWrite.ALL,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"},multisample:{count:this.multisample?4:1}})}runPass(e,n){const r=e.beginRenderPass({colorAttachments:[{view:this.multisample?n:this.context.getCurrentTexture().createView(),resolveTarget:this.multisample?this.context.getCurrentTexture().createView():void 0,loadOp:"load",storeOp:"store"}]});r.setPipeline(this.pipeline),r.draw(6,1,0,0),r.end()}}class UT{constructor(){this.init()}async init(){const e=window.WEBGPU=await Ny("myCanvas");Object.assign(this,e),this.scene=new Ux(this),this.common=new mT(this),await this.common.init(),this.ViewController=new CT({scene:this.scene,ele:this.canvas}),this.rasterizer=new OT(this),await this.rasterizer.init(),this.coordinate=new AT(this),await this.coordinate.init(),this.triangle=new _T(this),this.test=new dT(this),await this.test.init(),requestAnimationFrame(this.render.bind(this))}render(e){const n=this.device.createCommandEncoder();this.common.update(e),this.rasterizer.runPass(n,e),this.coordinate.runPass(n,this.rasterizer.frameBuffer.createView()),this.test.runPass(n,this.rasterizer.frameBuffer.createView());const r=n.finish();this.device.queue.submit([r]),requestAnimationFrame(this.render.bind(this))}}window.app=new UT});export default kT();
//# sourceMappingURL=index-y8zIw5PA.js.map
